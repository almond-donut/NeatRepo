Can you help me debug this code?

app\api\analyze\route.ts:
<code>
import { type NextRequest, NextResponse } from "next/server"
import { geminiAI } from "@/lib/gemini"

export async function POST(request: NextRequest) {
  try {
    const { repository, userProfile } = await request.json()

    if (!repository) {
      return NextResponse.json({ error: "Repository data is required" }, { status: 400 })
    }

    // Analyze repository using Gemini AI
    const analysis = await geminiAI.analyzeRepository(repository, userProfile)

    return NextResponse.json({
      success: true,
      analysis,
    })
  } catch (error) {
    console.error("Analysis error:", error)
    return NextResponse.json({ error: "Failed to analyze repository" }, { status: 500 })
  }
}

</code>

app\api\auth\callback\route.ts:
<code>
import { createServerClient, type CookieOptions } from '@supabase/ssr'
import { NextResponse, type NextRequest } from 'next/server'

export async function GET(request: NextRequest) {
  console.log('üöÄ AUTH CALLBACK: Starting OAuth callback processing')

  const { searchParams, origin } = new URL(request.url)
  const code = searchParams.get('code')
  // if "next" is in param, use it as the redirect URL
  let next = searchParams.get('next') ?? '/dashboard'
  if (!next.startsWith('/')) {
    // if "next" is not a relative URL, use the default
    next = '/dashboard'
  }

  console.log('üîç AUTH CALLBACK: Received params:', {
    hasCode: !!code,
    next,
    origin
  })

  if (code) {
    const supabase = createServerClient(
      process.env.NEXT_PUBLIC_SUPABASE_URL!,
      process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
      {
        cookies: {
          get(name: string) {
            return request.cookies.get(name)?.value
          },
          set(name: string, value: string, options: CookieOptions) {
            // This will be handled by the redirect response
          },
          remove(name: string, options: CookieOptions) {
            // This will be handled by the redirect response
          },
        },
      }
    )

    // Use the same Supabase client to both exchange the code and write the
      // resulting session cookies to the outbound response. Because the
      // cookies.set handler writes to `response`, the auth helper will
      // automatically persist the session for the browser.
      const response = NextResponse.redirect(`${origin}${next}`)
      const supabaseWithResponse = createServerClient(
        process.env.NEXT_PUBLIC_SUPABASE_URL!,
        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
        {
          cookies: {
            get(name: string) {
              return request.cookies.get(name)?.value
            },
            set(name: string, value: string, options: CookieOptions) {
              response.cookies.set({ name, value, ...options })
            },
            remove(name: string, options: CookieOptions) {
              response.cookies.set({ name, value: '', ...options })
            }
          }
        }
      )

      console.log('üîÑ AUTH CALLBACK: Exchanging code for session (and setting cookies)...')
      const { error: exchangeError } = await supabaseWithResponse.auth.exchangeCodeForSession(code)

      if (exchangeError) {
        console.error('‚ùå AUTH CALLBACK: Error exchanging code for session:', exchangeError)
        return NextResponse.redirect(`${origin}/auth/error?error=${encodeURIComponent(exchangeError.message)}`)
      }

      console.log('‚úÖ AUTH CALLBACK: Session cookies set ‚Äì redirecting user')
      return response
    console.log('üîç AUTH CALLBACK: Environment check:', {
      supabaseUrl: process.env.NEXT_PUBLIC_SUPABASE_URL?.substring(0, 30) + '...',
      hasAnonKey: !!process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,
      nodeEnv: process.env.NODE_ENV,
      origin,
      next
    })

    const { data, error } = await supabase.auth.exchangeCodeForSession(code)

    console.log('üîç AUTH CALLBACK: Exchange result:', {
      hasData: !!data,
      hasSession: !!data?.session,
      hasUser: !!data?.user,
      error: error ? {
        message: error.message,
        status: error.status,
        name: error.name
      } : null
    })

    if (!error && data?.session) {
      console.log('‚úÖ AUTH CALLBACK: Successfully exchanged code for session')
      console.log('üîç AUTH CALLBACK: Session details:', {
        userId: data.user?.id,
        email: data.user?.email,
        provider: data.user?.app_metadata?.provider,
        hasProviderToken: !!data.session.provider_token
      })

      // Create response with proper cookie handling
      const forwardedHost = request.headers.get('x-forwarded-host')
      const isLocalEnv = process.env.NODE_ENV === 'development'

      let redirectUrl: string
      if (isLocalEnv) {
        redirectUrl = `${origin}${next}`
      } else if (forwardedHost) {
        redirectUrl = `https://${forwardedHost}${next}`
      } else {
        redirectUrl = `${origin}${next}`
      }

      console.log('üîÑ AUTH CALLBACK: Redirecting to:', redirectUrl)

      // Create response with proper session cookies
      const response = NextResponse.redirect(redirectUrl)

      // Ensure session cookies are properly set
      const sessionCookies = [
        'sb-ldfjlbxbnmxdryhuyfmd-auth-token',
        'sb-ldfjlbxbnmxdryhuyfmd-auth-token.0',
        'sb-ldfjlbxbnmxdryhuyfmd-auth-token.1'
      ]

      // Set session cookies from the established session
      if (data.session) {
        try {
          // Force cookie setting through supabase client
          const cookieClient = createServerClient(
            process.env.NEXT_PUBLIC_SUPABASE_URL!,
            process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
            {
              cookies: {
                get(name: string) {
                  return request.cookies.get(name)?.value
                },
                set(name: string, value: string, options: CookieOptions) {
                  response.cookies.set({ name, value, ...options })
                },
                remove(name: string, options: CookieOptions) {
                  response.cookies.set({ name, value: '', ...options })
                },
              },
            }
          )

          // Trigger cookie setting by calling getSession
          await cookieClient.auth.getSession()
          console.log('‚úÖ AUTH CALLBACK: Session cookies set in response')
        } catch (cookieError) {
          console.error('‚ö†Ô∏è AUTH CALLBACK: Cookie setting error:', cookieError)
        }
      }

      return response
    } else {
      console.error('‚ùå AUTH CALLBACK: Error exchanging code for session:', error)
      console.error('‚ùå AUTH CALLBACK: Full error details:', {
        error,
        hasData: !!data,
        dataKeys: data ? Object.keys(data) : null
      })
      return NextResponse.redirect(`${origin}/auth/error?error=${encodeURIComponent(error?.message || 'session_exchange_failed')}`)
    }

  }

  // Handle case where no authorization code is provided
  console.log('‚ùå AUTH CALLBACK: No authorization code provided')
  return NextResponse.redirect(`${origin}/auth/error?error=no_code_provided`)
}

</code>

app\api\bug-report\route.ts:
<code>
import { NextRequest, NextResponse } from 'next/server'
import nodemailer from 'nodemailer'
import { createClient } from '@supabase/supabase-js'

// Initialize Supabase client
const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL!,
  process.env.SUPABASE_SERVICE_ROLE_KEY || process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
)

export async function POST(request: NextRequest) {
  try {
    const formData = await request.formData()
    
    // Extract form fields
    const userEmail = formData.get('userEmail') as string
    const bugTitle = formData.get('bugTitle') as string
    const bugDescription = formData.get('bugDescription') as string
    const stepsToReproduce = formData.get('stepsToReproduce') as string
    const expectedBehavior = formData.get('expectedBehavior') as string
    const actualBehavior = formData.get('actualBehavior') as string
    const browserInfo = formData.get('browserInfo') as string
    const additionalInfo = formData.get('additionalInfo') as string
    const timestamp = formData.get('timestamp') as string
    const url = formData.get('url') as string
    const referrer = formData.get('referrer') as string

    // Extract and upload screenshots to Supabase
    const screenshotUrls: string[] = []
    const attachments: { filename: string; content: Buffer; cid: string }[] = []
    for (const [key, value] of formData.entries()) {
      if (key.startsWith('screenshot_') && value instanceof File) {
        try {
          const fileExt = value.name.split('.').pop()
          const fileName = `bug-reports/${Date.now()}-${Math.random().toString(36).substring(2)}.${fileExt}`

          const { data, error } = await supabase.storage
            .from('bug-reports') // Using dedicated bug-reports bucket
            .upload(fileName, value, {
              contentType: value.type,
              upsert: false
            })

          if (error) {
            console.error('Error uploading screenshot:', error)
            // Continue without this screenshot rather than failing completely
          } else {
            // Get public URL
            const { data: { publicUrl } } = supabase.storage
              .from('bug-reports')
              .getPublicUrl(fileName)

            screenshotUrls.push(publicUrl)

            // Prepare inline attachment for email (download from uploaded File)
            const arrayBuffer = await value.arrayBuffer()
            attachments.push({
              filename: value.name,
              content: Buffer.from(arrayBuffer),
              cid: `screenshot-${attachments.length}`
            })
          }
        } catch (uploadError) {
          console.error('Screenshot upload error:', uploadError)
          // Continue without this screenshot
        }
      }
    }

    // Validate required fields
    if (!userEmail || !bugTitle || !bugDescription) {
      return NextResponse.json(
        { error: 'Missing required fields' },
        { status: 400 }
      )
    }

    // Determine if SMTP email service is configured
    const emailServiceAvailable = !!process.env.SMTP_USER && !!process.env.SMTP_PASS;
    console.log('üìß Email service available:', emailServiceAvailable, {
      hasUser: !!process.env.SMTP_USER,
      hasPass: !!process.env.SMTP_PASS
    });

    // Create email transporter only if service is available
    const transporter = emailServiceAvailable
      ? nodemailer.createTransport({
          service: 'gmail',
          auth: {
            user: process.env.SMTP_USER,
            pass: process.env.SMTP_PASS
          }
        })
      : null;

    // Format email content (plain text for fallback)
    const textContent = `
üêõ NEW BUG REPORT - NeatRepo

üìß Reporter Email: ${userEmail}
üïí Timestamp: ${new Date(timestamp).toLocaleString('id-ID', { timeZone: 'Asia/Jakarta' })}
üåê URL: ${url}
üîó Referrer: ${referrer || 'Direct access'}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

üìã BUG TITLE:
${bugTitle}

üìù DETAILED DESCRIPTION:
${bugDescription}

${stepsToReproduce ? `üîÑ STEPS TO REPRODUCE:
${stepsToReproduce}

` : ''}${expectedBehavior ? `‚úÖ EXPECTED BEHAVIOR:
${expectedBehavior}

` : ''}${actualBehavior ? `‚ùå ACTUAL BEHAVIOR:
${actualBehavior}

` : ''}üåê BROWSER INFO:
${browserInfo}

${additionalInfo ? `‚ÑπÔ∏è ADDITIONAL INFO:
${additionalInfo}

` : ''}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

üì∏ Screenshots: ${screenshotUrls.length} file(s) uploaded to Supabase
${screenshotUrls.length > 0 ? `
üîó Screenshot URLs:
${screenshotUrls.map((url, index) => `${index + 1}. ${url}`).join('\n')}
` : ''}
üîß Auto-generated by NeatRepo Bug Report System
    `

    // HTML version with inline images
    const htmlContent = `
      <h2>üêõ NEW BUG REPORT - NeatRepo</h2>
      <p><strong>Reporter Email:</strong> ${userEmail}<br/>
      <strong>Timestamp:</strong> ${new Date(timestamp).toLocaleString('id-ID', { timeZone: 'Asia/Jakarta' })}<br/>
      <strong>URL:</strong> <a href="${url}">${url}</a><br/>
      <strong>Referrer:</strong> ${referrer || 'Direct access'}</p>
      <hr/>
      <h3>üìã BUG TITLE</h3>
      <p>${bugTitle}</p>
      <h3>üìù DETAILED DESCRIPTION</h3>
      <p>${bugDescription.replace(/\n/g,'<br/>')}</p>
      ${stepsToReproduce ? `<h3>üîÑ STEPS TO REPRODUCE</h3><p>${stepsToReproduce.replace(/\n/g,'<br/>')}</p>` : ''}
      ${expectedBehavior ? `<h3>‚úÖ EXPECTED BEHAVIOR</h3><p>${expectedBehavior.replace(/\n/g,'<br/>')}</p>` : ''}
      ${actualBehavior ? `<h3>‚ùå ACTUAL BEHAVIOR</h3><p>${actualBehavior.replace(/\n/g,'<br/>')}</p>` : ''}
      <h3>üåê BROWSER INFO</h3>
      <p>${browserInfo}</p>
      ${additionalInfo ? `<h3>‚ÑπÔ∏è ADDITIONAL INFO</h3><p>${additionalInfo.replace(/\n/g,'<br/>')}</p>` : ''}
      <hr/>
      <h3>üì∏ Screenshots (${attachments.length})</h3>
      ${attachments.map((att, idx) => `<p><img src="cid:${att.cid}" style="max-width:100%;border:1px solid #ccc" alt="screenshot ${idx+1}"/></p>`).join('')}
      <p>üîß Auto-generated by NeatRepo Bug Report System</p>
    `;

    // Send email if service is available
    if (emailServiceAvailable && transporter) {
      try {
        console.log('üìß Attempting to send email to:', 'prada.202201006@student.stikomyos.ac.id');
        await transporter.sendMail({
          from: process.env.SMTP_USER!,
          to: 'prada.202201006@student.stikomyos.ac.id',
          replyTo: userEmail,
          subject: `üêõ Bug Report: ${bugTitle} - NeatRepo`,
          text: textContent,
          html: htmlContent,
          attachments
          // No attachments needed since screenshots are in Supabase with URLs
        });
        console.log('‚úÖ Email sent successfully!');
      } catch (emailError) {
        console.error('‚ùå Email sending failed:', emailError);
        // Don't fail the whole request if email fails
      }
    } else {
      console.log('üì≠ Email service not configured ‚Äì bug report stored with screenshots in Supabase.')
    }

    return NextResponse.json({ 
      success: true, 
      message: 'Bug report sent successfully' 
    })

  } catch (error) {
    console.error('Error sending bug report:', error)
    return NextResponse.json(
      { error: 'Failed to send bug report' },
      { status: 500 }
    )
  }
}

</code>

app\api\session\route.ts:
<code>
import { type NextRequest, NextResponse } from "next/server"

export async function GET(request: NextRequest) {
  try {
    const sessionCookie = request.cookies.get("github_session")

    if (!sessionCookie) {
      return NextResponse.json({ error: "No session found" }, { status: 401 })
    }

    const sessionData = JSON.parse(sessionCookie.value)

    // Verify session is still valid (not expired)
    const authenticatedAt = new Date(sessionData.authenticated_at)
    const now = new Date()
    const daysSinceAuth = (now.getTime() - authenticatedAt.getTime()) / (1000 * 60 * 60 * 24)

    if (daysSinceAuth > 7) {
      // Session expired
      return NextResponse.json({ error: "Session expired" }, { status: 401 })
    }

    // Remove sensitive data before sending to client
    const { access_token, ...safeSessionData } = sessionData

    return NextResponse.json(safeSessionData)
  } catch (error) {
    console.error("Session fetch error:", error)
    return NextResponse.json({ error: "Invalid session" }, { status: 401 })
  }
}

export async function DELETE(request: NextRequest) {
  try {
    const response = NextResponse.json({ success: true })

    // Clear the session cookie
    response.cookies.set("github_session", "", {
      httpOnly: true,
      secure: process.env.NODE_ENV === "production",
      sameSite: "lax",
      maxAge: 0, // Expire immediately
    })

    return response
  } catch (error) {
    console.error("Session delete error:", error)
    return NextResponse.json({ error: "Failed to sign out" }, { status: 500 })
  }
}

</code>

app\auth\error\page.tsx:
<code>
"use client"

import { useSearchParams, useRouter } from 'next/navigation'
import { useEffect, useState } from 'react'
import { Button } from '@/components/ui/button'
import { AlertCircle, Home, RefreshCw } from 'lucide-react'

export default function AuthErrorPage() {
  const searchParams = useSearchParams()
  const router = useRouter()
  const [error, setError] = useState<string>('')

  useEffect(() => {
    const errorParam = searchParams.get('error')
    setError(errorParam || 'Unknown authentication error')
  }, [searchParams])

  const handleRetry = () => {
    // User must manually navigate to retry authentication
    console.log('üîÑ AUTH ERROR: User requested retry - manual navigation required')
    // Show message to user about manual navigation
    alert('Please manually navigate to the homepage to retry authentication.')
  }

  const handleGoHome = () => {
    // User must manually navigate to homepage
    console.log('üè† AUTH ERROR: User requested home - manual navigation required')
    // Show message to user about manual navigation
    alert('Please manually navigate to the homepage.')
  }

  return (
    <div className="min-h-screen flex items-center justify-center bg-background">
      <div className="max-w-md w-full mx-4">
        <div className="text-center space-y-6">
          {/* Error Icon */}
          <div className="flex justify-center">
            <div className="rounded-full bg-destructive/10 p-3">
              <AlertCircle className="h-8 w-8 text-destructive" />
            </div>
          </div>

          {/* Error Title */}
          <div className="space-y-2">
            <h1 className="text-2xl font-bold tracking-tight">
              Authentication Error
            </h1>
            <p className="text-muted-foreground">
              We encountered an issue while trying to sign you in.
            </p>
          </div>

          {/* Error Details */}
          <div className="bg-muted/50 rounded-lg p-4">
            <p className="text-sm text-muted-foreground">
              <strong>Error:</strong> {error}
            </p>
          </div>

          {/* Action Buttons */}
          <div className="space-y-3">
            <Button
              onClick={handleRetry}
              className="w-full"
              size="lg"
            >
              <RefreshCw className="mr-2 h-4 w-4" />
              Manual Retry Required
            </Button>

            <Button
              onClick={handleGoHome}
              variant="outline"
              className="w-full"
              size="lg"
            >
              <Home className="mr-2 h-4 w-4" />
              Manual Navigation Required
            </Button>
          </div>

          {/* Manual Navigation Notice */}
          <div className="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4">
            <p className="text-sm text-yellow-800 dark:text-yellow-200">
              <strong>Note:</strong> Automatic redirects have been disabled. You must manually navigate to your desired page.
            </p>
          </div>

          {/* Help Text */}
          <div className="text-sm text-muted-foreground space-y-2">
            <p>If this problem persists, please try:</p>
            <ul className="text-left space-y-1 ml-4">
              <li>‚Ä¢ Clearing your browser cache and cookies</li>
              <li>‚Ä¢ Using an incognito/private browsing window</li>
              <li>‚Ä¢ Checking your GitHub account permissions</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  )
}

</code>

app\bug-report\page.tsx:
<code>
'use client'

// Force dynamic rendering to avoid static generation issues with auth
export const dynamic = 'force-dynamic'

import React, { useState, useEffect } from 'react'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Textarea } from '@/components/ui/textarea'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Label } from '@/components/ui/label'
import { Upload, Send, ArrowLeft, Bug, Camera, AlertCircle, Mail, Github } from 'lucide-react'
import { useRouter } from 'next/navigation'
import { Alert, AlertDescription } from '@/components/ui/alert'
import { useAuth } from '@/components/auth-provider'
import AuthForms from '@/components/auth-forms'

export default function BugReportPage() {
  const router = useRouter()
  const { user, loading } = useAuth()
  const [showAuthForms, setShowAuthForms] = useState(false)
  const [formData, setFormData] = useState({
    userEmail: '',
    bugTitle: '',
    bugDescription: '',
    stepsToReproduce: '',
    expectedBehavior: '',
    actualBehavior: '',
    browserInfo: '',
    additionalInfo: ''
  })
  const [screenshots, setScreenshots] = useState<File[]>([])
  const [isSubmitting, setIsSubmitting] = useState(false)
  const [submitStatus, setSubmitStatus] = useState<'idle' | 'success' | 'error'>('idle')
  const [authError, setAuthError] = useState<string | null>(null)

  // Auto-detect browser info and handle user email
  useEffect(() => {
    const browserInfo = `${navigator.userAgent} | Screen: ${screen.width}x${screen.height} | Viewport: ${window.innerWidth}x${window.innerHeight}`
    setFormData(prev => ({ ...prev, browserInfo }))
  }, [])

  // Handle user authentication and email detection
  useEffect(() => {
    if (user) {
      // Check if user has email (email login) or only OAuth
      if (user.email && !user.email.includes('github')) {
        // User logged in with email - use that email
        setFormData(prev => ({ ...prev, userEmail: user.email || '' }))
        setAuthError(null)
      } else {
        // User logged in with GitHub OAuth - need email login
        setAuthError('Please sign in with your email account to submit bug reports')
      }
    }
  }, [user])

  const handleInputChange = (field: string, value: string) => {
    setFormData(prev => ({ ...prev, [field]: value }))
  }

  const handleScreenshotUpload = (event: React.ChangeEvent<HTMLInputElement>) => {
    const files = Array.from(event.target.files || [])
    setScreenshots(prev => [...prev, ...files].slice(0, 5)) // Max 5 screenshots
  }

  const removeScreenshot = (index: number) => {
    setScreenshots(prev => prev.filter((_, i) => i !== index))
  }

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setIsSubmitting(true)
    setSubmitStatus('idle')

    try {
      const formDataToSend = new FormData()
      
      // Add form fields
      Object.entries(formData).forEach(([key, value]) => {
        formDataToSend.append(key, value)
      })
      
      // Add screenshots
      screenshots.forEach((file, index) => {
        formDataToSend.append(`screenshot_${index}`, file)
      })
      
      // Add timestamp and additional metadata
      formDataToSend.append('timestamp', new Date().toISOString())
      formDataToSend.append('url', window.location.href)
      formDataToSend.append('referrer', document.referrer)

      const response = await fetch('/api/bug-report', {
        method: 'POST',
        body: formDataToSend
      })

      if (response.ok) {
        setSubmitStatus('success')
        // Reset form after successful submission
        setTimeout(() => {
          router.push('/dashboard')
        }, 3000)
      } else {
        throw new Error('Failed to submit bug report')
      }
    } catch (error) {
      console.error('Error submitting bug report:', error)
      setSubmitStatus('error')
    } finally {
      setIsSubmitting(false)
    }
  }

  // Show auth forms modal if needed
  if (showAuthForms) {
    return <AuthForms onClose={() => setShowAuthForms(false)} />
  }

  // Show OAuth user needs email login
  if (authError && user) {
    return (
      <div className="min-h-screen bg-background flex items-center justify-center p-4">
        <Card className="w-full max-w-md">
          <CardContent className="pt-6 text-center">
            <div className="w-16 h-16 bg-blue-100 dark:bg-blue-900/20 rounded-full flex items-center justify-center mx-auto mb-4">
              <Mail className="w-8 h-8 text-blue-600 dark:text-blue-400" />
            </div>
            <h2 className="text-xl font-semibold mb-2">Email Account Required</h2>
            <p className="text-muted-foreground mb-4">
              To submit bug reports, please sign in with your email account instead of GitHub OAuth.
            </p>
            <div className="flex items-center justify-center gap-2 mb-4 text-sm text-muted-foreground">
              <Github className="w-4 h-4" />
              <span>Currently signed in with GitHub</span>
            </div>
            <div className="space-y-3">
              <Button
                onClick={() => setShowAuthForms(true)}
                className="w-full"
              >
                <Mail className="w-4 h-4 mr-2" />
                Sign In with Email
              </Button>
              <Button
                variant="outline"
                onClick={() => router.push('/dashboard')}
                className="w-full"
              >
                Back to Dashboard
              </Button>
            </div>
          </CardContent>
        </Card>
      </div>
    )
  }

  if (submitStatus === 'success') {
    return (
      <div className="min-h-screen bg-background flex items-center justify-center p-4">
        <Card className="w-full max-w-md">
          <CardContent className="pt-6 text-center">
            <div className="w-16 h-16 bg-green-100 dark:bg-green-900/20 rounded-full flex items-center justify-center mx-auto mb-4">
              <Send className="w-8 h-8 text-green-600 dark:text-green-400" />
            </div>
            <h2 className="text-xl font-semibold mb-2">Bug Report Sent!</h2>
            <p className="text-muted-foreground mb-4">
              Thank you for helping us improve NeatRepo. We'll review your report and get back to you if needed.
            </p>
            <p className="text-sm text-muted-foreground">
              You can now manually navigate to your desired page.
            </p>
          </CardContent>
        </Card>
      </div>
    )
  }

  return (
    <div className="min-h-screen bg-background">
      <div className="container mx-auto px-4 py-8 max-w-4xl">
        {/* Header */}
        <div className="flex items-center gap-4 mb-8">
          <Button
            variant="ghost"
            size="sm"
            onClick={() => router.back()}
            className="flex items-center gap-2"
          >
            <ArrowLeft className="w-4 h-4" />
            Back
          </Button>
          <div className="flex items-center gap-3">
            <div className="w-10 h-10 bg-red-100 dark:bg-red-900/20 rounded-lg flex items-center justify-center">
              <Bug className="w-5 h-5 text-red-600 dark:text-red-400" />
            </div>
            <div>
              <h1 className="text-2xl font-bold">Report a Bug</h1>
              <p className="text-muted-foreground">Help us improve NeatRepo by reporting issues</p>
            </div>
          </div>
        </div>

        {submitStatus === 'error' && (
          <Alert variant="destructive" className="mb-6">
            <AlertCircle className="h-4 w-4" />
            <AlertDescription>
              Failed to submit bug report. Please try again or contact support directly.
            </AlertDescription>
          </Alert>
        )}

        <form onSubmit={handleSubmit} className="space-y-6">
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
            {/* Left Column */}
            <div className="space-y-6">
              <Card>
                <CardHeader>
                  <CardTitle className="text-lg">Contact Information</CardTitle>
                  <CardDescription>
                    We'll use this to follow up if needed
                  </CardDescription>
                </CardHeader>
                <CardContent className="space-y-4">
                  <div>
                    <Label htmlFor="userEmail">Your Email Address *</Label>
                    <Input
                      id="userEmail"
                      type="email"
                      placeholder="your.email@example.com"
                      value={formData.userEmail}
                      onChange={(e) => handleInputChange('userEmail', e.target.value)}
                      required
                    />
                  </div>
                </CardContent>
              </Card>

              <Card>
                <CardHeader>
                  <CardTitle className="text-lg">Bug Details</CardTitle>
                </CardHeader>
                <CardContent className="space-y-4">
                  <div>
                    <Label htmlFor="bugTitle">Bug Title *</Label>
                    <Input
                      id="bugTitle"
                      placeholder="Brief description of the issue"
                      value={formData.bugTitle}
                      onChange={(e) => handleInputChange('bugTitle', e.target.value)}
                      required
                    />
                  </div>

                  <div>
                    <Label htmlFor="bugDescription">Detailed Description *</Label>
                    <Textarea
                      id="bugDescription"
                      placeholder="Describe what happened in detail..."
                      rows={4}
                      value={formData.bugDescription}
                      onChange={(e) => handleInputChange('bugDescription', e.target.value)}
                      required
                    />
                  </div>

                  <div>
                    <Label htmlFor="stepsToReproduce">Steps to Reproduce</Label>
                    <Textarea
                      id="stepsToReproduce"
                      placeholder="1. Go to...&#10;2. Click on...&#10;3. See error..."
                      rows={4}
                      value={formData.stepsToReproduce}
                      onChange={(e) => handleInputChange('stepsToReproduce', e.target.value)}
                    />
                  </div>
                </CardContent>
              </Card>
            </div>

            {/* Right Column */}
            <div className="space-y-6">
              <Card>
                <CardHeader>
                  <CardTitle className="text-lg flex items-center gap-2">
                    <Camera className="w-5 h-5" />
                    Screenshots
                  </CardTitle>
                  <CardDescription>
                    Upload screenshots to help us understand the issue (max 5 files)
                  </CardDescription>
                </CardHeader>
                <CardContent>
                  <div className="space-y-4">
                    <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-6 text-center">
                      <Upload className="w-8 h-8 text-muted-foreground mx-auto mb-2" />
                      <Label htmlFor="screenshots" className="cursor-pointer">
                        <span className="text-sm font-medium">Click to upload screenshots</span>
                        <Input
                          id="screenshots"
                          type="file"
                          accept="image/*"
                          multiple
                          className="sr-only"
                          onChange={handleScreenshotUpload}
                        />
                      </Label>
                      <p className="text-xs text-muted-foreground mt-1">
                        PNG, JPG, GIF up to 10MB each
                      </p>
                    </div>

                    {screenshots.length > 0 && (
                      <div className="space-y-2">
                        <Label>Uploaded Screenshots:</Label>
                        {screenshots.map((file, index) => (
                          <div key={index} className="flex items-center justify-between p-2 bg-muted rounded">
                            <span className="text-sm truncate">{file.name}</span>
                            <Button
                              type="button"
                              variant="ghost"
                              size="sm"
                              onClick={() => removeScreenshot(index)}
                            >
                              Remove
                            </Button>
                          </div>
                        ))}
                      </div>
                    )}
                  </div>
                </CardContent>
              </Card>

              <Card>
                <CardHeader>
                  <CardTitle className="text-lg">Expected vs Actual Behavior</CardTitle>
                </CardHeader>
                <CardContent className="space-y-4">
                  <div>
                    <Label htmlFor="expectedBehavior">What should happen?</Label>
                    <Textarea
                      id="expectedBehavior"
                      placeholder="Describe the expected behavior..."
                      rows={3}
                      value={formData.expectedBehavior}
                      onChange={(e) => handleInputChange('expectedBehavior', e.target.value)}
                    />
                  </div>

                  <div>
                    <Label htmlFor="actualBehavior">What actually happened?</Label>
                    <Textarea
                      id="actualBehavior"
                      placeholder="Describe what actually happened..."
                      rows={3}
                      value={formData.actualBehavior}
                      onChange={(e) => handleInputChange('actualBehavior', e.target.value)}
                    />
                  </div>
                </CardContent>
              </Card>

              <Card>
                <CardHeader>
                  <CardTitle className="text-lg">Additional Information</CardTitle>
                </CardHeader>
                <CardContent className="space-y-4">
                  <div>
                    <Label htmlFor="additionalInfo">Any other details?</Label>
                    <Textarea
                      id="additionalInfo"
                      placeholder="Browser version, device type, frequency of issue, etc..."
                      rows={3}
                      value={formData.additionalInfo}
                      onChange={(e) => handleInputChange('additionalInfo', e.target.value)}
                    />
                  </div>
                </CardContent>
              </Card>
            </div>
          </div>

          {/* Submit Button */}
          <div className="flex justify-end pt-6">
            <Button
              type="submit"
              disabled={isSubmitting || !formData.userEmail || !formData.bugTitle || !formData.bugDescription}
              className="min-w-[150px]"
            >
              {isSubmitting ? (
                <>
                  <div className="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2" />
                  Sending...
                </>
              ) : (
                <>
                  <Send className="w-4 h-4 mr-2" />
                  Send Bug Report
                </>
              )}
            </Button>
          </div>
        </form>
      </div>
    </div>
  )
}

</code>

app\connect-github\page.tsx:
<code>
'use client'

// Force dynamic rendering to avoid static generation issues with auth
export const dynamic = 'force-dynamic'

import { useEffect, useState } from 'react'
import { useAuth } from '@/components/auth-provider'
import { Button } from '@/components/ui/button'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Badge } from '@/components/ui/badge'
import { Github, ArrowRight, Shield, Zap, Trash2 } from 'lucide-react'
import { supabase } from '@/lib/supabase'

export default function ConnectGitHubPage() {
  const { user, loading } = useAuth()
  const [isConnecting, setIsConnecting] = useState(false)
  const [error, setError] = useState<string | null>(null)

  // Redirect if not authenticated
  useEffect(() => {
    if (!loading && !user) {
      window.location.href = '/'
    }
  }, [user, loading])

  // Check if user already has GitHub connection
  useEffect(() => {
    if (user) {
      // Check if user signed up with GitHub
      const provider = user.app_metadata?.provider
      if (provider === 'github') {
        // Already connected via GitHub OAuth, redirect to dashboard
        window.location.href = '/dashboard'
      }
    }
  }, [user])

  const handleConnectGitHub = async () => {
    setIsConnecting(true)
    setError(null)

    try {
      const { error } = await supabase.auth.linkIdentity({
        provider: 'github',
        options: {
          redirectTo: `${window.location.origin}/dashboard`,
          queryParams: {
            access_type: 'offline',
            prompt: 'consent',
          }
        }
      })

      if (error) throw error
    } catch (error: any) {
      console.error('GitHub connection error:', error)
      setError(error.message)
      setIsConnecting(false)
    }
  }

  if (loading) {
    return (
      <div className="min-h-screen bg-background flex items-center justify-center">
        <div className="text-center">
          <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"></div>
          <p className="text-muted-foreground">Loading...</p>
        </div>
      </div>
    )
  }

  return (
    <div className="min-h-screen bg-background flex items-center justify-center p-4">
      <div className="max-w-md w-full space-y-6">
        <div className="text-center space-y-2">
          <div className="mx-auto w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center">
            <Github className="w-6 h-6 text-primary" />
          </div>
          <h1 className="text-2xl font-bold">Connect Your GitHub Account</h1>
          <p className="text-muted-foreground">
            To use NeatRepo, you need to connect your GitHub account to access your repositories.
          </p>
        </div>

        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <Shield className="w-5 h-5 text-green-500" />
              Why Connect GitHub?
            </CardTitle>
            <CardDescription>
              NeatRepo is a GitHub portfolio management tool that helps you organize and showcase your repositories.
            </CardDescription>
          </CardHeader>
          <CardContent className="space-y-4">
            <div className="space-y-3">
              <div className="flex items-center gap-3">
                <div className="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                  <Zap className="w-4 h-4 text-blue-600" />
                </div>
                <div>
                  <p className="font-medium">Access Your Repositories</p>
                  <p className="text-sm text-muted-foreground">View and manage all your GitHub repos</p>
                </div>
              </div>
              
              <div className="flex items-center gap-3">
                <div className="w-8 h-8 bg-red-100 rounded-full flex items-center justify-center">
                  <Trash2 className="w-4 h-4 text-red-600" />
                </div>
                <div>
                  <p className="font-medium">Bulk Delete Feature</p>
                  <p className="text-sm text-muted-foreground">Delete multiple repos at once (requires GitHub token)</p>
                </div>
              </div>
              
              <div className="flex items-center gap-3">
                <div className="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                  <ArrowRight className="w-4 h-4 text-green-600" />
                </div>
                <div>
                  <p className="font-medium">Portfolio Management</p>
                  <p className="text-sm text-muted-foreground">Organize repos for job applications</p>
                </div>
              </div>
            </div>

            <div className="pt-4 border-t">
              <Badge variant="secondary" className="mb-3">
                üîí Secure & Private
              </Badge>
              <p className="text-xs text-muted-foreground">
                We only request necessary permissions and never store your GitHub credentials. 
                You can revoke access anytime from your GitHub settings.
              </p>
            </div>
          </CardContent>
        </Card>

        {error && (
          <div className="p-3 bg-red-50 border border-red-200 rounded-md">
            <p className="text-sm text-red-600">{error}</p>
          </div>
        )}

        <Button 
          onClick={handleConnectGitHub} 
          disabled={isConnecting}
          className="w-full"
          size="lg"
        >
          {isConnecting ? (
            <>
              <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div>
              Connecting...
            </>
          ) : (
            <>
              <Github className="mr-2 h-4 w-4" />
              Connect with GitHub
            </>
          )}
        </Button>

        <p className="text-center text-xs text-muted-foreground">
          By connecting, you agree to our terms of service and privacy policy.
        </p>
      </div>
    </div>
  )
}

</code>

app\dashboard\loading.tsx:
<code>
export default function Loading() {
  return null
}

</code>

app\dashboard\page-new.tsx:
<code>
"use client"

import React, { useEffect } from "react";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { AuthGuard } from "@/components/auth-guard";
import DashboardHeader from "@/components/dashboard-header";
import GitHubTokenWarning from "@/components/github-token-warning";
import { 
  AIChatPanel,
  RepositoryActions,
  RepositoryList,
  ErrorDisplay,
  JobTemplateModal
} from "@/components/dashboard";
import { useRepositories } from "@/hooks/dashboard";
import { useUIStore } from "@/stores";
import { useAuth } from "@/components/auth-provider";

// Force dynamic rendering to avoid static generation issues with auth
export const dynamic = 'force-dynamic';

export default function DashboardPage() {
  const { user, showTokenPopup } = useAuth();
  const { setJobTemplateModal } = useUIStore();
  
  const {
    repositories,
    isLoading,
    isError,
    hasRepositories,
    fetchRepositories,
    deleteRepository
  } = useRepositories();

  // Auto-fetch repositories when component mounts
  useEffect(() => {
    if (user) {
      fetchRepositories();
    }
  }, [user, fetchRepositories]);

  const handleRefresh = () => {
    fetchRepositories(true); // Force refresh
  };

  const handleJobTemplateOpen = () => {
    setJobTemplateModal(true);
  };

  const handleDeleteRepository = async (repo: any) => {
    const success = await deleteRepository(repo);
    if (success) {
      // Repository was successfully deleted
      console.log(`Repository ${repo.name} deleted successfully`);
    }
  };

  return (
    <AuthGuard>
      <div className="min-h-screen bg-background">
        {/* Header */}
        <DashboardHeader />
        
        {/* GitHub Token Warning */}
        <GitHubTokenWarning onSetupToken={showTokenPopup} />

        {/* Main Content */}
        <main className="container mx-auto px-4 py-6">
          {/* Global Error Display */}
          <ErrorDisplay className="mb-6" />

          {/* Page Title and Description */}
          <div className="mb-6">
            <h1 className="text-3xl font-bold tracking-tight mb-2">
              Repository Dashboard
            </h1>
            <p className="text-muted-foreground">
              Manage, organize, and optimize your GitHub repositories for maximum impact.
            </p>
          </div>

          {/* Dashboard Grid */}
          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
            {/* Main Repository Section */}
            <div className="lg:col-span-2 space-y-6">
              {/* Repository Actions */}
              <Card>
                <CardHeader>
                  <CardTitle className="text-lg">Repository Management</CardTitle>
                </CardHeader>
                <CardContent>
                  <RepositoryActions
                    onRefresh={handleRefresh}
                    onJobTemplateOpen={handleJobTemplateOpen}
                    isLoading={isLoading}
                    repositoryCount={repositories.length}
                  />
                </CardContent>
              </Card>

              {/* Repository List */}
              <Card>
                <CardHeader>
                  <CardTitle className="text-lg">
                    Your Repositories
                    {hasRepositories && (
                      <span className="text-sm font-normal text-muted-foreground ml-2">
                        ({repositories.length})
                      </span>
                    )}
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <RepositoryList onDeleteRepository={handleDeleteRepository} />
                </CardContent>
              </Card>
            </div>

            {/* Sidebar */}
            <div className="space-y-6">
              {/* Quick Stats */}
              {hasRepositories && (
                <Card>
                  <CardHeader>
                    <CardTitle className="text-lg">Quick Stats</CardTitle>
                  </CardHeader>
                  <CardContent>
                    <div className="space-y-4">
                      <div className="flex justify-between items-center">
                        <span className="text-sm text-muted-foreground">Total Repositories</span>
                        <span className="font-medium">{repositories.length}</span>
                      </div>
                      <div className="flex justify-between items-center">
                        <span className="text-sm text-muted-foreground">Total Stars</span>
                        <span className="font-medium">
                          {repositories.reduce((sum, repo) => sum + repo.stargazers_count, 0)}
                        </span>
                      </div>
                      <div className="flex justify-between items-center">
                        <span className="text-sm text-muted-foreground">Total Forks</span>
                        <span className="font-medium">
                          {repositories.reduce((sum, repo) => sum + repo.forks_count, 0)}
                        </span>
                      </div>
                      <div className="flex justify-between items-center">
                        <span className="text-sm text-muted-foreground">Languages</span>
                        <span className="font-medium">
                          {new Set(repositories.filter(r => r.language).map(r => r.language)).size}
                        </span>
                      </div>
                    </div>
                  </CardContent>
                </Card>
              )}

              {/* Getting Started */}
              {!hasRepositories && !isLoading && (
                <Card>
                  <CardHeader>
                    <CardTitle className="text-lg">Getting Started</CardTitle>
                  </CardHeader>
                  <CardContent>
                    <div className="space-y-3 text-sm">
                      <p>Welcome to your repository dashboard!</p>
                      <div className="space-y-2">
                        <p className="font-medium">To get started:</p>
                        <ul className="space-y-1 text-muted-foreground">
                          <li>1. Make sure your GitHub token is configured</li>
                          <li>2. Create some repositories on GitHub</li>
                          <li>3. Refresh to load your repositories</li>
                          <li>4. Use AI assistance to optimize your profile</li>
                        </ul>
                      </div>
                    </div>
                  </CardContent>
                </Card>
              )}
            </div>
          </div>
        </main>

        {/* AI Chat Panel */}
        <AIChatPanel repositories={repositories} />

        {/* Job Template Modal */}
        <JobTemplateModal repositories={repositories} />
      </div>
    </AuthGuard>
  );
}

</code>

app\dashboard\page.tsx:
<code>
"use client"

// Force dynamic rendering to avoid static generation issues with auth
export const dynamic = 'force-dynamic'

import React, { useState, useEffect, useRef } from "react";
import { DragDropContext, Droppable, Draggable, DropResult, DraggableProvided, DraggableStateSnapshot, DroppableProvided, DroppableStateSnapshot } from "@hello-pangea/dnd";
import { useRouter, useSearchParams } from "next/navigation";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Input } from "@/components/ui/input";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";
import { ScrollArea } from "@/components/ui/scroll-area";
// import { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuLabel, DropdownMenuSeparator, DropdownMenuTrigger } from "@/components/ui/dropdown-menu";
import { ThemeToggle } from "@/components/theme-toggle";
import { useAuth } from "@/components/auth-provider";
import TokenWarningBadge from "@/components/token-warning-badge";
import GitHubTokenWarning from "@/components/github-token-warning";
import DashboardHeader from "@/components/dashboard-header";
import { supabase } from "@/lib/supabase";
import { repositoryManager } from "@/lib/repository-manager";
import { aiAssistant } from "@/lib/ai-assistant";
import { geminiAI } from "@/lib/gemini";
import {
  Github,
  Star,
  GitFork,
  Clock,
  Settings,
  LogOut,
  Plus,
  User,
  GripVertical,
  Folder,
  Bug,
  Code,
  FileText,
  Lightbulb,
  Send,
  ChevronDown,
  ChevronRight,
  RefreshCw,
  MessageCircle,
  Square,
  Eye,
  AlertTriangle,
  CheckCircle,
  Trash2,
  ArrowUp,
  X,
  Zap,
  Download,
  Calendar,
  CalendarDays,
  Target,
  Edit,
  Sparkles,
  ExternalLink,
} from "lucide-react";

interface GitHubUser {
  id: number;
  login: string;
  name: string;
  email: string;
  avatar_url: string;
  bio: string;
  public_repos: number;
}

interface GitHubRepo {
  id: number;
  name: string;
  full_name: string;
  description: string;
  language: string;
  stargazers_count: number;
  forks_count: number;
  html_url: string;
  updated_at: string;
  private: boolean;
  fork: boolean;
  parent?: {
    full_name: string;
    html_url: string;
  };
}

interface UserSession {
  user: GitHubUser;
  repositories: GitHubRepo[];
  access_token: string;
  authenticated_at: string;
}

interface ChatMessage {
  id: string;
  role: "user" | "assistant";
  content: string;
  timestamp: Date;
}

import { AuthGuard } from "@/components/auth-guard";

export default function DashboardPage() {
  const { user, profile, loading, signOut, showTokenPopup, getEffectiveToken } = useAuth();
  const router = useRouter();
  const [showProfileDropdown, setShowProfileDropdown] = useState(false);
  const profileDropdownRef = useRef<HTMLDivElement>(null);

  // Close dropdown when clicking outside
  useEffect(() => {
    function handleClickOutside(event: MouseEvent) {
      if (profileDropdownRef.current && !profileDropdownRef.current.contains(event.target as Node)) {
        setShowProfileDropdown(false);
      }
    }

    document.addEventListener('mousedown', handleClickOutside);
    return () => {
      document.removeEventListener('mousedown', handleClickOutside);
    };
  }, []);

  // üöÄ REAL USER ONLY - NO MORE MOCK DATA!
  const currentUser = user;
  const currentProfile = profile;

  // üö® EMERGENCY PROFILE RECOVERY - Fix corrupted OAuth sessions + AUTOMATIC RECOVERY FOR ALL USERS
  useEffect(() => {
    const recoverProfile = async () => {
      // üîí SECURITY: Only recover for authenticated users with valid usernames
      if (!currentUser?.user_metadata?.user_name) {
        console.log('üö´ SECURITY: No authenticated user or username available, skipping recovery');
        return;
      }

      const authenticatedUsername = currentUser.user_metadata.user_name;

      // Check if we need recovery (no profile for authenticated user)
      // Note: github_pat_token is optional - users can access dashboard without it
      const needsRecovery = !currentProfile;

      if (!needsRecovery) return;

      console.log('üîß SECURE RECOVERY: Attempting profile recovery for authenticated user:', authenticatedUsername);

      // If user has no profile, try to recover from existing profile
      if (!currentProfile) {

        try {
          // Look for existing profile with same GitHub username
          const { data: existingProfile } = await supabase
            .from('user_profiles')
            .select('*')
            .eq('github_username', authenticatedUsername)
            .single();

          if (existingProfile && existingProfile.github_pat_token) {
            // üîß AUTOMATIC RECOVERY: Handle both OAuth and non-OAuth users
            if (currentUser && existingProfile.id !== currentUser.id) {
              console.log('üîß RECOVERY: Found existing profile with token, linking...', existingProfile);

              // Update existing profile to use current user ID
              const { error: updateError } = await supabase
                .from('user_profiles')
                .update({
                  id: currentUser.id,
                  updated_at: new Date().toISOString(),
                })
                .eq('github_username', currentUser.user_metadata.user_name);

              if (!updateError) {
                console.log('‚úÖ RECOVERY: Successfully linked to existing profile with token!');
                // Mark token popup as permanently skipped since user has token
                localStorage.setItem(`token_popup_skipped_permanently_${currentUser.id}`, 'true');
                // Force page refresh to load the recovered profile
                window.location.reload();
              } else {
                console.error('‚ùå RECOVERY: Failed to link profile:', updateError);
              }
            } else {
              // üîí SECURE USER-SPECIFIC RECOVERY: Only for authenticated users
              if (user && existingProfile.id === user.id) {
                console.log('‚úÖ SECURE RECOVERY: Loading data for authenticated user:', user.id);

                // Store token with user-specific key for AI Assistant access
                localStorage.setItem(`github_pat_token_${user.id}`, existingProfile.github_pat_token);

                // Remove old global key to prevent confusion
                localStorage.removeItem('github_pat_token');

                // Fetch repositories with the user's token
                setIsLoadingRepos(true);
                await repositoryManager.fetchRepositories(existingProfile.github_pat_token, true, user.id);
                setError(null);
                setIsLoadingRepos(false);

                console.log('‚úÖ SECURE RECOVERY: User-specific repositories loaded');
              } else {
                console.log('üö´ SECURITY: Profile does not match authenticated user, skipping recovery');
              }
            }
          }
        } catch (error) {
          console.error('‚ùå RECOVERY: Profile recovery failed:', error);
        }
      } else if (currentProfile?.github_pat_token) {
        // If user has token, mark popup as permanently skipped
        console.log('‚úÖ RECOVERY: User has token, marking popup as skipped');
        localStorage.setItem(`token_popup_skipped_permanently_${currentUser.id}`, 'true');
      }
    };

    recoverProfile();
  }, [currentUser, currentProfile]);

  // Create fallback profile from user data if profile doesn't exist
  const fallbackProfile = currentProfile || {
    id: currentUser?.id || 'unknown',
    github_username: currentUser?.user_metadata?.user_name || 'unknown-user',
    github_pat_token: '', // Token will be set through profile management or OAuth
    display_name: currentUser?.user_metadata?.full_name || currentUser?.user_metadata?.user_name || 'User',
    avatar_url: currentUser?.user_metadata?.avatar_url || ''
  };

  // Use fallback profile for dashboard
  const effectiveProfile = fallbackProfile;

  // ALL HOOKS MUST BE DECLARED BEFORE ANY CONDITIONAL RETURNS
  const [repositories, setRepositories] = useState<GitHubRepo[]>([]);
  const [originalRepositories, setOriginalRepositories] = useState<GitHubRepo[]>([]);
  const [previewRepositories, setPreviewRepositories] = useState<GitHubRepo[]>([]);
  const [isPreviewMode, setIsPreviewMode] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [chatMessage, setChatMessage] = useState("");
  const [chatMessages, setChatMessages] = useState<ChatMessage[]>([]);
  const [expandedRepos, setExpandedRepos] = useState<Set<number>>(new Set());

  

  // Helper function to add chat messages
  const addChatMessage = (message: Omit<ChatMessage, 'timestamp'>) => {
    setChatMessages(prev => [...prev, { ...message, timestamp: new Date() }]);
  };

  // üóëÔ∏è DELETE FUNCTIONALITY - GAME CHANGER!
  const [selectedRepos, setSelectedRepos] = useState<Set<number>>(new Set());
  const [isDeleteMode, setIsDeleteMode] = useState(false);
  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);
  const [repoToDelete, setRepoToDelete] = useState<GitHubRepo | null>(null);
  const [isDeleting, setIsDeleting] = useState(false);

  // üìÖ DATE SORTING FUNCTIONALITY
  const [dateSortOrder, setDateSortOrder] = useState<'newest' | 'oldest' | 'default'>('default');

  // üéØ JOB TEMPLATE FUNCTIONALITY
  const [showJobTemplateModal, setShowJobTemplateModal] = useState(false);
  const [jobTitle, setJobTitle] = useState('');
  const [isGeneratingTemplate, setIsGeneratingTemplate] = useState(false);
  const [templateResults, setTemplateResults] = useState<GitHubRepo[]>([]);

  // ‚ûï ADD REPOSITORY FUNCTIONALITY
  const [showAddRepoModal, setShowAddRepoModal] = useState(false);
  const [newRepoName, setNewRepoName] = useState("");
  const [newRepoDescription, setNewRepoDescription] = useState("");
  const [isCreatingRepo, setIsCreatingRepo] = useState(false);

  // ‚úèÔ∏è RENAME REPOSITORY FUNCTIONALITY
  const [showRenameModal, setShowRenameModal] = useState(false);
  const [repoToRename, setRepoToRename] = useState<GitHubRepo | null>(null);
  const [newRepoNameForRename, setNewRepoNameForRename] = useState("");
  const [isRenamingRepo, setIsRenamingRepo] = useState(false);

  // ‚ûï CREATE REPOSITORY FUNCTION
  const createRepository = async () => {
    if (!newRepoName.trim()) return;
    if (!profile?.github_pat_token) {
      addChatMessage({
        id: Date.now().toString(),
        role: "assistant",
        content: `To create repositories, please set up your GitHub Personal Access Token first. Click the 'Setup GitHub Token' button above.`,
      });
      showTokenPopup(); // Automatically show the token setup popup
      return;
    }

    setIsCreatingRepo(true);
    try {
      const response = await fetch('https://api.github.com/user/repos', {
        method: 'POST',
        headers: {
          'Authorization': `token ${profile.github_pat_token}`,
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          name: newRepoName.trim(),
          description: newRepoDescription.trim() || undefined,
          private: false,
          auto_init: true,
        }),
      });

      if (response.ok) {
        const newRepo = await response.json();

        // Add to repositories list
        const formattedRepo: GitHubRepo = {
          id: newRepo.id,
          name: newRepo.name,
          full_name: newRepo.full_name,
          description: newRepo.description,
          private: newRepo.private,
          html_url: newRepo.html_url,
          clone_url: newRepo.clone_url,
          ssh_url: newRepo.ssh_url,
          language: newRepo.language,
          stargazers_count: newRepo.stargazers_count,
          forks_count: newRepo.forks_count,
          created_at: newRepo.created_at,
          updated_at: newRepo.updated_at,
          pushed_at: newRepo.pushed_at,
          size: newRepo.size,
          default_branch: newRepo.default_branch,
          topics: newRepo.topics || [],
          visibility: newRepo.visibility,
          fork: newRepo.fork,
          archived: newRepo.archived,
          disabled: newRepo.disabled,
          open_issues_count: newRepo.open_issues_count,
          license: newRepo.license,
          allow_forking: newRepo.allow_forking,
          is_template: newRepo.is_template,
          web_commit_signoff_required: newRepo.web_commit_signoff_required,
          has_issues: newRepo.has_issues,
          has_projects: newRepo.has_projects,
          has_wiki: newRepo.has_wiki,
          has_pages: newRepo.has_pages,
          has_downloads: newRepo.has_downloads,
          has_discussions: newRepo.has_discussions,
          security_and_analysis: newRepo.security_and_analysis,
        };

        setRepositories(prev => [formattedRepo, ...prev]);

        // Reset form and close modal
        setNewRepoName("");
        setNewRepoDescription("");
        setShowAddRepoModal(false);

        // Show success message
        addChatMessage({
          id: Date.now().toString(),
          role: "assistant",
          content: `üéâ Repository "${newRepo.name}" created successfully! It's now available in your repositories list.`,
        });
      } else {
        throw new Error('Failed to create repository');
      }
    } catch (error) {
      console.error('Error creating repository:', error);
      addChatMessage({
        id: Date.now().toString(),
        role: "assistant",
        content: `Failed to create repository. Please check your GitHub token permissions and try again.`,
      });
    } finally {
      setIsCreatingRepo(false);
    }
  };

  // ‚úèÔ∏è RENAME REPOSITORY FUNCTION
  const renameRepository = async () => {
    if (!repoToRename || !newRepoNameForRename.trim()) return;
    if (!profile?.github_pat_token) {
      addChatMessage({
        id: Date.now().toString(),
        role: "assistant",
        content: `To rename repositories, please set up your GitHub Personal Access Token first. Click the 'Setup GitHub Token' button above.`,
      });
      showTokenPopup(); // Automatically show the token setup popup
      return;
    }

    setIsRenamingRepo(true);
    try {
      const response = await fetch(`https://api.github.com/repos/${repoToRename.full_name}`, {
        method: 'PATCH',
        headers: {
          'Authorization': `token ${profile.github_pat_token}`,
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          name: newRepoNameForRename.trim(),
        }),
      });

      if (response.ok) {
        const updatedRepo = await response.json();

        // Update repositories list
        setRepositories(prev => prev.map(repo =>
          repo.id === repoToRename.id
            ? { ...repo, name: updatedRepo.name, full_name: updatedRepo.full_name }
            : repo
        ));

        // Reset form and close modal
        setNewRepoNameForRename("");
        setRepoToRename(null);
        setShowRenameModal(false);

        // Show success message
        addChatMessage({
          id: Date.now().toString(),
          role: "assistant",
          content: `üéâ Repository renamed from "${repoToRename.name}" to "${updatedRepo.name}" successfully!`,
        });
      } else {
        throw new Error('Failed to rename repository');
      }
    } catch (error) {
      console.error('Error renaming repository:', error);
      addChatMessage({
        id: Date.now().toString(),
        role: "assistant",
        content: `Failed to rename repository. Please check your GitHub token permissions and try again.`,
      });
    } finally {
      setIsRenamingRepo(false);
    }
  };

  // üöÄ DELETE FUNCTIONS - REVOLUTIONARY CLEANUP TOOL!
  const handleDeleteRepo = async (repo: GitHubRepo) => {
    setRepoToDelete(repo);
    setShowDeleteConfirm(true);
  };

  const confirmDeleteRepo = async () => {
    if (!repoToDelete) return;

    const token = await getEffectiveToken();
    if (!token) {
      addChatMessage({
        id: Date.now().toString(),
        role: "assistant",
        content: `To delete repositories, please set up your GitHub Personal Access Token first. Click the 'Setup GitHub Token' button above.`,
      });
      setShowDeleteConfirm(false);
      showTokenPopup(); // Automatically show the token setup popup
      return;
    }

    setIsDeleting(true);
    try {
      console.log(`üóëÔ∏è DELETING REPO: ${repoToDelete.name}`);

      const response = await fetch(`https://api.github.com/repos/${repoToDelete.full_name}`, {
        method: 'DELETE',
        headers: {
          'Authorization': `token ${token}`,
          'Accept': 'application/vnd.github.v3+json',
          'User-Agent': 'GitHub-Tailored-AI/1.0',
          'Content-Type': 'application/json',
        },
      });

      if (response.ok) {
        console.log(`‚úÖ REPO DELETED: ${repoToDelete.name}`);
        // Remove from repositories list
        setRepositories(prev => prev.filter(r => r.id !== repoToDelete.id));

        // Add success message to chat
        const successMessage: ChatMessage = {
          id: Date.now().toString(),
          role: 'assistant',
          content: `**Repository Deleted Successfully**

"${repoToDelete.name}" has been permanently deleted from your GitHub account.

This is part of cleaning up your portfolio for a more professional appearance.`,
          timestamp: new Date()
        };
        setChatMessages(prev => [...prev, successMessage]);
      } else {
        throw new Error(`Failed to delete repository: ${response.status}`);
      }
    } catch (error) {
      console.error('‚ùå DELETE ERROR:', error);

      // Auto-open GitHub repository settings for manual deletion
      const githubUrl = `https://github.com/${repoToDelete.full_name}/settings`;
      window.open(githubUrl, '_blank');

      const errorMessage: ChatMessage = {
        id: Date.now().toString(),
        role: 'assistant',
        content: `**Opening GitHub for you**

Just click "Delete this repository" in the new tab that opened.

Quick and easy manual deletion.`,
        timestamp: new Date()
      };
      setChatMessages(prev => [...prev, errorMessage]);
    } finally {
      setIsDeleting(false);
      setShowDeleteConfirm(false);
      setRepoToDelete(null);
    }
  };

  const handleBulkDelete = async () => {
    if (selectedRepos.size === 0) return;

    const reposToDelete = repositories.filter(repo => selectedRepos.has(repo.id));
    console.log(`üóëÔ∏è BULK DELETE: ${reposToDelete.length} repositories`);

    // Retrieve token once for bulk operation
    const token = await getEffectiveToken();
    if (!token) {
      addChatMessage({
        id: Date.now().toString(),
        role: "assistant",
        content: `To delete repositories, please set up your GitHub Personal Access Token first. Click the 'Setup GitHub Token' button above.`,
      });
      showTokenPopup();
      return;
    }

    // Show confirmation for bulk delete
    const confirmMessage = `Are you sure you want to delete ${reposToDelete.length} repositories? This action cannot be undone.`;
    if (window.confirm(confirmMessage)) {
      console.log('Bulk delete confirmed');

      setIsDeleting(true);
      let successCount = 0;
      let failedRepos: string[] = [];

      try {
        // Delete repositories one by one
        for (const repo of reposToDelete) {
          try {
            console.log(`üóëÔ∏è DELETING REPO: ${repo.name}`);

            const response = await fetch(`https://api.github.com/repos/${repo.full_name}`, {
              method: 'DELETE',
              headers: {
                'Authorization': `token ${token}`,
                'Accept': 'application/vnd.github.v3+json',
                'User-Agent': 'GitHub-Tailored-AI/1.0',
                'Content-Type': 'application/json',
              },
            });

            if (response.ok) {
              console.log(`‚úÖ REPO DELETED: ${repo.name}`);
              successCount++;

              // Remove from repositories list immediately
              setRepositories(prev => prev.filter(r => r.id !== repo.id));
            } else {
              console.error(`‚ùå FAILED TO DELETE: ${repo.name} - Status: ${response.status}`);
              failedRepos.push(repo.name);
            }
          } catch (error) {
            console.error(`‚ùå DELETE ERROR for ${repo.name}:`, error);
            failedRepos.push(repo.name);
          }
        }

        // Show results
        const resultMessage: ChatMessage = {
          id: Date.now().toString(),
          role: 'assistant',
          content: `**Bulk Delete Results**

**Successfully deleted:** ${successCount} repositories
${failedRepos.length > 0 ? `**Failed to delete:** ${failedRepos.join(', ')}` : ''}

${successCount > 0 ? 'Your portfolio is now cleaner and more professional.' : ''}`,
          timestamp: new Date()
        };
        setChatMessages(prev => [...prev, resultMessage]);

        // Clear selections and exit delete mode
        setSelectedRepos(new Set());
        setIsDeleteMode(false);

        // Force refresh repositories
        if (token) {
          await repositoryManager.fetchRepositories(token, true);
        }

      } catch (error) {
        console.error('‚ùå BULK DELETE ERROR:', error);
      } finally {
        setIsDeleting(false);
      }
    }
  };

  const toggleRepoSelection = (repoId: number) => {
    setSelectedRepos(prev => {
      const newSet = new Set(prev);
      if (newSet.has(repoId)) {
        newSet.delete(repoId);
      } else {
        newSet.add(repoId);
      }
      return newSet;
    });
  };

  const toggleDeleteMode = () => {
    setIsDeleteMode(!isDeleteMode);
    setSelectedRepos(new Set()); // Clear selections when toggling mode
  };

  // üìÖ DATE SORTING FUNCTIONS
  const sortRepositoriesByDate = (repos: GitHubRepo[], order: 'newest' | 'oldest' | 'default'): GitHubRepo[] => {
    if (order === 'default') {
      return repos; // Return original order
    }

    return [...repos].sort((a, b) => {
      const dateA = new Date(a.updated_at || a.created_at).getTime();
      const dateB = new Date(b.updated_at || b.created_at).getTime();

      if (order === 'newest') {
        return dateB - dateA; // Newest first
      } else {
        return dateA - dateB; // Oldest first
      }
    });
  };

  const handleDateSort = (order: 'newest' | 'oldest' | 'default') => {
    setDateSortOrder(order);
    const sortedRepos = sortRepositoriesByDate(repositories, order);
    setRepositories(sortedRepos);

    // Trigger staged changes if not default order
    if (order !== 'default') {
      setHasChanges(true);
    } else {
      setHasChanges(false);
    }
  };
  const [hasChanges, setHasChanges] = useState(false);
  const [isChatMinimized, setIsChatMinimized] = useState(false);
  const [isAiThinking, setIsAiThinking] = useState(false);
  const [welcomeText, setWelcomeText] = useState("Welcome to your GitHub AI Assistant");
  const [isTypingWelcome, setIsTypingWelcome] = useState(false);
  const [selectedTemplate, setSelectedTemplate] = useState("");
  const [isCriticMode, setIsCriticMode] = useState(false);
  // üöÄ NEW: Chat reset handler to exit interview mode and clear messages
  const handleResetChat = () => {
    if (window.confirm('Reset the chat and exit Interview mode?')) {
      // Clear AI interview state stored in localStorage (user-specific when possible)
      try {
        const storageKey = user ? `ai_interview_state_${user.id}` : 'ai_interview_state';
        localStorage.removeItem(storageKey);
        console.log('üßπ Interview state cleared from localStorage:', storageKey);
      } catch (err) {
        console.error('‚ùå Failed clearing interview state:', err);
      }

      // Reset local UI state
      setIsInterviewMode(false);
      setInterviewProgress(0);
      setChatMessages([]);
      setGeneratedReadme(null);
      console.log('‚ôªÔ∏è Chat and interview state reset');
    }
  };
  const [isInitialized, setIsInitialized] = useState(false);
  const [storageInitialized, setStorageInitialized] = useState(false);
  const [isInterviewMode, setIsInterviewMode] = useState(false);
  const [interviewProgress, setInterviewProgress] = useState(0);
  const [generatedReadme, setGeneratedReadme] = useState<string | null>(null);
  const [isPageVisible, setIsPageVisible] = useState(true);
  const [lastVisibilityChange, setLastVisibilityChange] = useState(Date.now());
  const [isLoadingRepos, setIsLoadingRepos] = useState(false);
  const [isProcessingOAuthCallback, setIsProcessingOAuthCallback] = useState(false);
  const [lastFetchTime, setLastFetchTime] = useState(0);
  const [persistentState, setPersistentState] = useState({
    dataLoaded: false,
    lastSync: 0
  });
  const chatEndRef = useRef<HTMLDivElement>(null);

  // SINGLETON: Subscribe to global repository manager - PREVENT DUPLICATES
  useEffect(() => {
    // Prevent multiple subscriptions
    if ((window as any).repoManagerSubscribed) {
      console.log('‚ö†Ô∏è SINGLETON: Already subscribed, skipping');
      return;
    }

    console.log('üéØ SINGLETON: Subscribing to repository manager');
    (window as any).repoManagerSubscribed = true;

    const unsubscribe = repositoryManager.subscribe((repos) => {
      console.log(`‚ö° SINGLETON: Received ${repos.length} repositories`);
      setRepositories(repos);
      setOriginalRepositories(repos);
      setIsLoadingRepos(false); // Stop loading when data arrives
      setPersistentState({
        dataLoaded: repos.length > 0,
        lastSync: repositoryManager.getLastFetchTime()
      });
    });

    return () => {
      unsubscribe();
      (window as any).repoManagerSubscribed = false;
    };
  }, []); // ZERO dependencies - subscribe once, get updates forever

  // YouTube-style background sync: ZERO dependencies to prevent re-triggers
  useEffect(() => {
    let backgroundSync: NodeJS.Timeout;

    const startBackgroundSync = () => {
      backgroundSync = setInterval(() => {
        // Check conditions inside interval, not in dependencies
        const currentUser = document.querySelector('[data-user-id]')?.getAttribute('data-user-id');
        const hasRepos = localStorage.getItem('github_repositories');

        if (currentUser && hasRepos) {
          console.log('üîÑ SINGLETON: Background sync starting...');
          const token = localStorage.getItem('github_pat_token');
          if (token) {
            repositoryManager.backgroundSync(token);
          }
        }
      }, 300000); // 5 minutes
    };

    startBackgroundSync();
    return () => clearInterval(backgroundSync);
  }, []); // ZERO dependencies!

  // Skip storage initialization - use client-side download only for better reliability
  useEffect(() => {
    if (user && !storageInitialized) {
      console.log('üìÅ Using client-side download only (no storage backup)');
      setStorageInitialized(true);
    }
  }, [user, storageInitialized]);

  // Improved download function with proper filename handling
  const saveAndDownloadContent = async (content: string, filename: string, contentType: string = 'text/markdown') => {
    try {
      console.log('üîΩ Starting download:', filename);

      // Ensure filename has proper extension and sanitize
      const sanitizedFilename = filename.replace(/[^a-zA-Z0-9-_\.]/g, '-');
      const properFilename = sanitizedFilename.endsWith('.md') ? sanitizedFilename : `${sanitizedFilename}.md`;

      // Create blob with proper MIME type - NO BOM to avoid encoding issues
      const blob = new Blob([content], {
        type: 'text/markdown;charset=utf-8'
      });

      console.log('üìÑ Blob created:', {
        size: blob.size,
        type: blob.type,
        filename: properFilename
      });

      // Skip Supabase Storage backup - use client-side download only
      console.log('üìÅ Using client-side download only (more reliable)');

      // Create download using multiple methods for better compatibility
      const url = URL.createObjectURL(blob);

      // Method 1: Try modern download API if available
      if ('showSaveFilePicker' in window) {
        try {
          const fileHandle = await (window as any).showSaveFilePicker({
            suggestedName: properFilename,
            types: [{
              description: 'Markdown files',
              accept: { 'text/markdown': ['.md'] }
            }]
          });
          const writable = await fileHandle.createWritable();
          await writable.write(blob);
          await writable.close();
          console.log('‚úÖ File saved using File System Access API');
          URL.revokeObjectURL(url);
          return true;
        } catch (fsError) {
          console.log('üìÅ File System Access API failed, falling back to download link');
        }
      }

      // Method 2: Traditional download link with enhanced attributes
      const downloadLink = document.createElement('a');
      downloadLink.href = url;
      downloadLink.download = properFilename;
      downloadLink.style.display = 'none';
      downloadLink.setAttribute('download', properFilename);
      downloadLink.setAttribute('type', 'text/markdown');

      // Prevent any other download handlers from interfering
      downloadLink.addEventListener('click', (e) => {
        e.stopPropagation();
        console.log('üéØ Direct download click for:', properFilename);
      });

      // Add to DOM temporarily
      document.body.appendChild(downloadLink);

      // Force click with user gesture simulation
      console.log('üñ±Ô∏è Triggering download click for:', properFilename);
      downloadLink.click();

      // Cleanup after a delay
      setTimeout(() => {
        if (document.body.contains(downloadLink)) {
          document.body.removeChild(downloadLink);
        }
        URL.revokeObjectURL(url);
        console.log('üßπ Download cleanup completed for:', properFilename);
      }, 3000);

      return true;
    } catch (error) {
      console.error('‚ùå Download error:', error);

      // Enhanced fallback method
      try {
        const sanitizedFilename = filename.replace(/[^a-zA-Z0-9-_\.]/g, '-');
        const properFilename = sanitizedFilename.endsWith('.md') ? sanitizedFilename : `${sanitizedFilename}.md`;
        const blob = new Blob([content], {
          type: 'application/octet-stream' // Force download
        });
        const url = URL.createObjectURL(blob);

        const link = document.createElement('a');
        link.href = url;
        link.download = properFilename;
        link.style.display = 'none';

        document.body.appendChild(link);
        link.click();

        setTimeout(() => {
          if (document.body.contains(link)) {
            document.body.removeChild(link);
          }
          URL.revokeObjectURL(url);
        }, 3000);

        console.log('‚úÖ Enhanced fallback download completed for:', properFilename);
        return true;
      } catch (fallbackError) {
        console.error('‚ùå All download methods failed:', fallbackError);

        // Last resort: copy to clipboard
        try {
          await navigator.clipboard.writeText(content);
          console.log('üìã Content copied to clipboard as last resort');
          alert(`Download failed, but content has been copied to clipboard. Please paste it into a new file named: ${filename.endsWith('.md') ? filename : `${filename}.md`}`);
          return true;
        } catch (clipboardError) {
          console.error('‚ùå Clipboard fallback also failed:', clipboardError);
          return false;
        }
      }
    }
  };



  const projectTemplates = [
    {
      id: "react-app",
      name: "React Web App",
      description: "Modern React application with TypeScript",
      icon: "‚öõÔ∏è",
      files: [
        "src/App.tsx",
        "src/components/Header.tsx",
        "src/components/Footer.tsx",
        "src/hooks/useAuth.ts",
        "src/utils/api.ts",
        "public/index.html",
        "package.json",
        "tsconfig.json",
        "tailwind.config.js"
      ]
    },
    {
      id: "npm-library",
      name: "NPM Library",
      description: "Reusable JavaScript/TypeScript library",
      icon: "üì¶",
      files: [
        "src/index.ts",
        "src/lib/core.ts",
        "src/types/index.ts",
        "tests/index.test.ts",
        "package.json",
        "tsconfig.json",
        "rollup.config.js",
        ".npmignore"
      ]
    },
    {
      id: "nextjs-app",
      name: "Next.js App",
      description: "Full-stack Next.js application",
      icon: "‚ñ≤",
      files: [
        "app/page.tsx",
        "app/layout.tsx",
        "app/api/auth/route.ts",
        "components/ui/button.tsx",
        "lib/utils.ts",
        "package.json",
        "next.config.js",
        "tailwind.config.ts"
      ]
    },
    {
      id: "python-api",
      name: "Python API",
      description: "FastAPI backend service",
      icon: "üêç",
      files: [
        "main.py",
        "app/models.py",
        "app/routes.py",
        "app/database.py",
        "tests/test_main.py",
        "requirements.txt",
        "Dockerfile",
        ".env.example"
      ]
    },
    {
      id: "rust-cli",
      name: "Rust CLI Tool",
      description: "Command-line application in Rust",
      icon: "ü¶Ä",
      files: [
        "src/main.rs",
        "src/lib.rs",
        "src/cli.rs",
        "src/config.rs",
        "tests/integration_test.rs",
        "Cargo.toml",
        "README.md",
        ".gitignore"
      ]
    }
  ];

  const fullWelcomeText = "Welcome to your GitHub AI Assistant";

  // Typewriter effect for welcome message
  useEffect(() => {
    if (isTypingWelcome && currentUser) {
      let index = 0;
      const timer = setInterval(() => {
        if (index < fullWelcomeText.length) {
          setWelcomeText(fullWelcomeText.slice(0, index + 1));
          index++;
        } else {
          setIsTypingWelcome(false);
          clearInterval(timer);
        }
      }, 50);

      return () => clearInterval(timer);
    }
  }, [isTypingWelcome, user]);

  useEffect(() => {
    chatEndRef.current?.scrollIntoView({ behavior: "smooth" });
  }, [chatMessages]);

  // üéØ YOUTUBE-STYLE: Long-term stability with smart recovery
  useEffect(() => {
    console.log('üéØ YouTube-style persistence: Long-term stability enabled');
    setIsPageVisible(true);

    // Enhanced visibility change handler for long-term scenarios
    const handleVisibilityChange = () => {
      if (!document.hidden) {
        const now = Date.now();
        const timeSinceLastChange = now - lastVisibilityChange;
        
        console.log(`üëÅÔ∏è Tab became visible after ${Math.round(timeSinceLastChange/1000)}s`);
        
        // Handle different scenarios based on how long user was away
        if (timeSinceLastChange > 7200000) { // 2+ hours
          console.log('üïê LONG ABSENCE: User was away for 2+ hours, performing health check...');
          performLongAbsenceRecovery();
        } else if (timeSinceLastChange > 3600000) { // 1+ hour  
          console.log('üïê MEDIUM ABSENCE: User was away for 1+ hour, checking session...');
          performMediumAbsenceRecovery();
        } else if (timeSinceLastChange > 1800000) { // 30+ minutes
          console.log('üïê SHORT ABSENCE: User was away for 30+ minutes, refreshing data...');
          performShortAbsenceRecovery();
        }
        
        // Reset stuck loading states
        if (isLoadingRepos && timeSinceLastChange > 30000) {
          console.warn('‚ö†Ô∏è Loading state stuck after absence - resetting');
          setIsLoadingRepos(false);
          setError('Session recovered. Please refresh if needed.');
        }
        
        setLastVisibilityChange(now);
      }
    };

    // Long-term health monitoring (every 10 minutes when active)
    const healthMonitor = setInterval(() => {
      if (!document.hidden && user) {
        console.log('üíì HEALTH: Performing routine health check...');
        checkSystemHealth();
      }
    }, 600000); // 10 minutes

    document.addEventListener('visibilitychange', handleVisibilityChange);
    
    return () => {
      document.removeEventListener('visibilitychange', handleVisibilityChange);
      clearInterval(healthMonitor);
    };
  }, [isLoadingRepos, lastVisibilityChange, user]);

  // üöÄ RECOVERY FUNCTIONS for different absence scenarios
  const performLongAbsenceRecovery = async () => {
    console.log('üîÑ LONG RECOVERY: Starting comprehensive recovery...');
    setError('Welcome back! Checking system status...');
    
    try {
      // Check if auth is still valid
      const { data: { session } } = await supabase.auth.getSession();
      if (!session) {
        setError('Session expired. Please log in again.');
        return;
      }
      
      // Force refresh all data
      const token = profile?.github_pat_token;
      if (token) {
        setIsLoadingRepos(true);
        await repositoryManager.fetchRepositories(token, true);
        setError(null);
      }
    } catch (error) {
      console.error('‚ùå LONG RECOVERY failed:', error);
      setError('Recovery failed. Please refresh the page.');
    }
  };

  const performMediumAbsenceRecovery = async () => {
    console.log('üîÑ MEDIUM RECOVERY: Checking session and refreshing data...');
    
    try {
      const token = profile?.github_pat_token;
      if (token) {
        // Background sync without showing loading
        await repositoryManager.backgroundSync(token);
      }
    } catch (error) {
      console.error('‚ùå MEDIUM RECOVERY failed:', error);
    }
  };

  const performShortAbsenceRecovery = async () => {
    console.log('üîÑ SHORT RECOVERY: Light refresh...');
    
    try {
      const token = profile?.github_pat_token;
      if (token) {
        await repositoryManager.backgroundSync(token);
      }
    } catch (error) {
      console.error('‚ùå SHORT RECOVERY failed:', error);
    }
  };

  const checkSystemHealth = async () => {
    try {
      // Test GitHub API connectivity
      const token = profile?.github_pat_token;
      if (token) {
        const response = await fetch("https://api.github.com/user", {
          headers: { Authorization: `token ${token}` },
        });
        
        if (!response.ok) {
          console.warn('‚ö†Ô∏è HEALTH: GitHub API issue detected');
          if (response.status === 401) {
            setError('GitHub token expired. Please refresh your token.');
          }
        } else {
          console.log('‚úÖ HEALTH: System healthy');
        }
      }
    } catch (error) {
      console.warn('‚ö†Ô∏è HEALTH: Health check failed:', error);
    }
  };

  // üöÄ KEYBOARD SHORTCUTS for flexible drag operations
  useEffect(() => {
    const handleKeyDown = (e: KeyboardEvent) => {
      if (isPreviewMode) {
        if (e.key === 'Escape') {
          e.preventDefault();
          cancelPreview();
        } else if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
          e.preventDefault();
          applyChanges();
        } else if (e.key === 'c' && (e.ctrlKey || e.metaKey)) {
          e.preventDefault();
          // Continue dragging without applying
          setIsPreviewMode(false);
          setHasChanges(false);
        }
      }
    };

    window.addEventListener('keydown', handleKeyDown);
    return () => window.removeEventListener('keydown', handleKeyDown);
  }, [isPreviewMode]);

  // OLD fetchRepositories function removed - using SINGLETON pattern only

  // üîÑ ENHANCED BROWSER NAVIGATION HANDLING
  useEffect(() => {
    // Reset initialization when page loads/navigates to ensure auto-fetch always works
    console.log('üîÑ PAGE NAVIGATION: Resetting initialization state for reliable auto-fetch');
    setIsInitialized(false);

    // Also reset loading state to prevent stuck loading screens
    if (repositories.length > 0) {
      console.log('üîÑ PAGE NAVIGATION: Found cached repositories, stopping loading state');
      setIsLoadingRepos(false);
    }

    // Handle browser navigation events (back/forward)
    const handlePopState = (event: PopStateEvent) => {
      console.log('üîÑ BROWSER: Back/Forward navigation detected');
      // Refresh data if user navigates back/forward
      if (currentProfile?.github_pat_token) {
        setIsLoadingRepos(true);
        repositoryManager.fetchRepositories(currentProfile.github_pat_token, false)
          .then(() => setIsLoadingRepos(false))
          .catch(() => setIsLoadingRepos(false));
      }
    };

    // Handle page visibility change (tab switching, minimize/restore)
    const handleVisibilityChange = () => {
      if (document.visibilityState === 'visible' && currentProfile?.github_pat_token) {
        console.log('üîÑ VISIBILITY: Page became visible, checking for updates');
        // Soft refresh when user returns to tab
        repositoryManager.fetchRepositories(currentProfile.github_pat_token, false);
      }
    };

    window.addEventListener('popstate', handlePopState);
    document.addEventListener('visibilitychange', handleVisibilityChange);

    return () => {
      window.removeEventListener('popstate', handlePopState);
      document.removeEventListener('visibilitychange', handleVisibilityChange);
    };
  }, [currentProfile?.github_pat_token]); // Depend on token to re-setup listeners

  // üîÑ SYNC INTERVIEW STATE FROM LOCALSTORAGE ON LOAD
  useEffect(() => {
    if (typeof window === 'undefined') return;

    try {
      const saved = localStorage.getItem('ai_interview_state');
      if (saved) {
        const state = JSON.parse(saved);
        if (state.isActive && !state.completed) {
          setIsInterviewMode(true);
          // Calculate progress based on current question
          const progress = state.questions.length > 0
            ? Math.round((state.currentQuestion / state.questions.length) * 100)
            : 0;
          setInterviewProgress(progress);
          console.log('üîÑ Synced interview UI state from localStorage:', { isActive: state.isActive, progress });
        }
      }
    } catch (error) {
      console.error('‚ùå Failed to sync interview state:', error);
    }
  }, []);

  // üé≠ PERSONALITY MODE PERSISTENCE - Fix for critic mode reset bug
  useEffect(() => {
    if (typeof window === 'undefined') return;

    try {
      // Load saved personality mode on component mount
      const savedCriticMode = localStorage.getItem('personality_critic_mode');
      if (savedCriticMode !== null) {
        const isEnabled = JSON.parse(savedCriticMode);
        setIsCriticMode(isEnabled);
        console.log('üé≠ Restored personality mode from localStorage:', { criticMode: isEnabled });
      }
    } catch (error) {
      console.error('‚ùå Failed to load personality mode:', error);
    }
  }, []);

  // üé≠ SAVE PERSONALITY MODE WHEN IT CHANGES
  useEffect(() => {
    if (typeof window === 'undefined') return;

    try {
      localStorage.setItem('personality_critic_mode', JSON.stringify(isCriticMode));
      console.log('üé≠ Saved personality mode to localStorage:', { criticMode: isCriticMode });
    } catch (error) {
      console.error('‚ùå Failed to save personality mode:', error);
    }
  }, [isCriticMode]);

  // üîß OAUTH ERROR URL CLEANUP - Fix for OAuth error persistence bug
  useEffect(() => {
    if (typeof window === 'undefined') return;

    const currentUrl = new URL(window.location.href);
    const hasOAuthError = currentUrl.searchParams.has('error') ||
                         currentUrl.searchParams.has('error_code') ||
                         currentUrl.searchParams.has('error_description');

    if (hasOAuthError) {
      // üö® CRITICAL DEBUG: Log actual OAuth error details before cleaning
      const errorDetails = {
        error: currentUrl.searchParams.get('error'),
        error_code: currentUrl.searchParams.get('error_code'),
        error_description: currentUrl.searchParams.get('error_description'),
        fullUrl: currentUrl.toString(),
        hash: currentUrl.hash
      };

      console.error('üö® OAUTH ERROR DETECTED:', errorDetails);
      console.error('üîç OAUTH ERROR ANALYSIS:', {
        errorType: errorDetails.error,
        errorCode: errorDetails.error_code,
        description: errorDetails.error_description,
        possibleCauses: [
          'GitHub OAuth app configuration mismatch',
          'Supabase GitHub provider settings incorrect',
          'OAuth callback URL mismatch',
          'Environment variables missing or incorrect',
          'OAuth scopes not matching configuration'
        ]
      });

      console.log('üîß OAuth error parameters detected in URL, cleaning up...');

      // Remove OAuth error parameters
      currentUrl.searchParams.delete('error');
      currentUrl.searchParams.delete('error_code');
      currentUrl.searchParams.delete('error_description');

      // Also clean up any hash-based error parameters
      if (currentUrl.hash.includes('error=')) {
        currentUrl.hash = '';
      }

      // Update the URL without reloading the page
      window.history.replaceState({}, '', currentUrl.toString());
      console.log('‚úÖ OAuth error parameters cleaned from URL');
    }
  }, []); // Run only once on component mount

  // üö® CRITICAL FIX: Simplified OAuth session detection and initialization
  useEffect(() => {
    const handleAuthInitialization = async () => {
      // Skip if still loading or no user
      if (loading || !user) {
        console.log('‚è≥ AUTH INIT: Waiting for authentication...', { loading, hasUser: !!user });
        return;
      }

      console.log('üöÄ AUTH INIT: Starting initialization for user:', user.id);

      // Check if this is a fresh OAuth login (user just authenticated)
      const isOAuthUser = user.app_metadata?.provider === 'github';
      const hasRepositories = repositories.length > 0;

      if (isOAuthUser && !hasRepositories) {
        console.log('üîÑ OAUTH INIT: Detected OAuth user without repositories, initializing...');
        setIsProcessingOAuthCallback(true);

        try {
          // REMOVED: Artificial 1-second delay that causes race conditions
          // Immediately attempt to get token and fetch repositories
          const effectiveToken = await getEffectiveToken();
          if (effectiveToken) {
            console.log('üöÄ OAUTH INIT: Fetching repositories with OAuth token');
            setIsLoadingRepos(true);
            await repositoryManager.fetchRepositories(effectiveToken, true, user.id);
            console.log('‚úÖ OAUTH INIT: Repository fetch completed');
          } else {
            console.error('‚ùå OAUTH INIT: No effective token available');
            setError('Unable to access GitHub repositories. Please try signing out and signing in again.');
          }
        } catch (error) {
          console.error('‚ùå OAUTH INIT: Repository fetch failed:', error);
          setError('Failed to load repositories. Please try refreshing the page.');
        } finally {
          setIsLoadingRepos(false);
          setIsProcessingOAuthCallback(false);
        }
      } else if (!isOAuthUser) {
        // Regular initialization for non-OAuth users
        console.log('üîß REGULAR INIT: Checking for cached token for user:', user.id);

        const cachedToken = localStorage.getItem(`github_pat_token_${user.id}`);
        if (cachedToken && !hasRepositories) {
          console.log('üîß REGULAR INIT: Found cached token, fetching repositories...');
          try {
            setIsLoadingRepos(true);
            await repositoryManager.fetchRepositories(cachedToken, true, user.id);
            console.log('‚úÖ REGULAR INIT: Repository fetch completed');
          } catch (error) {
            console.error('‚ùå REGULAR INIT: Repository fetch failed:', error);
          } finally {
            setIsLoadingRepos(false);
          }
        }
      } else {
        console.log('‚úÖ AUTH INIT: User already has repositories loaded');
      }
    };

    // Run initialization after a short delay to ensure auth state is stable
    const initTimeout = setTimeout(handleAuthInitialization, 500);
    return () => clearTimeout(initTimeout);
  }, [user, loading, repositories.length, getEffectiveToken]);

  // üöÄ INSTANT LOADING: Optimized auto-fetch with cache-first approach
  useEffect(() => {
    // Only run when we have user (profile optional for OAuth users)
    if (!user || isInitialized) {
      return;
    }

    // For OAuth users, we can proceed even without profile if we have OAuth token
    const hasOAuthToken = typeof window !== 'undefined' &&
      localStorage.getItem(`oauth_provider_token_${user.id}`);

    if (!currentProfile && !hasOAuthToken) {
      console.log('üîÑ INSTANT AUTO-FETCH: Waiting for profile or OAuth token...');
      return;
    }

    console.log('üöÄ INSTANT AUTO-FETCH: User ready, checking cache first...', {
      hasProfile: !!currentProfile,
      hasOAuthToken: !!hasOAuthToken
    });

    // üöÄ CACHE-FIRST: Check if we have recent cached data
    const cachedRepos = localStorage.getItem('github_repositories');
    const cacheTime = localStorage.getItem('github_repositories_time');
    
    if (cachedRepos && cacheTime) {
      const timeSinceCache = Date.now() - parseInt(cacheTime);
      if (timeSinceCache < 300000) { // 5 minutes
        console.log('‚ö° INSTANT: Using cached data for immediate display');
        try {
          const repos = JSON.parse(cachedRepos);
          setRepositories(repos);
          setOriginalRepositories(repos);
          // Don't show loading for cached data
        } catch (error) {
          console.error('‚ùå Cache parse error:', error);
        }
      }
    }

    // üîÑ BACKGROUND FETCH: Update data in background (non-blocking)
    const backgroundFetch = async () => {
      try {
        console.log('üîÑ BACKGROUND: Getting effective token for NEW USER...');
        const effectiveToken = await getEffectiveToken();

        if (!effectiveToken) {
          console.log('‚ö†Ô∏è NEW USER: No token available (PAT or OAuth), skipping repository fetch');
          console.log('üîç NEW USER DEBUG: This should NOT happen for GitHub OAuth users!');
          // Only show error if we don't have cached data
          if (!cachedRepos) {
            setError('Unable to access GitHub repositories. Please try refreshing the page.');
          }
          return;
        }

        console.log('‚úÖ NEW USER: Got effective token, fetching repositories...');

        console.log('üîÑ BACKGROUND: Fetching fresh data with effective token...');
        await repositoryManager.fetchRepositories(effectiveToken, false, user?.id);
        setError(null);
        console.log('‚úÖ BACKGROUND: Fresh data loaded');

        // Store token for background sync and AI Assistant with user-specific key
        if (typeof window !== 'undefined' && user) {
          localStorage.setItem(`github_pat_token_${user.id}`, effectiveToken);
          // Remove old global key
          localStorage.removeItem('github_pat_token');
        }

        // üîß Initialize AI Assistant with GitHub API (non-blocking)
        const username = currentProfile?.github_username ||
                        user?.user_metadata?.user_name ||
                        'user';
        aiAssistant.initializeGitHub(effectiveToken, username);
        console.log('üîß AI Assistant GitHub API initialized');

      } catch (error) {
        console.error('‚ùå Background fetch failed:', error);
        // Only show error if we don't have cached data
        if (!cachedRepos) {
          setError('Failed to load repositories. Please check your GitHub token or connection.');
        }
      }
    };

    // Start background fetch without blocking UI
    backgroundFetch();
    setIsInitialized(true);
  }, [user, currentProfile, isInitialized, getEffectiveToken]);

  const handleSignOut = async () => {
    await signOut();
    // REMOVED: Automatic redirect - user must manually navigate after sign out
  };

  const enablePreviewMode = (newRepos: GitHubRepo[]) => {
    setPreviewRepositories(newRepos);
    setIsPreviewMode(true);
    setHasChanges(true);
  };

  const applyPreview = () => {
    setRepositories(previewRepositories);
    setIsPreviewMode(false);
  };

  const cancelPreview = () => {
    setPreviewRepositories([]);
    setIsPreviewMode(false);
    setHasChanges(false);
  };

  const generateReadme = async (repo: GitHubRepo) => {
    setIsAiThinking(true);

    // Add user message to chat
    const userMessage: ChatMessage = {
      id: Date.now().toString(),
      role: "user",
      content: `Generate README for ${repo.name}`,
      timestamp: new Date(),
    };
    setChatMessages(prev => [...prev, userMessage]);

    // Simulate AI analysis and README generation
    setTimeout(() => {
      const readmeContent = `# ${repo.name}

${repo.description || 'A modern project built with cutting-edge technologies.'}

## üöÄ Features

- **Modern Architecture**: Built with ${repo.language || 'latest technologies'}
- **High Performance**: Optimized for speed and efficiency
- **Developer Friendly**: Easy to set up and contribute
- **Well Documented**: Comprehensive documentation and examples

## üì¶ Installation

\`\`\`bash
# Clone the repository
git clone ${repo.clone_url}

# Navigate to project directory
cd ${repo.name}

# Install dependencies
${repo.language === 'JavaScript' || repo.language === 'TypeScript' ? 'npm install' :
  repo.language === 'Python' ? 'pip install -r requirements.txt' :
  repo.language === 'Rust' ? 'cargo build' :
  repo.language === 'Go' ? 'go mod tidy' : 'make install'}
\`\`\`

## üõ†Ô∏è Usage

\`\`\`bash
# Run the application
${repo.language === 'JavaScript' || repo.language === 'TypeScript' ? 'npm start' :
  repo.language === 'Python' ? 'python main.py' :
  repo.language === 'Rust' ? 'cargo run' :
  repo.language === 'Go' ? 'go run main.go' : 'make run'}
\`\`\`

## ü§ù Contributing

1. Fork the repository
2. Create your feature branch (\`git checkout -b feature/amazing-feature\`)
3. Commit your changes (\`git commit -m 'Add some amazing feature'\`)
4. Push to the branch (\`git push origin feature/amazing-feature\`)
5. Open a Pull Request

## üìÑ License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## ‚≠ê Support

If you found this project helpful, please give it a star!

---

**Created with ‚ù§Ô∏è by NeatRepo**`;

      const aiMessage: ChatMessage = {
        id: Date.now().toString(),
        role: "assistant",
        content: `‚ö° README Generated Successfully!\n\nI've created a professional README for **${repo.name}** based on:\n\n‚Ä¢ Repository metadata and language\n‚Ä¢ Best practices and modern structure\n‚Ä¢ Installation and usage instructions\n‚Ä¢ Contributing guidelines\n\nThe README is ready to copy and paste into your repository!`,
        timestamp: new Date(),
      };

      setChatMessages(prev => [...prev, aiMessage]);
      setIsAiThinking(false);

      // Use Supabase Storage for saving and downloading
      saveAndDownloadContent(readmeContent, `README-${repo.name}.md`);
    }, 2000);
  };

  // üì• DOWNLOAD PORTFOLIO README
  const downloadPortfolioReadme = () => {
    if (!generatedReadme) return;

    const filename = `Portfolio-README-${new Date().toISOString().split('T')[0]}.md`;
    saveAndDownloadContent(generatedReadme, filename);

    // Show success message
    const successMessage: ChatMessage = {
      id: Date.now().toString(),
      role: "assistant",
      content: "üéâ **Portfolio README Downloaded!**\n\nYour personalized README has been saved. Upload it to your GitHub profile repository to showcase your unique story and skills!",
      timestamp: new Date(),
    };
    setChatMessages(prev => [...prev, successMessage]);
  };

  const generateTemplate = async (templateId: string) => {
    const template = projectTemplates.find(t => t.id === templateId);
    if (!template) return;

    setIsAiThinking(true);

    // Add user message to chat
    const userMessage: ChatMessage = {
      id: Date.now().toString(),
      role: "user",
      content: `Generate ${template.name} template`,
      timestamp: new Date(),
    };
    setChatMessages(prev => [...prev, userMessage]);

    // Simulate template generation
    setTimeout(() => {
      const fileStructure = template.files.map(file => `üìÑ ${file}`).join('\n');

      const aiMessage: ChatMessage = {
        id: Date.now().toString(),
        role: "assistant",
        content: `üöÄ ${template.name} Template Generated!\n\n${template.description}\n\n**File Structure:**\n${fileStructure}\n\n**Next Steps:**\n‚Ä¢ Create a new repository on GitHub\n‚Ä¢ Clone it locally\n‚Ä¢ Copy this structure to your project\n‚Ä¢ Start coding!\n\n**Template includes:**\n‚Ä¢ Modern project structure\n‚Ä¢ Best practices configuration\n‚Ä¢ Development tools setup\n‚Ä¢ Testing framework`,
        timestamp: new Date(),
      };

      setChatMessages(prev => [...prev, aiMessage]);
      setIsAiThinking(false);
      setSelectedTemplate("");

      // Generate downloadable template structure file
      const templateContent = `# ${template.name} Template

${template.description}

## File Structure

${template.files.map(file => `- ${file}`).join('\n')}

## Getting Started

1. Create a new repository on GitHub
2. Clone the repository locally
3. Create the file structure above
4. Install dependencies and start developing!

---
Generated by NeatRepo`;

      // Use Supabase Storage for saving and downloading
      saveAndDownloadContent(templateContent, `${template.id}-template.md`);
    }, 1500);
  };





  const onDragEnd = (result: DropResult) => {
    const { source, destination } = result;
    if (!destination) return;

    // üéØ CLEAN UX: Update repositories directly, no jumpscare preview
    const newRepos = Array.from(repositories);
    const [reorderedItem] = newRepos.splice(source.index, 1);
    newRepos.splice(destination.index, 0, reorderedItem);

    // üöÄ SEAMLESS: Update repositories and show apply button
    setRepositories(newRepos);
    setHasChanges(true);

    console.log(`üéØ Seamless Drag: "${reorderedItem.name}" moved from position ${source.index + 1} to ${destination.index + 1}`);
  };

  const toggleRepoExpansion = (repoId: number) => {
    setExpandedRepos((prev) => {
      const newSet = new Set(prev);
      if (newSet.has(repoId)) {
        newSet.delete(repoId);
      } else {
        newSet.add(repoId);
      }
      return newSet;
    });
  };

  // Function to send a specific message directly
  const sendDirectMessage = async (message: string) => {
    if (!message.trim()) return;

    const newMessage: ChatMessage = {
      id: Date.now().toString(),
      role: "user",
      content: message,
      timestamp: new Date(),
    };
    setChatMessages((prev) => [...prev, newMessage]);
    setIsAiThinking(true);

    // Continue with the same logic as handleSendMessage
    await processMessage(message);
  };

  const handleSendMessage = async () => {
    if (!chatMessage.trim()) return;

    const currentMessage = chatMessage;
    setChatMessage("");
    await sendDirectMessage(currentMessage);
  };

  // Extract the message processing logic
  const processMessage = async (currentMessage: string) => {
    // üéØ CHECK FOR GREETINGS FIRST
    const greetingWords = ['hello', 'hi', 'hey', 'greetings', 'good morning', 'good afternoon', 'good evening'];
    const isGreeting = greetingWords.some(greeting =>
      currentMessage.toLowerCase().trim() === greeting ||
      currentMessage.toLowerCase().startsWith(greeting + ' ') ||
      currentMessage.toLowerCase().startsWith(greeting + ',') ||
      currentMessage.toLowerCase().startsWith(greeting + '!')
    );

    if (isGreeting) {
      const helpMessage = `üëã Hello! I'm your GitHub AI Assistant. Here's what I can help you with:

**Repository Analysis:**
1. Analyze your portfolio structure
2. Review code quality and organization
3. Suggest improvements for better visibility

**Content Generation:**
1. Generate professional README files
2. Create compelling repository descriptions
3. Write documentation and guides

**Career Optimization:**
1. Optimize repositories for job applications
2. Prioritize projects for your portfolio
3. Get feedback on your coding showcase

**Quick Commands:**
‚Ä¢ "analyze my repos" - Get detailed portfolio analysis
‚Ä¢ "generate README for [repo-name]" - Create documentation
‚Ä¢ "optimize for jobs" - Get career-focused suggestions
‚Ä¢ "brutal feedback" - Switch to critic mode for honest reviews

What would you like to start with? üöÄ`;

      const aiMessage: ChatMessage = {
        id: Date.now().toString() + "-ai",
        role: "assistant",
        content: helpMessage,
        timestamp: new Date(),
      };
      setChatMessages((prev) => [...prev, aiMessage]);
      setIsAiThinking(false);
      return;
    }

    // üöÄ TRUE AI ASSISTANT - Real AI-powered responses with actions
    try {
      // üîß Initialize GitHub API using the same token source as repository manager
      let effectiveToken = await getEffectiveToken();

      // üîß FALLBACK: Check localStorage for PAT token (used during recovery)
      if (!effectiveToken && typeof window !== 'undefined') {
        const localToken = localStorage.getItem('github_pat_token');
        if (localToken) {
          effectiveToken = localToken;
          console.log('üîß AI Assistant: Using PAT token from localStorage (recovery mode)');
        }
      }

      if (effectiveToken) {
        const username = profile?.github_username || effectiveProfile?.github_username || currentUser?.user_metadata?.user_name || 'user';
        aiAssistant.initializeGitHub(effectiveToken, username);
        console.log('üîß AI Assistant GitHub API initialized with effective token for:', username);
      } else {
        console.log('‚ö†Ô∏è AI Assistant: No effective token available');
      }

      // Update AI context with current repositories
      aiAssistant.updateContext(repositories);

      // Add user message to AI conversation history
      aiAssistant.addToHistory('user', currentMessage);

      // üîÑ IMMEDIATE PROGRESS FEEDBACK
      const progressMessage: ChatMessage = {
        id: Date.now().toString() + "-progress",
        role: "assistant",
        content: "üß† Analyzing your request...",
        timestamp: new Date(),
      };
      setChatMessages((prev) => [...prev, progressMessage]);

      // üéØ ENHANCED AI ASSISTANT WITH PERSONALITY MODES
      // Create system prompt based on mode
      let systemPrompt = "";
      if (isCriticMode) {
        systemPrompt = `You are a brutally honest GitHub portfolio critic. Be harsh but constructive.

CRITICAL FORMATTING RULES:
- ALWAYS use numbered lists (1. 2. 3.)
- NEVER write long paragraphs
- Each point must be on a separate line
- Use clear section headers

EXACT RESPONSE FORMAT (REQUIRED):
1. Brief brutal assessment
2. Another harsh observation

Issues:
1. First major problem
2. Second major problem
3. Third major problem

Fixes:
1. First concrete solution
2. Second concrete solution
3. Third concrete solution

User has ${repositories.length} repositories, ${repositories.reduce((sum, repo) => sum + repo.stargazers_count, 0)} total stars.
${repositories.filter(repo => !repo.description || repo.description.length < 10).length} repos have poor descriptions.

Be brutal and sarcastic but follow the EXACT numbered format above.`;
      } else {
        systemPrompt = `You are an encouraging GitHub portfolio assistant. Be supportive but concise.

CRITICAL FORMATTING RULES:
- ALWAYS use numbered lists (1. 2. 3.)
- NEVER write long paragraphs
- Each point must be on a separate line
- Use clear section headers

EXACT RESPONSE FORMAT (REQUIRED):
1. Brief encouraging assessment
2. Another positive observation

Strengths:
1. First strength you notice
2. Second strength you notice
3. Third strength you notice

Suggestions:
1. First improvement suggestion
2. Second improvement suggestion
3. Third improvement suggestion

User has ${repositories.length} repositories, ${repositories.reduce((sum, repo) => sum + repo.stargazers_count, 0)} total stars.
${repositories.filter(repo => !repo.description || repo.description.length < 10).length} repos could benefit from better descriptions.

Be encouraging and supportive but follow the EXACT numbered format above.`;
      }

      // Add repository context to the AI assistant
      aiAssistant.updateContext(repositories, {});



      // üéØ DIRECT AI RESPONSE WITH PERSONALITY MODE
      try {
        // First try to parse as an action
        const action = await aiAssistant.parseCommand(currentMessage);
        console.log(' Parsed action:', action);
        
        let response: string;
        
        if (action.type !== 'general_response') {
          // Execute the specific action
          const actionResult = await aiAssistant.executeAction(action);
          response = actionResult.message;
          console.log('üéØ Action executed:', actionResult);

          // Handle interview-specific actions
          if (action.type === 'start_interview') {
            setIsInterviewMode(true);
            setInterviewProgress(0);
          } else if (action.type === 'interview_answer') {
            if (actionResult.data?.interviewCompleted) {
              setIsInterviewMode(false);
              setInterviewProgress(100);
              setGeneratedReadme(actionResult.data.portfolioReadme);
            } else if (actionResult.data?.progress) {
              setInterviewProgress(actionResult.data.progress);
            }
          } else if (action.type === 'generate_portfolio_readme') {
            setGeneratedReadme(actionResult.data?.portfolioReadme);
          }
        } else {
          // Fall back to direct AI response for general queries
          response = await geminiAI.generateResponse(
            currentMessage,
            chatMessages.slice(-5).map(msg => ({
              role: msg.role,
              content: msg.content
            })),
            systemPrompt
          );
          console.log(' Direct AI Response:', response);
        }

        console.log('‚úÖ Direct AI Response:', response);

        // Replace progress message with AI response
        setChatMessages((prev) => {
          const newMessages = [...prev];
          const progressIndex = newMessages.findIndex(msg => msg.id.includes("-progress"));
          if (progressIndex !== -1) {
            newMessages[progressIndex] = {
              id: Date.now().toString() + "-ai",
              role: "assistant",
              content: response,
              timestamp: new Date(),
            };
          } else {
            newMessages.push({
              id: Date.now().toString() + "-ai",
              role: "assistant",
              content: response,
              timestamp: new Date(),
            });
          }
          return newMessages;
        });
        setIsAiThinking(false);
        return;
      } catch (error) {
        console.error('‚ùå AI Response Error:', error);

        // Show error message to user
        setChatMessages((prev) => {
          const newMessages = [...prev];
          const progressIndex = newMessages.findIndex(msg => msg.id.includes("-progress"));
          if (progressIndex !== -1) {
            newMessages[progressIndex] = {
              id: Date.now().toString() + "-ai",
              role: "assistant",
              content: `‚ùå Sorry, I'm having trouble connecting to the AI service right now. Please try again in a moment.\n\nError: ${error.message}`,
              timestamp: new Date(),
            };
          }
          return newMessages;
        });
        setIsAiThinking(false);
        return;
      }



    } catch (error) {
      console.error('‚ùå Outer Error in handleSendMessage:', error);

      // Show error message to user
      setChatMessages((prev) => {
        const newMessages = [...prev];
        const progressIndex = newMessages.findIndex(msg => msg.id.includes("-progress"));
        if (progressIndex !== -1) {
          newMessages[progressIndex] = {
            id: Date.now().toString() + "-ai",
            role: "assistant",
            content: `‚ùå Sorry, I encountered an unexpected error. Please try again.\n\nError: ${error.message}`,
            timestamp: new Date(),
          };
        }
        return newMessages;
      });
      setIsAiThinking(false);
    }
  };

  const applyChanges = async () => {
    console.log("Applying changes to repository order");

    // Show loading state
    setIsAiThinking(true);

    try {
      // Apply preview changes if in preview mode
      if (isPreviewMode) {
        applyPreview();
      }

      // Simulate API call to save repository order
      await new Promise(resolve => setTimeout(resolve, 1000));

      // Add success message to chat
      const successMessage: ChatMessage = {
        id: Date.now().toString(),
        role: "assistant",
        content: `‚úÖ Repository order updated successfully!\n\nI've reorganized your repositories according to your changes. The new order has been saved to your profile.`,
        timestamp: new Date(),
      };

      setChatMessages(prev => [...prev, successMessage]);
      setHasChanges(false);

      console.log("‚úÖ Repository order applied successfully");
    } catch (error) {
      console.error("‚ùå Failed to apply changes:", error);

      // Add error message to chat
      const errorMessage: ChatMessage = {
        id: Date.now().toString(),
        role: "assistant",
        content: `‚ùå Failed to apply changes\n\nThere was an error saving your repository order. Please try again.`,
        timestamp: new Date(),
      };

      setChatMessages(prev => [...prev, errorMessage]);
    } finally {
      setIsAiThinking(false);
    }
  };

  // üéØ GENERATE JOB TEMPLATE - AI selects 4 most relevant repos
  const generateJobTemplate = async () => {
    if (!jobTitle.trim()) return;

    setIsGeneratingTemplate(true);
    console.log(`üéØ Generating template for: ${jobTitle}`);

    try {
      // Filter out forked repositories for template (focus on original work)
      const originalRepos = repositories.filter(repo => !repo.fork);

      // AI prompt to select best repositories for the job
      const prompt = `As a career advisor, analyze these repositories and select the 4 MOST RELEVANT ones for a "${jobTitle}" position.

Repositories:
${originalRepos.map(repo => `
- ${repo.name}: ${repo.description || 'No description'} (${repo.language || 'Unknown language'}, ${repo.stargazers_count} stars)
`).join('')}

Consider:
1. Programming languages relevant to ${jobTitle}
2. Project complexity and completeness
3. Industry relevance
4. Professional presentation

Return ONLY the repository names in this exact format:
1. repository-name-1
2. repository-name-2
3. repository-name-3
4. repository-name-4

No explanations, just the list.`;

      const response = await geminiAI.generateResponse(prompt, [], "You are a career advisor helping developers select their best repositories for job applications.");

      // Parse AI response to get repository names
      const selectedRepoNames = response
        .split('\n')
        .map(line => line.replace(/^\d+\.\s*/, '').trim())
        .filter(name => name.length > 0)
        .slice(0, 4);

      // Find the actual repository objects
      const selectedRepos = selectedRepoNames
        .map(name => originalRepos.find(repo => repo.name === name))
        .filter(repo => repo !== undefined) as GitHubRepo[];

      setTemplateResults(selectedRepos);

      // Add success message to chat
      const successMessage: ChatMessage = {
        id: Date.now().toString(),
        role: "assistant",
        content: `üéØ **Perfect ${jobTitle} Portfolio Generated!**

I've selected your 4 most relevant repositories for ${jobTitle} positions:

${selectedRepos.map((repo, index) => `
**${index + 1}. ${repo.name}**
- Language: ${repo.language || 'Multiple'}
- Stars: ${repo.stargazers_count}
- ${repo.description || 'Professional project showcasing your skills'}
`).join('')}

These repositories best demonstrate the skills recruiters look for in ${jobTitle} candidates. Perfect for your CV and portfolio! üöÄ`,
        timestamp: new Date(),
      };

      setChatMessages(prev => [...prev, successMessage]);

    } catch (error) {
      console.error("‚ùå Failed to generate template:", error);

      const errorMessage: ChatMessage = {
        id: Date.now().toString(),
        role: "assistant",
        content: `‚ùå Failed to generate job template\n\nThere was an error analyzing your repositories. Please try again.`,
        timestamp: new Date(),
      };

      setChatMessages(prev => [...prev, errorMessage]);
    } finally {
      setIsGeneratingTemplate(false);
    }
  };

  const getLanguageColor = (language: string) => {
    return "bg-gray-500";
  };

  const formatTimeAgo = (dateString: string) => {
    const date = new Date(dateString);
    const now = new Date();
    const seconds = Math.floor((now.getTime() - date.getTime()) / 1000);
    let interval = seconds / 31536000;
    if (interval > 1) return Math.floor(interval) + " years ago";
    interval = seconds / 2592000;
    if (interval > 1) return Math.floor(interval) + " months ago";
    interval = seconds / 86400;
    if (interval > 1) return Math.floor(interval) + " days ago";
    return "today";
  };

  const ThinkingSpinner = () => (
    <div className="w-5 h-5 border-2 border-muted-foreground/30 border-t-transparent rounded-full animate-spin"></div>
  );

  // CONDITIONAL RETURNS AFTER ALL HOOKS
  // CRITICAL FIX: Remove problematic auth check that causes 1-second kick
  // The middleware already handles auth protection, so this is redundant
  // if (!currentUser && !loading) {
  //   // Wait longer for auth to establish and check user from auth provider too
  //   if (typeof window !== 'undefined' && !user) {
  //     setTimeout(() => {
  //       console.log('üö´ DASHBOARD: No user after extended wait, redirecting to homepage');
  //       window.location.href = '/';
  //     }, 3000); // Increased from 1000ms to 3000ms
  //   }
  //   return (
  //     <div className="min-h-screen bg-background flex items-center justify-center">
  //       <div className="text-center">
  //         <h1 className="text-2xl font-bold mb-4">Loading Dashboard...</h1>
  //         <p className="text-muted-foreground">Please wait while we load your dashboard.</p>
  //       </div>
  //     </div>
  //   );
  // }

  // üîß SIMPLIFIED: Single timeout to prevent infinite "Getting ready" state
  useEffect(() => {
    if (loading || isProcessingOAuthCallback) {
      // Set a reasonable timeout to prevent infinite loading
      const loadingTimeout = setTimeout(async () => {
        console.log('‚ö†Ô∏è LOADING TIMEOUT: Dashboard stuck in loading - attempting recovery');
        setIsProcessingOAuthCallback(false);
        // If auth provider is still loading, try to force session refresh
        if (loading) {
          console.log('üîß DASHBOARD RECOVERY: Auth provider still loading, forcing session refresh');
          try {
            const { data, error } = await supabase.auth.refreshSession();
            if (error) {
              console.error('‚ùå DASHBOARD RECOVERY: Session refresh failed:', error);
            } else {
              console.log('‚úÖ DASHBOARD RECOVERY: Session refresh completed');
            }
          } catch (refreshError) {
            console.error('‚ùå DASHBOARD RECOVERY: Exception during session refresh:', refreshError);
          }
        }
      }, 10000); // 10 second timeout for dashboard loading recovery

      return () => clearTimeout(loadingTimeout);
    }
  }, [loading, isProcessingOAuthCallback]);

  // üöÄ IMPROVED LOADING: Better user feedback and faster resolution
  if (loading || isProcessingOAuthCallback) {
    // Show specific loading message for OAuth callback processing
    const loadingMessage = isProcessingOAuthCallback
      ? "Loading your repositories..."
      : "Getting ready...";

    return (
      <div className="min-h-screen bg-background flex items-center justify-center">
        <div className="text-center">
          <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"></div>
          <p className="text-muted-foreground">{loadingMessage}</p>
          {isProcessingOAuthCallback && (
            <p className="text-xs text-muted-foreground mt-2">
              Fetching your GitHub repositories...
            </p>
          )}
          <p className="text-xs text-muted-foreground mt-4">
            Taking longer than expected? Try refreshing the page.
          </p>
          <button
            onClick={() => {
              console.log('üßπ USER INITIATED: Clearing cache and reloading');
              localStorage.clear();
              sessionStorage.clear();
              window.location.reload();
            }}
            className="mt-2 px-4 py-2 text-xs bg-black text-white rounded hover:bg-gray-800 dark:bg-white dark:text-black dark:hover:bg-gray-200"
          >
            Clear Cache & Reload
          </button>
        </div>
      </div>
    );
  }

  // üöÄ ULTRA-FAST: FORCE RENDER - NO LOADING SCREEN!
  // Always render dashboard immediately for maximum speed

  const publicRepos = repositories.filter((repo) => !repo.private).length;
  const privateRepos = repositories.length - publicRepos;

  return (
    <div
      className="min-h-screen bg-background text-foreground"
      data-user-id={currentUser?.id}
      data-loading={loading.toString()}
      data-repos-count={repositories.length}
    >
      {/* üöÄ ENHANCED DASHBOARD HEADER WITH MULTI-ACCOUNT SUPPORT */}
      <DashboardHeader />



      <div className="container mx-auto px-6 py-8">
        <div className="grid grid-cols-3 gap-8">
          <div className="col-span-2">
            {/* GitHub Token Warning - Use auth provider state */}
            {!profile?.github_pat_token && (
              <GitHubTokenWarning onSetupToken={showTokenPopup} />
            )}

            {/* Legacy Token Warning Badge */}
            <TokenWarningBadge />

            {error && (
              <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert">
                <strong className="font-bold">Error: </strong>
                <span className="block sm:inline">{error}</span>
              </div>
            )}

            {/* Project Templates Section */}
            <Card className="mb-6 border-border/50">
              <CardHeader className="pb-3">
                <div className="flex items-center justify-between">
                  <div className="flex items-center space-x-2">
                    <Plus className="h-5 w-5 text-muted-foreground" />
                    <CardTitle className="text-lg">Quick Start Templates</CardTitle>
                  </div>
                </div>
              </CardHeader>
              <CardContent className="pt-0">
                <div className="flex items-center space-x-4">
                  <div className="flex-1">
                    <Select value={selectedTemplate} onValueChange={setSelectedTemplate}>
                      <SelectTrigger className="w-full">
                        <SelectValue placeholder="Choose a project template..." />
                      </SelectTrigger>
                      <SelectContent>
                        {projectTemplates.map((template) => (
                          <SelectItem key={template.id} value={template.id}>
                            <div className="flex items-center space-x-2">
                              <span>{template.icon}</span>
                              <div>
                                <div className="font-medium">{template.name}</div>
                                <div className="text-xs text-muted-foreground">{template.description}</div>
                              </div>
                            </div>
                          </SelectItem>
                        ))}
                      </SelectContent>
                    </Select>
                  </div>
                  <Button
                    onClick={() => selectedTemplate && generateTemplate(selectedTemplate)}
                    disabled={!selectedTemplate || isAiThinking}
                    className="bg-foreground text-background hover:bg-foreground/90"
                  >
                    <Plus className="h-4 w-4 mr-2" />
                    Generate Template
                  </Button>
                </div>
                <p className="text-xs text-muted-foreground mt-2">
                  Generate a complete project structure with best practices and modern tooling
                </p>
              </CardContent>
            </Card>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
              <Card>
                <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                  <CardTitle className="text-sm font-medium">Total Repositories</CardTitle>
                  <Folder className="h-4 w-4 text-muted-foreground" />
                </CardHeader>
                <CardContent>
                  <div className="text-2xl font-bold">{repositories.length}</div>
                  <p className="text-xs text-muted-foreground">
                    {publicRepos} public, {privateRepos} private
                  </p>
                </CardContent>
              </Card>
              <Card>
                <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                  <CardTitle className="text-sm font-medium">Total Stars</CardTitle>
                  <Star className="h-4 w-4 text-muted-foreground" />
                </CardHeader>
                <CardContent>
                  <div className="text-2xl font-bold">
                    {repositories.reduce((sum, repo) => sum + repo.stargazers_count, 0)}
                  </div>
                  <p className="text-xs text-muted-foreground">Across all repositories</p>
                </CardContent>
              </Card>
            </div>

            {/* üöÄ ACTION BUTTONS - ALIGNED ACCORDING TO MOCKUP */}
            <div className="flex items-center justify-between gap-4 mb-6">
              {/* Left Side Container for Refresh and Sort Buttons */}
              <div className="flex items-center gap-4">
                {/* Refresh Button */}
                <Button
                  variant="outline"
                  size="sm"
                  onClick={async () => {
                    const effectiveToken = await getEffectiveToken();
                    if (effectiveToken) {
                      setIsLoadingRepos(true);
                      setError(null); // Clear any previous errors
                      
                      // Add timeout protection for manual refresh too
                      const refreshTimeout = setTimeout(() => {
                        console.warn('‚è∞ Manual refresh timeout - resetting loading state');
                        setIsLoadingRepos(false);
                        setError('Refresh timed out. Please try again.');
                      }, 15000);

                      try {
                        await repositoryManager.fetchRepositories(effectiveToken, true);
                        clearTimeout(refreshTimeout);
                        console.log('‚úÖ Manual refresh completed successfully');
                      } catch (error) {
                        clearTimeout(refreshTimeout);
                        console.error('‚ùå Manual refresh failed:', error);
                        setIsLoadingRepos(false);
                        setError('Failed to refresh repositories. Please try again.');
                      }
                    } else {
                      setError('No GitHub token available. Please setup your GitHub token.');
                    }
                  }}
                  className="flex items-center gap-2"
                  title="Refresh repositories"
                  disabled={isLoadingRepos}
                >
                  <RefreshCw className={`h-4 w-4 ${isLoadingRepos ? 'animate-spin' : ''}`} />
                  <span>Refresh</span>
                </Button>

                {/* üìÖ DATE SORTING SELECT */}
                <div className="flex items-center gap-2">
                  <Calendar className="h-4 w-4 text-muted-foreground" />
                  <Select value={dateSortOrder} onValueChange={(value: 'newest' | 'oldest' | 'default') => handleDateSort(value)}>
                    <SelectTrigger className="w-[140px] h-9">
                      <SelectValue placeholder="Sort by Date" />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="default">Default Order</SelectItem>
                      <SelectItem value="newest">Newest First</SelectItem>
                      <SelectItem value="oldest">Oldest First</SelectItem>
                    </SelectContent>
                  </Select>
                </div>

                {/* ADD REPOSITORY BUTTON */}
                <Button
                  variant="outline"
                  size="icon"
                  onClick={() => setShowAddRepoModal(true)}
                  title="Add Repository"
                >
                  <Plus className="h-4 w-4" />
                  <span className="sr-only">Add Repository</span>
                </Button>

                {/* JOB TEMPLATE BUTTON */}
                <Button
                  variant="outline"
                  size="sm"
                  onClick={() => setShowJobTemplateModal(true)}
                  className="flex items-center gap-2"
                  title="Generate job-specific portfolio template"
                >
                  <Target className="h-4 w-4" />
                  <span>Job Template</span>
                </Button>
              </div>

              {/* Right Side Container for Delete Buttons */}
              <div className="flex items-center gap-4">
                {/* üóëÔ∏è DELETE MODE TOGGLE - ALIGNED TO RIGHT AS PER MOCKUP */}
                <Button
                  variant={isDeleteMode ? "destructive" : "outline"}
                  size="sm"
                  onClick={!currentProfile?.github_pat_token ? undefined : toggleDeleteMode}
                  disabled={!currentProfile?.github_pat_token}
                  className={`flex items-center gap-2 ${!currentProfile?.github_pat_token ? 'hover:cursor-not-allowed' : ''}`}
                  
                  title={
                    !currentProfile?.github_pat_token
                      ? "GitHub Personal Access Token required for delete operations"
                      : isDeleteMode
                        ? "Exit delete mode"
                        : "Enter delete mode - Clean up your portfolio!"
                  }
                >
                  <Trash2 className="h-4 w-4" />
                  <span>{isDeleteMode ? "Exit delete mode" : "Enter delete mode"}</span>
                </Button>

                {/* üöÄ BULK DELETE BUTTON */}
                {isDeleteMode && selectedRepos.size > 0 && (
                  <Button
                    variant="destructive"
                    size="sm"
                    onClick={handleBulkDelete}
                    className="flex items-center gap-2"
                    title={`Delete ${selectedRepos.size} selected repositories`}
                  >
                    <Trash2 className="h-4 w-4" />
                    <span>Delete {selectedRepos.size}</span>
                  </Button>
                )}
              </div>
            </div>

            {false ? (
              /* REMOVED: Two-Column Preview Layout - No more jumpscare! */
              <div className="grid grid-cols-2 gap-6">
                {/* Current Order */}
                <Card className="opacity-75 border-gray-500/30">
                  <CardHeader className="pb-3">
                    <div className="flex items-center justify-between">
                      <CardTitle className="text-sm font-medium text-muted-foreground flex items-center gap-2">
                        <Eye className="h-4 w-4" />
                        Current Order
                      </CardTitle>
                      <Badge variant="outline" className="text-xs">Before</Badge>
                    </div>
                  </CardHeader>
                  <CardContent className="p-4 pt-0">
                    <ScrollArea className="h-[calc(100vh-300px)]">
                      <div className="space-y-2 pr-4">
                        {repositories.map((repo, index) => (
                        <div key={repo.id} className="p-3 rounded-lg border bg-card border-border">
                          <div className="flex items-center space-x-3">
                            <div className="w-4 h-4 flex items-center justify-center text-xs text-muted-foreground">
                              {index + 1}
                            </div>
                            <Folder className="h-4 w-4 text-muted-foreground" />
                            <div className="flex-1">
                              <div className="flex items-center space-x-2">
                                <span className="font-medium text-sm">{repo.name}</span>
                                {repo.language && (
                                  <Badge variant="outline" className="text-xs">
                                    {repo.language}
                                  </Badge>
                                )}
                              </div>
                              <div className="flex items-center space-x-4 mt-1 text-xs text-muted-foreground">
                                <div className="flex items-center space-x-1">
                                  <Star className="h-3 w-3" />
                                  <span>{repo.stargazers_count}</span>
                                </div>
                                <div className="flex items-center space-x-1">
                                  <Clock className="h-3 w-3" />
                                  <span>{formatTimeAgo(repo.updated_at)}</span>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      ))}
                      </div>
                    </ScrollArea>
                  </CardContent>
                </Card>

                {/* Preview Order */}
                <Card className="border-border/50 shadow-sm">
                  <CardHeader className="pb-3">
                    <div className="flex items-center justify-between">
                      <CardTitle className="text-sm font-medium flex items-center gap-2">
                        <ArrowUp className="h-4 w-4" />
                        Preview Changes
                      </CardTitle>
                      <div className="text-xs text-muted-foreground">
                        üí° Live Preview: Drag repos on the left, see instant preview on the right! ESC to reset, Ctrl+Enter to apply
                      </div>
                      <div className="flex items-center space-x-2">
                        <Badge className="text-xs bg-foreground text-background">After</Badge>
                        <Button
                          variant="ghost"
                          size="sm"
                          onClick={cancelPreview}
                          className="text-xs hover:bg-destructive/20 hover:text-destructive"
                          title="Reset to original order"
                        >
                          ‚Ü∫ Reset
                        </Button>
                        <Button
                          variant="outline"
                          size="sm"
                          onClick={() => {
                            // Hide preview but keep changes for more dragging
                            setIsPreviewMode(false);
                            // Keep hasChanges true so user can see they have pending changes
                          }}
                          className="text-xs"
                          title="Hide preview and continue dragging - changes are saved in background"
                        >
                          üéØ Continue Live Dragging
                        </Button>
                        <Button
                          size="sm"
                          onClick={applyChanges}
                          disabled={isAiThinking}
                          className="text-xs bg-foreground text-background hover:bg-foreground/90"
                          title="Save this order permanently"
                        >
                          ‚úÖ Apply Changes
                        </Button>
                      </div>
                    </div>
                  </CardHeader>
                  <CardContent className="p-4 pt-0">
                    <ScrollArea className="h-[calc(100vh-300px)]">
                      <div className="space-y-2 pr-4">
                        {previewRepositories.map((repo, index) => {
                        const originalIndex = repositories.findIndex(r => r.id === repo.id);
                        const positionChanged = originalIndex !== index;
                        const positionDiff = originalIndex - index;

                        return (
                          <div key={repo.id} className={`p-3 rounded-lg border bg-card transition-all duration-200 ${
                            positionChanged ? 'border-foreground/20 bg-muted/50' : 'border-border/50'
                          }`}>
                            <div className="flex items-center space-x-3">
                              <div className="w-4 h-4 flex items-center justify-center text-xs text-yellow-400 font-medium">
                                {index + 1}
                              </div>
                              {positionChanged && (
                                <div className="flex items-center text-xs">
                                  {positionDiff > 0 ? (
                                    <ArrowUp className="h-3 w-3 text-green-400" />
                                  ) : (
                                    <ArrowUp className="h-3 w-3 text-red-400 rotate-180" />
                                  )}
                                  <span className="text-yellow-400 ml-1">
                                    {Math.abs(positionDiff)}
                                  </span>
                                </div>
                              )}
                              <Folder className="h-4 w-4 text-yellow-400" />
                              <div className="flex-1">
                                <div className="flex items-center space-x-2">
                                  <span className="font-medium text-sm">{repo.name}</span>
                                  {positionChanged && (
                                    <Badge variant="outline" className="text-xs bg-muted text-muted-foreground border-border">
                                      Moved
                                    </Badge>
                                  )}
                                  {repo.language && (
                                    <Badge variant="outline" className="text-xs">
                                      {repo.language}
                                    </Badge>
                                  )}
                                </div>
                                <div className="flex items-center space-x-4 mt-1 text-xs text-muted-foreground">
                                  <div className="flex items-center space-x-1">
                                    <Star className="h-3 w-3" />
                                    <span>{repo.stargazers_count}</span>
                                  </div>
                                  <div className="flex items-center space-x-1">
                                    <Clock className="h-3 w-3" />
                                    <span>{formatTimeAgo(repo.updated_at)}</span>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        );
                      })}
                      </div>
                    </ScrollArea>
                  </CardContent>
                </Card>
              </div>
            ) : (
              /* Normal Single Column Layout */
              <Card>
                <CardContent className="p-4">
                  <ScrollArea className="h-[calc(100vh-200px)]">
                    <div className="pr-4">
                      {repositories.length === 0 ? (
                    isLoadingRepos ? (
                      <div className="flex items-center justify-center py-12">
                        <div className="flex items-center space-x-2">
                          <RefreshCw className="h-5 w-5 animate-spin" />
                          <span>Loading repositories...</span>
                        </div>
                      </div>
                    ) : (
                      // üéØ SUPER FRIENDLY MESSAGE FOR NEW USERS
                      <div className="flex flex-col items-center justify-center py-12 space-y-6">
                        <div className="text-center">
                          <div className="relative">
                            <Folder className="h-16 w-16 text-muted-foreground mx-auto mb-4" />
                            <div className="absolute -top-2 -right-2 w-6 h-6 bg-yellow-500 rounded-full flex items-center justify-center">
                              <span className="text-white text-xs font-bold">!</span>
                            </div>
                          </div>
                          <h3 className="text-xl font-semibold text-foreground mb-2">Welcome to NeatRepo! üéâ</h3>
                          <p className="text-muted-foreground mb-6 max-w-md mx-auto">
                            We need your GitHub Personal Access Token to see your repositories and unlock powerful features like bulk delete.
                          </p>

                          <div className="flex flex-col sm:flex-row gap-3 justify-center">
                            <Button
                              onClick={() => window.location.href = '/profile'}
                              className="bg-black hover:bg-gray-800 text-white dark:bg-white dark:text-black dark:hover:bg-gray-200"
                            >
                              <Settings className="h-4 w-4 mr-2" />
                              Setup GitHub Token
                            </Button>
                            <Button
                              variant="outline"
                              size="sm"
                              onClick={async () => {
                                const effectiveToken = await getEffectiveToken();
                                if (effectiveToken) {
                                  setIsLoadingRepos(true);
                                  await repositoryManager.fetchRepositories(effectiveToken, true);
                                }
                              }}
                              className="flex items-center gap-2"
                              disabled={isLoadingRepos}
                            >
                              <RefreshCw className="h-4 w-4" />
                              Refresh Repositories
                            </Button>


                          </div>

                          <div className="mt-6 p-4 bg-yellow-50 dark:bg-yellow-950/20 rounded-lg border border-yellow-200 dark:border-yellow-800 max-w-md mx-auto">
                            <p className="text-sm text-yellow-700 dark:text-yellow-300">
                              üí° <strong>New user?</strong> Don't worry! Setting up your token takes just 2 minutes and unlocks all features.
                            </p>
                          </div>
                        </div>
                      </div>
                    )
                  ) : isLoadingRepos && repositories.length === 0 ? (
                    // üöÄ ULTRA-FAST SKELETON LOADING for perceived performance
                    <div className="space-y-2">
                      {[...Array(5)].map((_, i) => (
                        <div key={i} className="p-3 rounded-lg bg-card animate-pulse">
                          <div className="flex items-center justify-between">
                            <div className="flex items-center space-x-3">
                              <div className="w-5 h-5 bg-muted rounded"></div>
                              <div className="w-4 h-4 bg-muted rounded"></div>
                              <div className="w-4 h-4 bg-muted rounded"></div>
                              <div className="space-y-1">
                                <div className="w-32 h-4 bg-muted rounded"></div>
                                <div className="w-20 h-3 bg-muted rounded"></div>
                              </div>
                            </div>
                            <div className="w-16 h-3 bg-muted rounded"></div>
                          </div>
                        </div>
                      ))}
                      <div className="text-center py-4">
                        <p className="text-sm text-muted-foreground">üöÄ Loading repositories at light speed...</p>
                      </div>
                    </div>
                  ) : (
                    <>
                      <DragDropContext
                        onDragEnd={onDragEnd}
                        autoScrollerOptions={{
                          startFromPercentage: 0.05,
                          maxScrollAtPercentage: 0.15,
                          maxPixelScroll: 30,
                          ease: (percentage: number) => Math.pow(percentage, 2),
                          durationDampening: {
                            stopDampeningAt: 1200,
                            accelerateAt: 360,
                          },
                        }}
                      >
                        <Droppable droppableId="repositories">
                          {(provided: DroppableProvided, snapshot: DroppableStateSnapshot) => (
                            <div
                              {...provided.droppableProps}
                              ref={provided.innerRef}
                              className={`space-y-2 rounded-lg transition-all duration-200 ${
                                snapshot.isDraggingOver ? 'bg-accent/20 border-2 border-dashed border-primary/30' : ''
                              }`}
                            >
                            {repositories.map((repo, index) => (
                            <Draggable key={repo.id} draggableId={repo.id.toString()} index={index}>
                              {(provided: DraggableProvided, snapshot: DraggableStateSnapshot) => (
                                <div
                                  ref={provided.innerRef}
                                  {...provided.draggableProps}
                                  className={`p-3 rounded-lg transition-all duration-200 bg-card border ${
                                    snapshot.isDragging
                                      ? "opacity-90 shadow-2xl scale-105 border-primary/50 bg-primary/5 z-50"
                                      : snapshot.isDropAnimating
                                      ? "shadow-lg border-primary/30"
                                      : "border-border/50 hover:border-border hover:shadow-md"
                                  }`}
                                  style={{
                                    ...provided.draggableProps.style,
                                    ...(snapshot.isDragging && {
                                      transform: `${provided.draggableProps.style?.transform} rotate(2deg)`,
                                    }),
                                  }}
                                >
                                  <div className="flex items-center justify-between min-w-0">
                                    <div className="flex items-center min-w-0 flex-1 mr-4">
                                      {/* üóëÔ∏è DELETE MODE: Show checkbox instead of drag handle */}
                                      {isDeleteMode ? (
                                        <div className="mr-3 flex items-center">
                                          <input
                                            type="checkbox"
                                            checked={selectedRepos.has(repo.id)}
                                            onChange={() => toggleRepoSelection(repo.id)}
                                            className="w-4 h-4 text-destructive bg-background border-border rounded focus:ring-destructive focus:ring-2"
                                            title="Select for deletion"
                                          />
                                        </div>
                                      ) : (
                                        <div
                                          {...provided.dragHandleProps}
                                          className={`mr-3 transition-all duration-200 cursor-grab hover:cursor-grabbing ${
                                            snapshot.isDragging
                                              ? "text-primary scale-110"
                                              : "text-muted-foreground hover:text-foreground hover:scale-105"
                                          }`}
                                          title="üöÄ Drag to reorder - Multiple drags allowed!"
                                        >
                                          <GripVertical className="h-5 w-5" />
                                        </div>
                                      )}
                                      <button onClick={() => toggleRepoExpansion(repo.id)} className="mr-2">
                                        {expandedRepos.has(repo.id) ? <ChevronDown className="h-4 w-4" /> : <ChevronRight className="h-4 w-4" />}
                                      </button>
                                      <Folder className="h-4 w-4 text-muted-foreground mr-3" />
                                      <div className="flex-1 min-w-0">
                                        <div className="flex items-center space-x-2">
                                          <div className="flex items-center space-x-2 min-w-0 flex-1">
                                            {/* Position indicator */}
                                            <span className={`text-xs font-mono px-1.5 py-0.5 rounded flex-shrink-0 ${
                                              snapshot.isDragging
                                                ? "bg-primary text-primary-foreground"
                                                : "bg-muted text-muted-foreground"
                                            }`}>
                                              {index + 1}
                                            </span>
                                            <span className="font-semibold truncate">{repo.name}</span>
                                          </div>
                                          {repo.private && (
                                            <Badge variant="secondary" className="text-xs">
                                              Private
                                            </Badge>
                                          )}
                                        </div>
                                        <div className="flex items-center">
                                          <div className={`w-3 h-3 rounded-full mr-1.5 ${getLanguageColor(repo.language)}`}></div>
                                          <span>{repo.language}</span>
                                        </div>
                                      </div>
                                    </div>
                                    <div className="flex items-center space-x-2 flex-shrink-0">
                                      <div className="text-xs text-muted-foreground">
                                        Updated {formatTimeAgo(repo.updated_at)}
                                      </div>
                                    </div>
                                  </div>
                                  {expandedRepos.has(repo.id) && (
                                    <div className="pl-10 mt-2 space-y-2">
                                      <p className="text-sm text-muted-foreground">{repo.description || "No description available."}</p>
                                      <div className="flex items-center space-x-4 text-xs text-muted-foreground mt-1">
                                        <div className="flex items-center">
                                          <div className={`w-3 h-3 rounded-full mr-1.5 ${getLanguageColor(repo.language)}`}></div>
                                          <span>{repo.language}</span>
                                        </div>
                                        <div className="flex items-center">
                                          <Star className="h-3 w-3 mr-1" />
                                          <span>{repo.stargazers_count}</span>
                                        </div>
                                        <div className="flex items-center">
                                          <GitFork className="h-3 w-3 mr-1" />
                                          <span>{repo.forks_count}</span>
                                        </div>
                                        <div className="flex items-center">
                                          <Clock className="h-3 w-3 mr-1" />
                                          <span>{formatTimeAgo(repo.updated_at)}</span>
                                        </div>
                                      </div>
                                      <div className="flex space-x-2 pt-2">
                                        <Button variant="outline" size="sm" onClick={() => window.open(repo.html_url, "_blank")}>
                                          <Eye className="h-4 w-4 mr-2" /> View on GitHub
                                        </Button>
                                        <Button
                                          variant="outline"
                                          size="sm"
                                          onClick={() => {
                                            setRepoToRename(repo);
                                            setNewRepoNameForRename(repo.name);
                                            setShowRenameModal(true);
                                          }}
                                        >
                                          <Edit className="h-4 w-4 mr-2" /> Rename
                                        </Button>
                                        <Button variant="outline" size="sm">
                                          <Code className="h-4 w-4 mr-2" /> Analyze
                                        </Button>
                                        <Button
                                          variant="outline"
                                          size="sm"
                                          onClick={() => generateReadme(repo)}
                                          disabled={isAiThinking}
                                          className="bg-foreground text-background hover:bg-foreground/90 border-0"
                                        >
                                          <Zap className="h-4 w-4 mr-2" /> Quick README
                                        </Button>
                                      </div>
                                    </div>
                                  )}
                                </div>
                              )}
                            </Draggable>
                          ))}
                            {provided.placeholder}
                          </div>
                        )}
                      </Droppable>
                    </DragDropContext>


                  </>
                  )}
                    </div>
                  </ScrollArea>
                </CardContent>
              </Card>
            )}

            {/* üéØ STAGED CHANGES - Outside the repository card */}
            {hasChanges && (
              <div className="mt-4 p-3 bg-muted/30 rounded-lg border border-border/50">
                <div className="flex items-center justify-between mb-2">
                  <div className="flex items-center space-x-2">
                    <div className="w-2 h-2 bg-orange-500 rounded-full animate-pulse"></div>
                    <span className="text-sm font-medium text-muted-foreground">
                      Staged Changes
                    </span>
                  </div>
                  <span className="text-xs text-muted-foreground">
                    Repository order changed
                  </span>
                </div>
                <Button
                  onClick={applyChanges}
                  disabled={isAiThinking}
                  className="w-full bg-white text-black border border-gray-300 hover:bg-gray-50 transition-all duration-200"
                  size="sm"
                >
                  {isAiThinking ? (
                    <>
                      <div className="w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin mr-2"></div>
                      Applying Changes...
                    </>
                  ) : (
                    <>
                      <CheckCircle className="w-4 h-4 mr-2" />
                      Apply Changes
                    </>
                  )}
                </Button>
              </div>
            )}

            {/* üç¥ FORKED REPOSITORIES SECTION */}
            {repositories.filter(repo => repo.fork).length > 0 && (
              <div className="mt-6">
                <Card className="border-dashed border-2 border-gray-300 bg-gray-50/50 dark:bg-gray-900/50">
                  <CardHeader className="pb-3">
                    <div className="flex items-center gap-2">
                      <GitFork className="h-5 w-5 text-muted-foreground" />
                      <CardTitle className="text-lg">Forked Repositories</CardTitle>
                      <span className="text-sm text-muted-foreground">
                        ({repositories.filter(repo => repo.fork).length} forks)
                      </span>
                    </div>
                    <p className="text-sm text-muted-foreground">
                      Repositories you've forked from other developers - great for showing open source contributions!
                    </p>
                  </CardHeader>
                  <CardContent className="pt-0">
                    <div className="grid gap-3">
                      {repositories
                        .filter(repo => repo.fork)
                        .map((repo, index) => (
                          <div
                            key={repo.id}
                            className="flex items-center justify-between p-3 rounded-lg bg-background border border-border/50 hover:border-border transition-colors"
                          >
                            <div className="flex items-center space-x-3">
                              <div className="flex items-center justify-center w-8 h-8 rounded-full bg-muted text-muted-foreground text-sm font-medium">
                                <GitFork className="h-4 w-4" />
                              </div>
                              <div className="flex-1 min-w-0">
                                <div className="flex items-center gap-2">
                                  <h3 className="font-medium text-sm truncate">{repo.name}</h3>
                                  <span className="text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full dark:bg-yellow-900 dark:text-yellow-200">
                                    Fork
                                  </span>
                                </div>
                                {repo.parent && (
                                  <p className="text-xs text-muted-foreground">
                                    Forked from{" "}
                                    <a
                                      href={repo.parent.html_url}
                                      target="_blank"
                                      rel="noopener noreferrer"
                                      className="text-yellow-600 hover:underline dark:text-yellow-400"
                                    >
                                      {repo.parent.full_name}
                                    </a>
                                  </p>
                                )}
                                {repo.description && (
                                  <p className="text-xs text-muted-foreground mt-1 line-clamp-1">
                                    {repo.description}
                                  </p>
                                )}
                                <div className="flex items-center gap-3 mt-1">
                                  {repo.language && (
                                    <span className="text-xs text-muted-foreground flex items-center gap-1">
                                      <div className="w-2 h-2 rounded-full bg-gray-500"></div>
                                      {repo.language}
                                    </span>
                                  )}
                                  <span className="text-xs text-muted-foreground flex items-center gap-1">
                                    <Star className="h-3 w-3" />
                                    {repo.stargazers_count}
                                  </span>
                                  <span className="text-xs text-muted-foreground">
                                    Updated {new Date(repo.updated_at).toLocaleDateString()}
                                  </span>
                                </div>
                              </div>
                            </div>
                            <div className="flex items-center gap-2">
                              <Button
                                variant="ghost"
                                size="sm"
                                onClick={() => window.open(repo.html_url, '_blank')}
                                className="h-8 w-8 p-0"
                                title="View on GitHub"
                              >
                                <ExternalLink className="h-4 w-4" />
                              </Button>
                            </div>
                          </div>
                        ))}
                    </div>
                  </CardContent>
                </Card>
              </div>
            )}
          </div>

          {/* Right Sidebar: AI Chat */}
          <div className="col-span-1">
            {!isChatMinimized ? (
              <Card className="sticky top-24 shadow-lg border-gray-700/50">
                <CardHeader className="flex flex-row items-center justify-between bg-gray-800/80 backdrop-blur-sm border-b border-gray-700/50 p-2">
                  <div className="flex items-center gap-2">
                    <div className="flex items-center gap-1.5">
                      <button onClick={() => { /* Close logic */ }} className="w-3 h-3 bg-red-500 rounded-full hover:bg-red-600"></button>
                      <button onClick={() => setIsChatMinimized(true)} className="w-3 h-3 bg-yellow-400 rounded-full hover:bg-yellow-500"></button>
                      <button className="w-3 h-3 bg-green-500 rounded-full hover:bg-green-600"></button>
                    </div>
                    <h2 className="text-sm font-medium text-gray-300">
                      AI Assistant
                      {isCriticMode && <span className="text-red-400">‚Ä¢ Critic Mode</span>}
                      {isInterviewMode && <span className="text-yellow-400">‚Ä¢ Interview Mode</span>}
                    </h2>
                    {isInterviewMode && (
                      <div className="mt-1">
                        <div className="flex items-center gap-2 text-xs text-gray-400">
                          <span>Portfolio Interview Progress</span>
                          <div className="flex-1 bg-gray-700 rounded-full h-1">
                            <div
                              className="bg-yellow-500 h-1 rounded-full transition-all duration-300"
                              style={{ width: `${interviewProgress}%` }}
                            />
                          </div>
                          <span>{interviewProgress}%</span>
                        </div>
                      </div>
                    )}
                  </div>
                  <div className="flex items-center gap-2">
                    <Button
                      variant="ghost"
                      size="sm"
                      onClick={() => setIsCriticMode(!isCriticMode)}
                      className={`text-xs ${isCriticMode ? 'text-red-400 bg-red-500/20' : 'text-gray-400'}`}
                    >
                      {isCriticMode ? 'üî•' : 'üòä'} {isCriticMode ? 'Brutal' : 'Nice'}
                    </Button>

                    {/* NEW: Reset/Exit button */}
                    <Button
                      variant="ghost"
                      size="sm"
                      onClick={handleResetChat}
                      className="text-xs text-yellow-400 bg-yellow-500/20 hover:bg-yellow-500/30"
                      title="Reset chat & exit interview"
                    >
                      üîÑ Reset
                    </Button>

                    {generatedReadme && (
                      <Button
                        variant="ghost"
                        size="sm"
                        onClick={downloadPortfolioReadme}
                        className="text-xs text-green-400 bg-green-500/20 hover:bg-green-500/30"
                        title="Download Portfolio README"
                      >
                        üì• Download README
                      </Button>
                    )}
                  </div>
                </CardHeader>
                <CardContent className="p-4 h-[60vh] flex flex-col">
                  <div className="flex-grow overflow-hidden">
                    <ScrollArea className="h-full pr-2">
                      <div className="space-y-4">
                        {/* Welcome Message */}
                        <div className="flex justify-start">
                          <div className="bg-accent text-foreground border border-border p-2 rounded-lg text-sm">
                            {welcomeText}
                            {isTypingWelcome && <span className="animate-pulse">|</span>}
                          </div>
                        </div>

                        {/* GitHub Logo Center */}
                        {!isTypingWelcome && chatMessages.length === 0 && (
                          <div className="flex flex-col items-center justify-center py-8">
                            <Github className="h-16 w-16 text-gray-600 mb-4" />
                            <div className="flex flex-col gap-3 text-sm max-w-sm mx-auto">
                              <div className="grid grid-cols-2 gap-3">
                                <Button
                                  variant="outline"
                                  size="sm"
                                  className="w-full justify-start bg-transparent text-xs px-2 py-1 h-8"
                                  onClick={() => {
                                    sendDirectMessage("analyze my repository structure");
                                  }}
                                  disabled={isAiThinking}
                                >
                                  <Code className="h-3 w-3 mr-1.5" />
                                  Analyze Structure
                                </Button>
                                <Button
                                  variant="outline"
                                  size="sm"
                                  className="w-full justify-start bg-foreground text-background hover:bg-foreground/90 border-0 text-xs px-2 py-1 h-8"
                                  onClick={() => {
                                    if (repositories.length > 0) {
                                      generateReadme(repositories[0]);
                                    }
                                  }}
                                  disabled={isAiThinking || repositories.length === 0}
                                >
                                  <Zap className="h-3 w-3 mr-1.5" />
                                  Quick README
                                </Button>
                              </div>
                              <Button
                                variant="outline"
                                size="sm"
                                className="w-full justify-start bg-transparent text-xs px-2 py-1 h-8"
                                onClick={() => {
                                  sendDirectMessage("give me suggestions to improve my repositories");
                                }}
                                disabled={isAiThinking}
                              >
                                <Lightbulb className="h-3 w-3 mr-1.5" />
                                Get Suggestions
                              </Button>

                              {/* Portfolio README Actions */}
                              <div className="border-t border-border pt-2 mt-2">
                                <div className="text-xs text-muted-foreground mb-2 font-medium">üìù Portfolio README</div>
                                <div className="grid grid-cols-1 gap-2">
                                  <Button
                                    variant="outline"
                                    size="sm"
                                    className="w-full justify-start bg-yellow-500/10 text-yellow-400 border-yellow-500/30 hover:bg-yellow-500/20 text-xs px-2 py-1 h-8"
                                    onClick={() => {
                                      sendDirectMessage("start interview for personalized portfolio README");
                                    }}
                                    disabled={isAiThinking || repositories.length === 0 || isInterviewMode}
                                  >
                                    <MessageCircle className="h-3 w-3 mr-1.5" />
                                    {isInterviewMode ? 'Interview Active...' : 'Generate Portfolio README'}
                                  </Button>
                                  <div className="text-xs text-muted-foreground/70 px-1">
                                    ‚ú® AI will interview you for a personalized README
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        )}

                        {/* Chat Messages */}
                        <div className="space-y-3">
                          {chatMessages.map((message) => (
                            <div
                              key={message.id}
                              className={`flex ${message.role === "user" ? "justify-end" : "justify-start"}`}
                            >
                              <div
                                className={`max-w-xs p-2 rounded-lg text-sm ${
                                  message.role === "user"
                                    ? "bg-primary text-primary-foreground"
                                    : "bg-accent text-foreground border border-border"
                                }`}
                              >
                                {message.content}
                              </div>
                            </div>
                          ))}
                          {isAiThinking && (
                            <div className="flex justify-start">
                              <div className="bg-accent text-foreground border border-border p-2 rounded-lg text-sm flex items-center gap-2">
                                <ThinkingSpinner />
                                <span>AI is thinking...</span>
                              </div>
                            </div>
                          )}
                          <div ref={chatEndRef} />
                        </div>
                      </div>
                    </ScrollArea>
                  </div>

                  {!isTypingWelcome && (
                    <div className="space-y-3">
                      <div className="flex gap-2">
                        <Input
                          placeholder={isAiThinking ? "AI is thinking..." : "Ask about your repositories..."}
                          value={chatMessage}
                          onChange={(e) => setChatMessage(e.target.value)}
                          onKeyPress={(e) => e.key === "Enter" && !isAiThinking && handleSendMessage()}
                          disabled={isAiThinking}
                          className="bg-background border-border"
                        />
                        <Button
                          onClick={isAiThinking ? () => setIsAiThinking(false) : handleSendMessage}
                          size="sm"
                          disabled={!isAiThinking && !chatMessage.trim()}
                          className={isAiThinking
                            ? "bg-red-500 hover:bg-red-600 text-white"
                            : "bg-white hover:bg-gray-100 text-black border border-gray-300"
                          }
                        >
                          {isAiThinking ? (
                            <Square className="h-3 w-3 fill-current" />
                          ) : (
                            <ArrowUp className="h-4 w-4" />
                          )}
                        </Button>
                      </div>
                    </div>
                  )}
                </CardContent>
              </Card>
            ) : (
              /* Minimized Chat Bubble */
              <div className="fixed bottom-6 right-6 z-50">
                <Button
                  onClick={() => setIsChatMinimized(false)}
                  className="w-14 h-14 rounded-full bg-gray-900 hover:bg-gray-800 shadow-lg border border-gray-700"
                >
                  <Github className="h-6 w-6 text-white" />
                </Button>
              </div>
            )}
          </div>
        </div>

        {/* üóëÔ∏è DELETE CONFIRMATION DIALOG - SAFETY FIRST! */}
        {showDeleteConfirm && repoToDelete && (
          <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
            <div className="bg-background border rounded-lg p-6 max-w-md w-full mx-4">
              <div className="flex items-center space-x-3 mb-4">
                <div className="w-10 h-10 rounded-full bg-destructive/10 flex items-center justify-center">
                  <Trash2 className="h-5 w-5 text-destructive" />
                </div>
                <div>
                  <h3 className="font-semibold text-lg">Delete Repository</h3>
                  <p className="text-sm text-muted-foreground">This action cannot be undone</p>
                </div>
              </div>

              <div className="mb-6">
                <p className="text-sm mb-3">
                  Are you sure you want to delete <strong>"{repoToDelete.name}"</strong>?
                </p>
                <div className="bg-muted p-3 rounded-lg text-xs space-y-1">
                  <div className="flex justify-between">
                    <span>Repository:</span>
                    <span className="font-mono">{repoToDelete.full_name}</span>
                  </div>
                  <div className="flex justify-between">
                    <span>Stars:</span>
                    <span>{repoToDelete.stargazers_count}</span>
                  </div>
                  <div className="flex justify-between">
                    <span>Forks:</span>
                    <span>{repoToDelete.forks_count}</span>
                  </div>
                  <div className="flex justify-between">
                    <span>Last updated:</span>
                    <span>{formatTimeAgo(repoToDelete.updated_at)}</span>
                  </div>
                </div>
              </div>

              <div className="flex space-x-3">
                <Button
                  variant="outline"
                  onClick={() => {
                    setShowDeleteConfirm(false);
                    setRepoToDelete(null);
                  }}
                  disabled={isDeleting}
                  className="flex-1"
                >
                  Cancel
                </Button>
                <Button
                  variant="destructive"
                  onClick={confirmDeleteRepo}
                  disabled={isDeleting}
                  className="flex-1"
                >
                  {isDeleting ? (
                    <>
                      <RefreshCw className="h-4 w-4 mr-2 animate-spin" />
                      Deleting...
                    </>
                  ) : (
                    <>
                      <Trash2 className="h-4 w-4 mr-2" />
                      Delete Forever
                    </>
                  )}
                </Button>
              </div>
            </div>
          </div>
        )}

        {/* üéØ JOB TEMPLATE MODAL */}
        {showJobTemplateModal && (
          <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
            <div className="bg-background border border-border rounded-lg p-6 w-full max-w-md mx-4">
              <div className="flex items-center justify-between mb-4">
                <h2 className="text-lg font-semibold flex items-center gap-2">
                  <Target className="h-5 w-5" />
                  Generate Job Template
                </h2>
                <Button
                  variant="ghost"
                  size="sm"
                  onClick={() => setShowJobTemplateModal(false)}
                  className="h-8 w-8 p-0"
                >
                  <X className="h-4 w-4" />
                </Button>
              </div>

              <div className="space-y-4">
                <div>
                  <label className="text-sm font-medium mb-2 block">
                    Target Job Position
                  </label>
                  <Input
                    placeholder="e.g., Software Engineer, Frontend Developer, Data Scientist"
                    value={jobTitle}
                    onChange={(e) => setJobTitle(e.target.value)}
                    onKeyPress={(e) => e.key === "Enter" && !isGeneratingTemplate && generateJobTemplate()}
                    disabled={isGeneratingTemplate}
                    className="w-full"
                  />
                  <p className="text-xs text-muted-foreground mt-1">
                    AI will select your 4 most relevant repositories for this position
                  </p>
                </div>

                <div className="flex gap-2">
                  <Button
                    variant="outline"
                    onClick={() => setShowJobTemplateModal(false)}
                    className="flex-1"
                    disabled={isGeneratingTemplate}
                  >
                    Cancel
                  </Button>
                  <Button
                    onClick={generateJobTemplate}
                    disabled={!jobTitle.trim() || isGeneratingTemplate}
                    className="flex-1"
                  >
                    {isGeneratingTemplate ? (
                      <>
                        <RefreshCw className="h-4 w-4 mr-2 animate-spin" />
                        Generating...
                      </>
                    ) : (
                      <>
                        <Sparkles className="h-4 w-4 mr-2" />
                        Generate Template
                      </>
                    )}
                  </Button>
                </div>

                {templateResults.length > 0 && (
                  <div className="mt-4 p-3 bg-muted/30 rounded-lg border border-border/50">
                    <h3 className="text-sm font-medium mb-2 flex items-center gap-2">
                      <CheckCircle className="h-4 w-4 text-green-500" />
                      Selected Repositories
                    </h3>
                    <div className="space-y-2">
                      {templateResults.map((repo, index) => (
                        <div key={repo.id} className="flex items-center gap-2 text-sm">
                          <span className="w-5 h-5 bg-primary text-primary-foreground rounded-full flex items-center justify-center text-xs">
                            {index + 1}
                          </span>
                          <span className="font-medium">{repo.name}</span>
                          <span className="text-muted-foreground">({repo.language})</span>
                        </div>
                      ))}
                    </div>
                  </div>
                )}
              </div>
            </div>
          </div>
        )}

        {/* ‚ûï ADD REPOSITORY MODAL */}
        {showAddRepoModal && (
          <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
            <div className="bg-background border border-border rounded-lg p-6 w-full max-w-md mx-4">
              <div className="flex items-center justify-between mb-4">
                <h2 className="text-lg font-semibold flex items-center gap-2">
                  <Plus className="h-5 w-5" />
                  Create New Repository
                </h2>
                <button
                  onClick={() => setShowAddRepoModal(false)}
                  className="text-muted-foreground hover:text-foreground"
                >
                  <X className="h-5 w-5" />
                </button>
              </div>

              <div className="space-y-4">
                <div>
                  <label className="text-sm font-medium">Repository Name</label>
                  <Input
                    value={newRepoName}
                    onChange={(e) => setNewRepoName(e.target.value)}
                    placeholder="my-awesome-project"
                    className="mt-1"
                  />
                </div>

                <div>
                  <label className="text-sm font-medium">Description (Optional)</label>
                  <Input
                    value={newRepoDescription}
                    onChange={(e) => setNewRepoDescription(e.target.value)}
                    placeholder="A brief description of your project"
                    className="mt-1"
                  />
                </div>

                <div className="flex gap-2 pt-2">
                  <Button
                    variant="outline"
                    onClick={() => setShowAddRepoModal(false)}
                    className="flex-1"
                  >
                    Cancel
                  </Button>
                  <Button
                    onClick={createRepository}
                    disabled={!newRepoName.trim() || isCreatingRepo}
                    className="flex-1"
                  >
                    {isCreatingRepo ? (
                      <>
                        <RefreshCw className="h-4 w-4 mr-2 animate-spin" />
                        Creating...
                      </>
                    ) : (
                      <>
                        <Plus className="h-4 w-4 mr-2" />
                        Create Repository
                      </>
                    )}
                  </Button>
                </div>
              </div>
            </div>
          </div>
        )}

        {/* ‚úèÔ∏è RENAME REPOSITORY MODAL */}
        {showRenameModal && repoToRename && (
          <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
            <div className="bg-background border border-border rounded-lg p-6 w-full max-w-md mx-4">
              <div className="flex items-center justify-between mb-4">
                <h2 className="text-lg font-semibold flex items-center gap-2">
                  <Edit className="h-5 w-5" />
                  Rename Repository
                </h2>
                <button
                  onClick={() => setShowRenameModal(false)}
                  className="text-muted-foreground hover:text-foreground"
                >
                  <X className="h-5 w-5" />
                </button>
              </div>

              <div className="space-y-4">
                <div>
                  <label className="text-sm font-medium">Current Name</label>
                  <div className="mt-1 p-2 bg-muted rounded text-sm text-muted-foreground">
                    {repoToRename.name}
                  </div>
                </div>

                <div>
                  <label className="text-sm font-medium">New Name</label>
                  <Input
                    value={newRepoNameForRename}
                    onChange={(e) => setNewRepoNameForRename(e.target.value)}
                    placeholder="new-repository-name"
                    className="mt-1"
                  />
                </div>

                <div className="flex gap-2 pt-2">
                  <Button
                    variant="outline"
                    onClick={() => setShowRenameModal(false)}
                    className="flex-1"
                  >
                    Cancel
                  </Button>
                  <Button
                    onClick={renameRepository}
                    disabled={!newRepoNameForRename.trim() || newRepoNameForRename === repoToRename.name || isRenamingRepo}
                    className="flex-1"
                  >
                    {isRenamingRepo ? (
                      <>
                        <RefreshCw className="h-4 w-4 mr-2 animate-spin" />
                        Renaming...
                      </>
                    ) : (
                      <>
                        <Edit className="h-4 w-4 mr-2" />
                        Rename Repository
                      </>
                    )}
                  </Button>
                </div>
              </div>
            </div>
          </div>
        )}

      </div>

      {/* Bug Report Button - Fixed at bottom */}
      <div className="fixed bottom-6 right-6 z-40">
        <Button
          onClick={() => router.push('/bug-report')}
          variant="outline"
          size="sm"
          className="bg-background/95 backdrop-blur-sm border-border/50 shadow-lg hover:shadow-xl transition-all duration-200 flex items-center gap-2"
        >
          <Bug className="w-4 h-4 text-red-500" />
          <span className="text-sm">Report Bug</span>
        </Button>
      </div>
    </div>
  );
}



</code>

app\debug\page.tsx:
<code>
"use client"

import { useState, useEffect } from "react"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Button } from "@/components/ui/button"
import { Badge } from "@/components/ui/badge"
import { Github, ArrowLeft, Settings, AlertTriangle, CheckCircle, XCircle } from "lucide-react"
import Link from "next/link"

export default function DebugPage() {
  const [debugInfo, setDebugInfo] = useState<any>(null)
  const [isLoading, setIsLoading] = useState(true)

  useEffect(() => {
    runDiagnostics()
  }, [])

  const runDiagnostics = async () => {
    setIsLoading(true)
    const info: any = {
      timestamp: new Date().toISOString(),
      environment: process.env.NODE_ENV,
      tests: {},
    }

    try {
      // Test 1: Environment Variables
      info.tests.envVars = {
        name: "Environment Variables",
        status: "success",
        details: {
          githubClientId: !!process.env.NEXT_PUBLIC_GITHUB_CLIENT_ID,
          clientIdValue: process.env.NEXT_PUBLIC_GITHUB_CLIENT_ID?.substring(0, 10) + "...",
          nodeEnv: process.env.NODE_ENV,
        },
      }

      // Test 2: URLs
      info.tests.urls = {
        name: "URL Configuration",
        status: "success",
        details: {
          currentOrigin: window.location.origin,
          callbackUrl: `${window.location.origin}/api/github/callback`,
          githubAuthUrl: `https://github.com/login/oauth/authorize?client_id=${process.env.NEXT_PUBLIC_GITHUB_CLIENT_ID}`,
        },
      }

      // Test 3: Session API
      try {
        const sessionResponse = await fetch("/api/session")
        info.tests.sessionApi = {
          name: "Session API",
          status: sessionResponse.ok ? "success" : "warning",
          details: {
            status: sessionResponse.status,
            statusText: sessionResponse.statusText,
            hasSession: sessionResponse.status === 200,
          },
        }
      } catch (err) {
        info.tests.sessionApi = {
          name: "Session API",
          status: "error",
          details: { error: err instanceof Error ? err.message : "Unknown error" },
        }
      }

      // Test 4: GitHub API Connectivity
      try {
        const githubResponse = await fetch("https://api.github.com/", { method: "HEAD" })
        info.tests.githubApi = {
          name: "GitHub API Connectivity",
          status: githubResponse.ok ? "success" : "error",
          details: {
            status: githubResponse.status,
            accessible: githubResponse.ok,
          },
        }
      } catch (err) {
        info.tests.githubApi = {
          name: "GitHub API Connectivity",
          status: "error",
          details: { error: err instanceof Error ? err.message : "Network error" },
        }
      }

      // Test 5: Browser Environment
      info.tests.browser = {
        name: "Browser Environment",
        status: "success",
        details: {
          localStorage: typeof localStorage !== "undefined",
          sessionStorage: typeof sessionStorage !== "undefined",
          cookies: typeof document !== "undefined",
          https: window.location.protocol === "https:" || window.location.hostname === "localhost",
          userAgent: navigator.userAgent.substring(0, 50) + "...",
        },
      }

      setDebugInfo(info)
    } catch (error) {
      console.error("Diagnostics error:", error)
      info.tests.diagnosticsError = {
        name: "Diagnostics Error",
        status: "error",
        details: { error: error instanceof Error ? error.message : "Unknown error" },
      }
      setDebugInfo(info)
    } finally {
      setIsLoading(false)
    }
  }

  const testGitHubOAuth = () => {
    const clientId = process.env.NEXT_PUBLIC_GITHUB_CLIENT_ID
    if (!clientId) {
      alert('GitHub Client ID not configured. Please set NEXT_PUBLIC_GITHUB_CLIENT_ID environment variable.')
      return
    }

    const redirectUri = `${window.location.origin}/api/github/callback`
    const scope = "repo user"
    const state = `debug_test_${Date.now()}`

    const githubAuthUrl = new URL("https://github.com/login/oauth/authorize")
    githubAuthUrl.searchParams.set("client_id", clientId)
    githubAuthUrl.searchParams.set("redirect_uri", redirectUri)
    githubAuthUrl.searchParams.set("scope", scope)
    githubAuthUrl.searchParams.set("state", state)

    console.log("üß™ Testing GitHub OAuth with URL:", githubAuthUrl.toString())
    window.open(githubAuthUrl.toString(), "_blank")
  }

  const getStatusIcon = (status: string) => {
    switch (status) {
      case "success":
        return <CheckCircle className="h-4 w-4 text-green-400" />
      case "warning":
        return <AlertTriangle className="h-4 w-4 text-yellow-400" />
      case "error":
        return <XCircle className="h-4 w-4 text-red-400" />
      default:
        return <AlertTriangle className="h-4 w-4 text-gray-400" />
    }
  }

  const getStatusColor = (status: string) => {
    switch (status) {
      case "success":
        return "border-green-500/50 bg-green-900/20"
      case "warning":
        return "border-yellow-500/50 bg-yellow-900/20"
      case "error":
        return "border-red-500/50 bg-red-900/20"
      default:
        return "border-gray-500/50 bg-gray-900/20"
    }
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 text-white">
      <div className="container mx-auto px-4 py-8">
        {/* Header */}
        <div className="flex items-center justify-between mb-8">
          <div>
            <h1 className="text-3xl font-bold mb-2">üîß Debug Dashboard</h1>
            <p className="text-gray-400">Troubleshoot GitHub OAuth issues</p>
          </div>
          <Link href="/">
            <Button variant="outline" className="border-gray-600 text-gray-300 hover:bg-gray-800 bg-transparent">
              <ArrowLeft className="h-4 w-4 mr-2" />
              Back to Home
            </Button>
          </Link>
        </div>

        {/* Quick Actions */}
        <div className="grid md:grid-cols-3 gap-6 mb-8">
          <Card className="bg-gray-800/30 border-gray-700/50">
            <CardContent className="p-6">
              <Button onClick={testGitHubOAuth} className="w-full bg-purple-600 hover:bg-purple-700">
                <Github className="h-4 w-4 mr-2" />
                Test GitHub OAuth (New Tab)
              </Button>
            </CardContent>
          </Card>

          <Card className="bg-gray-800/30 border-gray-700/50">
            <CardContent className="p-6">
              <Button onClick={runDiagnostics} disabled={isLoading} className="w-full bg-blue-600 hover:bg-blue-700">
                <Settings className="h-4 w-4 mr-2" />
                {isLoading ? "Running..." : "Refresh Diagnostics"}
              </Button>
            </CardContent>
          </Card>

          <Card className="bg-gray-800/30 border-gray-700/50">
            <CardContent className="p-6">
              <Button
                onClick={() => window.open("https://github.com/settings/applications", "_blank")}
                variant="outline"
                className="w-full border-gray-600 bg-transparent"
              >
                <Github className="h-4 w-4 mr-2" />
                GitHub OAuth Apps
              </Button>
            </CardContent>
          </Card>
        </div>

        {/* Diagnostics Results */}
        {debugInfo && (
          <div className="space-y-6">
            <Card className="bg-gray-800/30 border-gray-700/50">
              <CardHeader>
                <CardTitle>üìä System Information</CardTitle>
              </CardHeader>
              <CardContent>
                <div className="grid md:grid-cols-2 gap-4 text-sm">
                  <div>
                    <strong>Timestamp:</strong> {new Date(debugInfo.timestamp).toLocaleString()}
                  </div>
                  <div>
                    <strong>Environment:</strong> {debugInfo.environment}
                  </div>
                </div>
              </CardContent>
            </Card>

            {/* Test Results */}
            <div className="grid gap-4">
              {Object.entries(debugInfo.tests).map(([key, test]: [string, any]) => (
                <Card key={key} className={`${getStatusColor(test.status)} border`}>
                  <CardContent className="p-4">
                    <div className="flex items-center justify-between mb-3">
                      <h4 className="font-semibold flex items-center gap-2">
                        {getStatusIcon(test.status)}
                        {test.name}
                      </h4>
                      <Badge variant={test.status === "success" ? "default" : "destructive"}>
                        {test.status.toUpperCase()}
                      </Badge>
                    </div>
                    <div className="text-sm space-y-2">
                      {Object.entries(test.details).map(([detailKey, value]: [string, any]) => (
                        <div key={detailKey} className="flex justify-between items-center">
                          <span className="text-gray-400">{detailKey}:</span>
                          <span
                            className={`font-mono text-xs ${
                              typeof value === "boolean" ? (value ? "text-green-400" : "text-red-400") : "text-gray-300"
                            }`}
                          >
                            {typeof value === "boolean" ? (value ? "‚úÖ Yes" : "‚ùå No") : String(value)}
                          </span>
                        </div>
                      ))}
                    </div>
                  </CardContent>
                </Card>
              ))}
            </div>
          </div>
        )}

        {/* Common Issues */}
        <Card className="bg-gray-800/30 border-gray-700/50 mt-8">
          <CardHeader>
            <CardTitle>üö® Common Issues & Solutions</CardTitle>
          </CardHeader>
          <CardContent className="space-y-4">
            <div className="border-l-4 border-red-500 pl-4">
              <h4 className="font-semibold text-red-400">Blank White Page After OAuth</h4>
              <p className="text-sm text-gray-300">
                Usually caused by callback URL mismatch. Check that your GitHub OAuth App callback URL is exactly:{" "}
                <code className="bg-gray-700 px-1 rounded">
                  {typeof window !== "undefined" ? `${window.location.origin}/api/github/callback` : ""}
                </code>
              </p>
            </div>
            <div className="border-l-4 border-yellow-500 pl-4">
              <h4 className="font-semibold text-yellow-400">OAuth App Not Found</h4>
              <p className="text-sm text-gray-300">
                Make sure your GitHub OAuth App exists and the Client ID matches your environment variable
              </p>
            </div>
            <div className="border-l-4 border-blue-500 pl-4">
              <h4 className="font-semibold text-blue-400">CORS or Network Issues</h4>
              <p className="text-sm text-gray-300">
                Check browser console for errors and ensure you're not blocking GitHub API requests
              </p>
            </div>
          </CardContent>
        </Card>
      </div>
    </div>
  )
}

</code>

app\profile\page.tsx:
<code>
"use client"

// Force dynamic rendering to avoid static generation issues with auth
export const dynamic = 'force-dynamic'

import React, { useState } from 'react';
import { useRouter } from 'next/navigation';
import { useAuth } from '@/components/auth-provider';
import TokenManagement from '@/components/token-management';
import { ThemeToggle } from '@/components/theme-toggle';
import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Input } from '@/components/ui/input';
import { Badge } from '@/components/ui/badge';
// import { Label } from '@/components/ui/label';
import { Separator } from '@/components/ui/separator';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { 
  ArrowLeft, 
  User, 
  Settings, 
  Shield, 
  LogOut, 
  Github,
  Mail,
  Calendar,
  CheckCircle,
  AlertTriangle,
  Key
} from 'lucide-react';


export default function ProfilePage() {
  const router = useRouter();
  const { user, profile, loading, signOut, updateToken, deleteToken } = useAuth();
  const [isUpdating, setIsUpdating] = useState(false);
  const [updateMessage, setUpdateMessage] = useState('');

  const handleTokenUpdate = async (token: string) => {
    if (!user) return;
    
    setIsUpdating(true);
    try {
      await updateToken(token);
      
      setUpdateMessage('‚úÖ GitHub token updated successfully!');
      setTimeout(() => setUpdateMessage(''), 3000);
    } catch (error) {
      console.error('Error updating token:', error);
      setUpdateMessage('‚ùå Failed to update token. Please try again.');
      setTimeout(() => setUpdateMessage(''), 3000);
    } finally {
      setIsUpdating(false);
    }
  };

  const handleTokenDelete = async () => {
    if (!user) return;
    
    setIsUpdating(true);
    try {
      await deleteToken();
      
      setUpdateMessage('‚úÖ GitHub token deleted successfully!');
      setTimeout(() => setUpdateMessage(''), 3000);
    } catch (error) {
      console.error('Error deleting token:', error);
      setUpdateMessage('‚ùå Failed to delete token. Please try again.');
      setTimeout(() => setUpdateMessage(''), 3000);
    } finally {
      setIsUpdating(false);
    }
  };

  const handleSignOut = async () => {
    await signOut();
    router.push('/');
  };

  // Show loading while auth or profile is initializing
  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-center">
          <h1 className="text-2xl font-bold mb-4">Loading...</h1>
          <p className="text-muted-foreground mb-4">Initializing your profile...</p>
        </div>
      </div>
    );
  }

  // If still no user after loading, show message (no automatic redirect)
  if (!user) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-center">
          <h1 className="text-2xl font-bold mb-4">Not Authenticated</h1>
          <p className="text-muted-foreground mb-4">Please sign in to view your profile.</p>
          <p className="text-muted-foreground">Navigate manually to the homepage to sign in.</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-background">
      {/* Header */}
      <div className="border-b bg-card">
        <div className="container mx-auto px-4 py-4">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-4">
              <Button 
                variant="ghost" 
                size="sm" 
                onClick={() => router.push('/dashboard')}
              >
                <ArrowLeft className="h-4 w-4 mr-2" />
                Back to Dashboard
              </Button>
              <div className="flex items-center gap-2">
                <User className="h-5 w-5" />
                <h1 className="text-xl font-semibold">Profile Settings</h1>
              </div>
            </div>
            <ThemeToggle />
          </div>
        </div>
      </div>

      <div className="container mx-auto px-4 py-8 max-w-4xl">
        {/* Update Message */}
        {updateMessage && (
          <Alert className="mb-6">
            <AlertDescription>{updateMessage}</AlertDescription>
          </Alert>
        )}

        <div className="grid gap-6">
          {/* Profile Information */}
          <Card>
            <CardHeader>
              <div className="flex items-center gap-2">
                <User className="h-5 w-5" />
                <CardTitle>Profile Information</CardTitle>
              </div>
              <CardDescription>
                Your account information from GitHub
              </CardDescription>
            </CardHeader>
            <CardContent className="space-y-6">
              <div className="flex items-center gap-4">
                <Avatar className="h-16 w-16">
                  <AvatarImage 
                    src={user.user_metadata?.avatar_url} 
                    alt={user.user_metadata?.name || 'User'} 
                  />
                  <AvatarFallback>
                    {user.user_metadata?.name?.[0] || 'U'}
                  </AvatarFallback>
                </Avatar>
                <div>
                  <h3 className="text-lg font-semibold">
                    {user.user_metadata?.full_name || user.user_metadata?.name || 'Unknown User'}
                  </h3>
                  <p className="text-muted-foreground">
                    @{user.user_metadata?.user_name || 'unknown'}
                  </p>
                </div>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div className="space-y-2">
                  <label htmlFor="email" className="text-sm font-medium">Email</label>
                  <div className="flex items-center gap-2">
                    <Mail className="h-4 w-4 text-muted-foreground" />
                    <Input
                      id="email"
                      value={user.email || 'Not provided'}
                      disabled
                      className="bg-muted"
                    />
                  </div>
                </div>

                <div className="space-y-2">
                  <label htmlFor="github" className="text-sm font-medium">GitHub Username</label>
                  <div className="flex items-center gap-2">
                    <Github className="h-4 w-4 text-muted-foreground" />
                    <Input
                      id="github"
                      value={user.user_metadata?.user_name || 'Not connected'}
                      disabled
                      className="bg-muted"
                    />
                  </div>
                </div>
              </div>

              <div className="space-y-2">
                <label htmlFor="joined" className="text-sm font-medium">Member Since</label>
                <div className="flex items-center gap-2">
                  <Calendar className="h-4 w-4 text-muted-foreground" />
                  <Input
                    id="joined"
                    value={new Date(user.created_at).toLocaleDateString()}
                    disabled
                    className="bg-muted"
                  />
                </div>
              </div>
            </CardContent>
          </Card>

          {/* GitHub Token Management */}
          <Card>
            <CardHeader>
              <div className="flex items-center gap-2">
                <Key className="h-5 w-5" />
                <CardTitle>GitHub Access Token</CardTitle>
              </div>
              <CardDescription>
                Manage your GitHub Personal Access Token for repository operations
              </CardDescription>
            </CardHeader>
            <CardContent>
              <TokenManagement
                currentToken={profile?.github_pat_token}
                onTokenUpdate={handleTokenUpdate}
                onTokenDelete={handleTokenDelete}
              />
            </CardContent>
          </Card>

          {/* Account Security */}
          <Card>
            <CardHeader>
              <div className="flex items-center gap-2">
                <Shield className="h-5 w-5" />
                <CardTitle>Account Security</CardTitle>
              </div>
              <CardDescription>
                Manage your account security settings
              </CardDescription>
            </CardHeader>
            <CardContent className="space-y-4">
              <div className="flex items-center justify-between p-4 border rounded-lg">
                <div className="flex items-center gap-3">
                  <CheckCircle className="h-5 w-5 text-green-500" />
                  <div>
                    <p className="font-medium">GitHub OAuth</p>
                    <p className="text-sm text-muted-foreground">
                      Connected via GitHub OAuth
                    </p>
                  </div>
                </div>
                <Badge variant="secondary">Active</Badge>
              </div>

              <Alert>
                <AlertTriangle className="h-4 w-4" />
                <AlertDescription>
                  <strong>Password Management:</strong> Your account is managed through GitHub OAuth. 
                  To change your password, please update it in your GitHub account settings.
                </AlertDescription>
              </Alert>
            </CardContent>
          </Card>

          {/* Danger Zone */}
          <Card className="border-red-200 dark:border-red-800">
            <CardHeader>
              <CardTitle className="text-red-600 dark:text-red-400">Danger Zone</CardTitle>
              <CardDescription>
                Irreversible and destructive actions
              </CardDescription>
            </CardHeader>
            <CardContent>
              <div className="flex items-center justify-between p-4 border border-red-200 dark:border-red-800 rounded-lg">
                <div>
                  <p className="font-medium">Sign Out</p>
                  <p className="text-sm text-muted-foreground">
                    Sign out of your account on this device
                  </p>
                </div>
                <Button 
                  variant="destructive" 
                  onClick={handleSignOut}
                >
                  <LogOut className="h-4 w-4 mr-2" />
                  Sign Out
                </Button>
              </div>
            </CardContent>
          </Card>
        </div>
      </div>
    </div>
  );
}

</code>

app\signout\page.tsx:
<code>
"use client"

import { useEffect, useState } from 'react';
import { useRouter, useSearchParams } from 'next/navigation';
import { Github, CheckCircle } from 'lucide-react';
import { Badge } from '@/components/ui/badge';
import { Card, CardContent } from '@/components/ui/card';

export default function SignoutPage() {
  const router = useRouter();
  const searchParams = useSearchParams();

  // Get user info from URL parameters
  const username = searchParams.get('username') || 'User';
  const email = searchParams.get('email') || '';
  const avatar = searchParams.get('avatar') || '';

  // REMOVED: Countdown timer and automatic redirect logic

  return (
    <div className="min-h-screen bg-background flex items-center justify-center p-4">
      <div className="w-full max-w-md space-y-6">
        {/* Header */}
        <div className="text-center space-y-2">
          <div className="flex items-center justify-center space-x-3 mb-4">
            <Github className="h-8 w-8 text-primary" />
            <div className="flex flex-col">
              <span className="text-xl font-bold">NeatRepo</span>
            </div>
          </div>
          <h1 className="text-2xl font-bold">Account signed out</h1>
          <p className="text-muted-foreground">
            You have been successfully signed out
          </p>
        </div>

        {/* Signed out account card */}
        <Card className="border-2">
          <CardContent className="p-6">
            <div className="flex items-center space-x-4">
              {/* Avatar */}
              <div className="relative">
                {avatar ? (
                  <img 
                    src={avatar} 
                    alt={username}
                    className="w-12 h-12 rounded-full"
                  />
                ) : (
                  <div className="w-12 h-12 rounded-full bg-muted flex items-center justify-center">
                    <Github className="h-6 w-6 text-muted-foreground" />
                  </div>
                )}
                {/* Signed out badge */}
                <div className="absolute -top-1 -right-1">
                  <Badge variant="secondary" className="text-xs px-2 py-1 bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">
                    <CheckCircle className="h-3 w-3 mr-1" />
                    Signed out
                  </Badge>
                </div>
              </div>

              {/* Account info */}
              <div className="flex-1 min-w-0">
                <p className="font-medium text-sm truncate">{username}</p>
                {email && (
                  <p className="text-xs text-muted-foreground truncate">{email}</p>
                )}
                <p className="text-xs text-muted-foreground mt-1">
                  GitHub account
                </p>
              </div>
            </div>
          </CardContent>
        </Card>

        {/* Status message */}
        <div className="text-center space-y-3">
          <div className="flex items-center justify-center space-x-2">
            <CheckCircle className="w-4 h-4 text-green-600" />
            <span className="text-sm text-muted-foreground">
              Sign out complete
            </span>
          </div>

          <p className="text-xs text-muted-foreground">
            Choose where to go next - no automatic redirection
          </p>
        </div>

        {/* Additional options */}
        <div className="text-center space-y-2">
          <button
            onClick={() => router.push('/')}
            className="text-sm text-primary hover:underline"
          >
            Go to homepage now
          </button>
          
          <div className="text-xs text-muted-foreground">
            Want to sign in with a different account?{' '}
            <button
              onClick={() => router.push('/')}
              className="text-primary hover:underline"
            >
              Sign in here
            </button>
          </div>
        </div>
      </div>
    </div>
  );
}

</code>

app\test-callback\page.tsx:
<code>
"use client"

import { useState } from "react"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Button } from "@/components/ui/button"
import { Badge } from "@/components/ui/badge"
import { Github, ArrowLeft, Play, CheckCircle, XCircle, AlertTriangle } from "lucide-react"
import Link from "next/link"

export default function TestCallbackPage() {
  const [testResults, setTestResults] = useState<any>(null)
  const [isLoading, setIsLoading] = useState(false)

  const runCallbackTest = async () => {
    setIsLoading(true)
    const results: any = {
      timestamp: new Date().toISOString(),
      tests: {},
    }

    try {
      // Test 1: Basic callback endpoint
      console.log("üß™ Testing callback endpoint...")
      try {
        const response = await fetch("/api/github/callback?test=true")
        results.tests.callbackEndpoint = {
          name: "Callback Endpoint",
          status: response.ok ? "success" : "error",
          details: {
            status: response.status,
            statusText: response.statusText,
            accessible: response.ok,
          },
        }
      } catch (err) {
        results.tests.callbackEndpoint = {
          name: "Callback Endpoint",
          status: "error",
          details: { error: err instanceof Error ? err.message : "Unknown error" },
        }
      }

      // Test 2: Environment variables
      results.tests.environment = {
        name: "Environment Variables",
        status: "success",
        details: {
          clientId: !!process.env.NEXT_PUBLIC_GITHUB_CLIENT_ID,
          nodeEnv: process.env.NODE_ENV,
          origin: window.location.origin,
        },
      }

      // Test 3: Session API
      try {
        const sessionResponse = await fetch("/api/session")
        results.tests.sessionApi = {
          name: "Session API",
          status: sessionResponse.status === 401 ? "success" : "warning", // 401 is expected when no session
          details: {
            status: sessionResponse.status,
            statusText: sessionResponse.statusText,
            working: sessionResponse.status === 401 || sessionResponse.status === 200,
          },
        }
      } catch (err) {
        results.tests.sessionApi = {
          name: "Session API",
          status: "error",
          details: { error: err instanceof Error ? err.message : "Unknown error" },
        }
      }

      // Test 4: GitHub OAuth URL generation
      try {
        const clientId = process.env.NEXT_PUBLIC_GITHUB_CLIENT_ID
        if (!clientId) {
          throw new Error('GitHub Client ID not configured')
        }

        const redirectUri = `${window.location.origin}/api/github/callback`
        const githubUrl = `https://github.com/login/oauth/authorize?client_id=${clientId}&redirect_uri=${encodeURIComponent(redirectUri)}&scope=repo%20user`

        results.tests.oauthUrl = {
          name: "OAuth URL Generation",
          status: "success",
          details: {
            clientId: clientId.substring(0, 10) + "...",
            redirectUri,
            fullUrl: githubUrl.substring(0, 100) + "...",
          },
        }
      } catch (err) {
        results.tests.oauthUrl = {
          name: "OAuth URL Generation",
          status: "error",
          details: { error: err instanceof Error ? err.message : "Unknown error" },
        }
      }

      setTestResults(results)
    } catch (error) {
      console.error("Test error:", error)
      results.tests.testError = {
        name: "Test Execution",
        status: "error",
        details: { error: error instanceof Error ? error.message : "Unknown error" },
      }
      setTestResults(results)
    } finally {
      setIsLoading(false)
    }
  }

  const testOAuthFlow = () => {
    const clientId = process.env.NEXT_PUBLIC_GITHUB_CLIENT_ID || "Ov23liaOcBS8zuFJCGyG"
    const redirectUri = `${window.location.origin}/api/github/callback`
    const scope = "repo user"
    const state = `test_${Date.now()}`

    const githubAuthUrl = new URL("https://github.com/login/oauth/authorize")
    githubAuthUrl.searchParams.set("client_id", clientId)
    githubAuthUrl.searchParams.set("redirect_uri", redirectUri)
    githubAuthUrl.searchParams.set("scope", scope)
    githubAuthUrl.searchParams.set("state", state)

    console.log("üß™ Testing OAuth flow with URL:", githubAuthUrl.toString())
    window.location.href = githubAuthUrl.toString()
  }

  const getStatusIcon = (status: string) => {
    switch (status) {
      case "success":
        return <CheckCircle className="h-4 w-4 text-green-400" />
      case "warning":
        return <AlertTriangle className="h-4 w-4 text-yellow-400" />
      case "error":
        return <XCircle className="h-4 w-4 text-red-400" />
      default:
        return <AlertTriangle className="h-4 w-4 text-gray-400" />
    }
  }

  const getStatusColor = (status: string) => {
    switch (status) {
      case "success":
        return "border-green-500/50 bg-green-900/20"
      case "warning":
        return "border-yellow-500/50 bg-yellow-900/20"
      case "error":
        return "border-red-500/50 bg-red-900/20"
      default:
        return "border-gray-500/50 bg-gray-900/20"
    }
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 text-white">
      <div className="container mx-auto px-4 py-8">
        {/* Header */}
        <div className="flex items-center justify-between mb-8">
          <div>
            <h1 className="text-3xl font-bold mb-2">üß™ Callback Test Page</h1>
            <p className="text-gray-400">Test GitHub OAuth callback functionality</p>
          </div>
          <Link href="/">
            <Button variant="outline" className="border-gray-600 text-gray-300 hover:bg-gray-800 bg-transparent">
              <ArrowLeft className="h-4 w-4 mr-2" />
              Back to Home
            </Button>
          </Link>
        </div>

        {/* Test Actions */}
        <div className="grid md:grid-cols-2 gap-6 mb-8">
          <Card className="bg-gray-800/30 border-gray-700/50">
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <Play className="h-5 w-5 text-blue-400" />
                Run Callback Tests
              </CardTitle>
            </CardHeader>
            <CardContent>
              <p className="text-gray-400 mb-4">Test all callback-related functionality without OAuth</p>
              <Button onClick={runCallbackTest} disabled={isLoading} className="w-full bg-blue-600 hover:bg-blue-700">
                {isLoading ? "Running Tests..." : "Run Tests"}
              </Button>
            </CardContent>
          </Card>

          <Card className="bg-gray-800/30 border-gray-700/50">
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <Github className="h-5 w-5 text-purple-400" />
                Test Full OAuth Flow
              </CardTitle>
            </CardHeader>
            <CardContent>
              <p className="text-gray-400 mb-4">Test the complete GitHub OAuth flow (will redirect)</p>
              <Button onClick={testOAuthFlow} className="w-full bg-purple-600 hover:bg-purple-700">
                <Github className="h-4 w-4 mr-2" />
                Test OAuth Flow
              </Button>
            </CardContent>
          </Card>
        </div>

        {/* Test Results */}
        {testResults && (
          <div className="space-y-4">
            <Card className="bg-gray-800/30 border-gray-700/50">
              <CardHeader>
                <CardTitle>üìä Test Results</CardTitle>
              </CardHeader>
              <CardContent>
                <div className="text-sm text-gray-400 mb-4">
                  Last run: {new Date(testResults.timestamp).toLocaleString()}
                </div>
              </CardContent>
            </Card>

            {Object.entries(testResults.tests).map(([key, test]: [string, any]) => (
              <Card key={key} className={`${getStatusColor(test.status)} border`}>
                <CardContent className="p-4">
                  <div className="flex items-center justify-between mb-3">
                    <h4 className="font-semibold flex items-center gap-2">
                      {getStatusIcon(test.status)}
                      {test.name}
                    </h4>
                    <Badge variant={test.status === "success" ? "default" : "destructive"}>
                      {test.status.toUpperCase()}
                    </Badge>
                  </div>
                  <div className="text-sm space-y-1">
                    {Object.entries(test.details).map(([detailKey, value]: [string, any]) => (
                      <div key={detailKey} className="flex justify-between items-center">
                        <span className="text-gray-400">{detailKey}:</span>
                        <span
                          className={`font-mono text-xs ${
                            typeof value === "boolean" ? (value ? "text-green-400" : "text-red-400") : "text-gray-300"
                          }`}
                        >
                          {typeof value === "boolean" ? (value ? "‚úÖ" : "‚ùå") : String(value)}
                        </span>
                      </div>
                    ))}
                  </div>
                </CardContent>
              </Card>
            ))}
          </div>
        )}

        {/* Instructions */}
        <Card className="bg-gray-800/30 border-gray-700/50 mt-8">
          <CardHeader>
            <CardTitle>üìù Testing Instructions</CardTitle>
          </CardHeader>
          <CardContent className="space-y-4">
            <div className="border-l-4 border-blue-500 pl-4">
              <h4 className="font-semibold text-blue-400">Step 1: Run Callback Tests</h4>
              <p className="text-sm text-gray-300">
                This will test if your callback endpoint is working and all environment variables are set correctly.
              </p>
            </div>
            <div className="border-l-4 border-purple-500 pl-4">
              <h4 className="font-semibold text-purple-400">Step 2: Test OAuth Flow</h4>
              <p className="text-sm text-gray-300">
                This will redirect you to GitHub OAuth. If successful, you should be redirected back to the dashboard.
              </p>
            </div>
            <div className="border-l-4 border-green-500 pl-4">
              <h4 className="font-semibold text-green-400">Step 3: Check Console Logs</h4>
              <p className="text-sm text-gray-300">
                Open browser developer tools and check the console for detailed logs during the OAuth process.
              </p>
            </div>
          </CardContent>
        </Card>
      </div>
    </div>
  )
}

</code>

app\test-sorting\page.tsx:
<code>
'use client';

import { useState } from 'react';
import { RepositorySorter, Repository } from '@/lib/repository-sorter';

// Mock repository data for testing
const mockRepositories: Repository[] = [
  {
    id: 1,
    name: 'hello-world',
    full_name: 'almond-donut/hello-world',
    description: 'My first repository',
    language: 'JavaScript',
    stargazers_count: 2,
    forks_count: 0,
    updated_at: '2024-01-15T10:00:00Z',
    created_at: '2024-01-01T10:00:00Z',
    html_url: 'https://github.com/almond-donut/hello-world',
    size: 50,
    has_issues: true,
    has_projects: false,
    has_wiki: false,
    open_issues_count: 1,
    topics: ['beginner'],
  },
  {
    id: 2,
    name: 'react-dashboard',
    full_name: 'almond-donut/react-dashboard',
    description: 'Advanced React dashboard with TypeScript and real-time features',
    language: 'TypeScript',
    stargazers_count: 25,
    forks_count: 5,
    updated_at: '2024-07-20T15:30:00Z',
    created_at: '2024-06-01T10:00:00Z',
    html_url: 'https://github.com/almond-donut/react-dashboard',
    size: 15000,
    has_issues: true,
    has_projects: true,
    has_wiki: true,
    open_issues_count: 8,
    topics: ['react', 'typescript', 'dashboard', 'real-time'],
  },
  {
    id: 3,
    name: 'python-scraper',
    full_name: 'almond-donut/python-scraper',
    description: 'Web scraping tool with data analysis',
    language: 'Python',
    stargazers_count: 12,
    forks_count: 3,
    updated_at: '2024-07-10T12:00:00Z',
    created_at: '2024-05-15T10:00:00Z',
    html_url: 'https://github.com/almond-donut/python-scraper',
    size: 5000,
    has_issues: true,
    has_projects: false,
    has_wiki: false,
    open_issues_count: 3,
    topics: ['python', 'scraping', 'data-analysis'],
  },
  {
    id: 4,
    name: 'css-animations',
    full_name: 'almond-donut/css-animations',
    description: 'Collection of CSS animations and effects',
    language: 'CSS',
    stargazers_count: 8,
    forks_count: 1,
    updated_at: '2024-03-20T14:00:00Z',
    created_at: '2024-03-01T10:00:00Z',
    html_url: 'https://github.com/almond-donut/css-animations',
    size: 200,
    has_issues: false,
    has_projects: false,
    has_wiki: false,
    open_issues_count: 0,
    topics: ['css', 'animations'],
  },
  {
    id: 5,
    name: 'rust-cli-tool',
    full_name: 'almond-donut/rust-cli-tool',
    description: 'High-performance CLI tool built with Rust',
    language: 'Rust',
    stargazers_count: 45,
    forks_count: 12,
    updated_at: '2024-07-22T09:15:00Z',
    created_at: '2024-04-01T10:00:00Z',
    html_url: 'https://github.com/almond-donut/rust-cli-tool',
    size: 8000,
    has_issues: true,
    has_projects: true,
    has_wiki: true,
    open_issues_count: 15,
    topics: ['rust', 'cli', 'performance', 'systems-programming'],
  },
];

export default function TestSortingPage() {
  const [repositories, setRepositories] = useState<Repository[]>(mockRepositories);
  const [sortMode, setSortMode] = useState<string>('original');

  const handleSort = (mode: string) => {
    let sorted: Repository[];
    
    switch (mode) {
      case 'complexity-asc':
        sorted = RepositorySorter.sortByComplexity([...repositories], 'asc');
        break;
      case 'complexity-desc':
        sorted = RepositorySorter.sortByComplexity([...repositories], 'desc');
        break;
      case 'cv-optimized':
        sorted = RepositorySorter.sortForCV([...repositories]);
        break;
      default:
        sorted = [...mockRepositories];
    }
    
    setRepositories(sorted);
    setSortMode(mode);
  };

  const getComplexityInfo = (repo: Repository) => {
    const complexity = RepositorySorter.calculateComplexity(repo);
    return complexity;
  };

  return (
    <div className="min-h-screen bg-gray-50 p-8">
      <div className="max-w-6xl mx-auto">
        <h1 className="text-3xl font-bold text-gray-900 mb-8">
          üß™ Repository Sorting Test Page
        </h1>
        
        <div className="bg-white rounded-lg shadow-md p-6 mb-8">
          <h2 className="text-xl font-semibold mb-4">Sorting Controls</h2>
          <div className="flex flex-wrap gap-4">
            <button
              onClick={() => handleSort('original')}
              className={`px-4 py-2 rounded-md ${
                sortMode === 'original'
                  ? 'bg-blue-600 text-white'
                  : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
              }`}
            >
              Original Order
            </button>
            <button
              onClick={() => handleSort('complexity-asc')}
              className={`px-4 py-2 rounded-md ${
                sortMode === 'complexity-asc'
                  ? 'bg-blue-600 text-white'
                  : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
              }`}
            >
              Simple ‚Üí Complex
            </button>
            <button
              onClick={() => handleSort('complexity-desc')}
              className={`px-4 py-2 rounded-md ${
                sortMode === 'complexity-desc'
                  ? 'bg-blue-600 text-white'
                  : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
              }`}
            >
              Complex ‚Üí Simple
            </button>
            <button
              onClick={() => handleSort('cv-optimized')}
              className={`px-4 py-2 rounded-md ${
                sortMode === 'cv-optimized'
                  ? 'bg-blue-600 text-white'
                  : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
              }`}
            >
              CV Optimized
            </button>
          </div>
          <p className="text-sm text-gray-600 mt-2">
            Current mode: <span className="font-semibold">{sortMode}</span>
          </p>
        </div>

        <div className="space-y-4">
          {repositories.map((repo, index) => {
            const complexity = getComplexityInfo(repo);
            return (
              <div key={repo.id} className="bg-white rounded-lg shadow-md p-6">
                <div className="flex items-start justify-between">
                  <div className="flex-1">
                    <div className="flex items-center gap-3 mb-2">
                      <span className="text-lg font-bold text-gray-500">
                        #{index + 1}
                      </span>
                      <h3 className="text-xl font-semibold text-gray-900">
                        {repo.name}
                      </h3>
                      <span className="px-2 py-1 bg-blue-100 text-blue-800 text-sm rounded-md">
                        {repo.language}
                      </span>
                    </div>
                    <p className="text-gray-600 mb-3">{repo.description}</p>
                    <div className="flex items-center gap-4 text-sm text-gray-500">
                      <span>‚≠ê {repo.stargazers_count}</span>
                      <span>üç¥ {repo.forks_count}</span>
                      <span>üì¶ {repo.size} KB</span>
                      <span>üìÖ {new Date(repo.updated_at).toLocaleDateString()}</span>
                    </div>
                  </div>
                  <div className="ml-6 text-right">
                    <div className={`px-3 py-1 rounded-full text-sm font-medium mb-2 ${
                      complexity.level === 'Simple' ? 'bg-green-100 text-green-800' :
                      complexity.level === 'Intermediate' ? 'bg-yellow-100 text-yellow-800' :
                      complexity.level === 'Complex' ? 'bg-orange-100 text-orange-800' :
                      'bg-red-100 text-red-800'
                    }`}>
                      {complexity.level}
                    </div>
                    <div className="text-lg font-bold text-gray-900">
                      Score: {complexity.score}
                    </div>
                    <div className="text-xs text-gray-500 mt-1">
                      {complexity.factors.slice(0, 2).join(', ')}
                      {complexity.factors.length > 2 && '...'}
                    </div>
                  </div>
                </div>
              </div>
            );
          })}
        </div>

        <div className="mt-8 bg-white rounded-lg shadow-md p-6">
          <h2 className="text-xl font-semibold mb-4">üéØ CV Recommendations</h2>
          <button
            onClick={() => {
              const recommendations = RepositorySorter.generateCVRecommendations(repositories);
              console.log('CV Recommendations:', recommendations);
              alert(`Generated ${recommendations.length} CV recommendations. Check console for details.`);
            }}
            className="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700"
          >
            Generate CV Recommendations
          </button>
        </div>
      </div>
    </div>
  );
}

</code>

app\globals.css:
<code>
@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  --font-jetbrains-mono: "JetBrains Mono", monospace;
  --background: 0 0% 100%;
  --foreground: 0 0% 0%;
  --card: 0 0% 100%;
  --card-foreground: 0 0% 0%;
  --popover: 0 0% 100%;
  --popover-foreground: 0 0% 0%;
  --primary: 0 0% 0%;
  --primary-foreground: 0 0% 100%;
  --secondary: 0 0% 97%;
  --secondary-foreground: 0 0% 0%;
  --muted: 0 0% 96%;
  --muted-foreground: 0 0% 40%;
  --accent: 45 100% 88%;
  --accent-foreground: 0 0% 0%;
  --destructive: 0 84% 60%;
  --destructive-foreground: 0 0% 100%;
  --border: 0 0% 90%;
  --input: 0 0% 90%;
  --ring: 45 100% 50%;
  --chart-1: 45 100% 88%;
  --chart-2: 0 0% 70%;
  --chart-3: 0 0% 50%;
  --chart-4: 45 80% 75%;
  --chart-5: 0 0% 30%;
  --radius: 0.5rem;
  --sidebar-background: 0 0% 99%;
  --sidebar-foreground: 0 0% 0%;
  --sidebar-primary: 0 0% 0%;
  --sidebar-primary-foreground: 0 0% 100%;
  --sidebar-accent: 45 100% 88%;
  --sidebar-accent-foreground: 0 0% 0%;
  --sidebar-border: 0 0% 92%;
  --sidebar-ring: 45 100% 50%;
}

.dark {
  --background: 0 0% 0%;
  --foreground: 0 0% 100%;
  --card: 0 0% 5%;
  --card-foreground: 0 0% 100%;
  --popover: 0 0% 5%;
  --popover-foreground: 0 0% 100%;
  --primary: 0 0% 100%;
  --primary-foreground: 0 0% 0%;
  --secondary: 0 0% 10%;
  --secondary-foreground: 0 0% 100%;
  --muted: 0 0% 8%;
  --muted-foreground: 0 0% 70%;
  --accent: 45 100% 20%;
  --accent-foreground: 0 0% 100%;
  --destructive: 0 62% 30%;
  --destructive-foreground: 0 0% 100%;
  --border: 0 0% 15%;
  --input: 0 0% 15%;
  --ring: 45 100% 50%;
  --chart-1: 45 80% 60%;
  --chart-2: 0 0% 60%;
  --chart-3: 0 0% 40%;
  --chart-4: 45 60% 50%;
  --chart-5: 0 0% 80%;
  --sidebar-background: 0 0% 2%;
  --sidebar-foreground: 0 0% 95%;
  --sidebar-primary: 45 100% 70%;
  --sidebar-primary-foreground: 0 0% 0%;
  --sidebar-accent: 0 0% 8%;
  --sidebar-accent-foreground: 0 0% 95%;
  --sidebar-border: 0 0% 10%;
  --sidebar-ring: 45 100% 50%;
}

body {
  font-family: var(--font-jetbrains-mono);
}

@layer utilities {
  .text-balance {
    text-wrap: balance;
  }
}

@layer base {
  * {
    @apply border-border;
  }
  body {
    @apply bg-background text-foreground;
  }
  :root {
    --sidebar-background: 0 0% 98%;
    --sidebar-foreground: 240 5.3% 26.1%;
    --sidebar-primary: 240 5.9% 10%;
    --sidebar-primary-foreground: 0 0% 98%;
    --sidebar-accent: 240 4.8% 95.9%;
    --sidebar-accent-foreground: 240 5.9% 10%;
    --sidebar-border: 220 13% 91%;
    --sidebar-ring: 217.2 91.2% 59.8%;
  }
  .dark {
    --sidebar-background: 240 5.9% 10%;
    --sidebar-foreground: 240 4.8% 95.9%;
    --sidebar-primary: 224.3 76.3% 48%;
    --sidebar-primary-foreground: 0 0% 100%;
    --sidebar-accent: 240 3.7% 15.9%;
    --sidebar-accent-foreground: 240 4.8% 95.9%;
    --sidebar-border: 240 3.7% 15.9%;
    --sidebar-ring: 217.2 91.2% 59.8%;
  }
}

</code>

app\layout.tsx:
<code>
import type React from "react"
import type { Metadata } from "next"
import { JetBrains_Mono } from "next/font/google"
import "./globals.css"
import { ThemeProvider } from "@/components/theme-provider"
import { AuthProvider } from "@/components/auth-provider"
import { NavigationErrorBoundary } from "@/components/navigation-error-boundary"

const jetbrainsMono = JetBrains_Mono({
  subsets: ["latin"],
  variable: "--font-jetbrains-mono",
})

export const metadata: Metadata = {
  title: "NeatRepo - Your Personal Repository Assistant",
  description:
    "Clean up and organize your GitHub repositories before applying for jobs. Reorganize structure, bulk delete, drag & drop, and prep your repos like a pro.",
  generator: 'v0.dev',
  icons: {
    icon: "/icon.png",
  },
}

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="en" suppressHydrationWarning>
      <body className={`${jetbrainsMono.variable} font-mono`}>
        <ThemeProvider attribute="class" defaultTheme="dark" enableSystem disableTransitionOnChange>
          <NavigationErrorBoundary>
            <AuthProvider>
              {children}
            </AuthProvider>
          </NavigationErrorBoundary>
        </ThemeProvider>
      </body>
    </html>
  )
}

</code>

app\loading.tsx:
<code>
export default function Loading() {
  return null
}

</code>

app\page.tsx:
<code>
"use client"

import { useState, useEffect, useCallback, Suspense } from "react"
import { useSearchParams } from "next/navigation"
import { Button } from "@/components/ui/button"
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"
import { Badge } from "@/components/ui/badge"
import { Alert, AlertDescription } from "@/components/ui/alert"
import { ThemeToggle } from "@/components/theme-toggle"
import GitHubAuth from "@/components/github-auth"
import { useAuth } from "@/components/auth-provider"
import GitHubConnectPopup from "@/components/github-connect-popup"
import { supabase } from "@/lib/supabase"
import { 
  Github,
  Star, 
  TrendingUp, 
  Zap, 
  Shield, 
  FileText, 
  GitBranch, 
  CheckCircle, 
  ArrowRight, 
  AlertCircle, 
  X, 
  RefreshCw, 
  LogOut 
} from "lucide-react"
import Image from "next/image"
import { useTheme } from "next-themes"

// Theme-aware logo component
function ThemeAwareLogo() {
  const { theme, resolvedTheme } = useTheme()
  const currentTheme = resolvedTheme || theme
  
  return (
    <Image 
      src={currentTheme === 'dark' ? '/logo-dark.png' : '/logo-light.png'} 
      alt="NeatRepo Logo" 
      width={32} 
      height={32} 
      className="h-8 w-8" 
    />
  )
}

// Separate component for search params logic to avoid hydration issues
function SearchParamsHandler({ onError }: { onError: (error: string) => void }) {
  const searchParams = useSearchParams()

  useEffect(() => {
    const oauthError = searchParams.get("oauth_error")
    if (oauthError) {
      onError(`OAuth Error: ${decodeURIComponent(oauthError)}`)
      console.error("OAuth Error from URL:", oauthError)
    }
  }, [searchParams, onError])

  return null
}

// Separate component to handle auth state
function AuthGuard({ children }: { children: React.ReactNode }) {
  const { user, loading, profile } = useAuth()
  const [showGitHubPopup, setShowGitHubPopup] = useState(false)

  // DISABLED: Auto-redirect interferes with button navigation
  // Let users manually click "Continue to Dashboard" button instead
  // Handle GitHub connection requirement and dashboard redirect
  // useEffect(() => {
  //   if (user && !loading) {
  //     // If profile is loaded, check GitHub connection
  //     if (profile) {
  //       const hasGitHubConnection = profile.github_username || user.app_metadata?.provider === 'github'

  //       if (hasGitHubConnection) {
  //         // User has GitHub connection, redirect to dashboard
  //         setIsRedirecting(true)
  //         const timer = setTimeout(() => {
  //           window.location.href = '/dashboard'
  //         }, 100)
  //         return () => clearTimeout(timer)
  //       } else {
  //         // User doesn't have GitHub connection, show popup instead of auto-redirect
  //         console.log('‚ö†Ô∏è AUTH: User not connected to GitHub, showing connect popup...')
  //         setShowGitHubPopup(true)
  //       }
  //     }
  //     // If profile is not loaded yet, wait for it
  //   }
  // }, [user, loading, profile])

  const handleSkipGitHub = () => {
    setShowGitHubPopup(false)
    // User must manually navigate to dashboard
    console.log('üîÑ USER: Skipped GitHub connection - manual navigation required')
  }

  // Show loading state while auth is loading
  if (loading) {
    return (
      <div className="min-h-screen bg-background flex items-center justify-center">
        <div className="text-center">
          <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"></div>
          <p className="text-muted-foreground">Loading...</p>
        </div>
      </div>
    )
  }

  // Show GitHub connect popup if needed
  if (showGitHubPopup) {
    return (
      <>
        <GitHubConnectPopup 
          onClose={() => setShowGitHubPopup(false)}
          onSkip={handleSkipGitHub}
          userEmail={user?.email}
        />
        {children}
      </>
    )
  }

  // Only render children if user is not authenticated and not loading
  return <>{children}</>
}

function HomePageContent({ handleError }: { handleError: (error: string) => void }) {
  const { user, loading, signOut } = useAuth()
  const [showGitHubAuth, setShowGitHubAuth] = useState(false)
  const [debugInfo, setDebugInfo] = useState<any>(null)
  const [isLoading, setIsLoading] = useState(false)

  // Debug authentication state
  useEffect(() => {
    console.log('üîç Homepage auth state:', { user: !!user, loading, userId: user?.id })
  }, [user, loading])

  // Handle auth success redirect
  useEffect(() => {
    const urlParams = new URLSearchParams(window.location.search)
    const authSuccess = urlParams.get('auth')

    if (authSuccess === 'success' && user && !loading) {
      console.log('üéØ Auth success detected, redirecting to dashboard...')
      // Clear the auth parameter from URL
      window.history.replaceState({}, '', window.location.pathname)
      // Redirect to dashboard
      setTimeout(() => {
        window.location.href = '/dashboard'
      }, 1000) // Give time for session to fully establish
    }
  }, [user, loading])

  // Handle logout with proper cleanup (local only, no GitHub redirect)
  const handleLogout = async () => {
    try {
      setIsLoading(true)

      // Clear all localStorage data
      if (typeof window !== 'undefined') {
        localStorage.clear()
        sessionStorage.clear()
      }

      // Sign out from Supabase with global scope to revoke OAuth tokens
      await supabase.auth.signOut({ scope: 'global' })

      // Force page reload to ensure clean state
      window.location.reload()
    } catch (error) {
      console.error('Logout error:', error)
      handleError('Failed to log out. Please try again.')
    } finally {
      setIsLoading(false)
    }
  }

  const initializeDebugInfo = useCallback(() => {
    if (typeof window !== "undefined") {
      return {
        currentUrl: window.location.href,
        origin: window.location.origin,
        clientId: process.env.NEXT_PUBLIC_GITHUB_CLIENT_ID,
        userAgent: navigator.userAgent,
        timestamp: new Date().toISOString(),
      }
    }
    return null
  }, [])

  useEffect(() => {
    if (!debugInfo) {
      setDebugInfo(initializeDebugInfo())
    }
  }, [debugInfo, initializeDebugInfo])

  return (
    <div className="min-h-screen bg-background text-foreground">

      {/* GitHub Auth Modal */}
      {showGitHubAuth && (
        <GitHubAuth onClose={() => setShowGitHubAuth(false)} />
      )}

      {/* Navigation */}
      <nav className="container mx-auto px-4 py-6">
        <div className="flex items-center justify-between">
          <div className="flex items-center space-x-2">
            <ThemeAwareLogo />
            <span className="text-xl font-bold">NeatRepo</span>
            <Badge variant="secondary" className="bg-secondary text-secondary-foreground">
              Production Ready
            </Badge>
          </div>
          <div className="flex items-center space-x-4">
            <a href="#features" className="text-muted-foreground hover:text-foreground transition-colors">
              Features
            </a>
            <a href="#demo" className="text-muted-foreground hover:text-foreground transition-colors">
              Demo
            </a>
            <ThemeToggle />
            <div className="flex items-center space-x-2">
              {loading ? (
                // Show loading state
                <Button disabled className="bg-primary/50 text-primary-foreground">
                  <RefreshCw className="h-4 w-4 mr-2 animate-spin" />
                  Loading...
                </Button>
              ) : user ? (
                // Show dashboard and logout buttons when user is authenticated
                <>
                  <Button
                    onClick={() => {
                      console.log('üéØ BUTTON: Continue to Dashboard clicked');
                      // Force immediate navigation
                      window.location.href = '/dashboard';
                    }}
                    className="bg-primary hover:bg-primary/90 text-primary-foreground"
                  >
                    <ArrowRight className="h-4 w-4 mr-2" />
                    Continue to Dashboard
                  </Button>
                  <Button
                    onClick={handleLogout}
                    disabled={isLoading}
                    variant="outline"
                    className="border-destructive text-destructive hover:bg-destructive hover:text-destructive-foreground"
                  >
                    {isLoading ? (
                      <RefreshCw className="h-4 w-4 mr-2 animate-spin" />
                    ) : (
                      <LogOut className="h-4 w-4 mr-2" />
                    )}
                    {isLoading ? 'Signing out...' : 'Sign Out'}
                  </Button>
                </>
              ) : (
                // Show GitHub auth button when user is not authenticated
                <Button
                  onClick={() => setShowGitHubAuth(true)}
                  className="bg-primary hover:bg-primary/90 text-primary-foreground"
                >
                  <Github className="h-4 w-4 mr-2" />
                  Continue with GitHub
                </Button>
              )}
            </div>
          </div>
        </div>
      </nav>

      {/* Hero Section */}
      <section className="container mx-auto px-4 py-20 text-center">
        <div className="max-w-4xl mx-auto">
          <div className="mb-8">
            <Github className="h-16 w-16 mx-auto mb-6" />
          </div>

          <h1 className="text-5xl md:text-7xl font-bold mb-6">Professional GitHub Repository Management</h1>

          <p className="text-xl md:text-2xl text-muted-foreground mb-4">
            Organize, create, rename, and delete repositories with lightning-fast bulk operations
          </p>

          <p className="text-lg text-muted-foreground mb-12">We're here to help.</p>

          <div className="flex flex-col sm:flex-row gap-4 justify-center mb-12">
            <Button
              size="lg"
              onClick={loading ? undefined : (user ? () => {
                console.log('üéØ BUTTON: Go to Dashboard clicked');
                window.location.href = '/dashboard';
              } : () => setShowGitHubAuth(true))}
              disabled={loading}
              className="bg-primary hover:bg-primary/90 text-primary-foreground px-8 py-4 text-lg font-semibold"
            >
              {loading ? (
                <>
                  <RefreshCw className="h-5 w-5 mr-2 animate-spin" />
                  Loading...
                </>
              ) : user ? (
                <>
                  <ArrowRight className="h-5 w-5 mr-2" />
                  Go to Dashboard
                </>
              ) : (
                <>
                  <Github className="h-5 w-5 mr-2" />
                  Get Started
                </>
              )}
            </Button>
            <Button size="lg" variant="outline" className="px-8 py-4 text-lg bg-transparent">
              Watch Demo
              <ArrowRight className="h-5 w-5 ml-2" />
            </Button>
          </div>



          {/* Social Proof */}
          <div className="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-2xl mx-auto">
            <div className="text-center">
              <div className="text-2xl font-bold">1,247</div>
              <div className="text-muted-foreground">developers hired</div>
            </div>
            <div className="text-center">
              <div className="text-2xl font-bold">5,000+</div>
              <div className="text-muted-foreground">repos cleaned</div>
            </div>
            <div className="text-center">
              <div className="text-2xl font-bold">94%</div>
              <div className="text-muted-foreground">job success rate</div>
            </div>
          </div>
        </div>
      </section>

      {/* Features Section */}
      <section id="features" className="container mx-auto px-4 py-20 bg-accent/20">
        <div className="text-center mb-16">
          <h2 className="text-4xl font-bold mb-4">Features GitHub doesn't offer</h2>
          <p className="text-xl text-muted-foreground max-w-2xl mx-auto">
            Professional repository management tools for developers who care about organization
          </p>
        </div>

        <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
          <Card>
            <CardHeader>
              <Zap className="h-8 w-8 mb-2" />
              <CardTitle>Lightning-Fast Bulk Operations</CardTitle>
              <CardDescription>
                Delete multiple repositories at once - a feature GitHub doesn't offer natively
              </CardDescription>
            </CardHeader>
          </Card>

          <Card>
            <CardHeader>
              <FileText className="h-8 w-8 mb-2" />
              <CardTitle>Smart README Generation</CardTitle>
              <CardDescription>
                Automatically generate professional README files that showcase your projects effectively
              </CardDescription>
            </CardHeader>
          </Card>

          <Card>
            <CardHeader>
              <GitBranch className="h-8 w-8 mb-2" />
              <CardTitle>Visual Repository Organization</CardTitle>
              <CardDescription>
                Drag & drop reordering and professional presentation - GitHub only has alphabetical sorting
              </CardDescription>
            </CardHeader>
          </Card>

          <Card>
            <CardHeader>
              <Shield className="h-8 w-8 mb-2" />
              <CardTitle>Security Scanning</CardTitle>
              <CardDescription>Identify and fix security vulnerabilities before they become a problem</CardDescription>
            </CardHeader>
          </Card>

          <Card>
            <CardHeader>
              <TrendingUp className="h-8 w-8 mb-2" />
              <CardTitle>Portfolio Scoring</CardTitle>
              <CardDescription>
                Get a comprehensive score for each repository and track your improvement over time
              </CardDescription>
            </CardHeader>
          </Card>

          <Card>
            <CardHeader>
              <CheckCircle className="h-8 w-8 mb-2" />
              <CardTitle>Complete Repository Management</CardTitle>
              <CardDescription>
                Create, rename, and manage repositories without switching to GitHub - all in one place
              </CardDescription>
            </CardHeader>
          </Card>
        </div>
      </section>

      {/* Testimonials */}
      <section className="container mx-auto px-4 py-20">
        <div className="text-center mb-16">
          <h2 className="text-4xl font-bold mb-4">Loved by developers worldwide</h2>
          <p className="text-xl text-muted-foreground">See what our users have to say</p>
        </div>

        <div className="grid md:grid-cols-3 gap-8">
          <Card>
            <CardContent className="p-6">
              <div className="flex items-center mb-4">
                <div className="flex text-yellow-500">
                  {[...Array(5)].map((_, i) => (
                    <Star key={i} className="h-4 w-4 fill-current" />
                  ))}
                </div>
              </div>
              <p className="text-muted-foreground mb-4">
                "NeatRepo helped me organize my GitHub perfectly! The bulk operations saved me hours of work."
              </p>
              <div className="flex items-center">
                <div className="w-10 h-10 bg-primary rounded-full flex items-center justify-center text-primary-foreground font-semibold">
                  S
                </div>
                <div className="ml-3">
                  <div className="font-semibold">Sarah Chen</div>
                  <div className="text-sm text-muted-foreground">Frontend Developer</div>
                </div>
              </div>
            </CardContent>
          </Card>

          <Card>
            <CardContent className="p-6">
              <div className="flex items-center mb-4">
                <div className="flex text-yellow-500">
                  {[...Array(5)].map((_, i) => (
                    <Star key={i} className="h-4 w-4 fill-current" />
                  ))}
                </div>
              </div>
              <p className="text-muted-foreground mb-4">
                "Finally! Bulk delete saved me hours of cleaning up old repositories. NeatRepo is a game-changer!"
              </p>
              <div className="flex items-center">
                <div className="w-10 h-10 bg-primary rounded-full flex items-center justify-center text-primary-foreground font-semibold">
                  M
                </div>
                <div className="ml-3">
                  <div className="font-semibold">Marcus Johnson</div>
                  <div className="text-sm text-muted-foreground">Full Stack Developer</div>
                </div>
              </div>
            </CardContent>
          </Card>

          <Card>
            <CardContent className="p-6">
              <div className="flex items-center mb-4">
                <div className="flex text-yellow-500">
                  {[...Array(5)].map((_, i) => (
                    <Star key={i} className="h-4 w-4 fill-current" />
                  ))}
                </div>
              </div>
              <p className="text-muted-foreground mb-4">
                "The drag & drop organization is so intuitive. My GitHub looks professional now!"
              </p>
              <div className="flex items-center">
                <div className="w-10 h-10 bg-primary rounded-full flex items-center justify-center text-primary-foreground font-semibold">
                  A
                </div>
                <div className="ml-3">
                  <div className="font-semibold">Alex Rivera</div>
                  <div className="text-sm text-muted-foreground">Backend Developer</div>
                </div>
              </div>
            </CardContent>
          </Card>
        </div>
      </section>

      {/* Final CTA */}
      <section className="container mx-auto px-4 py-20 bg-accent/20">
        <div className="text-center max-w-3xl mx-auto">
          <h2 className="text-4xl font-bold mb-6">Ready to organize your repositories?</h2>
          <p className="text-xl text-muted-foreground mb-8">
            Join developers who use NeatRepo for professional GitHub repository management
          </p>
          <Button
            size="lg"
            onClick={() => setShowGitHubAuth(true)}
            className="bg-primary hover:bg-primary/90 text-primary-foreground px-12 py-4 text-xl font-semibold"
          >
            <Github className="h-6 w-6 mr-3" />
            Start Free Today
          </Button>
        </div>
      </section>

      {/* Search Params Handler */}
      <Suspense fallback={null}>
        <SearchParamsHandler onError={handleError} />
      </Suspense>

      {/* Footer */}
      <footer className="border-t border-border bg-card">
        <div className="container mx-auto px-4 py-12">
          <div className="grid md:grid-cols-4 gap-8">
            <div>
              <div className="flex items-center space-x-2 mb-4">
                <Github className="h-6 w-6" />
                <span className="text-lg font-bold">NeatRepo</span>
              </div>
              <p className="text-muted-foreground">
                Professional GitHub repository management with lightning-fast bulk operations.
              </p>
            </div>
            <div>
              <h3 className="font-semibold mb-4">Product</h3>
              <ul className="space-y-2 text-muted-foreground">
                <li>
                  <a href="#features" className="hover:text-foreground transition-colors">
                    Features
                  </a>
                </li>
                <li>
                  <a href="#demo" className="hover:text-foreground transition-colors">
                    Demo
                  </a>
                </li>
                <li>
                  <a href="#" className="hover:text-foreground transition-colors">
                    API
                  </a>
                </li>
                <li>
                  <a href="#" className="hover:text-foreground transition-colors">
                    Integrations
                  </a>
                </li>
              </ul>
            </div>
            <div>
              <h3 className="font-semibold mb-4">Company</h3>
              <ul className="space-y-2 text-muted-foreground">
                <li>
                  <a href="#" className="hover:text-foreground transition-colors">
                    About
                  </a>
                </li>
                <li>
                  <a href="#" className="hover:text-foreground transition-colors">
                    Blog
                  </a>
                </li>
                <li>
                  <a href="#" className="hover:text-foreground transition-colors">
                    Careers
                  </a>
                </li>
                <li>
                  <a href="#" className="hover:text-foreground transition-colors">
                    Contact
                  </a>
                </li>
              </ul>
            </div>
            <div>
              <h3 className="font-semibold mb-4">Support</h3>
              <ul className="space-y-2 text-muted-foreground">
                <li>
                  <a href="#" className="hover:text-foreground transition-colors">
                    Help Center
                  </a>
                </li>
                <li>
                  <a href="#" className="hover:text-foreground transition-colors">
                    Documentation
                  </a>
                </li>
                <li>
                  <a href="#" className="hover:text-foreground transition-colors">
                    Status
                  </a>
                </li>
                <li>
                  <a href="#" className="hover:text-foreground transition-colors">
                    Privacy
                  </a>
                </li>
              </ul>
            </div>
          </div>
          <div className="border-t border-border mt-8 pt-8 text-center text-muted-foreground">
            <p>&copy; 2025 NeatRepo. All rights reserved.</p>
          </div>
        </div>
      </footer>
    </div>
  )
}

function HomePageWrapper() {
  const [error, setError] = useState<string | null>(null)

  const handleError = useCallback((errorMessage: string) => {
    setError(errorMessage)
  }, [])

  return (
    <>
      <SearchParamsHandler onError={handleError} />
      {/* Error Alert */}
      {error && (
        <div className="fixed top-4 right-4 z-50 max-w-md">
          <Alert className="bg-destructive/20 border-destructive text-destructive">
            <AlertCircle className="h-4 w-4" />
            <AlertDescription className="pr-8">{error}</AlertDescription>
            <button
              onClick={() => setError(null)}
              className="absolute top-2 right-2 text-destructive hover:text-destructive/80"
            >
              <X className="h-4 w-4" />
            </button>
          </Alert>
        </div>
      )}
      <AuthGuard>
        <HomePageContent handleError={handleError} />
      </AuthGuard>
    </>
  )
}

export default function HomePage() {
  return (
    <Suspense fallback={
      <div className="min-h-screen bg-background flex items-center justify-center">
        <div className="text-center">
          <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"></div>
          <p className="text-muted-foreground">Loading...</p>
        </div>
      </div>
    }>
      <HomePageWrapper />
    </Suspense>
  )
}

</code>

components\dashboard\ai-chat-panel.tsx:
<code>
import React from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { ScrollArea } from '@/components/ui/scroll-area';
import { Send, MessageCircle, X, Sparkles } from 'lucide-react';
import { useChatStore } from '@/stores';
import { useAIChat } from '@/hooks/dashboard';

interface AIChatPanelProps {
  repositories: any[];
  className?: string;
}

export const AIChatPanel: React.FC<AIChatPanelProps> = ({ 
  repositories, 
  className = '' 
}) => {
  const {
    messages,
    currentMessage,
    isTyping,
    isChatExpanded,
    setCurrentMessage,
    sendAIMessage,
    generateRepositoryAnalysis,
    toggleChat,
    clearChat,
    hasMessages,
    canSendMessage
  } = useAIChat();

  const handleSendMessage = async (e: React.FormEvent) => {
    e.preventDefault();
    if (canSendMessage) {
      await sendAIMessage(currentMessage, repositories);
    }
  };

  const handleGenerateAnalysis = async () => {
    await generateRepositoryAnalysis(repositories);
  };

  if (!isChatExpanded) {
    return (
      <Card className={`fixed bottom-4 right-4 w-80 shadow-lg ${className}`}>
        <CardHeader className="pb-2">
          <div className="flex items-center justify-between">
            <CardTitle className="text-sm flex items-center gap-2">
              <Sparkles className="h-4 w-4" />
              AI Assistant
            </CardTitle>
            <Button
              variant="ghost"
              size="sm"
              onClick={toggleChat}
              className="h-8 w-8 p-0"
            >
              <MessageCircle className="h-4 w-4" />
            </Button>
          </div>
        </CardHeader>
      </Card>
    );
  }

  return (
    <Card className={`fixed bottom-4 right-4 w-96 h-96 shadow-lg flex flex-col ${className}`}>
      <CardHeader className="pb-2 flex-shrink-0">
        <div className="flex items-center justify-between">
          <CardTitle className="text-sm flex items-center gap-2">
            <Sparkles className="h-4 w-4" />
            AI Assistant
          </CardTitle>
          <div className="flex gap-1">
            {hasMessages && (
              <Button
                variant="ghost"
                size="sm"
                onClick={clearChat}
                className="h-8 w-8 p-0"
                title="Clear chat"
              >
                <X className="h-3 w-3" />
              </Button>
            )}
            <Button
              variant="ghost"
              size="sm"
              onClick={toggleChat}
              className="h-8 w-8 p-0"
            >
              <X className="h-4 w-4" />
            </Button>
          </div>
        </div>
      </CardHeader>
      
      <CardContent className="flex-1 flex flex-col p-3 gap-3">
        {/* Quick Actions */}
        {!hasMessages && (
          <div className="flex flex-wrap gap-2">
            <Button
              size="sm"
              variant="outline"
              onClick={handleGenerateAnalysis}
              disabled={repositories.length === 0}
              className="text-xs"
            >
              <Sparkles className="h-3 w-3 mr-1" />
              Analyze Repos
            </Button>
          </div>
        )}

        {/* Chat Messages */}
        <ScrollArea className="flex-1 pr-2">
          <div className="space-y-3">
            {messages.map((message) => (
              <div
                key={message.id}
                className={`flex ${message.role === 'user' ? 'justify-end' : 'justify-start'}`}
              >
                <div
                  className={`max-w-[80%] rounded-lg px-3 py-2 text-xs ${
                    message.role === 'user'
                      ? 'bg-primary text-primary-foreground'
                      : 'bg-muted'
                  }`}
                >
                  {message.content}
                </div>
              </div>
            ))}
            
            {isTyping && (
              <div className="flex justify-start">
                <div className="bg-muted rounded-lg px-3 py-2 text-xs">
                  <div className="flex space-x-1">
                    <div className="w-1 h-1 bg-current rounded-full animate-bounce"></div>
                    <div className="w-1 h-1 bg-current rounded-full animate-bounce" style={{ animationDelay: '0.1s' }}></div>
                    <div className="w-1 h-1 bg-current rounded-full animate-bounce" style={{ animationDelay: '0.2s' }}></div>
                  </div>
                </div>
              </div>
            )}
          </div>
        </ScrollArea>

        {/* Message Input */}
        <form onSubmit={handleSendMessage} className="flex gap-2">
          <input
            type="text"
            value={currentMessage}
            onChange={(e) => setCurrentMessage(e.target.value)}
            placeholder="Ask about your repositories..."
            className="flex-1 px-3 py-2 text-xs border rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
            disabled={isTyping}
          />
          <Button
            type="submit"
            size="sm"
            disabled={!canSendMessage}
            className="px-3"
          >
            <Send className="h-3 w-3" />
          </Button>
        </form>
      </CardContent>
    </Card>
  );
};

</code>

components\dashboard\error-display.tsx:
<code>
import React from 'react';
import { AlertTriangle, CheckCircle, Info, X } from 'lucide-react';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { Button } from '@/components/ui/button';
import { useErrorStore } from '@/stores';
import { AppError } from '@/stores/types';

interface ErrorDisplayProps {
  className?: string;
}

export const ErrorDisplay: React.FC<ErrorDisplayProps> = ({ className = '' }) => {
  const { errors, lastError, removeError, clearErrors } = useErrorStore();

  if (errors.length === 0) {
    return null;
  }

  const getErrorIcon = (type: AppError['type']) => {
    switch (type) {
      case 'error':
        return <AlertTriangle className="h-4 w-4" />;
      case 'warning':
        return <AlertTriangle className="h-4 w-4" />;
      case 'info':
        return <Info className="h-4 w-4" />;
      default:
        return <Info className="h-4 w-4" />;
    }
  };

  const getErrorVariant = (type: AppError['type']): 'default' | 'destructive' => {
    return type === 'error' ? 'destructive' : 'default';
  };

  return (
    <div className={`space-y-2 ${className}`}>
      {/* Show only the most recent error if there are multiple */}
      {lastError && (
        <Alert variant={getErrorVariant(lastError.type)} className="relative">
          {getErrorIcon(lastError.type)}
          <AlertDescription className="pr-8">
            {lastError.message}
            {lastError.code && (
              <span className="block text-xs mt-1 opacity-70">
                Error Code: {lastError.code}
              </span>
            )}
          </AlertDescription>
          <Button
            variant="ghost"
            size="sm"
            onClick={() => removeError(lastError.timestamp)}
            className="absolute top-2 right-2 h-6 w-6 p-0"
          >
            <X className="h-3 w-3" />
          </Button>
        </Alert>
      )}

      {/* Show error count if there are multiple errors */}
      {errors.length > 1 && (
        <div className="flex items-center justify-between text-xs text-muted-foreground">
          <span>
            {errors.length - 1} more error{errors.length > 2 ? 's' : ''}
          </span>
          <Button
            variant="ghost"
            size="sm"
            onClick={clearErrors}
            className="h-6 text-xs"
          >
            Clear all
          </Button>
        </div>
      )}
    </div>
  );
};

</code>

components\dashboard\index.ts:
<code>
export { AIChatPanel } from './ai-chat-panel';
export { RepositoryActions } from './repository-actions';
export { RepositoryCard } from './repository-card';
export { RepositoryList } from './repository-list';
export { ErrorDisplay } from './error-display';
export { JobTemplateModal } from './job-template-modal';

</code>

components\dashboard\job-template-modal.tsx:
<code>
import React from 'react';
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
} from '@/components/ui/dialog';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';
import { Target, Sparkles } from 'lucide-react';
import { useUIStore } from '@/stores';
import { useAIChat } from '@/hooks/dashboard';

interface JobTemplateModalProps {
  repositories: any[];
}

export const JobTemplateModal: React.FC<JobTemplateModalProps> = ({ repositories }) => {
  const { 
    showJobTemplateModal, 
    jobTitle, 
    jobDescription,
    isProcessing,
    setJobTemplateModal,
    setJobTitle,
    setJobDescription,
    setProcessing,
    resetJobForm
  } = useUIStore();

  const { generateJobRecommendations } = useAIChat();

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    
    if (!jobTitle.trim()) {
      return;
    }

    try {
      setProcessing(true);
      await generateJobRecommendations(jobTitle, repositories);
      resetJobForm();
    } catch (error) {
      console.error('Error generating job recommendations:', error);
    } finally {
      setProcessing(false);
    }
  };

  const handleClose = () => {
    if (!isProcessing) {
      resetJobForm();
    }
  };

  return (
    <Dialog open={showJobTemplateModal} onOpenChange={setJobTemplateModal}>
      <DialogContent className="sm:max-w-[500px]">
        <DialogHeader>
          <DialogTitle className="flex items-center gap-2">
            <Target className="h-5 w-5" />
            Job-Specific Portfolio Optimization
          </DialogTitle>
          <DialogDescription>
            Get AI-powered recommendations for tailoring your GitHub profile to a specific job role.
          </DialogDescription>
        </DialogHeader>

        <form onSubmit={handleSubmit} className="space-y-6">
          <div className="space-y-2">
            <Label htmlFor="jobTitle">Job Title or Role</Label>
            <Input
              id="jobTitle"
              type="text"
              placeholder="e.g., Frontend Developer, Full Stack Engineer, React Developer"
              value={jobTitle}
              onChange={(e) => setJobTitle(e.target.value)}
              disabled={isProcessing}
              required
            />
          </div>

          <div className="space-y-2">
            <Label htmlFor="jobDescription">Job Description (Optional)</Label>
            <Textarea
              id="jobDescription"
              placeholder="Paste the job description here for more specific recommendations..."
              value={jobDescription}
              onChange={(e) => setJobDescription(e.target.value)}
              disabled={isProcessing}
              rows={4}
            />
          </div>

          <div className="bg-muted p-4 rounded-lg">
            <h4 className="font-medium text-sm mb-2 flex items-center gap-2">
              <Sparkles className="h-4 w-4" />
              What you'll get:
            </h4>
            <ul className="text-sm text-muted-foreground space-y-1">
              <li>‚Ä¢ Repository recommendations to highlight</li>
              <li>‚Ä¢ Skills gaps analysis</li>
              <li>‚Ä¢ Profile improvement suggestions</li>
              <li>‚Ä¢ Interview talking points</li>
            </ul>
          </div>

          <div className="flex justify-end gap-3">
            <Button
              type="button"
              variant="outline"
              onClick={handleClose}
              disabled={isProcessing}
            >
              Cancel
            </Button>
            <Button
              type="submit"
              disabled={!jobTitle.trim() || isProcessing}
            >
              {isProcessing ? (
                <>
                  <div className="animate-spin rounded-full h-4 w-4 border-2 border-current border-t-transparent mr-2" />
                  Generating...
                </>
              ) : (
                <>
                  <Sparkles className="h-4 w-4 mr-2" />
                  Get Recommendations
                </>
              )}
            </Button>
          </div>
        </form>
      </DialogContent>
    </Dialog>
  );
};

</code>

components\dashboard\repository-actions.tsx:
<code>
import React from 'react';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { 
  RefreshCw, 
  ArrowUp, 
  Target, 
  Calendar,
  CalendarDays,
  Download,
  Zap,
  CheckCircle,
  X
} from 'lucide-react';
import { useRepositoryStore, useUIStore } from '@/stores';
import { useRepositorySorting } from '@/hooks/dashboard';

interface RepositoryActionsProps {
  onRefresh: () => void;
  onJobTemplateOpen: () => void;
  isLoading: boolean;
  repositoryCount: number;
}

export const RepositoryActions: React.FC<RepositoryActionsProps> = ({
  onRefresh,
  onJobTemplateOpen,
  isLoading,
  repositoryCount
}) => {
  const { isPreviewMode, applyPreview, cancelPreview } = useRepositoryStore();
  const { applySorting, resetSorting, currentSortOrder } = useRepositorySorting();

  const handleSortByStars = () => applySorting('stars', 'newest');
  const handleSortByForks = () => applySorting('forks', 'newest');
  const handleSortByUpdated = () => applySorting('updated', 'newest');
  const handleSortByName = () => applySorting('name', 'default');
  const handleSortByComplexity = () => applySorting('complexity', 'newest');

  return (
    <div className="space-y-4">
      {/* Preview Mode Banner */}
      {isPreviewMode && (
        <div className="bg-yellow-50 dark:bg-yellow-950/20 border border-yellow-200 dark:border-yellow-800/50 rounded-lg p-4">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-2">
              <Zap className="h-4 w-4 text-yellow-600 dark:text-yellow-400" />
              <span className="text-sm font-medium text-yellow-900 dark:text-yellow-100">
                Preview Mode Active
              </span>
            </div>
            <div className="flex gap-2">
              <Button
                size="sm"
                onClick={applyPreview}
                className="bg-black hover:bg-gray-800 text-white dark:bg-white dark:hover:bg-gray-200 dark:text-black"
              >
                <CheckCircle className="h-4 w-4 mr-1" />
                Apply
              </Button>
              <Button
                size="sm"
                variant="outline"
                onClick={cancelPreview}
                className="border-yellow-300 text-yellow-700 hover:bg-yellow-50 dark:border-yellow-600 dark:text-yellow-300 dark:hover:bg-yellow-950/30"
              >
                <X className="h-4 w-4 mr-1" />
                Cancel
              </Button>
            </div>
          </div>
        </div>
      )}

      {/* Main Actions */}
      <div className="flex flex-wrap gap-2">
        <Button 
          onClick={onRefresh} 
          disabled={isLoading}
          size="sm"
          variant="outline"
        >
          <RefreshCw className={`h-4 w-4 mr-2 ${isLoading ? 'animate-spin' : ''}`} />
          Refresh
        </Button>

        <Button 
          onClick={onJobTemplateOpen}
          size="sm"
          variant="outline"
        >
          <Target className="h-4 w-4 mr-2" />
          Job Template
        </Button>

        {repositoryCount > 0 && (
          <>
            <Button 
              onClick={handleSortByStars}
              size="sm"
              variant="outline"
            >
              <ArrowUp className="h-4 w-4 mr-2" />
              Stars
            </Button>

            <Button 
              onClick={handleSortByForks}
              size="sm"
              variant="outline"
            >
              <ArrowUp className="h-4 w-4 mr-2" />
              Forks
            </Button>

            <Button 
              onClick={handleSortByUpdated}
              size="sm"
              variant="outline"
            >
              <Calendar className="h-4 w-4 mr-2" />
              Updated
            </Button>

            <Button 
              onClick={handleSortByName}
              size="sm"
              variant="outline"
            >
              Name
            </Button>

            <Button 
              onClick={handleSortByComplexity}
              size="sm"
              variant="outline"
            >
              <Zap className="h-4 w-4 mr-2" />
              Complexity
            </Button>

            {currentSortOrder !== 'default' && (
              <Button 
                onClick={resetSorting}
                size="sm"
                variant="ghost"
                className="text-muted-foreground"
              >
                Reset Sort
              </Button>
            )}
          </>
        )}
      </div>

      {/* Repository Count Badge */}
      {repositoryCount > 0 && (
        <div className="flex items-center gap-2">
          <Badge variant="secondary" className="text-xs">
            {repositoryCount} repositories
          </Badge>
          {currentSortOrder !== 'default' && (
            <Badge variant="outline" className="text-xs">
              Sorted: {currentSortOrder}
            </Badge>
          )}
        </div>
      )}
    </div>
  );
};

</code>

components\dashboard\repository-card.tsx:
<code>
import React from 'react';
import { Draggable } from '@hello-pangea/dnd';
import { Card, CardContent } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { 
  Star, 
  GitFork, 
  Clock, 
  ExternalLink, 
  GripVertical,
  Trash2,
  Eye,
  ChevronDown,
  ChevronRight
} from 'lucide-react';
import { useRepositoryStore } from '@/stores';
import { GitHubRepo } from '@/stores/types';

interface RepositoryCardProps {
  repository: GitHubRepo;
  index: number;
  onDelete?: (repo: GitHubRepo) => void;
}

export const RepositoryCard: React.FC<RepositoryCardProps> = ({
  repository,
  index,
  onDelete
}) => {
  const { 
    expandedRepos, 
    selectedRepos, 
    isDeleteMode,
    toggleRepoExpansion,
    toggleRepoSelection
  } = useRepositoryStore();

  const isExpanded = expandedRepos.has(repository.id);
  const isSelected = selectedRepos.has(repository.id);

  const handleToggleExpansion = () => {
    toggleRepoExpansion(repository.id);
  };

  const handleToggleSelection = () => {
    if (isDeleteMode) {
      toggleRepoSelection(repository.id);
    }
  };

  const handleDelete = () => {
    if (onDelete) {
      onDelete(repository);
    }
  };

  const formatDate = (dateString: string) => {
    return new Date(dateString).toLocaleDateString('en-US', {
      year: 'numeric',
      month: 'short',
      day: 'numeric'
    });
  };

  return (
    <Draggable draggableId={repository.id.toString()} index={index}>
      {(provided, snapshot) => (
        <Card
          ref={provided.innerRef}
          {...provided.draggableProps}
          className={`mb-3 transition-all duration-200 ${
            snapshot.isDragging ? 'shadow-lg rotate-1' : 'hover:shadow-md'
          } ${
            isSelected ? 'ring-2 ring-destructive' : ''
          } ${
            isDeleteMode ? 'cursor-pointer' : ''
          }`}
          onClick={isDeleteMode ? handleToggleSelection : undefined}
        >
          <CardContent className="p-4">
            <div className="flex items-start gap-3">
              {/* Drag Handle */}
              <div
                {...provided.dragHandleProps}
                className="mt-1 cursor-grab active:cursor-grabbing"
              >
                <GripVertical className="h-4 w-4 text-muted-foreground" />
              </div>

              {/* Main Content */}
              <div className="flex-1 min-w-0">
                <div className="flex items-start justify-between gap-2">
                  <div className="flex-1 min-w-0">
                    <div className="flex items-center gap-2 mb-1">
                      <h3 className="font-semibold text-sm truncate">
                        {repository.name}
                      </h3>
                      {repository.private && (
                        <Badge variant="secondary" className="text-xs">
                          Private
                        </Badge>
                      )}
                      {repository.fork && (
                        <Badge variant="outline" className="text-xs">
                          Fork
                        </Badge>
                      )}
                    </div>

                    {repository.description && (
                      <p className="text-xs text-muted-foreground mb-2 line-clamp-2">
                        {repository.description}
                      </p>
                    )}

                    {/* Stats */}
                    <div className="flex items-center gap-4 text-xs text-muted-foreground">
                      {repository.language && (
                        <div className="flex items-center gap-1">
                          <div 
                            className="w-2 h-2 rounded-full bg-yellow-500"
                            title={repository.language}
                          />
                          <span>{repository.language}</span>
                        </div>
                      )}
                      <div className="flex items-center gap-1">
                        <Star className="h-3 w-3" />
                        <span>{repository.stargazers_count}</span>
                      </div>
                      <div className="flex items-center gap-1">
                        <GitFork className="h-3 w-3" />
                        <span>{repository.forks_count}</span>
                      </div>
                      <div className="flex items-center gap-1">
                        <Clock className="h-3 w-3" />
                        <span>{formatDate(repository.updated_at)}</span>
                      </div>
                    </div>
                  </div>

                  {/* Actions */}
                  <div className="flex items-center gap-1">
                    {isDeleteMode ? (
                      <Button
                        size="sm"
                        variant={isSelected ? "destructive" : "outline"}
                        onClick={handleDelete}
                        className="h-8 w-8 p-0"
                      >
                        <Trash2 className="h-3 w-3" />
                      </Button>
                    ) : (
                      <>
                        <Button
                          size="sm"
                          variant="ghost"
                          onClick={handleToggleExpansion}
                          className="h-8 w-8 p-0"
                        >
                          {isExpanded ? (
                            <ChevronDown className="h-3 w-3" />
                          ) : (
                            <ChevronRight className="h-3 w-3" />
                          )}
                        </Button>
                        <Button
                          size="sm"
                          variant="ghost"
                          asChild
                          className="h-8 w-8 p-0"
                        >
                          <a 
                            href={repository.html_url} 
                            target="_blank" 
                            rel="noopener noreferrer"
                          >
                            <ExternalLink className="h-3 w-3" />
                          </a>
                        </Button>
                      </>
                    )}
                  </div>
                </div>

                {/* Extended Details */}
                {isExpanded && (
                  <div className="mt-3 pt-3 border-t space-y-2">
                    <div className="grid grid-cols-2 gap-4 text-xs">
                      <div>
                        <span className="font-medium">Full Name:</span>
                        <br />
                        <span className="text-muted-foreground">{repository.full_name}</span>
                      </div>
                      <div>
                        <span className="font-medium">Last Push:</span>
                        <br />
                        <span className="text-muted-foreground">{formatDate(repository.updated_at)}</span>
                      </div>
                    </div>

                    {repository.fork && repository.parent && (
                      <div className="text-xs">
                        <span className="font-medium">Forked from:</span>
                        <br />
                        <a 
                          href={repository.parent.html_url}
                          target="_blank"
                          rel="noopener noreferrer"
                          className="text-yellow-600 hover:underline dark:text-yellow-400"
                        >
                          {repository.parent.full_name}
                        </a>
                      </div>
                    )}

                    <div className="flex gap-2">
                      <Button size="sm" variant="outline" asChild>
                        <a 
                          href={repository.html_url} 
                          target="_blank" 
                          rel="noopener noreferrer"
                        >
                          <Eye className="h-3 w-3 mr-1" />
                          View on GitHub
                        </a>
                      </Button>
                    </div>
                  </div>
                )}
              </div>
            </div>
          </CardContent>
        </Card>
      )}
    </Draggable>
  );
};

</code>

components\dashboard\repository-list.tsx:
<code>
import React from 'react';
import { DragDropContext, Droppable } from '@hello-pangea/dnd';
import { ScrollArea } from '@/components/ui/scroll-area';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { Loader2, AlertTriangle, Folder } from 'lucide-react';
import { useRepositoryStore } from '@/stores';
import { useDragAndDrop } from '@/hooks/dashboard';
import { RepositoryCard } from './repository-card';
import { GitHubRepo } from '@/stores/types';

interface RepositoryListProps {
  onDeleteRepository?: (repo: GitHubRepo) => void;
  className?: string;
}

export const RepositoryList: React.FC<RepositoryListProps> = ({
  onDeleteRepository,
  className = ''
}) => {
  const { 
    repositories, 
    isLoadingRepos, 
    isPreviewMode,
    previewRepositories 
  } = useRepositoryStore();
  
  const { handleDragEnd } = useDragAndDrop();

  // Determine which repositories to display
  const displayedRepositories = isPreviewMode ? previewRepositories : repositories;

  // Loading state
  if (isLoadingRepos === 'loading') {
    return (
      <div className={`flex items-center justify-center py-8 ${className}`}>
        <div className="text-center">
          <Loader2 className="h-8 w-8 animate-spin mx-auto mb-2 text-muted-foreground" />
          <p className="text-sm text-muted-foreground">Loading repositories...</p>
        </div>
      </div>
    );
  }

  // Error state
  if (isLoadingRepos === 'error') {
    return (
      <Alert className={`${className}`} variant="destructive">
        <AlertTriangle className="h-4 w-4" />
        <AlertDescription>
          Failed to load repositories. Please try refreshing or check your connection.
        </AlertDescription>
      </Alert>
    );
  }

  // Empty state
  if (displayedRepositories.length === 0) {
    return (
      <div className={`text-center py-8 ${className}`}>
        <Folder className="h-12 w-12 mx-auto mb-4 text-muted-foreground" />
        <h3 className="text-lg font-medium mb-2">No repositories found</h3>
        <p className="text-sm text-muted-foreground mb-4">
          {repositories.length === 0 
            ? "It looks like you don't have any repositories yet, or they couldn't be loaded."
            : "No repositories match the current filter or sort criteria."
          }
        </p>
      </div>
    );
  }

  return (
    <div className={className}>
      <DragDropContext onDragEnd={handleDragEnd}>
        <Droppable droppableId="repositories">
          {(provided, snapshot) => (
            <div
              ref={provided.innerRef}
              {...provided.droppableProps}
              className={`transition-colors duration-200 ${
                snapshot.isDraggingOver ? 'bg-muted/50' : ''
              }`}
            >
              <ScrollArea className="h-[600px] pr-4">
                <div className="space-y-3">
                  {displayedRepositories.map((repo, index) => (
                    <RepositoryCard
                      key={repo.id}
                      repository={repo}
                      index={index}
                      onDelete={onDeleteRepository}
                    />
                  ))}
                  {provided.placeholder}
                </div>
              </ScrollArea>
            </div>
          )}
        </Droppable>
      </DragDropContext>

      {/* Preview Mode Indicator */}
      {isPreviewMode && (
        <div className="mt-4 text-center">
          <p className="text-xs text-muted-foreground">
            Preview mode active - changes will not be saved until applied
          </p>
        </div>
      )}
    </div>
  );
};

</code>

components\ui\accordion.tsx:
<code>
"use client"

import * as React from "react"
import * as AccordionPrimitive from "@radix-ui/react-accordion"
import { ChevronDown } from "lucide-react"

import { cn } from "@/lib/utils"

const Accordion = AccordionPrimitive.Root

const AccordionItem = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>
>(({ className, ...props }, ref) => (
  <AccordionPrimitive.Item
    ref={ref}
    className={cn("border-b", className)}
    {...props}
  />
))
AccordionItem.displayName = "AccordionItem"

const AccordionTrigger = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <AccordionPrimitive.Header className="flex">
    <AccordionPrimitive.Trigger
      ref={ref}
      className={cn(
        "flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",
        className
      )}
      {...props}
    >
      {children}
      <ChevronDown className="h-4 w-4 shrink-0 transition-transform duration-200" />
    </AccordionPrimitive.Trigger>
  </AccordionPrimitive.Header>
))
AccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName

const AccordionContent = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <AccordionPrimitive.Content
    ref={ref}
    className="overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down"
    {...props}
  >
    <div className={cn("pb-4 pt-0", className)}>{children}</div>
  </AccordionPrimitive.Content>
))

AccordionContent.displayName = AccordionPrimitive.Content.displayName

export { Accordion, AccordionItem, AccordionTrigger, AccordionContent }

</code>

components\ui\alert-dialog.tsx:
<code>
"use client"

import * as React from "react"
import * as AlertDialogPrimitive from "@radix-ui/react-alert-dialog"

import { cn } from "@/lib/utils"
import { buttonVariants } from "@/components/ui/button"

const AlertDialog = AlertDialogPrimitive.Root

const AlertDialogTrigger = AlertDialogPrimitive.Trigger

const AlertDialogPortal = AlertDialogPrimitive.Portal

const AlertDialogOverlay = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Overlay
    className={cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
    ref={ref}
  />
))
AlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName

const AlertDialogContent = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>
>(({ className, ...props }, ref) => (
  <AlertDialogPortal>
    <AlertDialogOverlay />
    <AlertDialogPrimitive.Content
      ref={ref}
      className={cn(
        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",
        className
      )}
      {...props}
    />
  </AlertDialogPortal>
))
AlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName

const AlertDialogHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-2 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
AlertDialogHeader.displayName = "AlertDialogHeader"

const AlertDialogFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
AlertDialogFooter.displayName = "AlertDialogFooter"

const AlertDialogTitle = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Title
    ref={ref}
    className={cn("text-lg font-semibold", className)}
    {...props}
  />
))
AlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName

const AlertDialogDescription = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
AlertDialogDescription.displayName =
  AlertDialogPrimitive.Description.displayName

const AlertDialogAction = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Action>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Action
    ref={ref}
    className={cn(buttonVariants(), className)}
    {...props}
  />
))
AlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName

const AlertDialogCancel = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Cancel
    ref={ref}
    className={cn(
      buttonVariants({ variant: "outline" }),
      "mt-2 sm:mt-0",
      className
    )}
    {...props}
  />
))
AlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName

export {
  AlertDialog,
  AlertDialogPortal,
  AlertDialogOverlay,
  AlertDialogTrigger,
  AlertDialogContent,
  AlertDialogHeader,
  AlertDialogFooter,
  AlertDialogTitle,
  AlertDialogDescription,
  AlertDialogAction,
  AlertDialogCancel,
}

</code>

components\ui\alert.tsx:
<code>
import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const alertVariants = cva(
  "relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",
  {
    variants: {
      variant: {
        default: "bg-background text-foreground",
        destructive:
          "border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

const Alert = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>
>(({ className, variant, ...props }, ref) => (
  <div
    ref={ref}
    role="alert"
    className={cn(alertVariants({ variant }), className)}
    {...props}
  />
))
Alert.displayName = "Alert"

const AlertTitle = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLHeadingElement>
>(({ className, ...props }, ref) => (
  <h5
    ref={ref}
    className={cn("mb-1 font-medium leading-none tracking-tight", className)}
    {...props}
  />
))
AlertTitle.displayName = "AlertTitle"

const AlertDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("text-sm [&_p]:leading-relaxed", className)}
    {...props}
  />
))
AlertDescription.displayName = "AlertDescription"

export { Alert, AlertTitle, AlertDescription }

</code>

components\ui\aspect-ratio.tsx:
<code>
"use client"

import * as AspectRatioPrimitive from "@radix-ui/react-aspect-ratio"

const AspectRatio = AspectRatioPrimitive.Root

export { AspectRatio }

</code>

components\ui\avatar.tsx:
<code>
"use client"

import * as React from "react"
import * as AvatarPrimitive from "@radix-ui/react-avatar"

import { cn } from "@/lib/utils"

const Avatar = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Root
    ref={ref}
    className={cn(
      "relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",
      className
    )}
    {...props}
  />
))
Avatar.displayName = AvatarPrimitive.Root.displayName

const AvatarImage = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Image>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Image
    ref={ref}
    className={cn("aspect-square h-full w-full", className)}
    {...props}
  />
))
AvatarImage.displayName = AvatarPrimitive.Image.displayName

const AvatarFallback = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Fallback>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Fallback
    ref={ref}
    className={cn(
      "flex h-full w-full items-center justify-center rounded-full bg-muted",
      className
    )}
    {...props}
  />
))
AvatarFallback.displayName = AvatarPrimitive.Fallback.displayName

export { Avatar, AvatarImage, AvatarFallback }

</code>

components\ui\badge.tsx:
<code>
import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const badgeVariants = cva(
  "inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",
  {
    variants: {
      variant: {
        default:
          "border-transparent bg-primary text-primary-foreground hover:bg-primary/80",
        secondary:
          "border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",
        destructive:
          "border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",
        outline: "text-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

export interface BadgeProps
  extends React.HTMLAttributes<HTMLDivElement>,
    VariantProps<typeof badgeVariants> {}

function Badge({ className, variant, ...props }: BadgeProps) {
  return (
    <div className={cn(badgeVariants({ variant }), className)} {...props} />
  )
}

export { Badge, badgeVariants }

</code>

components\ui\breadcrumb.tsx:
<code>
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { ChevronRight, MoreHorizontal } from "lucide-react"

import { cn } from "@/lib/utils"

const Breadcrumb = React.forwardRef<
  HTMLElement,
  React.ComponentPropsWithoutRef<"nav"> & {
    separator?: React.ReactNode
  }
>(({ ...props }, ref) => <nav ref={ref} aria-label="breadcrumb" {...props} />)
Breadcrumb.displayName = "Breadcrumb"

const BreadcrumbList = React.forwardRef<
  HTMLOListElement,
  React.ComponentPropsWithoutRef<"ol">
>(({ className, ...props }, ref) => (
  <ol
    ref={ref}
    className={cn(
      "flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5",
      className
    )}
    {...props}
  />
))
BreadcrumbList.displayName = "BreadcrumbList"

const BreadcrumbItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentPropsWithoutRef<"li">
>(({ className, ...props }, ref) => (
  <li
    ref={ref}
    className={cn("inline-flex items-center gap-1.5", className)}
    {...props}
  />
))
BreadcrumbItem.displayName = "BreadcrumbItem"

const BreadcrumbLink = React.forwardRef<
  HTMLAnchorElement,
  React.ComponentPropsWithoutRef<"a"> & {
    asChild?: boolean
  }
>(({ asChild, className, ...props }, ref) => {
  const Comp = asChild ? Slot : "a"

  return (
    <Comp
      ref={ref}
      className={cn("transition-colors hover:text-foreground", className)}
      {...props}
    />
  )
})
BreadcrumbLink.displayName = "BreadcrumbLink"

const BreadcrumbPage = React.forwardRef<
  HTMLSpanElement,
  React.ComponentPropsWithoutRef<"span">
>(({ className, ...props }, ref) => (
  <span
    ref={ref}
    role="link"
    aria-disabled="true"
    aria-current="page"
    className={cn("font-normal text-foreground", className)}
    {...props}
  />
))
BreadcrumbPage.displayName = "BreadcrumbPage"

const BreadcrumbSeparator = ({
  children,
  className,
  ...props
}: React.ComponentProps<"li">) => (
  <li
    role="presentation"
    aria-hidden="true"
    className={cn("[&>svg]:w-3.5 [&>svg]:h-3.5", className)}
    {...props}
  >
    {children ?? <ChevronRight />}
  </li>
)
BreadcrumbSeparator.displayName = "BreadcrumbSeparator"

const BreadcrumbEllipsis = ({
  className,
  ...props
}: React.ComponentProps<"span">) => (
  <span
    role="presentation"
    aria-hidden="true"
    className={cn("flex h-9 w-9 items-center justify-center", className)}
    {...props}
  >
    <MoreHorizontal className="h-4 w-4" />
    <span className="sr-only">More</span>
  </span>
)
BreadcrumbEllipsis.displayName = "BreadcrumbElipssis"

export {
  Breadcrumb,
  BreadcrumbList,
  BreadcrumbItem,
  BreadcrumbLink,
  BreadcrumbPage,
  BreadcrumbSeparator,
  BreadcrumbEllipsis,
}

</code>

components\ui\button.tsx:
<code>
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90",
        destructive:
          "bg-destructive text-destructive-foreground hover:bg-destructive/90",
        outline:
          "border border-input bg-background hover:bg-accent hover:text-accent-foreground",
        secondary:
          "bg-secondary text-secondary-foreground hover:bg-secondary/80",
        ghost: "hover:bg-accent hover:text-accent-foreground",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-10 px-4 py-2",
        sm: "h-9 rounded-md px-3",
        lg: "h-11 rounded-md px-8",
        icon: "h-10 w-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  asChild?: boolean
}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant, size, asChild = false, ...props }, ref) => {
    const Comp = asChild ? Slot : "button"
    return (
      <Comp
        className={cn(buttonVariants({ variant, size, className }))}
        ref={ref}
        {...props}
      />
    )
  }
)
Button.displayName = "Button"

export { Button, buttonVariants }

</code>

components\ui\calendar.tsx:
<code>
"use client"

import * as React from "react"
import {
  ChevronDownIcon,
  ChevronLeftIcon,
  ChevronRightIcon,
} from "lucide-react"
import { DayButton, DayPicker, getDefaultClassNames } from "react-day-picker"

import { cn } from "@/lib/utils"
import { Button, buttonVariants } from "@/components/ui/button"

function Calendar({
  className,
  classNames,
  showOutsideDays = true,
  captionLayout = "label",
  buttonVariant = "ghost",
  formatters,
  components,
  ...props
}: React.ComponentProps<typeof DayPicker> & {
  buttonVariant?: React.ComponentProps<typeof Button>["variant"]
}) {
  const defaultClassNames = getDefaultClassNames()

  return (
    <DayPicker
      showOutsideDays={showOutsideDays}
      className={cn(
        "bg-background group/calendar p-3 [--cell-size:2rem] [[data-slot=card-content]_&]:bg-transparent [[data-slot=popover-content]_&]:bg-transparent",
        String.raw`rtl:**:[.rdp-button\_next>svg]:rotate-180`,
        String.raw`rtl:**:[.rdp-button\_previous>svg]:rotate-180`,
        className
      )}
      captionLayout={captionLayout}
      formatters={{
        formatMonthDropdown: (date) =>
          date.toLocaleString("default", { month: "short" }),
        ...formatters,
      }}
      classNames={{
        root: cn("w-fit", defaultClassNames.root),
        months: cn(
          "relative flex flex-col gap-4 md:flex-row",
          defaultClassNames.months
        ),
        month: cn("flex w-full flex-col gap-4", defaultClassNames.month),
        nav: cn(
          "absolute inset-x-0 top-0 flex w-full items-center justify-between gap-1",
          defaultClassNames.nav
        ),
        button_previous: cn(
          buttonVariants({ variant: buttonVariant }),
          "h-[--cell-size] w-[--cell-size] select-none p-0 aria-disabled:opacity-50",
          defaultClassNames.button_previous
        ),
        button_next: cn(
          buttonVariants({ variant: buttonVariant }),
          "h-[--cell-size] w-[--cell-size] select-none p-0 aria-disabled:opacity-50",
          defaultClassNames.button_next
        ),
        month_caption: cn(
          "flex h-[--cell-size] w-full items-center justify-center px-[--cell-size]",
          defaultClassNames.month_caption
        ),
        dropdowns: cn(
          "flex h-[--cell-size] w-full items-center justify-center gap-1.5 text-sm font-medium",
          defaultClassNames.dropdowns
        ),
        dropdown_root: cn(
          "has-focus:border-ring border-input shadow-xs has-focus:ring-ring/50 has-focus:ring-[3px] relative rounded-md border",
          defaultClassNames.dropdown_root
        ),
        dropdown: cn(
          "bg-popover absolute inset-0 opacity-0",
          defaultClassNames.dropdown
        ),
        caption_label: cn(
          "select-none font-medium",
          captionLayout === "label"
            ? "text-sm"
            : "[&>svg]:text-muted-foreground flex h-8 items-center gap-1 rounded-md pl-2 pr-1 text-sm [&>svg]:size-3.5",
          defaultClassNames.caption_label
        ),
        table: "w-full border-collapse",
        weekdays: cn("flex", defaultClassNames.weekdays),
        weekday: cn(
          "text-muted-foreground flex-1 select-none rounded-md text-[0.8rem] font-normal",
          defaultClassNames.weekday
        ),
        week: cn("mt-2 flex w-full", defaultClassNames.week),
        week_number_header: cn(
          "w-[--cell-size] select-none",
          defaultClassNames.week_number_header
        ),
        week_number: cn(
          "text-muted-foreground select-none text-[0.8rem]",
          defaultClassNames.week_number
        ),
        day: cn(
          "group/day relative aspect-square h-full w-full select-none p-0 text-center [&:first-child[data-selected=true]_button]:rounded-l-md [&:last-child[data-selected=true]_button]:rounded-r-md",
          defaultClassNames.day
        ),
        range_start: cn(
          "bg-accent rounded-l-md",
          defaultClassNames.range_start
        ),
        range_middle: cn("rounded-none", defaultClassNames.range_middle),
        range_end: cn("bg-accent rounded-r-md", defaultClassNames.range_end),
        today: cn(
          "bg-accent text-accent-foreground rounded-md data-[selected=true]:rounded-none",
          defaultClassNames.today
        ),
        outside: cn(
          "text-muted-foreground aria-selected:text-muted-foreground",
          defaultClassNames.outside
        ),
        disabled: cn(
          "text-muted-foreground opacity-50",
          defaultClassNames.disabled
        ),
        hidden: cn("invisible", defaultClassNames.hidden),
        ...classNames,
      }}
      components={{
        Root: ({ className, rootRef, ...props }) => {
          return (
            <div
              data-slot="calendar"
              ref={rootRef}
              className={cn(className)}
              {...props}
            />
          )
        },
        Chevron: ({ className, orientation, ...props }) => {
          if (orientation === "left") {
            return (
              <ChevronLeftIcon className={cn("size-4", className)} {...props} />
            )
          }

          if (orientation === "right") {
            return (
              <ChevronRightIcon
                className={cn("size-4", className)}
                {...props}
              />
            )
          }

          return (
            <ChevronDownIcon className={cn("size-4", className)} {...props} />
          )
        },
        DayButton: CalendarDayButton,
        WeekNumber: ({ children, ...props }) => {
          return (
            <td {...props}>
              <div className="flex size-[--cell-size] items-center justify-center text-center">
                {children}
              </div>
            </td>
          )
        },
        ...components,
      }}
      {...props}
    />
  )
}

function CalendarDayButton({
  className,
  day,
  modifiers,
  ...props
}: React.ComponentProps<typeof DayButton>) {
  const defaultClassNames = getDefaultClassNames()

  const ref = React.useRef<HTMLButtonElement>(null)
  React.useEffect(() => {
    if (modifiers.focused) ref.current?.focus()
  }, [modifiers.focused])

  return (
    <Button
      ref={ref}
      variant="ghost"
      size="icon"
      data-day={day.date.toLocaleDateString()}
      data-selected-single={
        modifiers.selected &&
        !modifiers.range_start &&
        !modifiers.range_end &&
        !modifiers.range_middle
      }
      data-range-start={modifiers.range_start}
      data-range-end={modifiers.range_end}
      data-range-middle={modifiers.range_middle}
      className={cn(
        "data-[selected-single=true]:bg-primary data-[selected-single=true]:text-primary-foreground data-[range-middle=true]:bg-accent data-[range-middle=true]:text-accent-foreground data-[range-start=true]:bg-primary data-[range-start=true]:text-primary-foreground data-[range-end=true]:bg-primary data-[range-end=true]:text-primary-foreground group-data-[focused=true]/day:border-ring group-data-[focused=true]/day:ring-ring/50 flex aspect-square h-auto w-full min-w-[--cell-size] flex-col gap-1 font-normal leading-none data-[range-end=true]:rounded-md data-[range-middle=true]:rounded-none data-[range-start=true]:rounded-md group-data-[focused=true]/day:relative group-data-[focused=true]/day:z-10 group-data-[focused=true]/day:ring-[3px] [&>span]:text-xs [&>span]:opacity-70",
        defaultClassNames.day,
        className
      )}
      {...props}
    />
  )
}

export { Calendar, CalendarDayButton }

</code>

components\ui\card.tsx:
<code>
import * as React from "react"

import { cn } from "@/lib/utils"

const Card = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn(
      "rounded-lg border bg-card text-card-foreground shadow-sm",
      className
    )}
    {...props}
  />
))
Card.displayName = "Card"

const CardHeader = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex flex-col space-y-1.5 p-6", className)}
    {...props}
  />
))
CardHeader.displayName = "CardHeader"

const CardTitle = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn(
      "text-2xl font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
CardTitle.displayName = "CardTitle"

const CardDescription = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
CardDescription.displayName = "CardDescription"

const CardContent = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div ref={ref} className={cn("p-6 pt-0", className)} {...props} />
))
CardContent.displayName = "CardContent"

const CardFooter = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex items-center p-6 pt-0", className)}
    {...props}
  />
))
CardFooter.displayName = "CardFooter"

export { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }

</code>

components\ui\carousel.tsx:
<code>
"use client"

import * as React from "react"
import useEmblaCarousel, {
  type UseEmblaCarouselType,
} from "embla-carousel-react"
import { ArrowLeft, ArrowRight } from "lucide-react"

import { cn } from "@/lib/utils"
import { Button } from "@/components/ui/button"

type CarouselApi = UseEmblaCarouselType[1]
type UseCarouselParameters = Parameters<typeof useEmblaCarousel>
type CarouselOptions = UseCarouselParameters[0]
type CarouselPlugin = UseCarouselParameters[1]

type CarouselProps = {
  opts?: CarouselOptions
  plugins?: CarouselPlugin
  orientation?: "horizontal" | "vertical"
  setApi?: (api: CarouselApi) => void
}

type CarouselContextProps = {
  carouselRef: ReturnType<typeof useEmblaCarousel>[0]
  api: ReturnType<typeof useEmblaCarousel>[1]
  scrollPrev: () => void
  scrollNext: () => void
  canScrollPrev: boolean
  canScrollNext: boolean
} & CarouselProps

const CarouselContext = React.createContext<CarouselContextProps | null>(null)

function useCarousel() {
  const context = React.useContext(CarouselContext)

  if (!context) {
    throw new Error("useCarousel must be used within a <Carousel />")
  }

  return context
}

const Carousel = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement> & CarouselProps
>(
  (
    {
      orientation = "horizontal",
      opts,
      setApi,
      plugins,
      className,
      children,
      ...props
    },
    ref
  ) => {
    const [carouselRef, api] = useEmblaCarousel(
      {
        ...opts,
        axis: orientation === "horizontal" ? "x" : "y",
      },
      plugins
    )
    const [canScrollPrev, setCanScrollPrev] = React.useState(false)
    const [canScrollNext, setCanScrollNext] = React.useState(false)

    const onSelect = React.useCallback((api: CarouselApi) => {
      if (!api) {
        return
      }

      setCanScrollPrev(api.canScrollPrev())
      setCanScrollNext(api.canScrollNext())
    }, [])

    const scrollPrev = React.useCallback(() => {
      api?.scrollPrev()
    }, [api])

    const scrollNext = React.useCallback(() => {
      api?.scrollNext()
    }, [api])

    const handleKeyDown = React.useCallback(
      (event: React.KeyboardEvent<HTMLDivElement>) => {
        if (event.key === "ArrowLeft") {
          event.preventDefault()
          scrollPrev()
        } else if (event.key === "ArrowRight") {
          event.preventDefault()
          scrollNext()
        }
      },
      [scrollPrev, scrollNext]
    )

    React.useEffect(() => {
      if (!api || !setApi) {
        return
      }

      setApi(api)
    }, [api, setApi])

    React.useEffect(() => {
      if (!api) {
        return
      }

      onSelect(api)
      api.on("reInit", onSelect)
      api.on("select", onSelect)

      return () => {
        api?.off("select", onSelect)
      }
    }, [api, onSelect])

    return (
      <CarouselContext.Provider
        value={{
          carouselRef,
          api: api,
          opts,
          orientation:
            orientation || (opts?.axis === "y" ? "vertical" : "horizontal"),
          scrollPrev,
          scrollNext,
          canScrollPrev,
          canScrollNext,
        }}
      >
        <div
          ref={ref}
          onKeyDownCapture={handleKeyDown}
          className={cn("relative", className)}
          role="region"
          aria-roledescription="carousel"
          {...props}
        >
          {children}
        </div>
      </CarouselContext.Provider>
    )
  }
)
Carousel.displayName = "Carousel"

const CarouselContent = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const { carouselRef, orientation } = useCarousel()

  return (
    <div ref={carouselRef} className="overflow-hidden">
      <div
        ref={ref}
        className={cn(
          "flex",
          orientation === "horizontal" ? "-ml-4" : "-mt-4 flex-col",
          className
        )}
        {...props}
      />
    </div>
  )
})
CarouselContent.displayName = "CarouselContent"

const CarouselItem = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const { orientation } = useCarousel()

  return (
    <div
      ref={ref}
      role="group"
      aria-roledescription="slide"
      className={cn(
        "min-w-0 shrink-0 grow-0 basis-full",
        orientation === "horizontal" ? "pl-4" : "pt-4",
        className
      )}
      {...props}
    />
  )
})
CarouselItem.displayName = "CarouselItem"

const CarouselPrevious = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<typeof Button>
>(({ className, variant = "outline", size = "icon", ...props }, ref) => {
  const { orientation, scrollPrev, canScrollPrev } = useCarousel()

  return (
    <Button
      ref={ref}
      variant={variant}
      size={size}
      className={cn(
        "absolute  h-8 w-8 rounded-full",
        orientation === "horizontal"
          ? "-left-12 top-1/2 -translate-y-1/2"
          : "-top-12 left-1/2 -translate-x-1/2 rotate-90",
        className
      )}
      disabled={!canScrollPrev}
      onClick={scrollPrev}
      {...props}
    >
      <ArrowLeft className="h-4 w-4" />
      <span className="sr-only">Previous slide</span>
    </Button>
  )
})
CarouselPrevious.displayName = "CarouselPrevious"

const CarouselNext = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<typeof Button>
>(({ className, variant = "outline", size = "icon", ...props }, ref) => {
  const { orientation, scrollNext, canScrollNext } = useCarousel()

  return (
    <Button
      ref={ref}
      variant={variant}
      size={size}
      className={cn(
        "absolute h-8 w-8 rounded-full",
        orientation === "horizontal"
          ? "-right-12 top-1/2 -translate-y-1/2"
          : "-bottom-12 left-1/2 -translate-x-1/2 rotate-90",
        className
      )}
      disabled={!canScrollNext}
      onClick={scrollNext}
      {...props}
    >
      <ArrowRight className="h-4 w-4" />
      <span className="sr-only">Next slide</span>
    </Button>
  )
})
CarouselNext.displayName = "CarouselNext"

export {
  type CarouselApi,
  Carousel,
  CarouselContent,
  CarouselItem,
  CarouselPrevious,
  CarouselNext,
}

</code>

components\ui\chart.tsx:
<code>
"use client"

import * as React from "react"
import * as RechartsPrimitive from "recharts"

import { cn } from "@/lib/utils"

// Format: { THEME_NAME: CSS_SELECTOR }
const THEMES = { light: "", dark: ".dark" } as const

export type ChartConfig = {
  [k in string]: {
    label?: React.ReactNode
    icon?: React.ComponentType
  } & (
    | { color?: string; theme?: never }
    | { color?: never; theme: Record<keyof typeof THEMES, string> }
  )
}

type ChartContextProps = {
  config: ChartConfig
}

const ChartContext = React.createContext<ChartContextProps | null>(null)

function useChart() {
  const context = React.useContext(ChartContext)

  if (!context) {
    throw new Error("useChart must be used within a <ChartContainer />")
  }

  return context
}

const ChartContainer = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    config: ChartConfig
    children: React.ComponentProps<
      typeof RechartsPrimitive.ResponsiveContainer
    >["children"]
  }
>(({ id, className, children, config, ...props }, ref) => {
  const uniqueId = React.useId()
  const chartId = `chart-${id || uniqueId.replace(/:/g, "")}`

  return (
    <ChartContext.Provider value={{ config }}>
      <div
        data-chart={chartId}
        ref={ref}
        className={cn(
          "flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none",
          className
        )}
        {...props}
      >
        <ChartStyle id={chartId} config={config} />
        <RechartsPrimitive.ResponsiveContainer>
          {children}
        </RechartsPrimitive.ResponsiveContainer>
      </div>
    </ChartContext.Provider>
  )
})
ChartContainer.displayName = "Chart"

const ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {
  const colorConfig = Object.entries(config).filter(
    ([, config]) => config.theme || config.color
  )

  if (!colorConfig.length) {
    return null
  }

  return (
    <style
      dangerouslySetInnerHTML={{
        __html: Object.entries(THEMES)
          .map(
            ([theme, prefix]) => `
${prefix} [data-chart=${id}] {
${colorConfig
  .map(([key, itemConfig]) => {
    const color =
      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||
      itemConfig.color
    return color ? `  --color-${key}: ${color};` : null
  })
  .join("\n")}
}
`
          )
          .join("\n"),
      }}
    />
  )
}

const ChartTooltip = RechartsPrimitive.Tooltip

const ChartTooltipContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &
    React.ComponentProps<"div"> & {
      hideLabel?: boolean
      hideIndicator?: boolean
      indicator?: "line" | "dot" | "dashed"
      nameKey?: string
      labelKey?: string
    }
>(
  (
    {
      active,
      payload,
      className,
      indicator = "dot",
      hideLabel = false,
      hideIndicator = false,
      label,
      labelFormatter,
      labelClassName,
      formatter,
      color,
      nameKey,
      labelKey,
    },
    ref
  ) => {
    const { config } = useChart()

    const tooltipLabel = React.useMemo(() => {
      if (hideLabel || !payload?.length) {
        return null
      }

      const [item] = payload
      const key = `${labelKey || item?.dataKey || item?.name || "value"}`
      const itemConfig = getPayloadConfigFromPayload(config, item, key)
      const value =
        !labelKey && typeof label === "string"
          ? config[label as keyof typeof config]?.label || label
          : itemConfig?.label

      if (labelFormatter) {
        return (
          <div className={cn("font-medium", labelClassName)}>
            {labelFormatter(value, payload)}
          </div>
        )
      }

      if (!value) {
        return null
      }

      return <div className={cn("font-medium", labelClassName)}>{value}</div>
    }, [
      label,
      labelFormatter,
      payload,
      hideLabel,
      labelClassName,
      config,
      labelKey,
    ])

    if (!active || !payload?.length) {
      return null
    }

    const nestLabel = payload.length === 1 && indicator !== "dot"

    return (
      <div
        ref={ref}
        className={cn(
          "grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl",
          className
        )}
      >
        {!nestLabel ? tooltipLabel : null}
        <div className="grid gap-1.5">
          {payload.map((item, index) => {
            const key = `${nameKey || item.name || item.dataKey || "value"}`
            const itemConfig = getPayloadConfigFromPayload(config, item, key)
            const indicatorColor = color || item.payload.fill || item.color

            return (
              <div
                key={item.dataKey}
                className={cn(
                  "flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground",
                  indicator === "dot" && "items-center"
                )}
              >
                {formatter && item?.value !== undefined && item.name ? (
                  formatter(item.value, item.name, item, index, item.payload)
                ) : (
                  <>
                    {itemConfig?.icon ? (
                      <itemConfig.icon />
                    ) : (
                      !hideIndicator && (
                        <div
                          className={cn(
                            "shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]",
                            {
                              "h-2.5 w-2.5": indicator === "dot",
                              "w-1": indicator === "line",
                              "w-0 border-[1.5px] border-dashed bg-transparent":
                                indicator === "dashed",
                              "my-0.5": nestLabel && indicator === "dashed",
                            }
                          )}
                          style={
                            {
                              "--color-bg": indicatorColor,
                              "--color-border": indicatorColor,
                            } as React.CSSProperties
                          }
                        />
                      )
                    )}
                    <div
                      className={cn(
                        "flex flex-1 justify-between leading-none",
                        nestLabel ? "items-end" : "items-center"
                      )}
                    >
                      <div className="grid gap-1.5">
                        {nestLabel ? tooltipLabel : null}
                        <span className="text-muted-foreground">
                          {itemConfig?.label || item.name}
                        </span>
                      </div>
                      {item.value && (
                        <span className="font-mono font-medium tabular-nums text-foreground">
                          {item.value.toLocaleString()}
                        </span>
                      )}
                    </div>
                  </>
                )}
              </div>
            )
          })}
        </div>
      </div>
    )
  }
)
ChartTooltipContent.displayName = "ChartTooltip"

const ChartLegend = RechartsPrimitive.Legend

const ChartLegendContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> &
    Pick<RechartsPrimitive.LegendProps, "payload" | "verticalAlign"> & {
      hideIcon?: boolean
      nameKey?: string
    }
>(
  (
    { className, hideIcon = false, payload, verticalAlign = "bottom", nameKey },
    ref
  ) => {
    const { config } = useChart()

    if (!payload?.length) {
      return null
    }

    return (
      <div
        ref={ref}
        className={cn(
          "flex items-center justify-center gap-4",
          verticalAlign === "top" ? "pb-3" : "pt-3",
          className
        )}
      >
        {payload.map((item) => {
          const key = `${nameKey || item.dataKey || "value"}`
          const itemConfig = getPayloadConfigFromPayload(config, item, key)

          return (
            <div
              key={item.value}
              className={cn(
                "flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground"
              )}
            >
              {itemConfig?.icon && !hideIcon ? (
                <itemConfig.icon />
              ) : (
                <div
                  className="h-2 w-2 shrink-0 rounded-[2px]"
                  style={{
                    backgroundColor: item.color,
                  }}
                />
              )}
              {itemConfig?.label}
            </div>
          )
        })}
      </div>
    )
  }
)
ChartLegendContent.displayName = "ChartLegend"

// Helper to extract item config from a payload.
function getPayloadConfigFromPayload(
  config: ChartConfig,
  payload: unknown,
  key: string
) {
  if (typeof payload !== "object" || payload === null) {
    return undefined
  }

  const payloadPayload =
    "payload" in payload &&
    typeof payload.payload === "object" &&
    payload.payload !== null
      ? payload.payload
      : undefined

  let configLabelKey: string = key

  if (
    key in payload &&
    typeof payload[key as keyof typeof payload] === "string"
  ) {
    configLabelKey = payload[key as keyof typeof payload] as string
  } else if (
    payloadPayload &&
    key in payloadPayload &&
    typeof payloadPayload[key as keyof typeof payloadPayload] === "string"
  ) {
    configLabelKey = payloadPayload[
      key as keyof typeof payloadPayload
    ] as string
  }

  return configLabelKey in config
    ? config[configLabelKey]
    : config[key as keyof typeof config]
}

export {
  ChartContainer,
  ChartTooltip,
  ChartTooltipContent,
  ChartLegend,
  ChartLegendContent,
  ChartStyle,
}

</code>

components\ui\checkbox.tsx:
<code>
"use client"

import * as React from "react"
import * as CheckboxPrimitive from "@radix-ui/react-checkbox"
import { Check } from "lucide-react"

import { cn } from "@/lib/utils"

const Checkbox = React.forwardRef<
  React.ElementRef<typeof CheckboxPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>
>(({ className, ...props }, ref) => (
  <CheckboxPrimitive.Root
    ref={ref}
    className={cn(
      "peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",
      className
    )}
    {...props}
  >
    <CheckboxPrimitive.Indicator
      className={cn("flex items-center justify-center text-current")}
    >
      <Check className="h-4 w-4" />
    </CheckboxPrimitive.Indicator>
  </CheckboxPrimitive.Root>
))
Checkbox.displayName = CheckboxPrimitive.Root.displayName

export { Checkbox }

</code>

components\ui\collapsible.tsx:
<code>
"use client"

import * as CollapsiblePrimitive from "@radix-ui/react-collapsible"

const Collapsible = CollapsiblePrimitive.Root

const CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger

const CollapsibleContent = CollapsiblePrimitive.CollapsibleContent

export { Collapsible, CollapsibleTrigger, CollapsibleContent }

</code>

components\ui\command.tsx:
<code>
"use client"

import * as React from "react"
import { type DialogProps } from "@radix-ui/react-dialog"
import { Command as CommandPrimitive } from "cmdk"
import { Search } from "lucide-react"

import { cn } from "@/lib/utils"
import { Dialog, DialogContent } from "@/components/ui/dialog"

const Command = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive>
>(({ className, ...props }, ref) => (
  <CommandPrimitive
    ref={ref}
    className={cn(
      "flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",
      className
    )}
    {...props}
  />
))
Command.displayName = CommandPrimitive.displayName

const CommandDialog = ({ children, ...props }: DialogProps) => {
  return (
    <Dialog {...props}>
      <DialogContent className="overflow-hidden p-0 shadow-lg">
        <Command className="[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5">
          {children}
        </Command>
      </DialogContent>
    </Dialog>
  )
}

const CommandInput = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Input>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>
>(({ className, ...props }, ref) => (
  <div className="flex items-center border-b px-3" cmdk-input-wrapper="">
    <Search className="mr-2 h-4 w-4 shrink-0 opacity-50" />
    <CommandPrimitive.Input
      ref={ref}
      className={cn(
        "flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    />
  </div>
))

CommandInput.displayName = CommandPrimitive.Input.displayName

const CommandList = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.List
    ref={ref}
    className={cn("max-h-[300px] overflow-y-auto overflow-x-hidden", className)}
    {...props}
  />
))

CommandList.displayName = CommandPrimitive.List.displayName

const CommandEmpty = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Empty>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>
>((props, ref) => (
  <CommandPrimitive.Empty
    ref={ref}
    className="py-6 text-center text-sm"
    {...props}
  />
))

CommandEmpty.displayName = CommandPrimitive.Empty.displayName

const CommandGroup = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Group>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Group
    ref={ref}
    className={cn(
      "overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",
      className
    )}
    {...props}
  />
))

CommandGroup.displayName = CommandPrimitive.Group.displayName

const CommandSeparator = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 h-px bg-border", className)}
    {...props}
  />
))
CommandSeparator.displayName = CommandPrimitive.Separator.displayName

const CommandItem = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
      className
    )}
    {...props}
  />
))

CommandItem.displayName = CommandPrimitive.Item.displayName

const CommandShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn(
        "ml-auto text-xs tracking-widest text-muted-foreground",
        className
      )}
      {...props}
    />
  )
}
CommandShortcut.displayName = "CommandShortcut"

export {
  Command,
  CommandDialog,
  CommandInput,
  CommandList,
  CommandEmpty,
  CommandGroup,
  CommandItem,
  CommandShortcut,
  CommandSeparator,
}

</code>

components\ui\context-menu.tsx:
<code>
"use client"

import * as React from "react"
import * as ContextMenuPrimitive from "@radix-ui/react-context-menu"
import { Check, ChevronRight, Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const ContextMenu = ContextMenuPrimitive.Root

const ContextMenuTrigger = ContextMenuPrimitive.Trigger

const ContextMenuGroup = ContextMenuPrimitive.Group

const ContextMenuPortal = ContextMenuPrimitive.Portal

const ContextMenuSub = ContextMenuPrimitive.Sub

const ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup

const ContextMenuSubTrigger = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {
    inset?: boolean
  }
>(({ className, inset, children, ...props }, ref) => (
  <ContextMenuPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",
      inset && "pl-8",
      className
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto h-4 w-4" />
  </ContextMenuPrimitive.SubTrigger>
))
ContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName

const ContextMenuSubContent = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <ContextMenuPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]",
      className
    )}
    {...props}
  />
))
ContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName

const ContextMenuContent = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>
>(({ className, ...props }, ref) => (
  <ContextMenuPrimitive.Portal>
    <ContextMenuPrimitive.Content
      ref={ref}
      className={cn(
        "z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]",
        className
      )}
      {...props}
    />
  </ContextMenuPrimitive.Portal>
))
ContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName

const ContextMenuItem = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <ContextMenuPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
ContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName

const ContextMenuCheckboxItem = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <ContextMenuPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <ContextMenuPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </ContextMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </ContextMenuPrimitive.CheckboxItem>
))
ContextMenuCheckboxItem.displayName =
  ContextMenuPrimitive.CheckboxItem.displayName

const ContextMenuRadioItem = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <ContextMenuPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <ContextMenuPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </ContextMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </ContextMenuPrimitive.RadioItem>
))
ContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName

const ContextMenuLabel = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <ContextMenuPrimitive.Label
    ref={ref}
    className={cn(
      "px-2 py-1.5 text-sm font-semibold text-foreground",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
ContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName

const ContextMenuSeparator = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <ContextMenuPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-border", className)}
    {...props}
  />
))
ContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName

const ContextMenuShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn(
        "ml-auto text-xs tracking-widest text-muted-foreground",
        className
      )}
      {...props}
    />
  )
}
ContextMenuShortcut.displayName = "ContextMenuShortcut"

export {
  ContextMenu,
  ContextMenuTrigger,
  ContextMenuContent,
  ContextMenuItem,
  ContextMenuCheckboxItem,
  ContextMenuRadioItem,
  ContextMenuLabel,
  ContextMenuSeparator,
  ContextMenuShortcut,
  ContextMenuGroup,
  ContextMenuPortal,
  ContextMenuSub,
  ContextMenuSubContent,
  ContextMenuSubTrigger,
  ContextMenuRadioGroup,
}

</code>

components\ui\dialog.tsx:
<code>
"use client"

import * as React from "react"
import * as DialogPrimitive from "@radix-ui/react-dialog"
import { X } from "lucide-react"

import { cn } from "@/lib/utils"

const Dialog = DialogPrimitive.Root

const DialogTrigger = DialogPrimitive.Trigger

const DialogPortal = DialogPrimitive.Portal

const DialogClose = DialogPrimitive.Close

const DialogOverlay = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Overlay
    ref={ref}
    className={cn(
      "fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
  />
))
DialogOverlay.displayName = DialogPrimitive.Overlay.displayName

const DialogContent = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <DialogPortal>
    <DialogOverlay />
    <DialogPrimitive.Content
      ref={ref}
      className={cn(
        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",
        className
      )}
      {...props}
    >
      {children}
      <DialogPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground">
        <X className="h-4 w-4" />
        <span className="sr-only">Close</span>
      </DialogPrimitive.Close>
    </DialogPrimitive.Content>
  </DialogPortal>
))
DialogContent.displayName = DialogPrimitive.Content.displayName

const DialogHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-1.5 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
DialogHeader.displayName = "DialogHeader"

const DialogFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
DialogFooter.displayName = "DialogFooter"

const DialogTitle = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Title
    ref={ref}
    className={cn(
      "text-lg font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
DialogTitle.displayName = DialogPrimitive.Title.displayName

const DialogDescription = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
DialogDescription.displayName = DialogPrimitive.Description.displayName

export {
  Dialog,
  DialogPortal,
  DialogOverlay,
  DialogClose,
  DialogTrigger,
  DialogContent,
  DialogHeader,
  DialogFooter,
  DialogTitle,
  DialogDescription,
}

</code>

components\ui\drawer.tsx:
<code>
"use client"

import * as React from "react"
import { Drawer as DrawerPrimitive } from "vaul"

import { cn } from "@/lib/utils"

const Drawer = ({
  shouldScaleBackground = true,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (
  <DrawerPrimitive.Root
    shouldScaleBackground={shouldScaleBackground}
    {...props}
  />
)
Drawer.displayName = "Drawer"

const DrawerTrigger = DrawerPrimitive.Trigger

const DrawerPortal = DrawerPrimitive.Portal

const DrawerClose = DrawerPrimitive.Close

const DrawerOverlay = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <DrawerPrimitive.Overlay
    ref={ref}
    className={cn("fixed inset-0 z-50 bg-black/80", className)}
    {...props}
  />
))
DrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName

const DrawerContent = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <DrawerPortal>
    <DrawerOverlay />
    <DrawerPrimitive.Content
      ref={ref}
      className={cn(
        "fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",
        className
      )}
      {...props}
    >
      <div className="mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted" />
      {children}
    </DrawerPrimitive.Content>
  </DrawerPortal>
))
DrawerContent.displayName = "DrawerContent"

const DrawerHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn("grid gap-1.5 p-4 text-center sm:text-left", className)}
    {...props}
  />
)
DrawerHeader.displayName = "DrawerHeader"

const DrawerFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn("mt-auto flex flex-col gap-2 p-4", className)}
    {...props}
  />
)
DrawerFooter.displayName = "DrawerFooter"

const DrawerTitle = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>
>(({ className, ...props }, ref) => (
  <DrawerPrimitive.Title
    ref={ref}
    className={cn(
      "text-lg font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
DrawerTitle.displayName = DrawerPrimitive.Title.displayName

const DrawerDescription = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>
>(({ className, ...props }, ref) => (
  <DrawerPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
DrawerDescription.displayName = DrawerPrimitive.Description.displayName

export {
  Drawer,
  DrawerPortal,
  DrawerOverlay,
  DrawerTrigger,
  DrawerClose,
  DrawerContent,
  DrawerHeader,
  DrawerFooter,
  DrawerTitle,
  DrawerDescription,
}

</code>

components\ui\dropdown-menu.tsx:
<code>
"use client"

import * as React from "react"
import * as DropdownMenuPrimitive from "@radix-ui/react-dropdown-menu"
import { Check, ChevronRight, Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const DropdownMenu = DropdownMenuPrimitive.Root

const DropdownMenuTrigger = DropdownMenuPrimitive.Trigger

const DropdownMenuGroup = DropdownMenuPrimitive.Group

const DropdownMenuPortal = DropdownMenuPrimitive.Portal

const DropdownMenuSub = DropdownMenuPrimitive.Sub

const DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup

const DropdownMenuSubTrigger = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {
    inset?: boolean
  }
>(({ className, inset, children, ...props }, ref) => (
  <DropdownMenuPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
      inset && "pl-8",
      className
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto" />
  </DropdownMenuPrimitive.SubTrigger>
))
DropdownMenuSubTrigger.displayName =
  DropdownMenuPrimitive.SubTrigger.displayName

const DropdownMenuSubContent = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <DropdownMenuPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",
      className
    )}
    {...props}
  />
))
DropdownMenuSubContent.displayName =
  DropdownMenuPrimitive.SubContent.displayName

const DropdownMenuContent = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>
>(({ className, sideOffset = 4, ...props }, ref) => (
  <DropdownMenuPrimitive.Portal>
    <DropdownMenuPrimitive.Content
      ref={ref}
      sideOffset={sideOffset}
      className={cn(
        "z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",
        className
      )}
      {...props}
    />
  </DropdownMenuPrimitive.Portal>
))
DropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName

const DropdownMenuItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <DropdownMenuPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
DropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName

const DropdownMenuCheckboxItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <DropdownMenuPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <DropdownMenuPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </DropdownMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </DropdownMenuPrimitive.CheckboxItem>
))
DropdownMenuCheckboxItem.displayName =
  DropdownMenuPrimitive.CheckboxItem.displayName

const DropdownMenuRadioItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <DropdownMenuPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <DropdownMenuPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </DropdownMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </DropdownMenuPrimitive.RadioItem>
))
DropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName

const DropdownMenuLabel = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <DropdownMenuPrimitive.Label
    ref={ref}
    className={cn(
      "px-2 py-1.5 text-sm font-semibold",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
DropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName

const DropdownMenuSeparator = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <DropdownMenuPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
DropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName

const DropdownMenuShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn("ml-auto text-xs tracking-widest opacity-60", className)}
      {...props}
    />
  )
}
DropdownMenuShortcut.displayName = "DropdownMenuShortcut"

export {
  DropdownMenu,
  DropdownMenuTrigger,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuCheckboxItem,
  DropdownMenuRadioItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuShortcut,
  DropdownMenuGroup,
  DropdownMenuPortal,
  DropdownMenuSub,
  DropdownMenuSubContent,
  DropdownMenuSubTrigger,
  DropdownMenuRadioGroup,
}

</code>

components\ui\form.tsx:
<code>
"use client"

import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"
import { Slot } from "@radix-ui/react-slot"
import {
  Controller,
  FormProvider,
  useFormContext,
  type ControllerProps,
  type FieldPath,
  type FieldValues,
} from "react-hook-form"

import { cn } from "@/lib/utils"
import { Label } from "@/components/ui/label"

const Form = FormProvider

type FormFieldContextValue<
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>
> = {
  name: TName
}

const FormFieldContext = React.createContext<FormFieldContextValue>(
  {} as FormFieldContextValue
)

const FormField = <
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>
>({
  ...props
}: ControllerProps<TFieldValues, TName>) => {
  return (
    <FormFieldContext.Provider value={{ name: props.name }}>
      <Controller {...props} />
    </FormFieldContext.Provider>
  )
}

const useFormField = () => {
  const fieldContext = React.useContext(FormFieldContext)
  const itemContext = React.useContext(FormItemContext)
  const { getFieldState, formState } = useFormContext()

  const fieldState = getFieldState(fieldContext.name, formState)

  if (!fieldContext) {
    throw new Error("useFormField should be used within <FormField>")
  }

  const { id } = itemContext

  return {
    id,
    name: fieldContext.name,
    formItemId: `${id}-form-item`,
    formDescriptionId: `${id}-form-item-description`,
    formMessageId: `${id}-form-item-message`,
    ...fieldState,
  }
}

type FormItemContextValue = {
  id: string
}

const FormItemContext = React.createContext<FormItemContextValue>(
  {} as FormItemContextValue
)

const FormItem = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const id = React.useId()

  return (
    <FormItemContext.Provider value={{ id }}>
      <div ref={ref} className={cn("space-y-2", className)} {...props} />
    </FormItemContext.Provider>
  )
})
FormItem.displayName = "FormItem"

const FormLabel = React.forwardRef<
  React.ElementRef<typeof LabelPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>
>(({ className, ...props }, ref) => {
  const { error, formItemId } = useFormField()

  return (
    <Label
      ref={ref}
      className={cn(error && "text-destructive", className)}
      htmlFor={formItemId}
      {...props}
    />
  )
})
FormLabel.displayName = "FormLabel"

const FormControl = React.forwardRef<
  React.ElementRef<typeof Slot>,
  React.ComponentPropsWithoutRef<typeof Slot>
>(({ ...props }, ref) => {
  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()

  return (
    <Slot
      ref={ref}
      id={formItemId}
      aria-describedby={
        !error
          ? `${formDescriptionId}`
          : `${formDescriptionId} ${formMessageId}`
      }
      aria-invalid={!!error}
      {...props}
    />
  )
})
FormControl.displayName = "FormControl"

const FormDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => {
  const { formDescriptionId } = useFormField()

  return (
    <p
      ref={ref}
      id={formDescriptionId}
      className={cn("text-sm text-muted-foreground", className)}
      {...props}
    />
  )
})
FormDescription.displayName = "FormDescription"

const FormMessage = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, children, ...props }, ref) => {
  const { error, formMessageId } = useFormField()
  const body = error ? String(error?.message ?? "") : children

  if (!body) {
    return null
  }

  return (
    <p
      ref={ref}
      id={formMessageId}
      className={cn("text-sm font-medium text-destructive", className)}
      {...props}
    >
      {body}
    </p>
  )
})
FormMessage.displayName = "FormMessage"

export {
  useFormField,
  Form,
  FormItem,
  FormLabel,
  FormControl,
  FormDescription,
  FormMessage,
  FormField,
}

</code>

components\ui\hover-card.tsx:
<code>
"use client"

import * as React from "react"
import * as HoverCardPrimitive from "@radix-ui/react-hover-card"

import { cn } from "@/lib/utils"

const HoverCard = HoverCardPrimitive.Root

const HoverCardTrigger = HoverCardPrimitive.Trigger

const HoverCardContent = React.forwardRef<
  React.ElementRef<typeof HoverCardPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>
>(({ className, align = "center", sideOffset = 4, ...props }, ref) => (
  <HoverCardPrimitive.Content
    ref={ref}
    align={align}
    sideOffset={sideOffset}
    className={cn(
      "z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]",
      className
    )}
    {...props}
  />
))
HoverCardContent.displayName = HoverCardPrimitive.Content.displayName

export { HoverCard, HoverCardTrigger, HoverCardContent }

</code>

components\ui\input-otp.tsx:
<code>
"use client"

import * as React from "react"
import { OTPInput, OTPInputContext } from "input-otp"
import { Dot } from "lucide-react"

import { cn } from "@/lib/utils"

const InputOTP = React.forwardRef<
  React.ElementRef<typeof OTPInput>,
  React.ComponentPropsWithoutRef<typeof OTPInput>
>(({ className, containerClassName, ...props }, ref) => (
  <OTPInput
    ref={ref}
    containerClassName={cn(
      "flex items-center gap-2 has-[:disabled]:opacity-50",
      containerClassName
    )}
    className={cn("disabled:cursor-not-allowed", className)}
    {...props}
  />
))
InputOTP.displayName = "InputOTP"

const InputOTPGroup = React.forwardRef<
  React.ElementRef<"div">,
  React.ComponentPropsWithoutRef<"div">
>(({ className, ...props }, ref) => (
  <div ref={ref} className={cn("flex items-center", className)} {...props} />
))
InputOTPGroup.displayName = "InputOTPGroup"

const InputOTPSlot = React.forwardRef<
  React.ElementRef<"div">,
  React.ComponentPropsWithoutRef<"div"> & { index: number }
>(({ index, className, ...props }, ref) => {
  const inputOTPContext = React.useContext(OTPInputContext)
  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]

  return (
    <div
      ref={ref}
      className={cn(
        "relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md",
        isActive && "z-10 ring-2 ring-ring ring-offset-background",
        className
      )}
      {...props}
    >
      {char}
      {hasFakeCaret && (
        <div className="pointer-events-none absolute inset-0 flex items-center justify-center">
          <div className="h-4 w-px animate-caret-blink bg-foreground duration-1000" />
        </div>
      )}
    </div>
  )
})
InputOTPSlot.displayName = "InputOTPSlot"

const InputOTPSeparator = React.forwardRef<
  React.ElementRef<"div">,
  React.ComponentPropsWithoutRef<"div">
>(({ ...props }, ref) => (
  <div ref={ref} role="separator" {...props}>
    <Dot />
  </div>
))
InputOTPSeparator.displayName = "InputOTPSeparator"

export { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }

</code>

components\ui\input.tsx:
<code>
import * as React from "react"

import { cn } from "@/lib/utils"

const Input = React.forwardRef<HTMLInputElement, React.ComponentProps<"input">>(
  ({ className, type, ...props }, ref) => {
    return (
      <input
        type={type}
        className={cn(
          "flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
          className
        )}
        ref={ref}
        {...props}
      />
    )
  }
)
Input.displayName = "Input"

export { Input }

</code>

components\ui\label.tsx:
<code>
"use client"

import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const labelVariants = cva(
  "text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"
)

const Label = React.forwardRef<
  React.ElementRef<typeof LabelPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &
    VariantProps<typeof labelVariants>
>(({ className, ...props }, ref) => (
  <LabelPrimitive.Root
    ref={ref}
    className={cn(labelVariants(), className)}
    {...props}
  />
))
Label.displayName = LabelPrimitive.Root.displayName

export { Label }

</code>

components\ui\menubar.tsx:
<code>
"use client"

import * as React from "react"
import * as MenubarPrimitive from "@radix-ui/react-menubar"
import { Check, ChevronRight, Circle } from "lucide-react"

import { cn } from "@/lib/utils"

function MenubarMenu({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {
  return <MenubarPrimitive.Menu {...props} />
}

function MenubarGroup({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Group>) {
  return <MenubarPrimitive.Group {...props} />
}

function MenubarPortal({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {
  return <MenubarPrimitive.Portal {...props} />
}

function MenubarRadioGroup({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {
  return <MenubarPrimitive.RadioGroup {...props} />
}

function MenubarSub({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {
  return <MenubarPrimitive.Sub data-slot="menubar-sub" {...props} />
}

const Menubar = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Root
    ref={ref}
    className={cn(
      "flex h-10 items-center space-x-1 rounded-md border bg-background p-1",
      className
    )}
    {...props}
  />
))
Menubar.displayName = MenubarPrimitive.Root.displayName

const MenubarTrigger = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Trigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",
      className
    )}
    {...props}
  />
))
MenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName

const MenubarSubTrigger = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {
    inset?: boolean
  }
>(({ className, inset, children, ...props }, ref) => (
  <MenubarPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",
      inset && "pl-8",
      className
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto h-4 w-4" />
  </MenubarPrimitive.SubTrigger>
))
MenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName

const MenubarSubContent = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]",
      className
    )}
    {...props}
  />
))
MenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName

const MenubarContent = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>
>(
  (
    { className, align = "start", alignOffset = -4, sideOffset = 8, ...props },
    ref
  ) => (
    <MenubarPrimitive.Portal>
      <MenubarPrimitive.Content
        ref={ref}
        align={align}
        alignOffset={alignOffset}
        sideOffset={sideOffset}
        className={cn(
          "z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]",
          className
        )}
        {...props}
      />
    </MenubarPrimitive.Portal>
  )
)
MenubarContent.displayName = MenubarPrimitive.Content.displayName

const MenubarItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <MenubarPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
MenubarItem.displayName = MenubarPrimitive.Item.displayName

const MenubarCheckboxItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <MenubarPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <MenubarPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </MenubarPrimitive.ItemIndicator>
    </span>
    {children}
  </MenubarPrimitive.CheckboxItem>
))
MenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName

const MenubarRadioItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <MenubarPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <MenubarPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </MenubarPrimitive.ItemIndicator>
    </span>
    {children}
  </MenubarPrimitive.RadioItem>
))
MenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName

const MenubarLabel = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <MenubarPrimitive.Label
    ref={ref}
    className={cn(
      "px-2 py-1.5 text-sm font-semibold",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
MenubarLabel.displayName = MenubarPrimitive.Label.displayName

const MenubarSeparator = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
MenubarSeparator.displayName = MenubarPrimitive.Separator.displayName

const MenubarShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn(
        "ml-auto text-xs tracking-widest text-muted-foreground",
        className
      )}
      {...props}
    />
  )
}
MenubarShortcut.displayname = "MenubarShortcut"

export {
  Menubar,
  MenubarMenu,
  MenubarTrigger,
  MenubarContent,
  MenubarItem,
  MenubarSeparator,
  MenubarLabel,
  MenubarCheckboxItem,
  MenubarRadioGroup,
  MenubarRadioItem,
  MenubarPortal,
  MenubarSubContent,
  MenubarSubTrigger,
  MenubarGroup,
  MenubarSub,
  MenubarShortcut,
}

</code>

components\ui\navigation-menu.tsx:
<code>
import * as React from "react"
import * as NavigationMenuPrimitive from "@radix-ui/react-navigation-menu"
import { cva } from "class-variance-authority"
import { ChevronDown } from "lucide-react"

import { cn } from "@/lib/utils"

const NavigationMenu = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>
>(({ className, children, ...props }, ref) => (
  <NavigationMenuPrimitive.Root
    ref={ref}
    className={cn(
      "relative z-10 flex max-w-max flex-1 items-center justify-center",
      className
    )}
    {...props}
  >
    {children}
    <NavigationMenuViewport />
  </NavigationMenuPrimitive.Root>
))
NavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName

const NavigationMenuList = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.List
    ref={ref}
    className={cn(
      "group flex flex-1 list-none items-center justify-center space-x-1",
      className
    )}
    {...props}
  />
))
NavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName

const NavigationMenuItem = NavigationMenuPrimitive.Item

const navigationMenuTriggerStyle = cva(
  "group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent"
)

const NavigationMenuTrigger = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <NavigationMenuPrimitive.Trigger
    ref={ref}
    className={cn(navigationMenuTriggerStyle(), "group", className)}
    {...props}
  >
    {children}{" "}
    <ChevronDown
      className="relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180"
      aria-hidden="true"
    />
  </NavigationMenuPrimitive.Trigger>
))
NavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName

const NavigationMenuContent = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.Content
    ref={ref}
    className={cn(
      "left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto ",
      className
    )}
    {...props}
  />
))
NavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName

const NavigationMenuLink = NavigationMenuPrimitive.Link

const NavigationMenuViewport = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>
>(({ className, ...props }, ref) => (
  <div className={cn("absolute left-0 top-full flex justify-center")}>
    <NavigationMenuPrimitive.Viewport
      className={cn(
        "origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]",
        className
      )}
      ref={ref}
      {...props}
    />
  </div>
))
NavigationMenuViewport.displayName =
  NavigationMenuPrimitive.Viewport.displayName

const NavigationMenuIndicator = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.Indicator
    ref={ref}
    className={cn(
      "top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in",
      className
    )}
    {...props}
  >
    <div className="relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md" />
  </NavigationMenuPrimitive.Indicator>
))
NavigationMenuIndicator.displayName =
  NavigationMenuPrimitive.Indicator.displayName

export {
  navigationMenuTriggerStyle,
  NavigationMenu,
  NavigationMenuList,
  NavigationMenuItem,
  NavigationMenuContent,
  NavigationMenuTrigger,
  NavigationMenuLink,
  NavigationMenuIndicator,
  NavigationMenuViewport,
}

</code>

components\ui\pagination.tsx:
<code>
import * as React from "react"
import { ChevronLeft, ChevronRight, MoreHorizontal } from "lucide-react"

import { cn } from "@/lib/utils"
import { ButtonProps, buttonVariants } from "@/components/ui/button"

const Pagination = ({ className, ...props }: React.ComponentProps<"nav">) => (
  <nav
    role="navigation"
    aria-label="pagination"
    className={cn("mx-auto flex w-full justify-center", className)}
    {...props}
  />
)
Pagination.displayName = "Pagination"

const PaginationContent = React.forwardRef<
  HTMLUListElement,
  React.ComponentProps<"ul">
>(({ className, ...props }, ref) => (
  <ul
    ref={ref}
    className={cn("flex flex-row items-center gap-1", className)}
    {...props}
  />
))
PaginationContent.displayName = "PaginationContent"

const PaginationItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentProps<"li">
>(({ className, ...props }, ref) => (
  <li ref={ref} className={cn("", className)} {...props} />
))
PaginationItem.displayName = "PaginationItem"

type PaginationLinkProps = {
  isActive?: boolean
} & Pick<ButtonProps, "size"> &
  React.ComponentProps<"a">

const PaginationLink = ({
  className,
  isActive,
  size = "icon",
  ...props
}: PaginationLinkProps) => (
  <a
    aria-current={isActive ? "page" : undefined}
    className={cn(
      buttonVariants({
        variant: isActive ? "outline" : "ghost",
        size,
      }),
      className
    )}
    {...props}
  />
)
PaginationLink.displayName = "PaginationLink"

const PaginationPrevious = ({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) => (
  <PaginationLink
    aria-label="Go to previous page"
    size="default"
    className={cn("gap-1 pl-2.5", className)}
    {...props}
  >
    <ChevronLeft className="h-4 w-4" />
    <span>Previous</span>
  </PaginationLink>
)
PaginationPrevious.displayName = "PaginationPrevious"

const PaginationNext = ({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) => (
  <PaginationLink
    aria-label="Go to next page"
    size="default"
    className={cn("gap-1 pr-2.5", className)}
    {...props}
  >
    <span>Next</span>
    <ChevronRight className="h-4 w-4" />
  </PaginationLink>
)
PaginationNext.displayName = "PaginationNext"

const PaginationEllipsis = ({
  className,
  ...props
}: React.ComponentProps<"span">) => (
  <span
    aria-hidden
    className={cn("flex h-9 w-9 items-center justify-center", className)}
    {...props}
  >
    <MoreHorizontal className="h-4 w-4" />
    <span className="sr-only">More pages</span>
  </span>
)
PaginationEllipsis.displayName = "PaginationEllipsis"

export {
  Pagination,
  PaginationContent,
  PaginationEllipsis,
  PaginationItem,
  PaginationLink,
  PaginationNext,
  PaginationPrevious,
}

</code>

components\ui\popover.tsx:
<code>
"use client"

import * as React from "react"
import * as PopoverPrimitive from "@radix-ui/react-popover"

import { cn } from "@/lib/utils"

const Popover = PopoverPrimitive.Root

const PopoverTrigger = PopoverPrimitive.Trigger

const PopoverContent = React.forwardRef<
  React.ElementRef<typeof PopoverPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>
>(({ className, align = "center", sideOffset = 4, ...props }, ref) => (
  <PopoverPrimitive.Portal>
    <PopoverPrimitive.Content
      ref={ref}
      align={align}
      sideOffset={sideOffset}
      className={cn(
        "z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",
        className
      )}
      {...props}
    />
  </PopoverPrimitive.Portal>
))
PopoverContent.displayName = PopoverPrimitive.Content.displayName

export { Popover, PopoverTrigger, PopoverContent }

</code>

components\ui\progress.tsx:
<code>
"use client"

import * as React from "react"
import * as ProgressPrimitive from "@radix-ui/react-progress"

import { cn } from "@/lib/utils"

const Progress = React.forwardRef<
  React.ElementRef<typeof ProgressPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>
>(({ className, value, ...props }, ref) => (
  <ProgressPrimitive.Root
    ref={ref}
    className={cn(
      "relative h-4 w-full overflow-hidden rounded-full bg-secondary",
      className
    )}
    {...props}
  >
    <ProgressPrimitive.Indicator
      className="h-full w-full flex-1 bg-primary transition-all"
      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}
    />
  </ProgressPrimitive.Root>
))
Progress.displayName = ProgressPrimitive.Root.displayName

export { Progress }

</code>

components\ui\radio-group.tsx:
<code>
"use client"

import * as React from "react"
import * as RadioGroupPrimitive from "@radix-ui/react-radio-group"
import { Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const RadioGroup = React.forwardRef<
  React.ElementRef<typeof RadioGroupPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>
>(({ className, ...props }, ref) => {
  return (
    <RadioGroupPrimitive.Root
      className={cn("grid gap-2", className)}
      {...props}
      ref={ref}
    />
  )
})
RadioGroup.displayName = RadioGroupPrimitive.Root.displayName

const RadioGroupItem = React.forwardRef<
  React.ElementRef<typeof RadioGroupPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>
>(({ className, ...props }, ref) => {
  return (
    <RadioGroupPrimitive.Item
      ref={ref}
      className={cn(
        "aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    >
      <RadioGroupPrimitive.Indicator className="flex items-center justify-center">
        <Circle className="h-2.5 w-2.5 fill-current text-current" />
      </RadioGroupPrimitive.Indicator>
    </RadioGroupPrimitive.Item>
  )
})
RadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName

export { RadioGroup, RadioGroupItem }

</code>

components\ui\resizable.tsx:
<code>
"use client"

import { GripVertical } from "lucide-react"
import * as ResizablePrimitive from "react-resizable-panels"

import { cn } from "@/lib/utils"

const ResizablePanelGroup = ({
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (
  <ResizablePrimitive.PanelGroup
    className={cn(
      "flex h-full w-full data-[panel-group-direction=vertical]:flex-col",
      className
    )}
    {...props}
  />
)

const ResizablePanel = ResizablePrimitive.Panel

const ResizableHandle = ({
  withHandle,
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {
  withHandle?: boolean
}) => (
  <ResizablePrimitive.PanelResizeHandle
    className={cn(
      "relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90",
      className
    )}
    {...props}
  >
    {withHandle && (
      <div className="z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border">
        <GripVertical className="h-2.5 w-2.5" />
      </div>
    )}
  </ResizablePrimitive.PanelResizeHandle>
)

export { ResizablePanelGroup, ResizablePanel, ResizableHandle }

</code>

components\ui\scroll-area.tsx:
<code>
"use client"

import * as React from "react"
import * as ScrollAreaPrimitive from "@radix-ui/react-scroll-area"

import { cn } from "@/lib/utils"

const ScrollArea = React.forwardRef<
  React.ElementRef<typeof ScrollAreaPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>
>(({ className, children, ...props }, ref) => (
  <ScrollAreaPrimitive.Root
    ref={ref}
    className={cn("relative overflow-hidden", className)}
    {...props}
  >
    <ScrollAreaPrimitive.Viewport className="h-full w-full rounded-[inherit]">
      {children}
    </ScrollAreaPrimitive.Viewport>
    <ScrollBar />
    <ScrollAreaPrimitive.Corner />
  </ScrollAreaPrimitive.Root>
))
ScrollArea.displayName = ScrollAreaPrimitive.Root.displayName

const ScrollBar = React.forwardRef<
  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,
  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>
>(({ className, orientation = "vertical", ...props }, ref) => (
  <ScrollAreaPrimitive.ScrollAreaScrollbar
    ref={ref}
    orientation={orientation}
    className={cn(
      "flex touch-none select-none transition-colors",
      orientation === "vertical" &&
        "h-full w-2.5 border-l border-l-transparent p-[1px]",
      orientation === "horizontal" &&
        "h-2.5 flex-col border-t border-t-transparent p-[1px]",
      className
    )}
    {...props}
  >
    <ScrollAreaPrimitive.ScrollAreaThumb className="relative flex-1 rounded-full bg-border" />
  </ScrollAreaPrimitive.ScrollAreaScrollbar>
))
ScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName

export { ScrollArea, ScrollBar }

</code>

components\ui\select.tsx:
<code>
"use client"

import * as React from "react"
import * as SelectPrimitive from "@radix-ui/react-select"
import { Check, ChevronDown, ChevronUp } from "lucide-react"

import { cn } from "@/lib/utils"

const Select = SelectPrimitive.Root

const SelectGroup = SelectPrimitive.Group

const SelectValue = SelectPrimitive.Value

const SelectTrigger = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <SelectPrimitive.Trigger
    ref={ref}
    className={cn(
      "flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",
      className
    )}
    {...props}
  >
    {children}
    <SelectPrimitive.Icon asChild>
      <ChevronDown className="h-4 w-4 opacity-50" />
    </SelectPrimitive.Icon>
  </SelectPrimitive.Trigger>
))
SelectTrigger.displayName = SelectPrimitive.Trigger.displayName

const SelectScrollUpButton = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.ScrollUpButton
    ref={ref}
    className={cn(
      "flex cursor-default items-center justify-center py-1",
      className
    )}
    {...props}
  >
    <ChevronUp className="h-4 w-4" />
  </SelectPrimitive.ScrollUpButton>
))
SelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName

const SelectScrollDownButton = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.ScrollDownButton
    ref={ref}
    className={cn(
      "flex cursor-default items-center justify-center py-1",
      className
    )}
    {...props}
  >
    <ChevronDown className="h-4 w-4" />
  </SelectPrimitive.ScrollDownButton>
))
SelectScrollDownButton.displayName =
  SelectPrimitive.ScrollDownButton.displayName

const SelectContent = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>
>(({ className, children, position = "popper", ...props }, ref) => (
  <SelectPrimitive.Portal>
    <SelectPrimitive.Content
      ref={ref}
      className={cn(
        "relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]",
        position === "popper" &&
          "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",
        className
      )}
      position={position}
      {...props}
    >
      <SelectScrollUpButton />
      <SelectPrimitive.Viewport
        className={cn(
          "p-1",
          position === "popper" &&
            "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"
        )}
      >
        {children}
      </SelectPrimitive.Viewport>
      <SelectScrollDownButton />
    </SelectPrimitive.Content>
  </SelectPrimitive.Portal>
))
SelectContent.displayName = SelectPrimitive.Content.displayName

const SelectLabel = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.Label
    ref={ref}
    className={cn("py-1.5 pl-8 pr-2 text-sm font-semibold", className)}
    {...props}
  />
))
SelectLabel.displayName = SelectPrimitive.Label.displayName

const SelectItem = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>
>(({ className, children, ...props }, ref) => (
  <SelectPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <SelectPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </SelectPrimitive.ItemIndicator>
    </span>

    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>
  </SelectPrimitive.Item>
))
SelectItem.displayName = SelectPrimitive.Item.displayName

const SelectSeparator = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
SelectSeparator.displayName = SelectPrimitive.Separator.displayName

export {
  Select,
  SelectGroup,
  SelectValue,
  SelectTrigger,
  SelectContent,
  SelectLabel,
  SelectItem,
  SelectSeparator,
  SelectScrollUpButton,
  SelectScrollDownButton,
}

</code>

components\ui\separator.tsx:
<code>
"use client"

import * as React from "react"
import * as SeparatorPrimitive from "@radix-ui/react-separator"

import { cn } from "@/lib/utils"

const Separator = React.forwardRef<
  React.ElementRef<typeof SeparatorPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>
>(
  (
    { className, orientation = "horizontal", decorative = true, ...props },
    ref
  ) => (
    <SeparatorPrimitive.Root
      ref={ref}
      decorative={decorative}
      orientation={orientation}
      className={cn(
        "shrink-0 bg-border",
        orientation === "horizontal" ? "h-[1px] w-full" : "h-full w-[1px]",
        className
      )}
      {...props}
    />
  )
)
Separator.displayName = SeparatorPrimitive.Root.displayName

export { Separator }

</code>

components\ui\sheet.tsx:
<code>
"use client"

import * as React from "react"
import * as SheetPrimitive from "@radix-ui/react-dialog"
import { cva, type VariantProps } from "class-variance-authority"
import { X } from "lucide-react"

import { cn } from "@/lib/utils"

const Sheet = SheetPrimitive.Root

const SheetTrigger = SheetPrimitive.Trigger

const SheetClose = SheetPrimitive.Close

const SheetPortal = SheetPrimitive.Portal

const SheetOverlay = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Overlay
    className={cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
    ref={ref}
  />
))
SheetOverlay.displayName = SheetPrimitive.Overlay.displayName

const sheetVariants = cva(
  "fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",
  {
    variants: {
      side: {
        top: "inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",
        bottom:
          "inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",
        left: "inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",
        right:
          "inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm",
      },
    },
    defaultVariants: {
      side: "right",
    },
  }
)

interface SheetContentProps
  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,
    VariantProps<typeof sheetVariants> {}

const SheetContent = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Content>,
  SheetContentProps
>(({ side = "right", className, children, ...props }, ref) => (
  <SheetPortal>
    <SheetOverlay />
    <SheetPrimitive.Content
      ref={ref}
      className={cn(sheetVariants({ side }), className)}
      {...props}
    >
      {children}
      <SheetPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary">
        <X className="h-4 w-4" />
        <span className="sr-only">Close</span>
      </SheetPrimitive.Close>
    </SheetPrimitive.Content>
  </SheetPortal>
))
SheetContent.displayName = SheetPrimitive.Content.displayName

const SheetHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-2 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
SheetHeader.displayName = "SheetHeader"

const SheetFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
SheetFooter.displayName = "SheetFooter"

const SheetTitle = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Title
    ref={ref}
    className={cn("text-lg font-semibold text-foreground", className)}
    {...props}
  />
))
SheetTitle.displayName = SheetPrimitive.Title.displayName

const SheetDescription = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
SheetDescription.displayName = SheetPrimitive.Description.displayName

export {
  Sheet,
  SheetPortal,
  SheetOverlay,
  SheetTrigger,
  SheetClose,
  SheetContent,
  SheetHeader,
  SheetFooter,
  SheetTitle,
  SheetDescription,
}

</code>

components\ui\sidebar.tsx:
<code>
"use client"

import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { VariantProps, cva } from "class-variance-authority"
import { PanelLeft } from "lucide-react"

import { useIsMobile } from "@/hooks/use-mobile"
import { cn } from "@/lib/utils"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Separator } from "@/components/ui/separator"
import {
  Sheet,
  SheetContent,
  SheetDescription,
  SheetHeader,
  SheetTitle,
} from "@/components/ui/sheet"
import { Skeleton } from "@/components/ui/skeleton"
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from "@/components/ui/tooltip"

const SIDEBAR_COOKIE_NAME = "sidebar_state"
const SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7
const SIDEBAR_WIDTH = "16rem"
const SIDEBAR_WIDTH_MOBILE = "18rem"
const SIDEBAR_WIDTH_ICON = "3rem"
const SIDEBAR_KEYBOARD_SHORTCUT = "b"

type SidebarContextProps = {
  state: "expanded" | "collapsed"
  open: boolean
  setOpen: (open: boolean) => void
  openMobile: boolean
  setOpenMobile: (open: boolean) => void
  isMobile: boolean
  toggleSidebar: () => void
}

const SidebarContext = React.createContext<SidebarContextProps | null>(null)

function useSidebar() {
  const context = React.useContext(SidebarContext)
  if (!context) {
    throw new Error("useSidebar must be used within a SidebarProvider.")
  }

  return context
}

const SidebarProvider = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    defaultOpen?: boolean
    open?: boolean
    onOpenChange?: (open: boolean) => void
  }
>(
  (
    {
      defaultOpen = true,
      open: openProp,
      onOpenChange: setOpenProp,
      className,
      style,
      children,
      ...props
    },
    ref
  ) => {
    const isMobile = useIsMobile()
    const [openMobile, setOpenMobile] = React.useState(false)

    // This is the internal state of the sidebar.
    // We use openProp and setOpenProp for control from outside the component.
    const [_open, _setOpen] = React.useState(defaultOpen)
    const open = openProp ?? _open
    const setOpen = React.useCallback(
      (value: boolean | ((value: boolean) => boolean)) => {
        const openState = typeof value === "function" ? value(open) : value
        if (setOpenProp) {
          setOpenProp(openState)
        } else {
          _setOpen(openState)
        }

        // This sets the cookie to keep the sidebar state.
        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`
      },
      [setOpenProp, open]
    )

    // Helper to toggle the sidebar.
    const toggleSidebar = React.useCallback(() => {
      return isMobile
        ? setOpenMobile((open) => !open)
        : setOpen((open) => !open)
    }, [isMobile, setOpen, setOpenMobile])

    // Adds a keyboard shortcut to toggle the sidebar.
    React.useEffect(() => {
      const handleKeyDown = (event: KeyboardEvent) => {
        if (
          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&
          (event.metaKey || event.ctrlKey)
        ) {
          event.preventDefault()
          toggleSidebar()
        }
      }

      window.addEventListener("keydown", handleKeyDown)
      return () => window.removeEventListener("keydown", handleKeyDown)
    }, [toggleSidebar])

    // We add a state so that we can do data-state="expanded" or "collapsed".
    // This makes it easier to style the sidebar with Tailwind classes.
    const state = open ? "expanded" : "collapsed"

    const contextValue = React.useMemo<SidebarContextProps>(
      () => ({
        state,
        open,
        setOpen,
        isMobile,
        openMobile,
        setOpenMobile,
        toggleSidebar,
      }),
      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]
    )

    return (
      <SidebarContext.Provider value={contextValue}>
        <TooltipProvider delayDuration={0}>
          <div
            style={
              {
                "--sidebar-width": SIDEBAR_WIDTH,
                "--sidebar-width-icon": SIDEBAR_WIDTH_ICON,
                ...style,
              } as React.CSSProperties
            }
            className={cn(
              "group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",
              className
            )}
            ref={ref}
            {...props}
          >
            {children}
          </div>
        </TooltipProvider>
      </SidebarContext.Provider>
    )
  }
)
SidebarProvider.displayName = "SidebarProvider"

const Sidebar = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    side?: "left" | "right"
    variant?: "sidebar" | "floating" | "inset"
    collapsible?: "offcanvas" | "icon" | "none"
  }
>(
  (
    {
      side = "left",
      variant = "sidebar",
      collapsible = "offcanvas",
      className,
      children,
      ...props
    },
    ref
  ) => {
    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()

    if (collapsible === "none") {
      return (
        <div
          className={cn(
            "flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",
            className
          )}
          ref={ref}
          {...props}
        >
          {children}
        </div>
      )
    }

    if (isMobile) {
      return (
        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>
          <SheetContent
            data-sidebar="sidebar"
            data-mobile="true"
            className="w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden"
            style={
              {
                "--sidebar-width": SIDEBAR_WIDTH_MOBILE,
              } as React.CSSProperties
            }
            side={side}
          >
            <SheetHeader className="sr-only">
              <SheetTitle>Sidebar</SheetTitle>
              <SheetDescription>Displays the mobile sidebar.</SheetDescription>
            </SheetHeader>
            <div className="flex h-full w-full flex-col">{children}</div>
          </SheetContent>
        </Sheet>
      )
    }

    return (
      <div
        ref={ref}
        className="group peer hidden text-sidebar-foreground md:block"
        data-state={state}
        data-collapsible={state === "collapsed" ? collapsible : ""}
        data-variant={variant}
        data-side={side}
      >
        {/* This is what handles the sidebar gap on desktop */}
        <div
          className={cn(
            "relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear",
            "group-data-[collapsible=offcanvas]:w-0",
            "group-data-[side=right]:rotate-180",
            variant === "floating" || variant === "inset"
              ? "group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]"
              : "group-data-[collapsible=icon]:w-[--sidebar-width-icon]"
          )}
        />
        <div
          className={cn(
            "fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex",
            side === "left"
              ? "left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]"
              : "right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",
            // Adjust the padding for floating and inset variants.
            variant === "floating" || variant === "inset"
              ? "p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]"
              : "group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l",
            className
          )}
          {...props}
        >
          <div
            data-sidebar="sidebar"
            className="flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow"
          >
            {children}
          </div>
        </div>
      </div>
    )
  }
)
Sidebar.displayName = "Sidebar"

const SidebarTrigger = React.forwardRef<
  React.ElementRef<typeof Button>,
  React.ComponentProps<typeof Button>
>(({ className, onClick, ...props }, ref) => {
  const { toggleSidebar } = useSidebar()

  return (
    <Button
      ref={ref}
      data-sidebar="trigger"
      variant="ghost"
      size="icon"
      className={cn("h-7 w-7", className)}
      onClick={(event) => {
        onClick?.(event)
        toggleSidebar()
      }}
      {...props}
    >
      <PanelLeft />
      <span className="sr-only">Toggle Sidebar</span>
    </Button>
  )
})
SidebarTrigger.displayName = "SidebarTrigger"

const SidebarRail = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button">
>(({ className, ...props }, ref) => {
  const { toggleSidebar } = useSidebar()

  return (
    <button
      ref={ref}
      data-sidebar="rail"
      aria-label="Toggle Sidebar"
      tabIndex={-1}
      onClick={toggleSidebar}
      title="Toggle Sidebar"
      className={cn(
        "absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex",
        "[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize",
        "[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize",
        "group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar",
        "[[data-side=left][data-collapsible=offcanvas]_&]:-right-2",
        "[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",
        className
      )}
      {...props}
    />
  )
})
SidebarRail.displayName = "SidebarRail"

const SidebarInset = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"main">
>(({ className, ...props }, ref) => {
  return (
    <main
      ref={ref}
      className={cn(
        "relative flex w-full flex-1 flex-col bg-background",
        "md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",
        className
      )}
      {...props}
    />
  )
})
SidebarInset.displayName = "SidebarInset"

const SidebarInput = React.forwardRef<
  React.ElementRef<typeof Input>,
  React.ComponentProps<typeof Input>
>(({ className, ...props }, ref) => {
  return (
    <Input
      ref={ref}
      data-sidebar="input"
      className={cn(
        "h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",
        className
      )}
      {...props}
    />
  )
})
SidebarInput.displayName = "SidebarInput"

const SidebarHeader = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="header"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  )
})
SidebarHeader.displayName = "SidebarHeader"

const SidebarFooter = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="footer"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  )
})
SidebarFooter.displayName = "SidebarFooter"

const SidebarSeparator = React.forwardRef<
  React.ElementRef<typeof Separator>,
  React.ComponentProps<typeof Separator>
>(({ className, ...props }, ref) => {
  return (
    <Separator
      ref={ref}
      data-sidebar="separator"
      className={cn("mx-2 w-auto bg-sidebar-border", className)}
      {...props}
    />
  )
})
SidebarSeparator.displayName = "SidebarSeparator"

const SidebarContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="content"
      className={cn(
        "flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",
        className
      )}
      {...props}
    />
  )
})
SidebarContent.displayName = "SidebarContent"

const SidebarGroup = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="group"
      className={cn("relative flex w-full min-w-0 flex-col p-2", className)}
      {...props}
    />
  )
})
SidebarGroup.displayName = "SidebarGroup"

const SidebarGroupLabel = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & { asChild?: boolean }
>(({ className, asChild = false, ...props }, ref) => {
  const Comp = asChild ? Slot : "div"

  return (
    <Comp
      ref={ref}
      data-sidebar="group-label"
      className={cn(
        "flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        "group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",
        className
      )}
      {...props}
    />
  )
})
SidebarGroupLabel.displayName = "SidebarGroupLabel"

const SidebarGroupAction = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button"> & { asChild?: boolean }
>(({ className, asChild = false, ...props }, ref) => {
  const Comp = asChild ? Slot : "button"

  return (
    <Comp
      ref={ref}
      data-sidebar="group-action"
      className={cn(
        "absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 after:md:hidden",
        "group-data-[collapsible=icon]:hidden",
        className
      )}
      {...props}
    />
  )
})
SidebarGroupAction.displayName = "SidebarGroupAction"

const SidebarGroupContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    data-sidebar="group-content"
    className={cn("w-full text-sm", className)}
    {...props}
  />
))
SidebarGroupContent.displayName = "SidebarGroupContent"

const SidebarMenu = React.forwardRef<
  HTMLUListElement,
  React.ComponentProps<"ul">
>(({ className, ...props }, ref) => (
  <ul
    ref={ref}
    data-sidebar="menu"
    className={cn("flex w-full min-w-0 flex-col gap-1", className)}
    {...props}
  />
))
SidebarMenu.displayName = "SidebarMenu"

const SidebarMenuItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentProps<"li">
>(({ className, ...props }, ref) => (
  <li
    ref={ref}
    data-sidebar="menu-item"
    className={cn("group/menu-item relative", className)}
    {...props}
  />
))
SidebarMenuItem.displayName = "SidebarMenuItem"

const sidebarMenuButtonVariants = cva(
  "peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",
        outline:
          "bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]",
      },
      size: {
        default: "h-8 text-sm",
        sm: "h-7 text-xs",
        lg: "h-12 text-sm group-data-[collapsible=icon]:!p-0",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

const SidebarMenuButton = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button"> & {
    asChild?: boolean
    isActive?: boolean
    tooltip?: string | React.ComponentProps<typeof TooltipContent>
  } & VariantProps<typeof sidebarMenuButtonVariants>
>(
  (
    {
      asChild = false,
      isActive = false,
      variant = "default",
      size = "default",
      tooltip,
      className,
      ...props
    },
    ref
  ) => {
    const Comp = asChild ? Slot : "button"
    const { isMobile, state } = useSidebar()

    const button = (
      <Comp
        ref={ref}
        data-sidebar="menu-button"
        data-size={size}
        data-active={isActive}
        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}
        {...props}
      />
    )

    if (!tooltip) {
      return button
    }

    if (typeof tooltip === "string") {
      tooltip = {
        children: tooltip,
      }
    }

    return (
      <Tooltip>
        <TooltipTrigger asChild>{button}</TooltipTrigger>
        <TooltipContent
          side="right"
          align="center"
          hidden={state !== "collapsed" || isMobile}
          {...tooltip}
        />
      </Tooltip>
    )
  }
)
SidebarMenuButton.displayName = "SidebarMenuButton"

const SidebarMenuAction = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button"> & {
    asChild?: boolean
    showOnHover?: boolean
  }
>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {
  const Comp = asChild ? Slot : "button"

  return (
    <Comp
      ref={ref}
      data-sidebar="menu-action"
      className={cn(
        "absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 after:md:hidden",
        "peer-data-[size=sm]/menu-button:top-1",
        "peer-data-[size=default]/menu-button:top-1.5",
        "peer-data-[size=lg]/menu-button:top-2.5",
        "group-data-[collapsible=icon]:hidden",
        showOnHover &&
          "group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",
        className
      )}
      {...props}
    />
  )
})
SidebarMenuAction.displayName = "SidebarMenuAction"

const SidebarMenuBadge = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    data-sidebar="menu-badge"
    className={cn(
      "pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground",
      "peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground",
      "peer-data-[size=sm]/menu-button:top-1",
      "peer-data-[size=default]/menu-button:top-1.5",
      "peer-data-[size=lg]/menu-button:top-2.5",
      "group-data-[collapsible=icon]:hidden",
      className
    )}
    {...props}
  />
))
SidebarMenuBadge.displayName = "SidebarMenuBadge"

const SidebarMenuSkeleton = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    showIcon?: boolean
  }
>(({ className, showIcon = false, ...props }, ref) => {
  // Random width between 50 to 90%.
  const width = React.useMemo(() => {
    return `${Math.floor(Math.random() * 40) + 50}%`
  }, [])

  return (
    <div
      ref={ref}
      data-sidebar="menu-skeleton"
      className={cn("flex h-8 items-center gap-2 rounded-md px-2", className)}
      {...props}
    >
      {showIcon && (
        <Skeleton
          className="size-4 rounded-md"
          data-sidebar="menu-skeleton-icon"
        />
      )}
      <Skeleton
        className="h-4 max-w-[--skeleton-width] flex-1"
        data-sidebar="menu-skeleton-text"
        style={
          {
            "--skeleton-width": width,
          } as React.CSSProperties
        }
      />
    </div>
  )
})
SidebarMenuSkeleton.displayName = "SidebarMenuSkeleton"

const SidebarMenuSub = React.forwardRef<
  HTMLUListElement,
  React.ComponentProps<"ul">
>(({ className, ...props }, ref) => (
  <ul
    ref={ref}
    data-sidebar="menu-sub"
    className={cn(
      "mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5",
      "group-data-[collapsible=icon]:hidden",
      className
    )}
    {...props}
  />
))
SidebarMenuSub.displayName = "SidebarMenuSub"

const SidebarMenuSubItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentProps<"li">
>(({ ...props }, ref) => <li ref={ref} {...props} />)
SidebarMenuSubItem.displayName = "SidebarMenuSubItem"

const SidebarMenuSubButton = React.forwardRef<
  HTMLAnchorElement,
  React.ComponentProps<"a"> & {
    asChild?: boolean
    size?: "sm" | "md"
    isActive?: boolean
  }
>(({ asChild = false, size = "md", isActive, className, ...props }, ref) => {
  const Comp = asChild ? Slot : "a"

  return (
    <Comp
      ref={ref}
      data-sidebar="menu-sub-button"
      data-size={size}
      data-active={isActive}
      className={cn(
        "flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground",
        "data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",
        size === "sm" && "text-xs",
        size === "md" && "text-sm",
        "group-data-[collapsible=icon]:hidden",
        className
      )}
      {...props}
    />
  )
})
SidebarMenuSubButton.displayName = "SidebarMenuSubButton"

export {
  Sidebar,
  SidebarContent,
  SidebarFooter,
  SidebarGroup,
  SidebarGroupAction,
  SidebarGroupContent,
  SidebarGroupLabel,
  SidebarHeader,
  SidebarInput,
  SidebarInset,
  SidebarMenu,
  SidebarMenuAction,
  SidebarMenuBadge,
  SidebarMenuButton,
  SidebarMenuItem,
  SidebarMenuSkeleton,
  SidebarMenuSub,
  SidebarMenuSubButton,
  SidebarMenuSubItem,
  SidebarProvider,
  SidebarRail,
  SidebarSeparator,
  SidebarTrigger,
  useSidebar,
}

</code>

components\ui\skeleton.tsx:
<code>
import { cn } from "@/lib/utils"

function Skeleton({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) {
  return (
    <div
      className={cn("animate-pulse rounded-md bg-muted", className)}
      {...props}
    />
  )
}

export { Skeleton }

</code>

components\ui\slider.tsx:
<code>
"use client"

import * as React from "react"
import * as SliderPrimitive from "@radix-ui/react-slider"

import { cn } from "@/lib/utils"

const Slider = React.forwardRef<
  React.ElementRef<typeof SliderPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>
>(({ className, ...props }, ref) => (
  <SliderPrimitive.Root
    ref={ref}
    className={cn(
      "relative flex w-full touch-none select-none items-center",
      className
    )}
    {...props}
  >
    <SliderPrimitive.Track className="relative h-2 w-full grow overflow-hidden rounded-full bg-secondary">
      <SliderPrimitive.Range className="absolute h-full bg-primary" />
    </SliderPrimitive.Track>
    <SliderPrimitive.Thumb className="block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50" />
  </SliderPrimitive.Root>
))
Slider.displayName = SliderPrimitive.Root.displayName

export { Slider }

</code>

components\ui\sonner.tsx:
<code>
"use client"

import { useTheme } from "next-themes"
import { Toaster as Sonner } from "sonner"

type ToasterProps = React.ComponentProps<typeof Sonner>

const Toaster = ({ ...props }: ToasterProps) => {
  const { theme = "system" } = useTheme()

  return (
    <Sonner
      theme={theme as ToasterProps["theme"]}
      className="toaster group"
      toastOptions={{
        classNames: {
          toast:
            "group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",
          description: "group-[.toast]:text-muted-foreground",
          actionButton:
            "group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",
          cancelButton:
            "group-[.toast]:bg-muted group-[.toast]:text-muted-foreground",
        },
      }}
      {...props}
    />
  )
}

export { Toaster }

</code>

components\ui\switch.tsx:
<code>
"use client"

import * as React from "react"
import * as SwitchPrimitives from "@radix-ui/react-switch"

import { cn } from "@/lib/utils"

const Switch = React.forwardRef<
  React.ElementRef<typeof SwitchPrimitives.Root>,
  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>
>(({ className, ...props }, ref) => (
  <SwitchPrimitives.Root
    className={cn(
      "peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",
      className
    )}
    {...props}
    ref={ref}
  >
    <SwitchPrimitives.Thumb
      className={cn(
        "pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0"
      )}
    />
  </SwitchPrimitives.Root>
))
Switch.displayName = SwitchPrimitives.Root.displayName

export { Switch }

</code>

components\ui\table.tsx:
<code>
import * as React from "react"

import { cn } from "@/lib/utils"

const Table = React.forwardRef<
  HTMLTableElement,
  React.HTMLAttributes<HTMLTableElement>
>(({ className, ...props }, ref) => (
  <div className="relative w-full overflow-auto">
    <table
      ref={ref}
      className={cn("w-full caption-bottom text-sm", className)}
      {...props}
    />
  </div>
))
Table.displayName = "Table"

const TableHeader = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <thead ref={ref} className={cn("[&_tr]:border-b", className)} {...props} />
))
TableHeader.displayName = "TableHeader"

const TableBody = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <tbody
    ref={ref}
    className={cn("[&_tr:last-child]:border-0", className)}
    {...props}
  />
))
TableBody.displayName = "TableBody"

const TableFooter = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <tfoot
    ref={ref}
    className={cn(
      "border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",
      className
    )}
    {...props}
  />
))
TableFooter.displayName = "TableFooter"

const TableRow = React.forwardRef<
  HTMLTableRowElement,
  React.HTMLAttributes<HTMLTableRowElement>
>(({ className, ...props }, ref) => (
  <tr
    ref={ref}
    className={cn(
      "border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",
      className
    )}
    {...props}
  />
))
TableRow.displayName = "TableRow"

const TableHead = React.forwardRef<
  HTMLTableCellElement,
  React.ThHTMLAttributes<HTMLTableCellElement>
>(({ className, ...props }, ref) => (
  <th
    ref={ref}
    className={cn(
      "h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",
      className
    )}
    {...props}
  />
))
TableHead.displayName = "TableHead"

const TableCell = React.forwardRef<
  HTMLTableCellElement,
  React.TdHTMLAttributes<HTMLTableCellElement>
>(({ className, ...props }, ref) => (
  <td
    ref={ref}
    className={cn("p-4 align-middle [&:has([role=checkbox])]:pr-0", className)}
    {...props}
  />
))
TableCell.displayName = "TableCell"

const TableCaption = React.forwardRef<
  HTMLTableCaptionElement,
  React.HTMLAttributes<HTMLTableCaptionElement>
>(({ className, ...props }, ref) => (
  <caption
    ref={ref}
    className={cn("mt-4 text-sm text-muted-foreground", className)}
    {...props}
  />
))
TableCaption.displayName = "TableCaption"

export {
  Table,
  TableHeader,
  TableBody,
  TableFooter,
  TableHead,
  TableRow,
  TableCell,
  TableCaption,
}

</code>

components\ui\tabs.tsx:
<code>
"use client"

import * as React from "react"
import * as TabsPrimitive from "@radix-ui/react-tabs"

import { cn } from "@/lib/utils"

const Tabs = TabsPrimitive.Root

const TabsList = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.List
    ref={ref}
    className={cn(
      "inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",
      className
    )}
    {...props}
  />
))
TabsList.displayName = TabsPrimitive.List.displayName

const TabsTrigger = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Trigger
    ref={ref}
    className={cn(
      "inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",
      className
    )}
    {...props}
  />
))
TabsTrigger.displayName = TabsPrimitive.Trigger.displayName

const TabsContent = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Content
    ref={ref}
    className={cn(
      "mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",
      className
    )}
    {...props}
  />
))
TabsContent.displayName = TabsPrimitive.Content.displayName

export { Tabs, TabsList, TabsTrigger, TabsContent }

</code>

components\ui\textarea.tsx:
<code>
import * as React from "react"

import { cn } from "@/lib/utils"

const Textarea = React.forwardRef<
  HTMLTextAreaElement,
  React.ComponentProps<"textarea">
>(({ className, ...props }, ref) => {
  return (
    <textarea
      className={cn(
        "flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
        className
      )}
      ref={ref}
      {...props}
    />
  )
})
Textarea.displayName = "Textarea"

export { Textarea }

</code>

components\ui\toast.tsx:
<code>
"use client"

import * as React from "react"
import * as ToastPrimitives from "@radix-ui/react-toast"
import { cva, type VariantProps } from "class-variance-authority"
import { X } from "lucide-react"

import { cn } from "@/lib/utils"

const ToastProvider = ToastPrimitives.Provider

const ToastViewport = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Viewport>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Viewport
    ref={ref}
    className={cn(
      "fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",
      className
    )}
    {...props}
  />
))
ToastViewport.displayName = ToastPrimitives.Viewport.displayName

const toastVariants = cva(
  "group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",
  {
    variants: {
      variant: {
        default: "border bg-background text-foreground",
        destructive:
          "destructive group border-destructive bg-destructive text-destructive-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

const Toast = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Root>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &
    VariantProps<typeof toastVariants>
>(({ className, variant, ...props }, ref) => {
  return (
    <ToastPrimitives.Root
      ref={ref}
      className={cn(toastVariants({ variant }), className)}
      {...props}
    />
  )
})
Toast.displayName = ToastPrimitives.Root.displayName

const ToastAction = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Action>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Action
    ref={ref}
    className={cn(
      "inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",
      className
    )}
    {...props}
  />
))
ToastAction.displayName = ToastPrimitives.Action.displayName

const ToastClose = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Close>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Close
    ref={ref}
    className={cn(
      "absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",
      className
    )}
    toast-close=""
    {...props}
  >
    <X className="h-4 w-4" />
  </ToastPrimitives.Close>
))
ToastClose.displayName = ToastPrimitives.Close.displayName

const ToastTitle = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Title>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Title
    ref={ref}
    className={cn("text-sm font-semibold", className)}
    {...props}
  />
))
ToastTitle.displayName = ToastPrimitives.Title.displayName

const ToastDescription = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Description>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Description
    ref={ref}
    className={cn("text-sm opacity-90", className)}
    {...props}
  />
))
ToastDescription.displayName = ToastPrimitives.Description.displayName

type ToastProps = React.ComponentPropsWithoutRef<typeof Toast>

type ToastActionElement = React.ReactElement<typeof ToastAction>

export {
  type ToastProps,
  type ToastActionElement,
  ToastProvider,
  ToastViewport,
  Toast,
  ToastTitle,
  ToastDescription,
  ToastClose,
  ToastAction,
}

</code>

components\ui\toaster.tsx:
<code>
"use client"

import { useToast } from "@/hooks/use-toast"
import {
  Toast,
  ToastClose,
  ToastDescription,
  ToastProvider,
  ToastTitle,
  ToastViewport,
} from "@/components/ui/toast"

export function Toaster() {
  const { toasts } = useToast()

  return (
    <ToastProvider>
      {toasts.map(function ({ id, title, description, action, ...props }) {
        return (
          <Toast key={id} {...props}>
            <div className="grid gap-1">
              {title && <ToastTitle>{title}</ToastTitle>}
              {description && (
                <ToastDescription>{description}</ToastDescription>
              )}
            </div>
            {action}
            <ToastClose />
          </Toast>
        )
      })}
      <ToastViewport />
    </ToastProvider>
  )
}

</code>

components\ui\toggle-group.tsx:
<code>
"use client"

import * as React from "react"
import * as ToggleGroupPrimitive from "@radix-ui/react-toggle-group"
import { type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"
import { toggleVariants } from "@/components/ui/toggle"

const ToggleGroupContext = React.createContext<
  VariantProps<typeof toggleVariants>
>({
  size: "default",
  variant: "default",
})

const ToggleGroup = React.forwardRef<
  React.ElementRef<typeof ToggleGroupPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &
    VariantProps<typeof toggleVariants>
>(({ className, variant, size, children, ...props }, ref) => (
  <ToggleGroupPrimitive.Root
    ref={ref}
    className={cn("flex items-center justify-center gap-1", className)}
    {...props}
  >
    <ToggleGroupContext.Provider value={{ variant, size }}>
      {children}
    </ToggleGroupContext.Provider>
  </ToggleGroupPrimitive.Root>
))

ToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName

const ToggleGroupItem = React.forwardRef<
  React.ElementRef<typeof ToggleGroupPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &
    VariantProps<typeof toggleVariants>
>(({ className, children, variant, size, ...props }, ref) => {
  const context = React.useContext(ToggleGroupContext)

  return (
    <ToggleGroupPrimitive.Item
      ref={ref}
      className={cn(
        toggleVariants({
          variant: context.variant || variant,
          size: context.size || size,
        }),
        className
      )}
      {...props}
    >
      {children}
    </ToggleGroupPrimitive.Item>
  )
})

ToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName

export { ToggleGroup, ToggleGroupItem }

</code>

components\ui\toggle.tsx:
<code>
"use client"

import * as React from "react"
import * as TogglePrimitive from "@radix-ui/react-toggle"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const toggleVariants = cva(
  "inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2",
  {
    variants: {
      variant: {
        default: "bg-transparent",
        outline:
          "border border-input bg-transparent hover:bg-accent hover:text-accent-foreground",
      },
      size: {
        default: "h-10 px-3 min-w-10",
        sm: "h-9 px-2.5 min-w-9",
        lg: "h-11 px-5 min-w-11",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

const Toggle = React.forwardRef<
  React.ElementRef<typeof TogglePrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &
    VariantProps<typeof toggleVariants>
>(({ className, variant, size, ...props }, ref) => (
  <TogglePrimitive.Root
    ref={ref}
    className={cn(toggleVariants({ variant, size, className }))}
    {...props}
  />
))

Toggle.displayName = TogglePrimitive.Root.displayName

export { Toggle, toggleVariants }

</code>

components\ui\tooltip.tsx:
<code>
"use client"

import * as React from "react"
import * as TooltipPrimitive from "@radix-ui/react-tooltip"

import { cn } from "@/lib/utils"

const TooltipProvider = TooltipPrimitive.Provider

const Tooltip = TooltipPrimitive.Root

const TooltipTrigger = TooltipPrimitive.Trigger

const TooltipContent = React.forwardRef<
  React.ElementRef<typeof TooltipPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>
>(({ className, sideOffset = 4, ...props }, ref) => (
  <TooltipPrimitive.Content
    ref={ref}
    sideOffset={sideOffset}
    className={cn(
      "z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",
      className
    )}
    {...props}
  />
))
TooltipContent.displayName = TooltipPrimitive.Content.displayName

export { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }

</code>

components\ui\use-mobile.tsx:
<code>
import * as React from "react"

const MOBILE_BREAKPOINT = 768

export function useIsMobile() {
  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)

  React.useEffect(() => {
    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)
    const onChange = () => {
      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    }
    mql.addEventListener("change", onChange)
    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    return () => mql.removeEventListener("change", onChange)
  }, [])

  return !!isMobile
}

</code>

components\ui\use-toast.ts:
<code>
"use client"

// Inspired by react-hot-toast library
import * as React from "react"

import type {
  ToastActionElement,
  ToastProps,
} from "@/components/ui/toast"

const TOAST_LIMIT = 1
const TOAST_REMOVE_DELAY = 1000000

type ToasterToast = ToastProps & {
  id: string
  title?: React.ReactNode
  description?: React.ReactNode
  action?: ToastActionElement
}

const actionTypes = {
  ADD_TOAST: "ADD_TOAST",
  UPDATE_TOAST: "UPDATE_TOAST",
  DISMISS_TOAST: "DISMISS_TOAST",
  REMOVE_TOAST: "REMOVE_TOAST",
} as const

let count = 0

function genId() {
  count = (count + 1) % Number.MAX_SAFE_INTEGER
  return count.toString()
}

type ActionType = typeof actionTypes

type Action =
  | {
      type: ActionType["ADD_TOAST"]
      toast: ToasterToast
    }
  | {
      type: ActionType["UPDATE_TOAST"]
      toast: Partial<ToasterToast>
    }
  | {
      type: ActionType["DISMISS_TOAST"]
      toastId?: ToasterToast["id"]
    }
  | {
      type: ActionType["REMOVE_TOAST"]
      toastId?: ToasterToast["id"]
    }

interface State {
  toasts: ToasterToast[]
}

const toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()

const addToRemoveQueue = (toastId: string) => {
  if (toastTimeouts.has(toastId)) {
    return
  }

  const timeout = setTimeout(() => {
    toastTimeouts.delete(toastId)
    dispatch({
      type: "REMOVE_TOAST",
      toastId: toastId,
    })
  }, TOAST_REMOVE_DELAY)

  toastTimeouts.set(toastId, timeout)
}

export const reducer = (state: State, action: Action): State => {
  switch (action.type) {
    case "ADD_TOAST":
      return {
        ...state,
        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),
      }

    case "UPDATE_TOAST":
      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === action.toast.id ? { ...t, ...action.toast } : t
        ),
      }

    case "DISMISS_TOAST": {
      const { toastId } = action

      // ! Side effects ! - This could be extracted into a dismissToast() action,
      // but I'll keep it here for simplicity
      if (toastId) {
        addToRemoveQueue(toastId)
      } else {
        state.toasts.forEach((toast) => {
          addToRemoveQueue(toast.id)
        })
      }

      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === toastId || toastId === undefined
            ? {
                ...t,
                open: false,
              }
            : t
        ),
      }
    }
    case "REMOVE_TOAST":
      if (action.toastId === undefined) {
        return {
          ...state,
          toasts: [],
        }
      }
      return {
        ...state,
        toasts: state.toasts.filter((t) => t.id !== action.toastId),
      }
  }
}

const listeners: Array<(state: State) => void> = []

let memoryState: State = { toasts: [] }

function dispatch(action: Action) {
  memoryState = reducer(memoryState, action)
  listeners.forEach((listener) => {
    listener(memoryState)
  })
}

type Toast = Omit<ToasterToast, "id">

function toast({ ...props }: Toast) {
  const id = genId()

  const update = (props: ToasterToast) =>
    dispatch({
      type: "UPDATE_TOAST",
      toast: { ...props, id },
    })
  const dismiss = () => dispatch({ type: "DISMISS_TOAST", toastId: id })

  dispatch({
    type: "ADD_TOAST",
    toast: {
      ...props,
      id,
      open: true,
      onOpenChange: (open) => {
        if (!open) dismiss()
      },
    },
  })

  return {
    id: id,
    dismiss,
    update,
  }
}

function useToast() {
  const [state, setState] = React.useState<State>(memoryState)

  React.useEffect(() => {
    listeners.push(setState)
    return () => {
      const index = listeners.indexOf(setState)
      if (index > -1) {
        listeners.splice(index, 1)
      }
    }
  }, [state])

  return {
    ...state,
    toast,
    dismiss: (toastId?: string) => dispatch({ type: "DISMISS_TOAST", toastId }),
  }
}

export { useToast, toast }

</code>

components\auth-forms.tsx:
<code>
'use client'

import React, { useState } from 'react'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Alert, AlertDescription } from '@/components/ui/alert'
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'
import { Github, Mail, Eye, EyeOff, AlertCircle, CheckCircle } from 'lucide-react'
import { supabase } from '@/lib/supabase'

interface AuthFormsProps {
  onClose?: () => void
}

export default function AuthForms({ onClose }: AuthFormsProps) {
  const [isLoading, setIsLoading] = useState(false)
  const [showPassword, setShowPassword] = useState(false)
  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null)
  
  const [signUpData, setSignUpData] = useState({
    email: '',
    password: '',
    confirmPassword: ''
  })
  
  const [signInData, setSignInData] = useState({
    email: '',
    password: ''
  })

  const handleSignUp = async (e: React.FormEvent) => {
    e.preventDefault()
    if (signUpData.password !== signUpData.confirmPassword) {
      setMessage({ type: 'error', text: 'Passwords do not match' })
      return
    }
    
    setIsLoading(true)
    setMessage(null)
    
    try {
      const { data, error } = await supabase.auth.signUp({
        email: signUpData.email,
        password: signUpData.password,
        // No email confirmation - direct signup for faster onboarding
      })
      
      if (error) throw error
      
      // User must manually switch to login after signup
      setMessage({
        type: 'success',
        text: 'Account created successfully! Please manually switch to login to continue.'
      })
      // REMOVED: Automatic tab switch - user must manually choose
    } catch (error: any) {
      setMessage({ type: 'error', text: error.message })
    } finally {
      setIsLoading(false)
    }
  }

  const handleSignIn = async (e: React.FormEvent) => {
    e.preventDefault()
    setIsLoading(true)
    setMessage(null)

    // Check if user entered a username instead of email
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/
    if (!emailRegex.test(signInData.email)) {
      setMessage({
        type: 'error',
        text: 'Please enter a valid email address. For GitHub login, use the GitHub button below instead of entering your username here.'
      })
      setIsLoading(false)
      return
    }

    try {
      const { data, error } = await supabase.auth.signInWithPassword({
        email: signInData.email,
        password: signInData.password
      })

      if (error) throw error

      setMessage({
        type: 'success',
        text: 'Signed in successfully! Please manually navigate to your desired page.'
      })
      // REMOVED: Automatic redirect - user must manually navigate
    } catch (error: any) {
      setMessage({ type: 'error', text: error.message })
    } finally {
      setIsLoading(false)
    }
  }

  const handleGitHubSignIn = async () => {
    setIsLoading(true)
    setMessage(null)

    try {
      const { error } = await supabase.auth.signInWithOAuth({
        provider: 'github',
        options: {
          redirectTo: `${window.location.origin}/`,
          queryParams: {
            access_type: 'offline',
            prompt: 'consent',
          }
        }
      })

      if (error) throw error
    } catch (error: any) {
      setMessage({ type: 'error', text: error.message })
      setIsLoading(false)
    }
  }

  const handleGoogleSignIn = async () => {
    setIsLoading(true)
    setMessage(null)

    try {
      const { error } = await supabase.auth.signInWithOAuth({
        provider: 'google',
        options: {
          redirectTo: `${window.location.origin}/`,
          queryParams: {
            access_type: 'offline',
            prompt: 'consent',
          }
        }
      })

      if (error) throw error
    } catch (error: any) {
      setMessage({ type: 'error', text: error.message })
      setIsLoading(false)
    }
  }

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <Card className="w-full max-w-md">
        <CardHeader className="space-y-1">
          <div className="flex items-center justify-between">
            <CardTitle className="text-2xl font-bold">Welcome to NeatRepo</CardTitle>
            {onClose && (
              <Button variant="ghost" size="sm" onClick={onClose}>
                √ó
              </Button>
            )}
          </div>
          <CardDescription>
            Sign in to your account or create a new one
          </CardDescription>
        </CardHeader>
        <CardContent>
          {message && (
            <Alert className={`mb-4 ${message.type === 'error' ? 'border-destructive' : 'border-green-500'}`}>
              {message.type === 'error' ? (
                <AlertCircle className="h-4 w-4" />
              ) : (
                <CheckCircle className="h-4 w-4" />
              )}
              <AlertDescription className={message.type === 'error' ? 'text-destructive' : 'text-green-600'}>
                {message.text}
              </AlertDescription>
            </Alert>
          )}

          <Tabs defaultValue="signin" className="w-full">
            <TabsList className="grid w-full grid-cols-2">
              <TabsTrigger value="signin">Sign In</TabsTrigger>
              <TabsTrigger value="signup">Sign Up</TabsTrigger>
            </TabsList>
            
            <TabsContent value="signin" className="space-y-4">
              <form onSubmit={handleSignIn} className="space-y-4">
                <div className="space-y-2">
                  <Label htmlFor="signin-email">Email</Label>
                  <Input
                    id="signin-email"
                    type="email"
                    placeholder="your@email.com"
                    value={signInData.email}
                    onChange={(e) => setSignInData(prev => ({ ...prev, email: e.target.value }))}
                    required
                  />
                </div>
                <div className="space-y-2">
                  <Label htmlFor="signin-password">Password</Label>
                  <div className="relative">
                    <Input
                      id="signin-password"
                      type={showPassword ? 'text' : 'password'}
                      placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                      value={signInData.password}
                      onChange={(e) => setSignInData(prev => ({ ...prev, password: e.target.value }))}
                      required
                    />
                    <Button
                      type="button"
                      variant="ghost"
                      size="sm"
                      className="absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent"
                      onClick={() => setShowPassword(!showPassword)}
                    >
                      {showPassword ? <EyeOff className="h-4 w-4" /> : <Eye className="h-4 w-4" />}
                    </Button>
                  </div>
                </div>
                <Button type="submit" className="w-full" disabled={isLoading}>
                  {isLoading ? 'Signing in...' : 'Sign In'}
                </Button>
              </form>
            </TabsContent>
            
            <TabsContent value="signup" className="space-y-4">
              <form onSubmit={handleSignUp} className="space-y-4">
                <div className="space-y-2">
                  <Label htmlFor="signup-email">Email</Label>
                  <Input
                    id="signup-email"
                    type="email"
                    placeholder="your@email.com"
                    value={signUpData.email}
                    onChange={(e) => setSignUpData(prev => ({ ...prev, email: e.target.value }))}
                    required
                  />
                </div>
                <div className="space-y-2">
                  <Label htmlFor="signup-password">Password</Label>
                  <Input
                    id="signup-password"
                    type="password"
                    placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                    value={signUpData.password}
                    onChange={(e) => setSignUpData(prev => ({ ...prev, password: e.target.value }))}
                    required
                  />
                </div>
                <div className="space-y-2">
                  <Label htmlFor="confirm-password">Confirm Password</Label>
                  <Input
                    id="confirm-password"
                    type="password"
                    placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                    value={signUpData.confirmPassword}
                    onChange={(e) => setSignUpData(prev => ({ ...prev, confirmPassword: e.target.value }))}
                    required
                  />
                </div>
                <Button type="submit" className="w-full" disabled={isLoading}>
                  {isLoading ? 'Creating account...' : 'Create Account'}
                </Button>
              </form>
            </TabsContent>
          </Tabs>

          <div className="relative my-4">
            <div className="absolute inset-0 flex items-center">
              <span className="w-full border-t" />
            </div>
            <div className="relative flex justify-center text-xs uppercase">
              <span className="bg-background px-2 text-muted-foreground">Or continue with</span>
            </div>
          </div>

          <div className="grid grid-cols-2 gap-3">
            <Button
              variant="outline"
              className="w-full"
              onClick={handleGoogleSignIn}
              disabled={isLoading}
            >
              <svg className="mr-2 h-4 w-4" viewBox="0 0 24 24">
                <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
              </svg>
              Google
            </Button>
            <Button
              variant="outline"
              className="w-full"
              onClick={handleGitHubSignIn}
              disabled={isLoading}
            >
              <Github className="mr-2 h-4 w-4" />
              GitHub
            </Button>
          </div>
        </CardContent>
      </Card>
    </div>
  )
}

</code>

components\auth-guard.tsx:
<code>
"use client"

import { useEffect, useState } from 'react'
import { useRouter, useSearchParams } from 'next/navigation'
import { useAuth } from './auth-provider'

interface AuthGuardProps {
  children: React.ReactNode
  requireAuth?: boolean
}

export function AuthGuard({ children, requireAuth = true }: AuthGuardProps) {
  const { user, loading } = useAuth()
  const router = useRouter()
  const searchParams = useSearchParams()
  const [isChecking, setIsChecking] = useState(true)

  useEffect(() => {
    // If we don't require auth, just render children
    if (!requireAuth) {
      setIsChecking(false)
      return
    }

    // If still loading, wait
    if (loading) {
      return
    }

    // Check for auth success parameter (fresh from OAuth)
    const authSuccess = searchParams.get('auth')
    if (authSuccess === 'success') {
      console.log('üîÑ AUTH GUARD: Auth success parameter detected, waiting for session...')
      
      // Give the session a moment to establish after OAuth callback
      const sessionTimeout = setTimeout(() => {
        if (!user) {
          console.log('‚ö†Ô∏è AUTH GUARD: Session not established after OAuth - user must manually navigate')
          // REMOVED: Automatic redirect - user must manually choose where to go
        } else {
          console.log('‚úÖ AUTH GUARD: Session established successfully')
          // Clean up the URL parameter
          const url = new URL(window.location.href)
          url.searchParams.delete('auth')
          window.history.replaceState({}, '', url.toString())
        }
        setIsChecking(false)
      }, 2000) // Give 2 seconds for session to establish

      return () => clearTimeout(sessionTimeout)
    }

    // Normal auth check
    if (!user) {
      console.log('üö´ AUTH GUARD: No user found - user must manually navigate')
      // REMOVED: Automatic redirect - user must manually choose where to go
      setIsChecking(false)
      return
    }

    console.log('‚úÖ AUTH GUARD: User authenticated, allowing access')
    setIsChecking(false)
  }, [user, loading, requireAuth, router, searchParams])

  // Show loading state while checking auth
  if (isChecking || loading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-center">
          <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"></div>
          <p className="text-muted-foreground">Authenticating...</p>
        </div>
      </div>
    )
  }

  // If we require auth and don't have a user, don't render children
  if (requireAuth && !user) {
    return null
  }

  return <>{children}</>
}
</code>

components\auth-provider.tsx:
<code>
"use client"

import React, { createContext, useContext, useEffect, useState } from "react";
import GitHubTokenPopup from "./github-token-popup";
import { User } from "@supabase/supabase-js";
import { supabase } from "@/lib/supabase";

interface UserProfile {
  id: string;
  github_pat_token?: string;
  [key: string]: any;
}

interface AuthContextType {
  user: User | null;
  profile: UserProfile | null;
  loading: boolean;
  signOut: () => Promise<void>;
  showTokenPopup: () => void;
  getEffectiveToken: () => Promise<string | null>;
  updateToken: (token: string) => Promise<void>;
  deleteToken: () => Promise<void>;
}

const AuthContext = createContext<AuthContextType | undefined>(undefined);

export const useAuth = () => {
  const context = useContext(AuthContext);
  if (context === undefined) {
    throw new Error("useAuth must be used within an AuthProvider");
  }
  return context;
};

// üåü AUTH PROVIDER: Main context provider component
export function AuthProvider({ children }: { children: React.ReactNode }) {
  const [user, setUser] = useState<User | null>(null);
  const [profile, setProfile] = useState<UserProfile | null>(null);
  const [loading, setLoading] = useState(true); // CRITICAL FIX: Start with loading true to prevent race conditions
  const [showTokenPopupState, setShowTokenPopupState] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  // üëÄ Track if we are currently fetching missing user data from Supabase
  const [awaitingUserFetch, setAwaitingUserFetch] = useState(false);

  // ‚è∞ FAIL-SAFE: Force loading to false after 8 seconds (extendable) if it somehow stays true
  useEffect(() => {
    if (!loading) return; // Already resolved

    const effectiveTimeout = awaitingUserFetch ? 15000 : 8000; // 15s if awaiting user fetch

    const timer = setTimeout(async () => {
      if (loading) {
        console.warn('‚ö†Ô∏è AUTH: Fallback timeout reached ‚Äì attempting final refreshSession');
        try {
          const { data: refData, error: refErr } = await supabase.auth.refreshSession();
          if (refErr) {
            console.error('‚ùå AUTH: refreshSession error in fallback:', refErr);
          }
          if (refData?.session?.user) {
            console.log('‚úÖ AUTH: User recovered during fallback refresh:', refData.session.user.id);
            setUser(refData.session.user);
            
            // üîß CRITICAL FIX: Load profile data with PAT token after fallback recovery
            console.log('üîÑ AUTH: Loading profile data after fallback recovery...');
            try {
              const recoveredProfile = await fetchProfile(refData.session.user.id);
              console.log('‚úÖ AUTH: Profile recovered after fallback:', {
                hasProfile: !!recoveredProfile,
                hasPAT: !!recoveredProfile?.github_pat_token,
                username: recoveredProfile?.github_username
              });
            } catch (profileError) {
              console.error('‚ùå AUTH: Failed to load profile after fallback recovery:', profileError);
            }
          } else {
            console.warn('‚ö†Ô∏è AUTH: Still no user after fallback refresh');
          }
        } catch (fallbackEx) {
          console.error('‚ùå AUTH: Exception during fallback refreshSession:', fallbackEx);
        }
        setLoading(false);
      }
    }, effectiveTimeout);

    return () => clearTimeout(timer);
  }, [loading, awaitingUserFetch]);

  // üîß REMOVED: Emergency timeout that was interfering with OAuth profile creation
  // Users must now manually sign out to end sessions, ensuring complete session cleanup
  // and preventing timing interference with OAuth UPSERT operations for new users

  // üö® HELPER: Create profile with proper username handling
  const createProfileWithUsername = async (user: any, githubUsername: string, githubId?: string) => {
    try {
      console.log('üîß AUTH: Creating profile with username:', githubUsername);
      console.log('üîç DEBUG: User data for profile creation:', {
        userId: user.id,
        githubUsername,
        githubId,
        userMetadata: user.user_metadata
      });

      const newProfile = {
        id: user.id,
        github_user_id: githubId,
        github_username: githubUsername,
        display_name: user.user_metadata?.full_name || user.user_metadata?.name || githubUsername,
        avatar_url: user.user_metadata?.avatar_url,
         // Will be set later if needed
        updated_at: new Date().toISOString(),
      };

      console.log('üîç DEBUG: Profile object to upsert:', newProfile);
      
      const upsertResult = await supabase
        .from('user_profiles')
        .upsert(newProfile, { onConflict: 'id' });

      console.log('üîç DEBUG: Upsert result:', upsertResult);
      
      if (upsertResult.error) {
        console.error('‚ùå Failed to create profile in database:', upsertResult.error);
        console.error('üîç DEBUG: Full upsert error details:', {
          code: upsertResult.error.code,
          message: upsertResult.error.message,
          details: upsertResult.error.details,
          hint: upsertResult.error.hint
        });
        // üîß CRITICAL FIX: Set profile state even if database operation fails
        // This prevents "No account" state while still allowing the app to function
        console.log('üîÑ AUTH: Setting profile state despite database error to prevent "No account" state');
        setProfile(newProfile);
        console.log('üîç DEBUG: Profile state set to:', newProfile);
        return newProfile; // Don't throw error, continue with local profile state
      }

      console.log('‚úÖ Profile created successfully in database:', githubUsername);
      setProfile(newProfile);
      console.log('üîç DEBUG: Profile state set successfully to:', newProfile);
      return newProfile;
    } catch (error) {
      console.error('‚ùå Profile creation failed:', error);

      // üîß CRITICAL FIX: Create fallback profile state to prevent "No account" state
      const fallbackProfile = {
        id: user.id,
        github_user_id: githubId,
        github_username: githubUsername,
        display_name: user.user_metadata?.full_name || user.user_metadata?.name || githubUsername,
        avatar_url: user.user_metadata?.avatar_url,
        
        updated_at: new Date().toISOString(),
      };

      console.log('üîÑ AUTH: Creating fallback profile state to prevent "No account" state');
      setProfile(fallbackProfile);
      return fallbackProfile; // Don't throw error - allow app to continue with local profile state
    }
  };

  const fetchProfile = async (userId: string) => {
    try {
      console.log("üîç AUTH: Fetching profile for user ID:", userId);
      console.log('üîç DEBUG: About to query user_profiles table');
      
      const { data, error } = await supabase
        .from('user_profiles')
        .select('*')
        .eq('id', userId)
        .single();

      console.log('üîç DEBUG: Supabase query result:', { data, error });
      
      if (error) {
        console.error('‚ùå AUTH: Error fetching profile:', error);
        console.error('üîç DEBUG: Full error details:', {
          code: error.code,
          message: error.message,
          details: error.details,
          hint: error.hint
        });
        // If profile doesn't exist, create it
        if (error.code === 'PGRST116') {
          console.log('üîß Profile not found, creating new profile...');

          // üîß CRITICAL FIX: Enhanced GitHub username extraction with multiple fallbacks
          const githubUsername = user?.user_metadata?.user_name ||
                                user?.user_metadata?.preferred_username ||
                                user?.user_metadata?.login ||
                                user?.user_metadata?.name ||
                                user?.email?.split('@')[0];

          console.log('üîç AUTH: GitHub username extraction:', {
            user_name: user?.user_metadata?.user_name,
            preferred_username: user?.user_metadata?.preferred_username,
            login: user?.user_metadata?.login,
            name: user?.user_metadata?.name,
            email: user?.email,
            finalUsername: githubUsername,
            allMetadata: user?.user_metadata
          });

          if (!githubUsername) {
            console.error('‚ùå Cannot create profile: No GitHub username available after all fallbacks');
            console.error('‚ùå Available user data:', {
              userMetadata: user?.user_metadata,
              email: user?.email,
              identities: user?.identities
            });
            throw new Error('GitHub username is required for profile creation');
          }

          const newProfile = {
            id: userId,
            github_username: githubUsername,
             // Only null for truly new users
            display_name: user?.user_metadata?.full_name || user?.user_metadata?.name,
            avatar_url: user?.user_metadata?.avatar_url
          };

          const { data: createdProfile, error: createError } = await supabase
            .from('user_profiles')
            .insert(newProfile)
            .select()
            .single();

          if (createError) {
            console.error('Error creating profile:', createError);
            setProfile(newProfile);
            return newProfile;
          } else {
            console.log('‚úÖ Profile created successfully');
            setProfile(createdProfile);
            if (typeof window !== 'undefined') {
              localStorage.setItem('github_username', createdProfile.github_username);
              localStorage.setItem(`github_username_${userId}`, createdProfile.github_username);
            }
            return createdProfile;
          }
        }

        // üö® CRITICAL FIX: For other errors (network, timeout, etc.),
        // don't override existing profile data - preserve current state
        console.error('‚ùå AUTH: Database error fetching profile, preserving current state');
        if (profile) {
          console.log('üîÑ AUTH: Keeping existing profile to preserve PAT token');
          return profile; // Keep existing profile to preserve any PAT
        }

        // Only create basic profile if we have no existing profile at all
        const basicProfile = {
          id: userId,
          github_username: user?.user_metadata?.user_name || 'user',
          github_pat_token: null // Only null if no existing profile
        };
        setProfile(basicProfile);
        return basicProfile;
      } else {
        // Sanitize profile token: treat OAuth tokens (gho_ prefix) as no PAT
        if (data && data.github_pat_token?.startsWith('gho_')) {
          data.github_pat_token = null;
        }
        console.log("‚úÖ AUTH: Profile fetched successfully:", {
          id: data.id,
          github_username: data.github_username,
          hasToken: !!data.github_pat_token,
          tokenLength: data.github_pat_token?.length,
          avatar_url: data.avatar_url
        });
        setProfile(data);
        if (typeof window !== 'undefined') {
          localStorage.setItem('github_username', data.github_username);
          localStorage.setItem(`github_username_${userId}`, data.github_username);
        }
        return data;
      }
    } catch (err) {
      console.error('‚ùå AUTH: Profile fetch failed with exception:', err);

      // üö® CRITICAL FIX: Don't override existing profile on network/connection errors
      if (profile) {
        console.log('üîÑ AUTH: Network error, preserving existing profile with PAT');
        return profile; // Keep existing profile to preserve any PAT
      }

      // Only create basic profile if we have no existing profile at all
      const basicProfile = {
        id: userId,
        github_username: user?.user_metadata?.user_name || 'user',
        github_pat_token: null
      };
      setProfile(basicProfile);
      return basicProfile;
    }
  };

  // üîí CRITICAL FIX: Ensure loading is false when user is present
  useEffect(() => {
    if (user && loading) {
      console.log('üö® LOADING FIX: User detected but loading is true - fixing immediately');
      setLoading(false);
    }
  }, [user, loading]);

  // üîí SECURE USER-SPECIFIC DATA LOADING
  useEffect(() => {
    const loadUserSpecificData = async () => {
      // Only load data if user is authenticated
      if (!user) {
        // üîß CRITICAL FIX: On hard refresh, check for cached user data before user state is set
        if (typeof window !== 'undefined') {
          const cachedUserId = sessionStorage.getItem('current_user_id');
          if (cachedUserId) {
            console.log('üîÑ AUTH: Hard refresh detected, checking cached PAT for user:', cachedUserId);
            const cachedPAT = localStorage.getItem(`github_pat_token_${cachedUserId}`);
            if (cachedPAT && !cachedPAT.startsWith('gho_')) {
              console.log('‚úÖ AUTH: Found cached PAT after hard refresh, will restore when user loads');
              // PAT will be restored when user state is properly set
            }
          }
        }
        return;
      }

      console.log('üîß AUTH: Loading user-specific data for:', user.id);

      try {
        // Load user-specific cached data only
        let userSpecificToken = localStorage.getItem(`github_pat_token_${user.id}`);

        // üßπ MIGRATION: remove leftover OAuth token accidentally cached as PAT
        if (userSpecificToken?.startsWith('gho_')) {
          console.log('üßπ AUTH: Removing legacy cached OAuth token stored under github_pat_token key');
          localStorage.removeItem(`github_pat_token_${user.id}`);
          userSpecificToken = null;
        }

        if (userSpecificToken && !userSpecificToken.startsWith('gho_')) {
          // If the cached token differs from the profile value, sync it locally **and** persist it to the DB
          if (profile?.github_pat_token !== userSpecificToken) {
            console.log('‚úÖ AUTH: Found user-specific cached token, syncing to profile & DB');

            // 1Ô∏è‚É£ Update local React state so UI can immediately leverage the PAT
            setProfile(prev => (prev ? { ...prev, github_pat_token: userSpecificToken } : null));

            // 2Ô∏è‚É£ Persist token to Supabase in the background so it survives hard refreshes
            try {
              await supabase
                .from('user_profiles')
                .update({ github_pat_token: userSpecificToken, updated_at: new Date().toISOString() })
                .eq('id', user.id);
              console.log('‚úÖ AUTH: Cached PAT synced to database after hard refresh recovery');
            } catch (syncErr) {
              console.error('‚ùå AUTH: Failed to sync cached token to DB:', syncErr);
            }
          }
        }
      } catch (error) {
        console.log('üîç AUTH: No user-specific cached data found');
      }
    };

    loadUserSpecificData();
  }, [user, profile]);

  useEffect(() => {
    const initializeSession = async () => {
      try {
        console.log('üöÄ AUTH: INSTANT LOADING - Starting optimized initialization...');

        // üîß SIMPLIFIED: Detect and clear corrupted session state
        if (typeof window !== 'undefined') {
          const corruptionIndicators = [
            localStorage.getItem('github_pat_token') && !localStorage.getItem('github_repositories_time'),
            localStorage.getItem('temp_recovery_profile')
          ];

          if (corruptionIndicators.some(indicator => indicator)) {
            console.log('üßπ CORRUPTION DETECTED: Clearing potentially corrupted cache data');
            // Clear specific corrupted keys but preserve valid user-specific data
            localStorage.removeItem('github_pat_token');
            localStorage.removeItem('temp_recovery_profile');
          }
        }

        // üî• CRITICAL FIX: Handle OAuth callback tokens in URL FIRST
        if (typeof window !== 'undefined') {
          const hashParams = new URLSearchParams(window.location.hash.substring(1));
          const accessToken = hashParams.get('access_token');

          if (accessToken) {
            console.log('üéØ AUTH: OAuth tokens detected in URL, establishing session...');

            try {
              // Set the session using the tokens from URL
              const { data, error } = await supabase.auth.setSession({
                access_token: accessToken,
                refresh_token: hashParams.get('refresh_token') || '',
              });

              if (error) {
                console.error('‚ùå AUTH: Error setting session from OAuth tokens:', error);
              } else {
                console.log('‚úÖ AUTH: Session established from OAuth tokens');
                // Clean up URL immediately
                window.history.replaceState({}, '', window.location.pathname);
                // Set user immediately and exit
                if (data.session?.user) {
                  setUser(data.session.user);
                  setLoading(false);
                  console.log('‚úÖ AUTH: OAuth login complete - user must manually navigate');
                  // REMOVED: Automatic redirect - user must manually choose where to go
                  return;
                }
              }
            } catch (err) {
              console.error('‚ùå AUTH: OAuth session error:', err);
            }

            // Always set loading false after OAuth processing
            setLoading(false);
            return;
          }
          
          // üîß CRITICAL FIX: On hard refresh, attempt to recover cached PAT data
          console.log('üîç AUTH: Checking for cached PAT data after hard refresh...');
          const currentUserId = sessionStorage.getItem('current_user_id');
          if (currentUserId) {
            const cachedPAT = localStorage.getItem(`github_pat_token_${currentUserId}`);
            if (cachedPAT && !cachedPAT.startsWith('gho_')) {
              console.log('üîÑ AUTH: Found cached PAT for user after hard refresh, will sync to profile');
              // Note: Will be handled in loadUserSpecificData effect
            }
          }
        }

        // üîß CRITICAL FIX: Add retry mechanism for session loading to prevent intermittent failures
        let session = null;
        let sessionError = null;
        let retryCount = 0;
        const maxRetries = 3;

        while (retryCount < maxRetries && !session) {
          try {
            const { data, error } = await supabase.auth.getSession();
            session = data.session;
            sessionError = error;

            if (session || retryCount === maxRetries - 1) {
              break;
            }

            if (!session && retryCount < maxRetries - 1) {
              console.log(`üîÑ Session not found, retrying... (${retryCount + 1}/${maxRetries})`);
              await new Promise(resolve => setTimeout(resolve, 100)); // Wait 100ms before retry
            }
          } catch (err) {
            sessionError = err;
            console.error(`‚ùå Session check error (attempt ${retryCount + 1}):`, err);
          }
          retryCount++;
        }

        console.log('üîç Session check:', {
          session: !!session,
          user: !!session?.user,
          error: sessionError,
          retryCount
        });

        if (session?.user) {
          console.log('‚úÖ Setting user from session:', session.user.id);
          setUser(session.user);
          
          // üîß CRITICAL FIX: Store current user ID for hard refresh recovery
          if (typeof window !== 'undefined') {
            sessionStorage.setItem('current_user_id', session.user.id);
          }

           // üîß CRITICAL FIX: Only set loading false AFTER user is set
           // This prevents race condition where loading=false but user=null

           // üñë CRITICAL FIX: Check for provider token during initialization (not just auth state change)
           if (session.provider_token) {
             console.log('üéØ INIT: Provider token detected in session during initialization!', {
               hasProviderToken: !!session.provider_token,
               tokenLength: session.provider_token.length,
               provider: session.user?.app_metadata?.provider
             });

             // Store provider token for this user
             if (typeof window !== 'undefined') {
               localStorage.setItem(`oauth_provider_token_${session.user.id}`, session.provider_token);
               console.log('‚úÖ INIT: Provider token stored for user:', session.user.id);

               // üö® CRITICAL FIX: Use UPSERT to create/update profile with provider token
               try {
                 // Extract GitHub metadata for profile creation
                 const githubUsername = session.user.user_metadata?.user_name ||
                                      session.user.user_metadata?.preferred_username ||
                                      session.user.email?.split('@')[0] || 'user';
                 const githubId = session.user.user_metadata?.provider_id ||
                                session.user.identities?.find(i => i.provider === 'github')?.id;

                 const profileData = {
                   id: session.user.id,
                   github_username: githubUsername,
                   github_user_id: githubId,
                   display_name: session.user.user_metadata?.full_name ||
                                session.user.user_metadata?.name ||
                                githubUsername,
                   avatar_url: session.user.user_metadata?.avatar_url,
                   // Do not store OAuth provider token as PAT

                   updated_at: new Date().toISOString()
                 };

                 const { error } = await supabase
                   .from('user_profiles')
                   .upsert(profileData, { onConflict: 'id' });

                 if (error) {
                   console.error('‚ùå INIT: Failed to upsert profile with provider token:', error);
                 } else {
                   console.log('‚úÖ INIT: Profile created/updated with provider token for user:', session.user.id);
                   // üîß CRITICAL FIX: Set profile state immediately after successful UPSERT
                   setProfile(profileData);
                   console.log('‚úÖ INIT: Profile state updated with OAuth data');
                 }
               } catch (error) {
                 console.error('‚ùå INIT: Exception upserting profile with provider token:', error);
               }
             }
           }

           // üöÄ CRITICAL FIX: Await profile fetch to prevent race condition with UI rendering
           try {
             console.log('üîÑ INIT: Fetching profile before setting loading false...');
             const fetchedProfile = await fetchProfile(session.user.id);

             console.log('‚úÖ INIT: Profile loaded before clearing loading state:', {
               hasProfile: !!fetchedProfile,
               hasPAT: !!fetchedProfile?.github_pat_token
             });

             // Check if this is a GitHub OAuth user
             const isGitHubOAuth = session.user.app_metadata?.provider === 'github';

             // Also check for PAT cached in localStorage
             const cachedPatToken = typeof window !== 'undefined' ? localStorage.getItem(`github_pat_token_${session.user.id}`) : null;

             console.log('üîç INITIAL PAT POPUP DEBUG:', {
               isGitHubOAuth,
               profileToken: !!fetchedProfile?.github_pat_token,
               cachedPatToken: !!cachedPatToken,
               userId: session.user.id,
               profile: fetchedProfile
             });

             // Show PAT popup for GitHub OAuth users who don't have a token
             if (isGitHubOAuth && !fetchedProfile?.github_pat_token && !cachedPatToken && typeof window !== 'undefined') {
               const permanentlySkipped = localStorage.getItem(`token_popup_skipped_permanently_${session.user.id}`);

               console.log('üîç INITIAL PAT POPUP STORAGE DEBUG:', {
                 permanentlySkipped,
                 shouldShow: !permanentlySkipped
               });

               // Only show popup if user hasn't permanently skipped
               if (!permanentlySkipped) {
                 console.log('‚úÖ INITIAL PAT POPUP: Showing popup for GitHub OAuth user without token');
                 setShowTokenPopupState(true);
               } else {
                 console.log('‚ùå INITIAL PAT POPUP: User permanently skipped token setup');
               }
             } else {
               console.log('‚ùå INITIAL PAT POPUP: Not showing - either not GitHub OAuth or already has token');
             }

             // Now it's safe to clear loading since both user and profile are ready
             setLoading(false);
             console.log('‚úÖ AUTH: Loading cleared after both user and profile are ready');

           } catch (error) {
             console.error('‚ùå INIT: Profile fetch failed, but clearing loading anyway:', error);

             // Create basic profile as fallback
             const basicProfile = {
               id: session.user.id,
               github_username: session.user.user_metadata?.user_name || 'user',
               github_pat_token: null
             };
             setProfile(basicProfile);

             // Show popup for GitHub OAuth users even on profile fetch error
             const isGitHubOAuth = session.user.app_metadata?.provider === 'github';
             if (isGitHubOAuth && typeof window !== 'undefined') {
               const permanentlySkipped = localStorage.getItem(`token_popup_skipped_permanently_${session.user.id}`);
               if (!permanentlySkipped) {
                 console.log('‚úÖ FALLBACK PAT POPUP: Showing popup for GitHub OAuth user (profile fetch failed)');
                 setShowTokenPopupState(true);
               }
             }

             // Clear loading even if profile fetch fails
             setLoading(false);
             console.log('‚ö†Ô∏è AUTH: Loading cleared despite profile fetch failure');
           }
        } else if (session?.provider_token) {
          // We might need an extra round-trip to fetch the user object
          setAwaitingUserFetch(true);
          // üõ†Ô∏è NEW: Session has provider token but missing user object ‚Äì fetch user explicitly
          console.log('üßê AUTH: Provider token present but user missing ‚Äì fetching user data');
          try {
            const { data: userData, error: userError } = await supabase.auth.getUser();
            if (userError) {
              console.error('‚ùå AUTH: Failed to fetch user with provider token:', userError);
            }
            if (userData?.user) {
              setAwaitingUserFetch(false);
              console.log('‚úÖ AUTH: User fetched successfully via provider token:', userData.user.id);
              // Persist user & continue normal flow
              setUser(userData.user);
              // Ensure loading state resolves
              setLoading(false);

              // Trigger background profile load similar to normal path
              fetchProfile(userData.user.id).catch(err => {
                console.error('‚ùå Background profile fetch failed after provider-token user fetch:', err);
              });
            } else {
               console.log('‚ö†Ô∏è AUTH: getUser returned null ‚Äì attempting refreshSession()');
               try {
                 const { data: refreshData, error: refreshErr } = await supabase.auth.refreshSession();
                 if (refreshErr) {
                   console.error('‚ùå AUTH: refreshSession error:', refreshErr);
                 }
                 if (refreshData?.session?.user) {
                   console.log('‚úÖ AUTH: User obtained after refreshSession:', refreshData.session.user.id);
                   setUser(refreshData.session.user);
                   setAwaitingUserFetch(false);
                   setLoading(false);
                   // background profile
                   fetchProfile(refreshData.session.user.id).catch(err => console.error('profile fetch fail after refresh', err));
                 } else {
                   console.warn('‚ö†Ô∏è AUTH: refreshSession still no user');
                   setAwaitingUserFetch(false);
                   setUser(null);
                   setLoading(false);
                 }
               } catch (refreshEx) {
                 console.error('‚ùå AUTH: Exception during refreshSession():', refreshEx);
                 setAwaitingUserFetch(false);
                 setUser(null);
                 setLoading(false);
               }
            }
          } catch (fetchErr) {
            console.error('‚ùå AUTH: Exception during getUser():', fetchErr);
            setAwaitingUserFetch(false);
            setUser(null);
            setLoading(false);
          }
        } else {
          console.log('‚ùå No user in session');
          setUser(null);
        }

        // Only set loading false if no user was found (already set above if user exists)
        if (!session?.user) {
          console.log('‚ùå No user in session - setting loading false');
          setLoading(false);
        }
        console.log('‚úÖ AUTH: INSTANT initialization completed - UI ready!');
      } catch (err) {
        console.error('‚ùå AUTH: Session initialization error:', err);
        setUser(null); // Fallback to no user
        setLoading(false); // Ensure loading is false even on error
      }
    };

    initializeSession();

    const { data: { subscription } } = supabase.auth.onAuthStateChange(
      async (event, session) => {
        console.log("üîÑ AUTH: Auth state changed:", event);

        // üîß CRITICAL FIX: Only set loading to false after user state is properly updated
        // This prevents race condition where loading=false but user state is inconsistent

        // üîë CRITICAL: Capture provider token immediately after OAuth redirect
        let oauthProfileUpdated = false; // Track if we've updated profile via OAuth
        // üÜï Handle case: provider_token present without full user object (happens on fresh tab)
        if (session?.provider_token && !session?.user) {
          console.log('üßê AUTH: provider_token present but no user in INITIAL/LOGIN event ‚Äì fetching user');
          try {
            setAwaitingUserFetch(true);
            const { data: userResp, error: userErr } = await supabase.auth.getUser();
            if (userErr) {
              console.error('‚ùå AUTH: getUser failed inside auth state change:', userErr);
            }
            if (userResp?.user) {
              // Mutate session.user so downstream logic proceeds consistently
              // @ts-ignore
              session.user = userResp.user;
              console.log('‚úÖ AUTH: Fetched user via getUser during auth change');
            } else {
              console.warn('‚ö†Ô∏è AUTH: getUser returned null during auth change');
            }
          } finally {
            setAwaitingUserFetch(false);
          }
        }

        if (session && session.provider_token) {
           console.log('üéØ AUTH: Provider token detected in session!', {
             hasProviderToken: !!session.provider_token,
             tokenLength: session.provider_token.length,
             provider: session.user?.app_metadata?.provider
           });

           // Store provider token for this user
           if (session.user && typeof window !== 'undefined') {
             // üöë CRITICAL: Set user and clear loading IMMEDIATELY when we have a valid session
             setUser(session.user);
             setLoading(false);
             
              // üîß CRITICAL FIX: Store current user ID for hard refresh recovery
              sessionStorage.setItem('current_user_id', session.user.id);
              console.log('‚úÖ AUTH: User and loading state set immediately for provider token session');
            localStorage.setItem(`oauth_provider_token_${session.user.id}`, session.provider_token);
            console.log('‚úÖ AUTH: Provider token stored for user:', session.user.id);

            // üö® CRITICAL FIX: Use UPSERT to create/update profile with provider token
            try {

              // Extract GitHub metadata for profile creation
              const githubUsername = session.user.user_metadata?.user_name ||
                                   session.user.user_metadata?.preferred_username ||
                                   session.user.email?.split('@')[0] || 'user';
              const githubId = session.user.user_metadata?.provider_id ||
                             session.user.identities?.find(i => i.provider === 'github')?.id;

              const profileData = {
                id: session.user.id,
                github_username: githubUsername,
                github_user_id: githubId,
                display_name: session.user.user_metadata?.full_name ||
                             session.user.user_metadata?.name ||
                             githubUsername,
                avatar_url: session.user.user_metadata?.avatar_url,
                // Do not store OAuth provider token as PAT

                updated_at: new Date().toISOString()
              };

              const { error } = await supabase
                .from('user_profiles')
                .upsert(profileData, { onConflict: 'id' });

              if (error) {
                console.error('‚ùå AUTH: Failed to upsert profile with provider token:', error);
                // üîß FALLBACK: Set profile state even if UPSERT fails to prevent "No account" state
                setProfile(profileData);
                console.log('üîÑ AUTH: Profile state set as fallback despite UPSERT error');
              } else {
                console.log('‚úÖ AUTH: Profile created/updated with provider token for user:', session.user.id);
                // üîß CRITICAL FIX: Set profile state immediately after successful UPSERT
                setProfile(profileData);
                oauthProfileUpdated = true; // Mark that we've updated the profile
                console.log('‚úÖ AUTH: Profile state updated with OAuth data');
              }
            } catch (error) {
              console.error('‚ùå AUTH: Exception upserting profile with provider token:', error);
              // üîß FALLBACK: Create temporary profile state to prevent "No account" state
              const fallbackProfileData = {
                id: session.user.id,
                github_username: session.user.user_metadata?.user_name || 'user',
                // Do not store OAuth provider token as PAT

                display_name: session.user.user_metadata?.full_name || session.user.user_metadata?.user_name || 'User',
                avatar_url: session.user.user_metadata?.avatar_url
              };
              setProfile(fallbackProfileData);
              console.log('üîÑ AUTH: Fallback profile state created to prevent "No account" state');
            }
          }
        }

        // üîí SIMPLIFIED: Handle user changes without multi-account complexity
        if (session?.user && user && user.id !== session.user.id) {
          console.log("üîç AUTH: User change detected:", {
            previousUser: user.id,
            newUser: session.user.id,
            event: event
          });

          // Clear any cached profile data for the previous user
          setProfile(null);

          // üßπ SECURITY: Clear ALL user-specific data when user changes
          if (typeof window !== 'undefined') {
            // Clear previous user's data
            localStorage.removeItem(`token_popup_dismissed_${user.id}`);
            localStorage.removeItem(`token_popup_skipped_permanently_${user.id}`);
            localStorage.removeItem(`github_pat_token_${user.id}`);
            localStorage.removeItem(`oauth_provider_token_${user.id}`);
            localStorage.removeItem(`github_repositories_${user.id}`);
            localStorage.removeItem(`github_repositories_time_${user.id}`);

            // Clear global keys that might contain mixed data
            localStorage.removeItem('github_pat_token');
            localStorage.removeItem('oauth_provider_token');
            localStorage.removeItem('github_repositories');
            localStorage.removeItem('github_repositories_time');

            console.log("üßπ AUTH: Cleared previous user's cached data including OAuth tokens");
          }
        }

        // üöë User and loading state already set above if provider token exists
        // For non-provider-token sessions, set user and loading here
        if (!session?.provider_token) {
          setUser(session?.user ?? null);
          
          // üîß CRITICAL FIX: Store current user ID for hard refresh recovery
          if (session?.user && typeof window !== 'undefined') {
            sessionStorage.setItem('current_user_id', session.user.id);
          }
          
          setLoading(false);
          console.log('‚úÖ AUTH: User and loading set for non-provider session');
        }

        if (event === 'SIGNED_IN' && session?.user) {
          console.log("‚úÖ AUTH: User signed in - UI ready immediately");
          console.log("üîç AUTH: Loading state after SIGNED_IN:", false);
          console.log("üîç AUTH: New user details:", {
            userId: session.user.id,
            email: session.user.email,
            githubUsername: session.user.user_metadata?.user_name,
            provider: session.user.app_metadata?.provider
          });

          // REMOVED: No more sign-in timeouts - let the session persist naturally

          try {
            // Check if user signed in with GitHub OAuth
            const isGitHubOAuth = session.user.app_metadata?.provider === 'github';
            const githubId = session.user.user_metadata?.provider_id || session.user.identities?.find(i => i.provider === 'github')?.id;

            // üö® CRITICAL FIX: Multiple fallback methods to extract GitHub username
            const githubUsername = session.user.user_metadata?.user_name ||
                                 session.user.user_metadata?.preferred_username ||
                                 session.user.user_metadata?.login ||
                                 session.user.identities?.find(i => i.provider === 'github')?.identity_data?.login;

            console.log("üîç AUTH: GitHub OAuth details:", {
              isGitHubOAuth,
              githubId,
              githubUsername,
              hasProviderToken: !!session.provider_token,
              userMetadata: session.user.user_metadata,
              identities: session.user.identities
            });

            // üîß CRITICAL FIX: Enhanced GitHub username extraction with multiple fallbacks
            if (!githubUsername) {
              console.error("‚ùå AUTH: No GitHub username available for profile creation");
              console.error("‚ùå AUTH: Available user data:", {
                userMetadata: session.user.user_metadata,
                identities: session.user.identities,
                email: session.user.email
              });

              // üö® ENHANCED FALLBACK: Try multiple username sources
              const fallbackUsername = session.user.user_metadata?.login ||
                                     session.user.user_metadata?.name ||
                                     session.user.email?.split('@')[0] ||
                                     `user_${session.user.id.substring(0, 8)}`;

              if (fallbackUsername) {
                console.log("üîß AUTH: Using enhanced fallback username:", fallbackUsername);
                await createProfileWithUsername(session.user, fallbackUsername, githubId);
              } else {
                console.error("‚ùå AUTH: All fallback username methods failed");
                // Create basic profile to prevent "No account" state
                const basicProfile = {
                  id: session.user.id,
                  github_username: `user_${session.user.id.substring(0, 8)}`,
                  // Do not store OAuth provider token as PAT

                  display_name: session.user.email || 'User',
                  avatar_url: session.user.user_metadata?.avatar_url
                };
                setProfile(basicProfile);
                console.log("üîÑ AUTH: Created basic profile to prevent 'No account' state");
              }
              return;
            }

            const { data: existingProfile } = await supabase
              .from('user_profiles')
              .select('*')
              .eq('github_username', githubUsername)
              .single();

            console.log("üîç AUTH: Existing profile check:", {
              githubUsername,
              hasExistingProfile: !!existingProfile,
              existingProfileId: existingProfile?.id,
              currentUserId: session.user.id
            });

            if (existingProfile && existingProfile.id !== session.user.id) {
              console.log('üîß FIXING: Found existing profile with different user ID, updating...');
              // Update the existing profile to use the new user ID
              const { error: updateError } = await supabase
                .from('user_profiles')
                .update({
                  id: session.user.id,
                  github_user_id: githubId,
                  display_name: session.user.user_metadata?.full_name,
                  avatar_url: session.user.user_metadata?.avatar_url,
                  updated_at: new Date().toISOString(),
                })
                .eq('github_username', session.user.user_metadata?.user_name);

              if (updateError) {
                console.error('‚ùå Failed to update existing profile:', updateError);
              } else {
                console.log('‚úÖ Successfully linked to existing profile with token');
              }
            } else {
              // üö® SIMPLIFIED: Use helper method for profile creation
              console.log('üîß AUTH: Creating/updating profile for user:', githubUsername);
              await createProfileWithUsername(session.user, githubUsername, githubId);
            }

            console.log("‚úÖ AUTH: Profile linking completed");

            // üîß CRITICAL FIX: Only fetch profile if we haven't already updated it via OAuth
            let fetchedProfile;
            if (oauthProfileUpdated) {
              console.log('üîÑ AUTH: Skipping fetchProfile - already updated via OAuth');
              fetchedProfile = profile; // Use the profile we already set
            } else {
              fetchedProfile = await fetchProfile(session.user.id);
            }

            // Simplified PAT popup logic for GitHub OAuth users
            // Also check for PAT cached locally
            const cachedPatToken = typeof window !== 'undefined' ? localStorage.getItem(`github_pat_token_${session.user.id}`) : null;

            console.log('üîç PAT POPUP DEBUG:', {
              isGitHubOAuth,
              profileToken: !!fetchedProfile?.github_pat_token,
              cachedPatToken: !!cachedPatToken,
              userId: session.user.id,
              profile: fetchedProfile,
              oauthProfileUpdated
            });

            // üö® FIXED: Don't show PAT popup if user already has token
            if (isGitHubOAuth && (fetchedProfile?.github_pat_token || cachedPatToken)) {
              console.log('‚úÖ PAT POPUP: User has token, marking as permanently skipped');
              // Mark as permanently skipped since user already has token
              localStorage.setItem(`token_popup_skipped_permanently_${session.user.id}`, 'true');
            } else if (isGitHubOAuth && !fetchedProfile?.github_pat_token && !cachedPatToken) {
              const permanentlySkipped = localStorage.getItem(`token_popup_skipped_permanently_${session.user.id}`);

              console.log('üîç PAT POPUP STORAGE DEBUG:', {
                permanentlySkipped,
                shouldShow: !permanentlySkipped
              });

              // Only check if permanently skipped - remove complex timing logic
              if (!permanentlySkipped) {
                console.log('‚úÖ PAT POPUP: Showing popup for GitHub OAuth user without token');
                setShowTokenPopupState(true);
              } else {
                console.log('‚ùå PAT POPUP: User permanently skipped token setup');
              }
            } else {
              console.log('‚ùå PAT POPUP: Not showing - either not GitHub OAuth or already has token');
            }

            console.log("‚úÖ AUTH: Sign-in background process completed");
          } catch (error) {
            console.error("‚ùå AUTH: Sign-in background process error:", error);
            // Don't set loading false here - it's already set above
          }
        } else if (event === 'SIGNED_OUT') {
          console.log("üëã AUTH: User signed out");
          setProfile(null);
          
          // üîß CRITICAL FIX: Clear user ID from sessionStorage on sign out
          if (typeof window !== 'undefined') {
            sessionStorage.removeItem('current_user_id');
          }
        }
      }
    );

    return () => {
      subscription.unsubscribe();
    };
  }, []);

  const signOut = async () => {
    // Show confirmation dialog before signing out
    const confirmed = window.confirm(
      "Are you sure you want to sign out?\n\n" +
      "This will:\n" +
      "‚Ä¢ Sign you out from NeatRepo\n" +
      "‚Ä¢ Clear all saved data"
    );

    if (!confirmed) {
      return; // User cancelled
    }

    // Store user info before clearing for signout page
    const userInfo = {
      username: user?.user_metadata?.user_name || user?.user_metadata?.preferred_username || 'User',
      email: user?.email || '',
      avatar: user?.user_metadata?.avatar_url || ''
    };

    // Clear dismiss tracking on sign out so popup shows for next login
    if (user) {
      localStorage.removeItem(`token_popup_dismissed_${user.id}`);
      localStorage.removeItem(`token_popup_skipped_permanently_${user.id}`);
    }

    // Clear local state first
    setProfile(null);

    // üîí CRITICAL FIX: Complete session cleanup to prevent user mixing
    // Clear ALL user-specific data from localStorage
    if (typeof window !== 'undefined') {
      // Clear all localStorage data to prevent cross-user contamination
      localStorage.clear();
      sessionStorage.clear(); // This will also clear current_user_id

      // Also clear any IndexedDB or other storage that might cause conflicts
      try {
        if ('caches' in window) {
          caches.keys().then(names => {
            names.forEach(name => {
              caches.delete(name);
            });
          });
        }
      } catch (error) {
        console.log('Cache clearing failed:', error);
      }

      console.log("üßπ AUTH: Cleared all localStorage, sessionStorage, and caches");
    }

    // Sign out from Supabase with global scope to revoke OAuth tokens
    await supabase.auth.signOut({ scope: 'global' });

    // Redirect to our custom signout page
    const signoutUrl = new URL('/signout', window.location.origin);
    signoutUrl.searchParams.set('username', userInfo.username);
    signoutUrl.searchParams.set('email', userInfo.email);
    signoutUrl.searchParams.set('avatar', userInfo.avatar);

    window.location.href = signoutUrl.toString();
  };

// üîê SAVE GITHUB PAT (handles first-time users too)
const updateToken = async (token: string) => {
  console.log('üîç DEBUG: updateToken called with token:', token ? 'PRESENT' : 'MISSING');
  console.log('üîç DEBUG: Current user:', user ? user.id : 'NULL');
  console.log('üîç DEBUG: Current profile:', profile ? profile.id : 'NULL');
  
  if (!user) {
    console.warn('‚ö†Ô∏è AUTH: Tried to save PAT but user is null');
    return;
  }

  console.log('üíæ AUTH: Starting PAT save for user:', user.id);
  console.log('üîç DEBUG: User metadata:', user.user_metadata);
  setIsSubmitting(true);

  try {
    console.log('üîç DEBUG: Entering try block for PAT save');
    
    // üîê CRITICAL FIX: Validate token with GitHub API FIRST before saving
    console.log('üîç AUTH: Validating token with GitHub API...');
    try {
      const tokenTest = await fetch("https://api.github.com/user", {
        headers: {
          Authorization: `token ${token}`,
          Accept: "application/vnd.github.v3+json",
        },
      });

      if (!tokenTest.ok) {
        if (tokenTest.status === 401) {
          throw new Error('Invalid GitHub token - please check your token and try again');
        } else if (tokenTest.status === 403) {
          throw new Error('GitHub token lacks required permissions - please ensure your token has "repo" and "delete_repo" scopes');
        } else {
          throw new Error(`GitHub API validation failed with status ${tokenTest.status}`);
        }
      }

      const userData = await tokenTest.json();
      console.log('‚úÖ AUTH: Token validated successfully for user:', userData.login);
      
      // Also check token scopes
      const scopeCheck = await fetch("https://api.github.com", {
        method: 'HEAD',
        headers: {
          Authorization: `token ${token}`,
          Accept: "application/vnd.github.v3+json",
        },
      });
      
      const scopes = scopeCheck.headers.get('x-oauth-scopes') || '';
      console.log('üîê AUTH: Token scopes:', scopes);
      
      // Check for required scopes
      const requiredScopes = ['repo', 'delete_repo'];
      const hasRequiredScopes = requiredScopes.some(scope => scopes.includes(scope)) || scopes.includes('repo');
      
      if (!hasRequiredScopes) {
        console.warn('‚ö†Ô∏è AUTH: Token may lack required scopes for full functionality');
        // Don't block saving, but warn user
      }
      
    } catch (validationError) {
      console.error('‚ùå AUTH: Token validation failed:', validationError);
      throw validationError; // Re-throw to prevent saving invalid token
    }

    // Always ensure we have a profile row BEFORE trying to update
    if (!profile) {
      console.log('‚ÑπÔ∏è AUTH: No profile in state ‚Äì creating one first');
      const fallbackUsername =
        user.user_metadata?.user_name ||
        user.user_metadata?.preferred_username ||
        user.email?.split('@')[0] ||
        'user';
      
      console.log('üîç DEBUG: Creating profile with username:', fallbackUsername);
      const insertResult = await supabase
        .from('user_profiles')
        .insert({
          id: user.id,
          github_username: fallbackUsername,
          github_user_id: user.user_metadata?.user_id || null,
          display_name: user.user_metadata?.full_name || user.user_metadata?.name || fallbackUsername,
          updated_at: new Date().toISOString(),
        }, { returning: 'minimal' });
      
      console.log('üîç DEBUG: Profile insert result:', insertResult);
      if (insertResult.error) {
        console.error('‚ùå DEBUG: Profile insert failed:', insertResult.error);
      }
    }

    // 1Ô∏è‚É£ Fast-path update
    console.log('üîÑ AUTH: Attempting to update existing profile row with PAT');
    const { error: updateError } = await supabase
      .from('user_profiles')
      .update({ github_pat_token: token, updated_at: new Date().toISOString() })
      .eq('id', user.id);

    if (updateError) {
      console.error('‚ùå AUTH: Update error ‚Äì falling back to upsert', updateError);
      // Fallback upsert
      console.log('‚ûï AUTH: Performing upsert fallback');
      const upsertPayload: any = {
        id: user.id,
        github_pat_token: token,
        updated_at: new Date().toISOString(),
      };
      const { error: upsertError } = await supabase
        .from('user_profiles')
        .upsert(upsertPayload, {
          onConflict: 'id',
          returning: 'minimal',
        });
      if (upsertError) throw upsertError;
    }

    // Update local state & storage
    setProfile(prev => (
        prev
          ? { ...prev, github_pat_token: token }
          : {
              id: user.id,
              github_pat_token: token,
            } as any
      ));
    if (typeof window !== 'undefined') {
      localStorage.setItem(`github_pat_token_${user.id}`, token);
      localStorage.removeItem(`token_popup_dismissed_${user.id}`);
      localStorage.removeItem(`token_popup_skipped_permanently_${user.id}`);
      localStorage.removeItem('github_pat_token');
      console.log('üîë AUTH: Token stored in localStorage');

    }
    // Hide the PAT popup now that the token is saved (ensure this runs even in SSR)
    setShowTokenPopupState(false);

    console.log('‚úÖ AUTH: PAT saved and validated successfully');
  } catch (error) {
    console.error('‚ùå AUTH: Could not save PAT:', error);
    console.error('üîç DEBUG: Error type:', typeof error);
    console.error('üîç DEBUG: Error constructor:', error?.constructor?.name);
    console.error('üîç DEBUG: Error stack:', error?.stack);
    
    // Show user-friendly error message
    if (error instanceof Error) {
      alert(`Failed to save token: ${error.message}`);
    } else {
      alert('Failed to save token. Please check console for details and try again.');
    }
  } finally {
    console.log('üßπ AUTH: PAT save flow complete (resetting submitting state)');
    setIsSubmitting(false);
  }
};

  const deleteToken = async () => {
    if (!user) return;
    setIsSubmitting(true);
    try {
      const { error } = await supabase
        .from('user_profiles')
        .update({ github_pat_token: null, updated_at: new Date().toISOString() })
        .eq('id', user.id);

      if (error) throw error;

      setProfile(prev => (prev ? { ...prev, github_pat_token: null } : null));
      // Clear token from storage
      if (typeof window !== 'undefined') {
        localStorage.removeItem(`github_pat_token_${user.id}`);
        console.log('üîë AUTH: Token removed from local storage');
      }
    } catch (error) {
      console.error('Error deleting GitHub token:', error);
      alert('Failed to delete token. Please try again.');
    } finally {
      setIsSubmitting(false);
    }
  };

   const handleSkipToken = () => {
    if (user && typeof window !== 'undefined') {
      // Mark that user permanently skipped token setup - don't show popup again
      localStorage.setItem(`token_popup_skipped_permanently_${user.id}`, 'true');
    }
    setShowTokenPopupState(false);
};

  const handleTokenPopupClose = () => {
    if (user && typeof window !== 'undefined') {
      // Track that user dismissed popup - don't show again for 1 hour
      localStorage.setItem(`token_popup_dismissed_${user.id}`, Date.now().toString());
    }
    setShowTokenPopupState(false);
  };

  // Get effective token: PAT if available, otherwise OAuth token from session
  const getEffectiveToken = async (): Promise<string | null> => {
    // First priority: Personal Access Token from profile (for users who set up PAT)
    if (profile?.github_pat_token) {
      console.log('üîë Using PAT token from profile');
      return profile.github_pat_token;
    }

    // Second priority: OAuth provider token stored during auth flow
    if (user && typeof window !== 'undefined') {
      const oauthProviderToken = localStorage.getItem(`oauth_provider_token_${user.id}`);
      if (oauthProviderToken) {
        console.log('üîë Using stored OAuth provider token');
        return oauthProviderToken;
      }
    }

    // Third priority: User-specific cached token (legacy)
    if (user && typeof window !== 'undefined') {
      const userSpecificToken = localStorage.getItem(`github_pat_token_${user.id}`);
      if (userSpecificToken) {
        console.log('üîë Using user-specific cached token');
        return userSpecificToken;
      }
    }

    // Fourth priority: OAuth token from current session (fallback for immediate use)
    try {
      const { data: { session } } = await supabase.auth.getSession();
      console.log('üîç OAUTH DEBUG: Checking session for OAuth token...', {
        hasSession: !!session,
        hasUser: !!session?.user,
        provider: session?.user?.app_metadata?.provider,
        hasProviderToken: !!session?.provider_token,
        tokenLength: session?.provider_token?.length
      });

      // Check if this is a GitHub OAuth user with a valid provider token
      if (session?.provider_token && session?.user?.app_metadata?.provider === 'github') {
        console.log('üîë ‚úÖ Using OAuth token from session for repository access');

        // Store it for future use if not already stored
        if (user && typeof window !== 'undefined') {
          const existingToken = localStorage.getItem(`oauth_provider_token_${user.id}`);
          if (!existingToken) {
            localStorage.setItem(`oauth_provider_token_${user.id}`, session.provider_token);
            console.log('‚úÖ AUTH: Provider token stored from session for future use');
          }
        }

        return session.provider_token;
      }

      // If no provider token but user is GitHub OAuth user, they may need to re-authenticate
      if (session?.user?.app_metadata?.provider === 'github' && !session?.provider_token) {
        console.log('‚ö†Ô∏è GitHub OAuth user but no provider token - session may have expired');
        console.log('üí° User should re-authenticate or set up a Personal Access Token');
        return null;
      }
    } catch (error) {
      console.error('‚ùå Failed to get OAuth token from session:', error);
    }

    console.log('‚ùå No token available - user should authenticate or set up PAT');
    return null;
  };

  const value = {
    user,
    profile,
    loading,
    signOut,
    showTokenPopup: () => setShowTokenPopupState(true),
    hasToken: !!profile?.github_pat_token || (user && typeof window !== 'undefined' && !!localStorage.getItem(`oauth_provider_token_${user.id}`)),
    getEffectiveToken,
    updateToken,
    deleteToken,
  };

  return (
    <AuthContext.Provider value={value}>
      {showTokenPopupState && (
        <GitHubTokenPopup
          onTokenSubmit={updateToken}
          isSubmitting={isSubmitting}
          onClose={handleTokenPopupClose}
          onSkip={handleSkipToken}
        />
      )}
      {children}
    </AuthContext.Provider>
  );
}

</code>

components\dashboard-header.tsx:
<code>
"use client"

import { User, LogOut, Settings } from "lucide-react"
import { ThemeToggle } from "@/components/theme-toggle"
import { useTheme } from "next-themes"
import { Badge } from "@/components/ui/badge"
import { Button } from "@/components/ui/button"

import { useAuth } from "@/components/auth-provider"
import { useRouter } from "next/navigation"

export default function DashboardHeader() {
  const { user, profile, loading, signOut } = useAuth()
  const router = useRouter()
  const { theme } = useTheme()

  // Prefer avatar from profile, fallback to metadata
  const avatarSrc = profile?.avatar_url || user?.user_metadata?.avatar_url;

  const handleSignOut = async () => {
    await signOut();
    // Redirect is handled within the AuthProvider's signOut implementation
  }

  const handleSignIn = () => {
    window.location.href = '/'
  }

  const handleProfileSettings = () => {
    router.push('/profile')
  }

  return (
    <header className="border-b border-border bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 sticky top-0 z-50">
      <div className="container mx-auto px-4 py-3">
        <div className="flex items-center justify-between">
          {/* Logo & Brand */}
          <div className="flex items-center space-x-3">
            <img 
              src={theme === 'dark' ? '/logo-dark.png' : '/logo-light.png'}
              alt="NeatRepo Logo"
              className="h-8 w-8"
            />
            <div className="flex flex-col">
              <span className="text-xl font-bold">NeatRepo</span>
              <div className="flex items-center space-x-2">
                <Badge variant="secondary" className="text-xs">
                  Dashboard
                </Badge>
              </div>
            </div>
          </div>

          {/* Navigation Actions */}
          <div className="flex items-center space-x-4">
            <ThemeToggle />

            {/* User Menu with Profile Settings */}
            {user ? (
              <div className="flex items-center space-x-2">
                                {avatarSrc ? (
                  <img
                    src={avatarSrc}
                    alt={profile?.username || user?.user_metadata?.user_name || 'User'}
                    className="w-6 h-6 rounded-full"
                  />
                ) : (
                  <User className="w-4 h-4" />
                )}
                <span className="text-sm">
                  {profile?.username || user.email || 'User'}
                </span>
                <Button
                  variant="ghost"
                  size="icon"
                  onClick={handleProfileSettings}
                  disabled={loading}
                >
                  <Settings className="w-4 h-4" />
                </Button>
                <Button
                  variant="ghost"
                  size="icon"
                  onClick={handleSignOut}
                  disabled={loading}
                >
                  <LogOut className="w-4 h-4" />
                </Button>
              </div>
            ) : (
              <Button
                variant="ghost"
                onClick={handleSignIn}
                disabled={loading}
              >
                <User className="w-4 h-4 mr-2" />
                Sign In
              </Button>
            )}
          </div>
        </div>
      </div>
    </header>
  )
}

</code>

components\github-auth.tsx:
<code>
"use client"

import { useState } from "react"
import { Button } from "@/components/ui/button"
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"
import { Badge } from "@/components/ui/badge"
import { Alert, AlertDescription } from "@/components/ui/alert"
import { Github, Users, Zap, Shield, GitBranch, Star, X, AlertCircle } from "lucide-react"
import { supabase } from "@/lib/supabase"

interface GitHubAuthProps {
  onClose?: () => void
}

export default function GitHubAuth({ onClose }: GitHubAuthProps) {
  const [isLoading, setIsLoading] = useState(false)
  const [error, setError] = useState<string | null>(null)

  const handleGitHubSignIn = async () => {
    setIsLoading(true)
    setError(null)

    try {
      const { error } = await supabase.auth.signInWithOAuth({
        provider: 'github',
        options: {
          // Use custom OAuth callback route to handle session exchange server-side
          redirectTo: `${window.location.origin}/api/auth/callback?next=/dashboard`,
          scopes: 'repo read:user',
          queryParams: {
            access_type: 'offline',
            prompt: 'consent',
          }
        }
      })

      if (error) {
        throw error
      }
    } catch (err: any) {
      console.error('GitHub OAuth error:', err)
      setError(err.message || 'Failed to sign in with GitHub')
      setIsLoading(false)
    }
  }

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <Card className="w-full max-w-lg mx-auto">
        <CardHeader className="text-center">
          <div className="flex items-center justify-between">
            <div className="flex-1" />
            <Github className="h-10 w-10 text-primary" />
            {onClose && (
              <Button
                variant="ghost"
                size="sm"
                onClick={onClose}
                className="flex-shrink-0"
              >
                <X className="h-4 w-4" />
              </Button>
            )}
          </div>
          <CardTitle className="text-2xl">Welcome to NeatRepo</CardTitle>
          <CardDescription className="text-base">
            Professional GitHub Repository Management
          </CardDescription>
        </CardHeader>
        
        <CardContent className="space-y-6">
          {error && (
            <Alert variant="destructive">
              <AlertCircle className="h-4 w-4" />
              <AlertDescription>{error}</AlertDescription>
            </Alert>
          )}
          
          {/* Features Grid */}
          <div className="grid grid-cols-2 gap-4 text-sm">
            <div className="flex items-center space-x-3">
              <Zap className="h-4 w-4 text-yellow-500" />
              <span>Lightning Fast</span>
            </div>
            <div className="flex items-center space-x-3">
              <Shield className="h-4 w-4 text-green-500" />
              <span>Secure OAuth</span>
            </div>
            <div className="flex items-center space-x-3">
              <GitBranch className="h-4 w-4 text-purple-500" />
              <span>Bulk Operations</span>
            </div>
            <div className="flex items-center space-x-3">
              <Users className="h-4 w-4 text-yellow-500" />
              <span>Repository Management</span>
            </div>
          </div>

          {/* Professional Features Highlight */}
          <div className="bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-950/20 dark:to-purple-950/20 p-4 rounded-lg border">
            <div className="flex items-center space-x-2 mb-2">
              <Star className="h-4 w-4 text-yellow-500" />
              <span className="font-semibold text-sm">Professional Repository Management</span>
              <Badge variant="secondary" className="text-xs">Production Ready</Badge>
            </div>
            <p className="text-sm text-muted-foreground">
              Organize, manage, and optimize your GitHub repositories with powerful bulk operations and AI assistance.
            </p>
          </div>
          
          {/* Sign In Button */}
          <Button 
            onClick={handleGitHubSignIn}
            disabled={isLoading}
            className="w-full h-12 text-base"
            size="lg"
          >
            {isLoading ? (
              <>
                <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-3" />
                Connecting to GitHub...
              </>
            ) : (
              <>
                <Github className="h-5 w-5 mr-3" />
                Continue with GitHub
              </>
            )}
          </Button>
          
          {/* Benefits */}
          <div className="space-y-2 text-xs text-muted-foreground">
            <p className="flex items-center justify-center space-x-1">
              <Shield className="h-3 w-3" />
              <span>We only request necessary permissions</span>
            </p>
            <p className="flex items-center justify-center space-x-1">
              <Users className="h-3 w-3" />
              <span>Easy account switching ‚Ä¢ No email required</span>
            </p>
          </div>
        </CardContent>
      </Card>
    </div>
  )
}

</code>

components\github-connect-popup.tsx:
<code>
"use client"

import { useState } from "react"
import { Button } from "@/components/ui/button"
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"
import { Badge } from "@/components/ui/badge"
import { Github, Shield, Zap, X } from "lucide-react"
import { supabase } from "@/lib/supabase"

interface GitHubConnectPopupProps {
  onClose: () => void
  onSkip: () => void
  userEmail?: string
}

export default function GitHubConnectPopup({ onClose, onSkip, userEmail }: GitHubConnectPopupProps) {
  const [isConnecting, setIsConnecting] = useState(false)

  const handleConnectGitHub = async () => {
    setIsConnecting(true)
    
    try {
      const currentUrl = window.location.href
      const { error } = await supabase.auth.signInWithOAuth({
        provider: 'github',
        options: {
          redirectTo: currentUrl,
          scopes: 'repo read:user'
        }
      })
      
      if (error) {
        console.error('‚ùå GitHub OAuth failed:', error)
        setIsConnecting(false)
      }
    } catch (error) {
      console.error('‚ùå GitHub connection error:', error)
      setIsConnecting(false)
    }
  }

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <Card className="w-full max-w-md mx-auto">
        <CardHeader className="text-center">
          <div className="flex items-center justify-between">
            <div className="flex-1" />
            <Github className="h-8 w-8 text-primary" />
            <Button
              variant="ghost"
              size="sm"
              onClick={onClose}
              className="flex-shrink-0"
            >
              <X className="h-4 w-4" />
            </Button>
          </div>
          <CardTitle className="text-xl">Connect Your GitHub Account</CardTitle>
          <CardDescription>
            To access your repositories and use NeatRepo's features, please connect your GitHub account.
          </CardDescription>
        </CardHeader>
        
        <CardContent className="space-y-4">
          {userEmail && (
            <div className="bg-muted p-3 rounded-lg text-sm">
              <p className="text-muted-foreground">Currently signed in as:</p>
              <p className="font-medium">{userEmail}</p>
            </div>
          )}
          
          <div className="space-y-3">
            <div className="flex items-center space-x-3 text-sm">
              <Shield className="h-4 w-4 text-green-500" />
              <span>Secure OAuth authentication</span>
            </div>
            <div className="flex items-center space-x-3 text-sm">
              <Zap className="h-4 w-4 text-yellow-500" />
              <span>Access your repositories</span>
            </div>
            <div className="flex items-center space-x-3 text-sm">
              <Github className="h-4 w-4 text-purple-500" />
              <span>Manage repositories efficiently</span>
            </div>
          </div>
          
          <div className="space-y-3 pt-4">
            <Button 
              onClick={handleConnectGitHub}
              disabled={isConnecting}
              className="w-full"
              size="lg"
            >
              {isConnecting ? (
                <>
                  <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2" />
                  Connecting...
                </>
              ) : (
                <>
                  <Github className="h-4 w-4 mr-2" />
                  Connect GitHub Account
                </>
              )}
            </Button>
            
            <Button 
              variant="outline" 
              onClick={onSkip}
              className="w-full"
              disabled={isConnecting}
            >
              Skip for now
              <Badge variant="secondary" className="ml-2 text-xs">
                Limited features
              </Badge>
            </Button>
          </div>
          
          <p className="text-xs text-muted-foreground text-center">
            You can connect your GitHub account later from your profile settings.
          </p>
        </CardContent>
      </Card>
    </div>
  )
}

</code>

components\github-token-popup.tsx:
<code>
import React, { useState } from 'react';
import { GithubIcon, X, ExternalLink, AlertTriangle, CheckCircle } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { Badge } from '@/components/ui/badge';

interface GitHubTokenPopupProps {
  onTokenSubmit: (token: string) => void;
  isSubmitting: boolean;
  onClose: () => void;
  onSkip: () => void;
}

export default function GitHubTokenPopup({ onTokenSubmit, isSubmitting, onClose, onSkip }: GitHubTokenPopupProps) {
  const [token, setToken] = useState('');

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    if (token.trim()) {
      onTokenSubmit(token.trim());
    }
  };

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4">
      <div className="bg-background border rounded-lg shadow-lg max-w-lg w-full max-h-[90vh] overflow-y-auto relative">
        <Button
          variant="ghost"
          size="icon"
          onClick={onClose}
          className="absolute top-4 right-4 h-8 w-8"
        >
          <X className="h-4 w-4" />
        </Button>

        <div className="p-6">
          <div className="flex items-center gap-3 mb-6">
            <div className="p-2 bg-muted rounded-lg">
              <GithubIcon className="h-6 w-6" />
            </div>
            <div>
              <h2 className="text-xl font-semibold">Connect GitHub Account</h2>
              <p className="text-sm text-muted-foreground">Set up your Personal Access Token</p>
            </div>
          </div>
          <Alert className="mb-4">
            <AlertTriangle className="h-4 w-4" />
            <AlertDescription>
              <strong>Required Permissions:</strong> The following scopes are needed for full functionality.
            </AlertDescription>
          </Alert>

          <div className="grid grid-cols-2 gap-2 mb-4">
            <Badge variant="secondary" className="justify-center">
              <CheckCircle className="h-3 w-3 mr-1" />
              repo
            </Badge>
            <Badge variant="secondary" className="justify-center">
              <CheckCircle className="h-3 w-3 mr-1" />
              delete_repo
            </Badge>
            <Badge variant="secondary" className="justify-center">
              <CheckCircle className="h-3 w-3 mr-1" />
              admin:org
            </Badge>
            <Badge variant="secondary" className="justify-center">
              <CheckCircle className="h-3 w-3 mr-1" />
              user
            </Badge>
          </div>

          <div className="space-y-3 mb-6 text-sm text-muted-foreground">
            <div className="flex items-start gap-2">
              <span className="flex-shrink-0 w-5 h-5 bg-primary text-primary-foreground rounded-full flex items-center justify-center text-xs font-medium">1</span>
              <span>Click the button below to open GitHub token page</span>
            </div>
            <div className="flex items-start gap-2">
              <span className="flex-shrink-0 w-5 h-5 bg-primary text-primary-foreground rounded-full flex items-center justify-center text-xs font-medium">2</span>
              <span>Name your token "NeatRepo" in the Note field</span>
            </div>
            <div className="flex items-start gap-2">
              <span className="flex-shrink-0 w-5 h-5 bg-primary text-primary-foreground rounded-full flex items-center justify-center text-xs font-medium">3</span>
              <span>Select all 4 required scopes shown above</span>
            </div>
            <div className="flex items-start gap-2">
              <span className="flex-shrink-0 w-5 h-5 bg-primary text-primary-foreground rounded-full flex items-center justify-center text-xs font-medium">4</span>
              <span>Generate and copy the token</span>
            </div>
            <div className="flex items-start gap-2">
              <span className="flex-shrink-0 w-5 h-5 bg-primary text-primary-foreground rounded-full flex items-center justify-center text-xs font-medium">5</span>
              <span>Paste the token in the field below</span>
            </div>
          </div>
          <form onSubmit={handleSubmit} className="space-y-4">
            <div className="space-y-2">
              <Label htmlFor="github-token">GitHub Personal Access Token</Label>
              <Input
                id="github-token"
                type="password"
                value={token}
                onChange={(e) => setToken(e.target.value)}
                placeholder="ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
              />
            </div>

            <Button
              type="button"
              variant="outline"
              className="w-full"
              asChild
            >
              <a
                href="https://github.com/settings/tokens/new?scopes=repo,delete_repo,admin:org,user&description=NeatRepo%20-%20Full%20Access"
                target="_blank"
                rel="noopener noreferrer"
                className="flex items-center justify-center gap-2"
              >
                <ExternalLink className="h-4 w-4" />
                Open GitHub & Auto-Select Scopes
              </a>
            </Button>
            <div className="flex flex-col gap-2">
              <Button
                type="submit"
                disabled={isSubmitting || !token.trim()}
                className="w-full"
              >
                {isSubmitting ? 'Saving...' : 'Save and Continue'}
              </Button>

              <Button
                type="button"
                variant="ghost"
                onClick={onSkip}
                disabled={isSubmitting}
                className="w-full text-muted-foreground"
              >
                Skip for now (Limited functionality)
              </Button>
            </div>
          </form>
        </div>
      </div>
    </div>
  );
}

</code>

components\github-token-warning.tsx:
<code>
'use client'

import { useState } from 'react'
import { Alert, AlertDescription } from '@/components/ui/alert'
import { Button } from '@/components/ui/button'
import { Badge } from '@/components/ui/badge'
import { AlertTriangle, Github, X, Trash2, Zap } from 'lucide-react'

interface GitHubTokenWarningProps {
  onSetupToken: () => void
}

export default function GitHubTokenWarning({ onSetupToken }: GitHubTokenWarningProps) {
  const [isDismissed, setIsDismissed] = useState(false)

  if (isDismissed) {
    return null
  }

  return (
    <Alert className="border-yellow-200 bg-yellow-50 dark:bg-yellow-900/20 dark:border-yellow-800 mb-6">
      <AlertTriangle className="h-4 w-4 text-yellow-600" />
      <AlertDescription className="flex items-center justify-between w-full">
        <div className="flex-1 pr-4">
          <div className="flex items-center gap-2 mb-2">
            <span className="font-medium text-yellow-800 dark:text-yellow-200">
              GitHub Token Not Configured
            </span>
            <Badge variant="outline" className="text-xs border-yellow-300 text-yellow-700">
              Limited Features
            </Badge>
          </div>
          
          <p className="text-sm text-yellow-700 dark:text-yellow-300 mb-3">
            Some features are disabled without a GitHub token. Set up your token to unlock:
          </p>
          
          <div className="grid grid-cols-1 sm:grid-cols-2 gap-2 mb-3">
            <div className="flex items-center gap-2 text-xs text-yellow-700 dark:text-yellow-300">
              <Trash2 className="w-3 h-3" />
              <span>Bulk Delete Repositories</span>
            </div>
            <div className="flex items-center gap-2 text-xs text-yellow-700 dark:text-yellow-300">
              <Zap className="w-3 h-3" />
              <span>Advanced Repository Management</span>
            </div>
            <div className="flex items-center gap-2 text-xs text-yellow-700 dark:text-yellow-300">
              <Github className="w-3 h-3" />
              <span>Private Repository Access</span>
            </div>
            <div className="flex items-center gap-2 text-xs text-yellow-700 dark:text-yellow-300">
              <Zap className="w-3 h-3" />
              <span>Real-time Repository Sync</span>
            </div>
          </div>
          
          <div className="flex items-center gap-2">
            <Button 
              onClick={onSetupToken}
              size="sm" 
              className="bg-yellow-600 hover:bg-yellow-700 text-white"
            >
              <Github className="w-3 h-3 mr-1" />
              Setup GitHub Token
            </Button>
            <Button 
              onClick={() => setIsDismissed(true)}
              variant="ghost" 
              size="sm"
              className="text-yellow-700 hover:text-yellow-800 hover:bg-yellow-100 dark:text-yellow-300 dark:hover:text-yellow-200 dark:hover:bg-yellow-800/30"
            >
              Dismiss
            </Button>
          </div>
        </div>
        
        <Button
          onClick={() => setIsDismissed(true)}
          variant="ghost"
          size="sm"
          className="text-yellow-600 hover:text-yellow-700 hover:bg-yellow-100 dark:text-yellow-400 dark:hover:text-yellow-300 dark:hover:bg-yellow-800/30 p-1"
        >
          <X className="w-4 h-4" />
        </Button>
      </AlertDescription>
    </Alert>
  )
}

</code>

components\navigation-error-boundary.tsx:
<code>
'use client'

import React from 'react'
import { Button } from '@/components/ui/button'
import { Alert, AlertDescription } from '@/components/ui/alert'
import { RefreshCw, Home } from 'lucide-react'

interface NavigationErrorBoundaryState {
  hasError: boolean
  error?: Error
}

interface NavigationErrorBoundaryProps {
  children: React.ReactNode
}

export class NavigationErrorBoundary extends React.Component<
  NavigationErrorBoundaryProps,
  NavigationErrorBoundaryState
> {
  constructor(props: NavigationErrorBoundaryProps) {
    super(props)
    this.state = { hasError: false }
  }

  static getDerivedStateFromError(error: Error): NavigationErrorBoundaryState {
    return { hasError: true, error }
  }

  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {
    console.error('üö® Navigation Error Boundary caught an error:', error, errorInfo)
    
    // Send error details to console for debugging
    console.error('üîç Error Details:', {
      message: error.message,
      stack: error.stack,
      name: error.name,
      componentStack: errorInfo.componentStack,
      errorBoundary: errorInfo.errorBoundary,
      timestamp: new Date().toISOString(),
      userAgent: typeof window !== 'undefined' ? window.navigator.userAgent : 'server',
      url: typeof window !== 'undefined' ? window.location.href : 'unknown'
    })
  }

  handleRefresh = () => {
    // Clear any cached data that might be causing issues
    localStorage.removeItem('github_repositories')
    localStorage.removeItem('github_repositories_time')
    
    // Reset error state and reload
    this.setState({ hasError: false })
    window.location.reload()
  }

  handleGoHome = () => {
    // Clear cached data and go to home
    localStorage.removeItem('github_repositories')
    localStorage.removeItem('github_repositories_time')
    window.location.href = '/'
  }

  render() {
    if (this.state.hasError) {
      return (
        <div className="min-h-screen flex items-center justify-center p-4">
          <div className="max-w-md w-full space-y-4">
            <Alert variant="destructive">
              <AlertDescription>
                Something went wrong with navigation. This might be due to browser back/forward 
                navigation or a temporary issue.
              </AlertDescription>
            </Alert>
            
            <div className="space-y-2">
              <Button 
                onClick={this.handleRefresh} 
                className="w-full"
                variant="default"
              >
                <RefreshCw className="mr-2 h-4 w-4" />
                Refresh Page
              </Button>
              
              <Button 
                onClick={this.handleGoHome} 
                className="w-full"
                variant="outline"
              >
                <Home className="mr-2 h-4 w-4" />
                Go to Home
              </Button>
            </div>
            
            {process.env.NODE_ENV === 'development' && (
              <details className="text-xs text-muted-foreground">
                <summary>Error Details (Development)</summary>
                <pre className="mt-2 p-2 bg-muted rounded text-xs overflow-auto">
                  {this.state.error?.stack}
                </pre>
              </details>
            )}
          </div>
        </div>
      )
    }

    return this.props.children
  }
}

</code>

components\oauth-debug.tsx:
<code>
"use client"

import { useState } from "react"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Button } from "@/components/ui/button"
import { Badge } from "@/components/ui/badge"
import { supabase } from "@/lib/supabase"
import { AlertTriangle, CheckCircle, XCircle, RefreshCw } from "lucide-react"

export function OAuthDebug() {
  const [testResults, setTestResults] = useState<any>(null)
  const [isLoading, setIsLoading] = useState(false)

  const runDiagnostics = async () => {
    setIsLoading(true)
    const results: any = {
      timestamp: new Date().toISOString(),
      tests: {},
    }

    try {
      // Test 1: Environment Variables
      results.tests.envVars = {
        name: "Environment Variables",
        status: "success",
        details: {
          supabaseUrl: !!process.env.NEXT_PUBLIC_SUPABASE_URL,
          supabaseKey: !!process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,
          urlValue: process.env.NEXT_PUBLIC_SUPABASE_URL?.substring(0, 20) + "...",
        },
      }

      // Test 2: Supabase Connection
      try {
        const { data, error } = await supabase.auth.getSession()
        results.tests.supabaseConnection = {
          name: "Supabase Connection",
          status: error ? "error" : "success",
          details: {
            connected: !error,
            session: !!data.session,
            error: error?.message,
          },
        }
      } catch (err) {
        results.tests.supabaseConnection = {
          name: "Supabase Connection",
          status: "error",
          details: { error: err instanceof Error ? err.message : "Unknown error" },
        }
      }

      // Test 3: GitHub OAuth Configuration
      try {
        // This will fail but we can catch the error to see if OAuth is configured
        await supabase.auth.signInWithOAuth({
          provider: "github",
          options: { redirectTo: "test" },
        })
      } catch (err: any) {
        results.tests.githubOAuth = {
          name: "GitHub OAuth Setup",
          status: err.message?.includes("not enabled") ? "error" : "warning",
          details: {
            configured: !err.message?.includes("not enabled"),
            error: err.message,
          },
        }
      }

      // Test 4: Network Connectivity
      try {
        const response = await fetch("https://api.github.com/", { method: "HEAD" })
        results.tests.networkConnectivity = {
          name: "Network Connectivity",
          status: response.ok ? "success" : "error",
          details: {
            githubApi: response.ok,
            status: response.status,
          },
        }
      } catch (err) {
        results.tests.networkConnectivity = {
          name: "Network Connectivity",
          status: "error",
          details: { error: err instanceof Error ? err.message : "Network error" },
        }
      }

      // Test 5: Browser Environment
      results.tests.browserEnv = {
        name: "Browser Environment",
        status: "success",
        details: {
          localStorage: typeof localStorage !== "undefined",
          sessionStorage: typeof sessionStorage !== "undefined",
          cookies: typeof document !== "undefined" && document.cookie !== undefined,
          https: window.location.protocol === "https:" || window.location.hostname === "localhost",
        },
      }

      setTestResults(results)
    } catch (error) {
      console.error("Diagnostics error:", error)
      results.tests.diagnosticsError = {
        name: "Diagnostics Error",
        status: "error",
        details: { error: error instanceof Error ? error.message : "Unknown error" },
      }
      setTestResults(results)
    } finally {
      setIsLoading(false)
    }
  }

  const getStatusIcon = (status: string) => {
    switch (status) {
      case "success":
        return <CheckCircle className="h-4 w-4 text-green-400" />
      case "warning":
        return <AlertTriangle className="h-4 w-4 text-yellow-400" />
      case "error":
        return <XCircle className="h-4 w-4 text-red-400" />
      default:
        return <RefreshCw className="h-4 w-4 text-gray-400" />
    }
  }

  const getStatusColor = (status: string) => {
    switch (status) {
      case "success":
        return "border-green-500/50 bg-green-900/20"
      case "warning":
        return "border-yellow-500/50 bg-yellow-900/20"
      case "error":
        return "border-red-500/50 bg-red-900/20"
      default:
        return "border-gray-500/50 bg-gray-900/20"
    }
  }

  return (
    <Card className="bg-gray-800/30 border-gray-700/50">
      <CardHeader>
        <CardTitle className="flex items-center gap-2">
          <AlertTriangle className="h-5 w-5 text-yellow-400" />
          OAuth Diagnostics
        </CardTitle>
      </CardHeader>
      <CardContent className="space-y-4">
        <Button onClick={runDiagnostics} disabled={isLoading} className="w-full">
          {isLoading ? (
            <>
              <RefreshCw className="h-4 w-4 mr-2 animate-spin" />
              Running Diagnostics...
            </>
          ) : (
            "Run OAuth Diagnostics"
          )}
        </Button>

        {testResults && (
          <div className="space-y-3">
            <div className="text-sm text-gray-400">Last run: {new Date(testResults.timestamp).toLocaleString()}</div>

            {Object.entries(testResults.tests).map(([key, test]: [string, any]) => (
              <Card key={key} className={`${getStatusColor(test.status)} border`}>
                <CardContent className="p-4">
                  <div className="flex items-center justify-between mb-2">
                    <h4 className="font-semibold flex items-center gap-2">
                      {getStatusIcon(test.status)}
                      {test.name}
                    </h4>
                    <Badge variant={test.status === "success" ? "default" : "destructive"}>
                      {test.status.toUpperCase()}
                    </Badge>
                  </div>
                  <div className="text-sm space-y-1">
                    {Object.entries(test.details).map(([detailKey, value]: [string, any]) => (
                      <div key={detailKey} className="flex justify-between">
                        <span className="text-gray-400">{detailKey}:</span>
                        <span className={typeof value === "boolean" ? (value ? "text-green-400" : "text-red-400") : ""}>
                          {typeof value === "boolean" ? (value ? "‚úÖ" : "‚ùå") : String(value)}
                        </span>
                      </div>
                    ))}
                  </div>
                </CardContent>
              </Card>
            ))}
          </div>
        )}
      </CardContent>
    </Card>
  )
}

</code>

components\theme-provider.tsx:
<code>
"use client"
import { ThemeProvider as NextThemesProvider } from "next-themes"
import type { ThemeProviderProps } from "next-themes"

export function ThemeProvider({ children, ...props }: ThemeProviderProps) {
  return (
    <NextThemesProvider attribute="class" defaultTheme="dark" enableSystem={false} {...props}>
      {children}
    </NextThemesProvider>
  )
}

</code>

components\theme-toggle.tsx:
<code>
"use client"
import { Moon, Sun } from "lucide-react"
import { useTheme } from "next-themes"

import { Button } from "@/components/ui/button"

export function ThemeToggle() {
  const { theme, setTheme } = useTheme()

  return (
    <Button
      variant="ghost"
      size="sm"
      onClick={() => setTheme(theme === "light" ? "dark" : "light")}
      className="text-gray-400 hover:text-white dark:text-gray-400 dark:hover:text-white"
    >
      <Sun className="h-4 w-4 rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0" />
      <Moon className="absolute h-4 w-4 rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100" />
      <span className="sr-only">Toggle theme</span>
    </Button>
  )
}

</code>

components\token-management.tsx:
<code>
import React, { useState } from 'react';
import { Settings, Trash2, Plus, AlertTriangle, CheckCircle, ExternalLink } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Alert, AlertDescription } from '@/components/ui/alert';
import GitHubTokenPopup from './github-token-popup';

interface TokenManagementProps {
  currentToken?: string;
  onTokenUpdate: (token: string) => void;
  onTokenDelete: () => void;
}

export default function TokenManagement({ currentToken, onTokenUpdate, onTokenDelete }: TokenManagementProps) {
  const [showTokenPopup, setShowTokenPopup] = useState(false);
  const [isDeleting, setIsDeleting] = useState(false);
  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);

  const handleDeleteToken = async () => {
    setIsDeleting(true);
    try {
      await onTokenDelete();
      setShowDeleteConfirm(false);
    } catch (error) {
      console.error('Error deleting token:', error);
    } finally {
      setIsDeleting(false);
    }
  };

  const handleTokenSubmit = async (token: string) => {
    setIsSubmitting(true);
    try {
      await onTokenUpdate(token);
      setShowTokenPopup(false);
    } catch (error) {
      console.error('Error updating token:', error);
    } finally {
      setIsSubmitting(false);
    }
  };

  const maskedToken = currentToken ? `${currentToken.substring(0, 8)}${'*'.repeat(32)}` : 'No token set';

  return (
    <>
      <Card className="w-full max-w-2xl">
        <CardHeader>
          <div className="flex items-center gap-2">
            <Settings className="h-5 w-5" />
            <CardTitle>GitHub Token Management</CardTitle>
          </div>
          <CardDescription>
            Manage your GitHub Personal Access Token for repository operations
          </CardDescription>
        </CardHeader>
        <CardContent className="space-y-6">
          {/* Current Token Status */}
          <div className="space-y-3">
            <h3 className="font-medium">Current Token Status</h3>
            <div className="flex items-center justify-between p-3 bg-muted rounded-lg">
              <div className="flex items-center gap-3">
                {currentToken ? (
                  <CheckCircle className="h-5 w-5 text-green-500" />
                ) : (
                  <AlertTriangle className="h-5 w-5 text-yellow-500" />
                )}
                <div>
                  <p className="font-mono text-sm">{maskedToken}</p>
                  <p className="text-xs text-muted-foreground">
                    {currentToken ? 'Token is active' : 'No token configured'}
                  </p>
                </div>
              </div>
              {currentToken && (
                <Button
                  variant="destructive"
                  size="sm"
                  onClick={() => setShowDeleteConfirm(true)}
                  disabled={isDeleting}
                >
                  <Trash2 className="h-4 w-4 mr-2" />
                  Delete
                </Button>
              )}
            </div>
          </div>

          {/* Token Permissions Check */}
          {currentToken && (
            <Alert>
              <AlertTriangle className="h-4 w-4" />
              <AlertDescription>
                <strong>Having issues with delete functionality?</strong> Your token might be missing required scopes. 
                Generate a new token with all required permissions.
              </AlertDescription>
            </Alert>
          )}

          {/* Action Buttons */}
          <div className="flex gap-3">
            <Button
              onClick={() => setShowTokenPopup(true)}
              className="flex-1"
              variant={currentToken ? "outline" : "default"}
            >
              <Plus className="h-4 w-4 mr-2" />
              {currentToken ? 'Update Token' : 'Add Token'}
            </Button>
            
            <Button
              variant="outline"
              onClick={() => window.open('https://github.com/settings/tokens', '_blank')}
            >
              <ExternalLink className="h-4 w-4 mr-2" />
              GitHub Settings
            </Button>
          </div>

          {/* Help Section */}
          <div className="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4">
            <h4 className="font-medium text-yellow-800 dark:text-yellow-200 mb-2">
              üîß Token Issues? Common Solutions:
            </h4>
            <ul className="text-sm text-yellow-700 dark:text-yellow-300 space-y-1">
              <li>‚Ä¢ <strong>Lost access after system update?</strong> Recent authentication improvements may require re-entering your PAT</li>
              <li>‚Ä¢ <strong>Delete not working?</strong> Generate new token with all 4 scopes</li>
              <li>‚Ä¢ <strong>Wrong scopes selected?</strong> Delete current token and create new one</li>
              <li>‚Ä¢ <strong>Token expired?</strong> GitHub tokens can expire, create a fresh one</li>
              <li>‚Ä¢ <strong>Permission denied?</strong> Make sure you have admin access to repositories</li>
            </ul>
          </div>

          {/* Recovery Notice */}
          {!currentToken && (
            <Alert className="border-amber-200 bg-amber-50 dark:bg-amber-900/20">
              <AlertTriangle className="h-4 w-4 text-amber-600" />
              <AlertDescription className="text-amber-800 dark:text-amber-200">
                <strong>Need to re-enter your PAT?</strong> Recent system improvements may have reset authentication settings.
                This is a one-time setup to restore your repository access. Your data is safe and secure.
              </AlertDescription>
            </Alert>
          )}
        </CardContent>
      </Card>

      {/* Delete Confirmation Dialog */}
      {showDeleteConfirm && (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm">
          <div className="bg-card text-card-foreground rounded-lg shadow-lg p-6 max-w-md w-full mx-4">
            <div className="flex items-center gap-3 mb-4">
              <AlertTriangle className="h-6 w-6 text-red-500" />
              <h3 className="text-lg font-semibold">Delete GitHub Token</h3>
            </div>
            <p className="text-muted-foreground mb-6">
              Are you sure you want to delete your GitHub token? You'll need to add a new one to continue using repository features.
            </p>
            <div className="flex gap-3">
              <Button
                variant="outline"
                onClick={() => setShowDeleteConfirm(false)}
                className="flex-1"
              >
                Cancel
              </Button>
              <Button
                variant="destructive"
                onClick={handleDeleteToken}
                disabled={isDeleting}
                className="flex-1"
              >
                {isDeleting ? 'Deleting...' : 'Delete Token'}
              </Button>
            </div>
          </div>
        </div>
      )}

      {/* Token Popup */}
      {showTokenPopup && (
        <GitHubTokenPopup
          onTokenSubmit={handleTokenSubmit}
          isSubmitting={isSubmitting}
          onClose={() => setShowTokenPopup(false)}
          onSkip={() => setShowTokenPopup(false)}
        />
      )}
    </>
  );
}

</code>

components\token-warning-badge.tsx:
<code>
'use client'

import React from 'react'
import { AlertTriangle, Settings } from 'lucide-react'
import { useAuth } from '@/components/auth-provider'

export default function TokenWarningBadge() {
  const { hasToken, showTokenPopup } = useAuth()

  // Don't show if user has token
  if (hasToken) return null

  return (
    <div className="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-3 mb-4">
      <div className="flex items-start gap-3">
        <AlertTriangle className="h-5 w-5 text-yellow-600 dark:text-yellow-400 flex-shrink-0 mt-0.5" />
        <div className="flex-1">
          <h3 className="font-semibold text-yellow-800 dark:text-yellow-200 text-sm mb-1">
            GitHub Token Not Configured
          </h3>
          <p className="text-yellow-700 dark:text-yellow-300 text-xs mb-3">
            Some features like <strong>bulk delete</strong>, <strong>repository creation</strong>, and <strong>advanced operations</strong> will not function properly without a GitHub Personal Access Token.
          </p>
          <button
            onClick={showTokenPopup}
            className="inline-flex items-center gap-2 bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-1.5 rounded-md text-xs font-medium transition-colors"
          >
            <Settings className="h-3 w-3" />
            Configure Token Now
          </button>
        </div>
      </div>
    </div>
  )
}

</code>

context7\src\lib\api.ts:
<code>
import { SearchResponse } from "./types.js";
import { generateHeaders } from "./encryption.js";

const CONTEXT7_API_BASE_URL = "https://context7.com/api";
const DEFAULT_TYPE = "txt";

/**
 * Searches for libraries matching the given query
 * @param query The search query
 * @param clientIp Optional client IP address to include in headers
 * @returns Search results or null if the request fails
 */
export async function searchLibraries(query: string, clientIp?: string): Promise<SearchResponse> {
  try {
    const url = new URL(`${CONTEXT7_API_BASE_URL}/v1/search`);
    url.searchParams.set("query", query);

    const headers = generateHeaders(clientIp);

    const response = await fetch(url, { headers });
    if (!response.ok) {
      const errorCode = response.status;
      if (errorCode === 429) {
        console.error(`Rate limited due to too many requests. Please try again later.`);
        return {
          results: [],
          error: `Rate limited due to too many requests. Please try again later.`,
        } as SearchResponse;
      }
      console.error(`Failed to search libraries. Please try again later. Error code: ${errorCode}`);
      return {
        results: [],
        error: `Failed to search libraries. Please try again later. Error code: ${errorCode}`,
      } as SearchResponse;
    }
    return await response.json();
  } catch (error) {
    console.error("Error searching libraries:", error);
    return { results: [], error: `Error searching libraries: ${error}` } as SearchResponse;
  }
}

/**
 * Fetches documentation context for a specific library
 * @param libraryId The library ID to fetch documentation for
 * @param options Options for the request
 * @param clientIp Optional client IP address to include in headers
 * @returns The documentation text or null if the request fails
 */
export async function fetchLibraryDocumentation(
  libraryId: string,
  options: {
    tokens?: number;
    topic?: string;
  } = {},
  clientIp?: string
): Promise<string | null> {
  try {
    if (libraryId.startsWith("/")) {
      libraryId = libraryId.slice(1);
    }
    const url = new URL(`${CONTEXT7_API_BASE_URL}/v1/${libraryId}`);
    if (options.tokens) url.searchParams.set("tokens", options.tokens.toString());
    if (options.topic) url.searchParams.set("topic", options.topic);
    url.searchParams.set("type", DEFAULT_TYPE);

    const headers = generateHeaders(clientIp, { "X-Context7-Source": "mcp-server" });

    const response = await fetch(url, { headers });
    if (!response.ok) {
      const errorCode = response.status;
      if (errorCode === 429) {
        const errorMessage = `Rate limited due to too many requests. Please try again later.`;
        console.error(errorMessage);
        return errorMessage;
      }
      const errorMessage = `Failed to fetch documentation. Please try again later. Error code: ${errorCode}`;
      console.error(errorMessage);
      return errorMessage;
    }
    const text = await response.text();
    if (!text || text === "No content available" || text === "No context data available") {
      return null;
    }
    return text;
  } catch (error) {
    const errorMessage = `Error fetching library documentation. Please try again later. ${error}`;
    console.error(errorMessage);
    return errorMessage;
  }
}

</code>

context7\src\lib\encryption.ts:
<code>
import { createCipheriv, randomBytes } from "crypto";

export const ENCRYPTION_KEY =
  process.env.CLIENT_IP_ENCRYPTION_KEY ||
  "000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f";
export const ALGORITHM = "aes-256-cbc";

export function validateEncryptionKey(key: string): boolean {
  // Must be exactly 64 hex characters (32 bytes)
  return /^[0-9a-fA-F]{64}$/.test(key);
}

export function encryptClientIp(clientIp: string): string {
  if (!validateEncryptionKey(ENCRYPTION_KEY)) {
    console.error("Invalid encryption key format. Must be 64 hex characters.");
    return clientIp; // Fallback to unencrypted
  }

  try {
    const iv = randomBytes(16);
    const cipher = createCipheriv(ALGORITHM, Buffer.from(ENCRYPTION_KEY, "hex"), iv);
    let encrypted = cipher.update(clientIp, "utf8", "hex");
    encrypted += cipher.final("hex");
    return iv.toString("hex") + ":" + encrypted;
  } catch (error) {
    console.error("Error encrypting client IP:", error);
    return clientIp; // Fallback to unencrypted
  }
}

export function generateHeaders(
  clientIp?: string,
  extraHeaders: Record<string, string> = {}
): Record<string, string> {
  const headers: Record<string, string> = { ...extraHeaders };
  if (clientIp) {
    headers["mcp-client-ip"] = encryptClientIp(clientIp);
  }
  return headers;
}

</code>

context7\src\lib\types.ts:
<code>
export interface SearchResult {
  id: string;
  title: string;
  description: string;
  branch: string;
  lastUpdateDate: string;
  state: DocumentState;
  totalTokens: number;
  totalSnippets: number;
  totalPages: number;
  stars?: number;
  trustScore?: number;
  versions?: string[];
}

export interface SearchResponse {
  error?: string;
  results: SearchResult[];
}

// Version state is still needed for validating search results
export type DocumentState = "initial" | "finalized" | "error" | "delete";

</code>

context7\src\lib\utils.ts:
<code>
import { SearchResponse, SearchResult } from "./types.js";

/**
 * Formats a search result into a human-readable string representation.
 * Only shows code snippet count and GitHub stars when available (not equal to -1).
 *
 * @param result The SearchResult object to format
 * @returns A formatted string with library information
 */
export function formatSearchResult(result: SearchResult): string {
  // Always include these basic details
  const formattedResult = [
    `- Title: ${result.title}`,
    `- Context7-compatible library ID: ${result.id}`,
    `- Description: ${result.description}`,
  ];

  // Only add code snippets count if it's a valid value
  if (result.totalSnippets !== -1 && result.totalSnippets !== undefined) {
    formattedResult.push(`- Code Snippets: ${result.totalSnippets}`);
  }

  // Only add trust score if it's a valid value
  if (result.trustScore !== -1 && result.trustScore !== undefined) {
    formattedResult.push(`- Trust Score: ${result.trustScore}`);
  }

  // Only add versions if it's a valid value
  if (result.versions !== undefined && result.versions.length > 0) {
    formattedResult.push(`- Versions: ${result.versions.join(", ")}`);
  }

  // Join all parts with newlines
  return formattedResult.join("\n");
}

/**
 * Formats a search response into a human-readable string representation.
 * Each result is formatted using formatSearchResult.
 *
 * @param searchResponse The SearchResponse object to format
 * @returns A formatted string with search results
 */
export function formatSearchResults(searchResponse: SearchResponse): string {
  if (!searchResponse.results || searchResponse.results.length === 0) {
    return "No documentation libraries found matching your query.";
  }

  const formattedResults = searchResponse.results.map(formatSearchResult);
  return formattedResults.join("\n----------\n");
}

</code>

context7\src\index.ts:
<code>
#!/usr/bin/env node

import { McpServer } from "@modelcontextprotocol/sdk/server/mcp.js";
import { StdioServerTransport } from "@modelcontextprotocol/sdk/server/stdio.js";
import { z } from "zod";
import { searchLibraries, fetchLibraryDocumentation } from "./lib/api.js";
import { formatSearchResults } from "./lib/utils.js";
import { SearchResponse } from "./lib/types.js";
import { createServer } from "http";
import { StreamableHTTPServerTransport } from "@modelcontextprotocol/sdk/server/streamableHttp.js";
import { SSEServerTransport } from "@modelcontextprotocol/sdk/server/sse.js";
import { Command } from "commander";
import { IncomingMessage } from "http";

const DEFAULT_MINIMUM_TOKENS = 10000;

// Parse CLI arguments using commander
const program = new Command()
  .option("--transport <stdio|http|sse>", "transport type", "stdio")
  .option("--port <number>", "port for HTTP/SSE transport", "3000")
  .allowUnknownOption() // let MCP Inspector / other wrappers pass through extra flags
  .parse(process.argv);

const cliOptions = program.opts<{
  transport: string;
  port: string;
}>();

// Validate transport option
const allowedTransports = ["stdio", "http", "sse"];
if (!allowedTransports.includes(cliOptions.transport)) {
  console.error(
    `Invalid --transport value: '${cliOptions.transport}'. Must be one of: stdio, http, sse.`
  );
  process.exit(1);
}

// Transport configuration
const TRANSPORT_TYPE = (cliOptions.transport || "stdio") as "stdio" | "http" | "sse";

// HTTP/SSE port configuration
const CLI_PORT = (() => {
  const parsed = parseInt(cliOptions.port, 10);
  return isNaN(parsed) ? undefined : parsed;
})();

// Store SSE transports by session ID
const sseTransports: Record<string, SSEServerTransport> = {};

function getClientIp(req: IncomingMessage): string | undefined {
  // Check for X-Forwarded-For header (set by AWS ELB and other load balancers)
  const forwardedFor = req.headers["x-forwarded-for"];
  if (forwardedFor) {
    // X-Forwarded-For can contain multiple IPs, take the first one
    const ips = Array.isArray(forwardedFor) ? forwardedFor[0] : forwardedFor;
    return ips.split(",")[0].trim();
  }

  // Fall back to socket remote address
  return req.socket?.remoteAddress || undefined;
}

// Function to create a new server instance with all tools registered
function createServerInstance(clientIp?: string) {
  const server = new McpServer(
    {
      name: "Context7",
      version: "1.0.13",
    },
    {
      instructions:
        "Use this server to retrieve up-to-date documentation and code examples for any library.",
    }
  );

  // Register Context7 tools
  server.tool(
    "resolve-library-id",
    `Resolves a package/product name to a Context7-compatible library ID and returns a list of matching libraries.

You MUST call this function before 'get-library-docs' to obtain a valid Context7-compatible library ID UNLESS the user explicitly provides a library ID in the format '/org/project' or '/org/project/version' in their query.

Selection Process:
1. Analyze the query to understand what library/package the user is looking for
2. Return the most relevant match based on:
- Name similarity to the query (exact matches prioritized)
- Description relevance to the query's intent
- Documentation coverage (prioritize libraries with higher Code Snippet counts)
- Trust score (consider libraries with scores of 7-10 more authoritative)

Response Format:
- Return the selected library ID in a clearly marked section
- Provide a brief explanation for why this library was chosen
- If multiple good matches exist, acknowledge this but proceed with the most relevant one
- If no good matches exist, clearly state this and suggest query refinements

For ambiguous queries, request clarification before proceeding with a best-guess match.`,
    {
      libraryName: z
        .string()
        .describe("Library name to search for and retrieve a Context7-compatible library ID."),
    },
    async ({ libraryName }) => {
      const searchResponse: SearchResponse = await searchLibraries(libraryName, clientIp);

      if (!searchResponse.results || searchResponse.results.length === 0) {
        return {
          content: [
            {
              type: "text",
              text: searchResponse.error
                ? searchResponse.error
                : "Failed to retrieve library documentation data from Context7",
            },
          ],
        };
      }

      const resultsText = formatSearchResults(searchResponse);

      return {
        content: [
          {
            type: "text",
            text: `Available Libraries (top matches):

Each result includes:
- Library ID: Context7-compatible identifier (format: /org/project)
- Name: Library or package name
- Description: Short summary
- Code Snippets: Number of available code examples
- Trust Score: Authority indicator
- Versions: List of versions if available. Use one of those versions if and only if the user explicitly provides a version in their query.

For best results, select libraries based on name match, trust score, snippet coverage, and relevance to your use case.

----------

${resultsText}`,
          },
        ],
      };
    }
  );

  server.tool(
    "get-library-docs",
    "Fetches up-to-date documentation for a library. You must call 'resolve-library-id' first to obtain the exact Context7-compatible library ID required to use this tool, UNLESS the user explicitly provides a library ID in the format '/org/project' or '/org/project/version' in their query.",
    {
      context7CompatibleLibraryID: z
        .string()
        .describe(
          "Exact Context7-compatible library ID (e.g., '/mongodb/docs', '/vercel/next.js', '/supabase/supabase', '/vercel/next.js/v14.3.0-canary.87') retrieved from 'resolve-library-id' or directly from user query in the format '/org/project' or '/org/project/version'."
        ),
      topic: z
        .string()
        .optional()
        .describe("Topic to focus documentation on (e.g., 'hooks', 'routing')."),
      tokens: z
        .preprocess((val) => (typeof val === "string" ? Number(val) : val), z.number())
        .transform((val) => (val < DEFAULT_MINIMUM_TOKENS ? DEFAULT_MINIMUM_TOKENS : val))
        .optional()
        .describe(
          `Maximum number of tokens of documentation to retrieve (default: ${DEFAULT_MINIMUM_TOKENS}). Higher values provide more context but consume more tokens.`
        ),
    },
    async ({ context7CompatibleLibraryID, tokens = DEFAULT_MINIMUM_TOKENS, topic = "" }) => {
      const fetchDocsResponse = await fetchLibraryDocumentation(
        context7CompatibleLibraryID,
        {
          tokens,
          topic,
        },
        clientIp
      );

      if (!fetchDocsResponse) {
        return {
          content: [
            {
              type: "text",
              text: "Documentation not found or not finalized for this library. This might have happened because you used an invalid Context7-compatible library ID. To get a valid Context7-compatible library ID, use the 'resolve-library-id' with the package name you wish to retrieve documentation for.",
            },
          ],
        };
      }

      return {
        content: [
          {
            type: "text",
            text: fetchDocsResponse,
          },
        ],
      };
    }
  );

  return server;
}

async function main() {
  const transportType = TRANSPORT_TYPE;

  if (transportType === "http" || transportType === "sse") {
    // Get initial port from environment or use default
    const initialPort = CLI_PORT ?? 3000;
    // Keep track of which port we end up using
    let actualPort = initialPort;
    const httpServer = createServer(async (req, res) => {
      const url = new URL(req.url || "", `http://${req.headers.host}`).pathname;

      // Set CORS headers for all responses
      res.setHeader("Access-Control-Allow-Origin", "*");
      res.setHeader("Access-Control-Allow-Methods", "GET,POST,OPTIONS,DELETE");
      res.setHeader(
        "Access-Control-Allow-Headers",
        "Content-Type, MCP-Session-Id, mcp-session-id, MCP-Protocol-Version"
      );
      res.setHeader("Access-Control-Expose-Headers", "MCP-Session-Id");

      // Handle preflight OPTIONS requests
      if (req.method === "OPTIONS") {
        res.writeHead(200);
        res.end();
        return;
      }

      try {
        // Extract client IP address using socket remote address (most reliable)
        const clientIp = getClientIp(req);

        // Create new server instance for each request
        const requestServer = createServerInstance(clientIp);

        if (url === "/mcp") {
          const transport = new StreamableHTTPServerTransport({
            sessionIdGenerator: undefined,
          });
          await requestServer.connect(transport);
          await transport.handleRequest(req, res);
        } else if (url === "/sse" && req.method === "GET") {
          // Create new SSE transport for GET request
          const sseTransport = new SSEServerTransport("/messages", res);
          // Store the transport by session ID
          sseTransports[sseTransport.sessionId] = sseTransport;
          // Clean up transport when connection closes
          res.on("close", () => {
            delete sseTransports[sseTransport.sessionId];
          });
          await requestServer.connect(sseTransport);
        } else if (url === "/messages" && req.method === "POST") {
          // Get session ID from query parameters
          const sessionId =
            new URL(req.url || "", `http://${req.headers.host}`).searchParams.get("sessionId") ??
            "";

          if (!sessionId) {
            res.writeHead(400);
            res.end("Missing sessionId parameter");
            return;
          }

          // Get existing transport for this session
          const sseTransport = sseTransports[sessionId];
          if (!sseTransport) {
            res.writeHead(400);
            res.end(`No transport found for sessionId: ${sessionId}`);
            return;
          }

          // Handle the POST message with the existing transport
          await sseTransport.handlePostMessage(req, res);
        } else if (url === "/ping") {
          res.writeHead(200, { "Content-Type": "text/plain" });
          res.end("pong");
        } else {
          res.writeHead(404);
          res.end("Not found");
        }
      } catch (error) {
        console.error("Error handling request:", error);
        if (!res.headersSent) {
          res.writeHead(500);
          res.end("Internal Server Error");
        }
      }
    });

    // Function to attempt server listen with port fallback
    const startServer = (port: number, maxAttempts = 10) => {
      httpServer.once("error", (err: NodeJS.ErrnoException) => {
        if (err.code === "EADDRINUSE" && port < initialPort + maxAttempts) {
          console.warn(`Port ${port} is in use, trying port ${port + 1}...`);
          startServer(port + 1, maxAttempts);
        } else {
          console.error(`Failed to start server: ${err.message}`);
          process.exit(1);
        }
      });

      httpServer.listen(port, () => {
        actualPort = port;
        console.error(
          `Context7 Documentation MCP Server running on ${transportType.toUpperCase()} at http://localhost:${actualPort}/mcp and legacy SSE at /sse`
        );
      });
    };

    // Start the server with initial port
    startServer(initialPort);
  } else {
    // Stdio transport - this is already stateless by nature
    const server = createServerInstance();
    const transport = new StdioServerTransport();
    await server.connect(transport);
    console.error("Context7 Documentation MCP Server running on stdio");
  }
}

main().catch((error) => {
  console.error("Fatal error in main():", error);
  process.exit(1);
});

</code>

hooks\dashboard\index.ts:
<code>
export { useRepositories } from './use-repositories';
export { useDragAndDrop, useRepositorySorting } from './use-sorting-and-dnd';
export { useAIChat } from './use-ai-chat';

</code>

hooks\dashboard\use-ai-chat.ts:
<code>
import { useCallback } from 'react';
import { useChatStore, useErrorStore } from '@/stores';
import { useAuth } from '@/components/auth-provider';
import { aiAssistant } from '@/lib/ai-assistant';
import { geminiAI } from '@/lib/gemini';

/**
 * Custom hook for AI chat functionality
 */
export const useAIChat = () => {
  const { user, getEffectiveToken } = useAuth();
  const { 
    messages, 
    currentMessage, 
    isLoadingChat, 
    isTyping,
    isChatExpanded,
    setCurrentMessage, 
    sendMessage,
    setChatExpanded,
    clearChat 
  } = useChatStore();
  const { addCriticalError } = useErrorStore();

  // Send a message to AI with proper error handling
  const sendAIMessage = useCallback(async (message: string, repositories?: any[]) => {
    if (!message.trim()) {
      return;
    }

    try {
      // Get effective token for AI context
      const token = await getEffectiveToken();
      
      // Prepare context for AI
      const context = {
        userId: user?.id,
        repositories: repositories || [],
        token: token,
        previousMessages: messages.slice(-5) // Last 5 messages for context
      };

      // Use the chat store's sendMessage which handles the API call
      await sendMessage(message, user?.id);

    } catch (error) {
      console.error('Error sending AI message:', error);
      addCriticalError(
        error instanceof Error ? error.message : 'Failed to send message to AI assistant',
        'AI_CHAT_ERROR'
      );
    }
  }, [user, messages, getEffectiveToken, sendMessage, addCriticalError]);

  // Generate AI analysis for repositories
  const generateRepositoryAnalysis = useCallback(async (repositories: any[]) => {
    if (!repositories || repositories.length === 0) {
      addCriticalError('No repositories available for analysis', 'NO_REPOS');
      return;
    }

    try {
      const analysisPrompt = `Please analyze my GitHub repositories and provide insights about:
1. Programming language distribution
2. Project complexity levels
3. Recent activity patterns
4. Recommendations for improvement
5. Suggestions for showcasing these projects

Repositories: ${repositories.map(repo => `${repo.name} (${repo.language || 'Unknown'}, ${repo.stargazers_count} stars)`).join(', ')}`;

      await sendAIMessage(analysisPrompt, repositories);

    } catch (error) {
      console.error('Error generating repository analysis:', error);
      addCriticalError('Failed to generate repository analysis', 'ANALYSIS_ERROR');
    }
  }, [sendAIMessage, addCriticalError]);

  // Generate job-specific recommendations
  const generateJobRecommendations = useCallback(async (jobTitle: string, repositories: any[]) => {
    if (!jobTitle.trim()) {
      addCriticalError('Job title is required for recommendations', 'MISSING_JOB_TITLE');
      return;
    }

    try {
      const jobPrompt = `I'm applying for a ${jobTitle} position. Based on my repositories, please:
1. Recommend which repositories to highlight for this role
2. Suggest improvements to make my profile more attractive
3. Identify any gaps in my skill set
4. Provide specific talking points for interviews

My repositories: ${repositories.map(repo => `${repo.name} (${repo.language || 'Unknown'}, ${repo.description || 'No description'})`).join(', ')}`;

      await sendAIMessage(jobPrompt, repositories);

    } catch (error) {
      console.error('Error generating job recommendations:', error);
      addCriticalError('Failed to generate job recommendations', 'JOB_REC_ERROR');
    }
  }, [sendAIMessage, addCriticalError]);

  // Toggle chat panel
  const toggleChat = useCallback(() => {
    setChatExpanded(!isChatExpanded);
  }, [isChatExpanded, setChatExpanded]);

  return {
    // State
    messages,
    currentMessage,
    isLoadingChat,
    isTyping,
    isChatExpanded,
    
    // Actions
    setCurrentMessage,
    sendAIMessage,
    generateRepositoryAnalysis,
    generateJobRecommendations,
    toggleChat,
    clearChat,
    
    // Computed
    hasMessages: messages.length > 0,
    canSendMessage: currentMessage.trim().length > 0 && isLoadingChat !== 'loading'
  };
};

</code>

hooks\dashboard\use-repositories.ts:
<code>
import { useEffect, useCallback } from 'react';
import { useRepositoryStore, useErrorStore } from '@/stores';
import { repositoryManager } from '@/lib/repository-manager';
import { useAuth } from '@/components/auth-provider';

/**
 * Custom hook for managing repository data and operations
 */
export const useRepositories = () => {
  const { user, profile, getEffectiveToken } = useAuth();
  const { addCriticalError, addWarning } = useErrorStore();
  
  const {
    repositories,
    originalRepositories,
    isLoadingRepos,
    setRepositories,
    setOriginalRepositories,
    setLoadingState,
    resetRepositories
  } = useRepositoryStore();
  
  // Fetch repositories with proper error handling
  const fetchRepositories = useCallback(async (forceRefresh = false) => {
    if (!user) {
      addWarning('User authentication required to fetch repositories');
      return;
    }
    
    try {
      setLoadingState('loading');
      
      const effectiveToken = await getEffectiveToken();
      if (!effectiveToken) {
        addWarning('GitHub token not available. Some features may be limited.');
        setLoadingState('error');
        return;
      }
      
      await repositoryManager.fetchRepositories(
        effectiveToken, 
        forceRefresh, 
        user.id
      );
      
      // Repository manager uses singleton pattern - get repositories from there
      const currentRepos = repositoryManager.getRepositories();
      if (currentRepos && currentRepos.length > 0) {
        setRepositories(currentRepos);
        setOriginalRepositories(currentRepos);
        setLoadingState('success');
      } else {
        addWarning('No repositories found or empty response from GitHub API');
        setLoadingState('success');
      }
      
    } catch (error) {
      console.error('Error fetching repositories:', error);
      
      if (error instanceof Error) {
        if (error.message.includes('401')) {
          addCriticalError('GitHub token is invalid or expired. Please reconnect your account.', 'AUTH_ERROR');
        } else if (error.message.includes('403')) {
          addCriticalError('GitHub API rate limit exceeded. Please try again later.', 'RATE_LIMIT');
        } else if (error.message.includes('404')) {
          addWarning('Some repositories may not be accessible with current permissions.', 'ACCESS_LIMITED');
        } else {
          addCriticalError(`Failed to fetch repositories: ${error.message}`, 'FETCH_ERROR');
        }
      } else {
        addCriticalError('An unexpected error occurred while fetching repositories', 'UNKNOWN_ERROR');
      }
      
      setLoadingState('error');
    }
  }, [user, getEffectiveToken, setRepositories, setOriginalRepositories, setLoadingState, addCriticalError, addWarning]);
  
  // Auto-fetch on mount and when user changes
  useEffect(() => {
    if (user && profile) {
      fetchRepositories();
    } else if (!user) {
      resetRepositories();
    }
  }, [user, profile, fetchRepositories, resetRepositories]);
  
  // Delete repository with proper error handling
  const deleteRepository = useCallback(async (repo: any) => {
    if (!user || !repo) {
      addWarning('Invalid repository or user context for deletion');
      return false;
    }
    
    try {
      setLoadingState('loading');
      
      const effectiveToken = await getEffectiveToken();
      if (!effectiveToken) {
        addCriticalError('GitHub token required for repository deletion');
        setLoadingState('error');
        return false;
      }
      
      // Call GitHub API to delete repository
      const response = await fetch(`/api/github/repos/${repo.full_name}`, {
        method: 'DELETE',
        headers: {
          'Authorization': `Bearer ${effectiveToken}`,
          'Content-Type': 'application/json'
        }
      });
      
      if (!response.ok) {
        const errorData = await response.json().catch(() => null);
        throw new Error(errorData?.message || `Failed to delete repository: ${response.statusText}`);
      }
      
      // Remove from local state
      const updatedRepos = repositories.filter(r => r.id !== repo.id);
      setRepositories(updatedRepos);
      setOriginalRepositories(updatedRepos);
      
      setLoadingState('success');
      return true;
      
    } catch (error) {
      console.error('Error deleting repository:', error);
      
      if (error instanceof Error) {
        if (error.message.includes('403')) {
          addCriticalError('You do not have permission to delete this repository', 'PERMISSION_DENIED');
        } else if (error.message.includes('404')) {
          addWarning('Repository not found or already deleted', 'NOT_FOUND');
        } else {
          addCriticalError(`Failed to delete repository: ${error.message}`, 'DELETE_ERROR');
        }
      } else {
        addCriticalError('An unexpected error occurred during deletion', 'UNKNOWN_DELETE_ERROR');
      }
      
      setLoadingState('error');
      return false;
    }
  }, [user, repositories, getEffectiveToken, setRepositories, setOriginalRepositories, setLoadingState, addCriticalError, addWarning]);
  
  return {
    repositories,
    originalRepositories,
    isLoadingRepos,
    fetchRepositories,
    deleteRepository,
    hasRepositories: repositories.length > 0,
    isError: isLoadingRepos === 'error',
    isLoading: isLoadingRepos === 'loading',
    isSuccess: isLoadingRepos === 'success'
  };
};

</code>

hooks\dashboard\use-sorting-and-dnd.ts:
<code>
import { useCallback } from 'react';
import { DragDropContext, DropResult } from '@hello-pangea/dnd';
import { useRepositoryStore, useErrorStore } from '@/stores';
import { RepositorySorter } from '@/lib/repository-sorter';

/**
 * Custom hook for handling drag and drop functionality
 */
export const useDragAndDrop = () => {
  const { 
    repositories, 
    setRepositories, 
    setPreviewRepositories, 
    setPreviewMode 
  } = useRepositoryStore();
  const { addWarning } = useErrorStore();

  const handleDragEnd = useCallback((result: DropResult) => {
    const { destination, source } = result;

    // If no destination, do nothing
    if (!destination) {
      return;
    }

    // If dropped in same position, do nothing
    if (
      destination.droppableId === source.droppableId &&
      destination.index === source.index
    ) {
      return;
    }

    try {
      // Create a copy of repositories for reordering
      const reorderedRepos = Array.from(repositories);
      const [reorderedItem] = reorderedRepos.splice(source.index, 1);
      reorderedRepos.splice(destination.index, 0, reorderedItem);

      // Update repositories and show as preview
      setPreviewRepositories(reorderedRepos);
      setPreviewMode(true);

    } catch (error) {
      console.error('Error during drag and drop:', error);
      addWarning('Failed to reorder repositories. Please try again.');
    }
  }, [repositories, setRepositories, setPreviewRepositories, setPreviewMode, addWarning]);

  return {
    handleDragEnd
  };
};

/**
 * Custom hook for sorting functionality
 */
export const useRepositorySorting = () => {
  const { 
    repositories,
    dateSortOrder,
    setRepositories,
    setPreviewRepositories,
    setSortOrder,
    setPreviewMode
  } = useRepositoryStore();
  const { addInfo, addWarning } = useErrorStore();

  const applySorting = useCallback(async (
    sortType: 'stars' | 'forks' | 'updated' | 'name' | 'size' | 'complexity',
    order: 'newest' | 'oldest' | 'default' = 'default'
  ) => {
    if (repositories.length === 0) {
      addWarning('No repositories available to sort');
      return;
    }

    try {
      let sortedRepos = [...repositories];

      switch (sortType) {
        case 'stars':
          sortedRepos.sort((a, b) => {
            const compareValue = b.stargazers_count - a.stargazers_count;
            return order === 'oldest' ? -compareValue : compareValue;
          });
          addInfo(`Repositories sorted by stars (${order})`);
          break;
        case 'forks':
          sortedRepos.sort((a, b) => {
            const compareValue = b.forks_count - a.forks_count;
            return order === 'oldest' ? -compareValue : compareValue;
          });
          addInfo(`Repositories sorted by forks (${order})`);
          break;
        case 'updated':
          sortedRepos.sort((a, b) => {
            const dateA = new Date(a.updated_at).getTime();
            const dateB = new Date(b.updated_at).getTime();
            const compareValue = dateB - dateA;
            return order === 'oldest' ? -compareValue : compareValue;
          });
          addInfo(`Repositories sorted by last updated (${order})`);
          break;
        case 'name':
          sortedRepos.sort((a, b) => {
            const compareValue = a.name.localeCompare(b.name);
            return order === 'oldest' ? -compareValue : compareValue;
          });
          addInfo(`Repositories sorted by name (${order})`);
          break;
        case 'complexity':
          // For now, sort by a complexity-like metric (stars + forks + recent activity)
          sortedRepos.sort((a, b) => {
            const scoreA = a.stargazers_count + a.forks_count + (Date.now() - new Date(a.updated_at).getTime() > 30 * 24 * 60 * 60 * 1000 ? 0 : 1);
            const scoreB = b.stargazers_count + b.forks_count + (Date.now() - new Date(b.updated_at).getTime() > 30 * 24 * 60 * 60 * 1000 ? 0 : 1);
            const compareValue = scoreB - scoreA;
            return order === 'oldest' ? -compareValue : compareValue;
          });
          addInfo(`Repositories sorted by complexity (${order})`);
          break;
        default:
          addWarning('Unknown sort type');
          return;
      }

      if (sortedRepos) {
        setPreviewRepositories(sortedRepos);
        setPreviewMode(true);
        setSortOrder(order);
      }

    } catch (error) {
      console.error('Error sorting repositories:', error);
      addWarning(`Failed to sort repositories by ${sortType}. Please try again.`);
    }
  }, [repositories, setPreviewRepositories, setPreviewMode, setSortOrder, addInfo, addWarning]);

  const resetSorting = useCallback(() => {
    setSortOrder('default');
    setPreviewMode(false);
    addInfo('Repository sorting reset to default order');
  }, [setSortOrder, setPreviewMode, addInfo]);

  return {
    applySorting,
    resetSorting,
    currentSortOrder: dateSortOrder
  };
};

</code>

hooks\use-mobile.tsx:
<code>
import * as React from "react"

const MOBILE_BREAKPOINT = 768

export function useIsMobile() {
  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)

  React.useEffect(() => {
    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)
    const onChange = () => {
      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    }
    mql.addEventListener("change", onChange)
    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    return () => mql.removeEventListener("change", onChange)
  }, [])

  return !!isMobile
}

</code>

hooks\use-toast.ts:
<code>
"use client"

// Inspired by react-hot-toast library
import * as React from "react"

import type {
  ToastActionElement,
  ToastProps,
} from "@/components/ui/toast"

const TOAST_LIMIT = 1
const TOAST_REMOVE_DELAY = 1000000

type ToasterToast = ToastProps & {
  id: string
  title?: React.ReactNode
  description?: React.ReactNode
  action?: ToastActionElement
}

const actionTypes = {
  ADD_TOAST: "ADD_TOAST",
  UPDATE_TOAST: "UPDATE_TOAST",
  DISMISS_TOAST: "DISMISS_TOAST",
  REMOVE_TOAST: "REMOVE_TOAST",
} as const

let count = 0

function genId() {
  count = (count + 1) % Number.MAX_SAFE_INTEGER
  return count.toString()
}

type ActionType = typeof actionTypes

type Action =
  | {
      type: ActionType["ADD_TOAST"]
      toast: ToasterToast
    }
  | {
      type: ActionType["UPDATE_TOAST"]
      toast: Partial<ToasterToast>
    }
  | {
      type: ActionType["DISMISS_TOAST"]
      toastId?: ToasterToast["id"]
    }
  | {
      type: ActionType["REMOVE_TOAST"]
      toastId?: ToasterToast["id"]
    }

interface State {
  toasts: ToasterToast[]
}

const toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()

const addToRemoveQueue = (toastId: string) => {
  if (toastTimeouts.has(toastId)) {
    return
  }

  const timeout = setTimeout(() => {
    toastTimeouts.delete(toastId)
    dispatch({
      type: "REMOVE_TOAST",
      toastId: toastId,
    })
  }, TOAST_REMOVE_DELAY)

  toastTimeouts.set(toastId, timeout)
}

export const reducer = (state: State, action: Action): State => {
  switch (action.type) {
    case "ADD_TOAST":
      return {
        ...state,
        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),
      }

    case "UPDATE_TOAST":
      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === action.toast.id ? { ...t, ...action.toast } : t
        ),
      }

    case "DISMISS_TOAST": {
      const { toastId } = action

      // ! Side effects ! - This could be extracted into a dismissToast() action,
      // but I'll keep it here for simplicity
      if (toastId) {
        addToRemoveQueue(toastId)
      } else {
        state.toasts.forEach((toast) => {
          addToRemoveQueue(toast.id)
        })
      }

      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === toastId || toastId === undefined
            ? {
                ...t,
                open: false,
              }
            : t
        ),
      }
    }
    case "REMOVE_TOAST":
      if (action.toastId === undefined) {
        return {
          ...state,
          toasts: [],
        }
      }
      return {
        ...state,
        toasts: state.toasts.filter((t) => t.id !== action.toastId),
      }
  }
}

const listeners: Array<(state: State) => void> = []

let memoryState: State = { toasts: [] }

function dispatch(action: Action) {
  memoryState = reducer(memoryState, action)
  listeners.forEach((listener) => {
    listener(memoryState)
  })
}

type Toast = Omit<ToasterToast, "id">

function toast({ ...props }: Toast) {
  const id = genId()

  const update = (props: ToasterToast) =>
    dispatch({
      type: "UPDATE_TOAST",
      toast: { ...props, id },
    })
  const dismiss = () => dispatch({ type: "DISMISS_TOAST", toastId: id })

  dispatch({
    type: "ADD_TOAST",
    toast: {
      ...props,
      id,
      open: true,
      onOpenChange: (open) => {
        if (!open) dismiss()
      },
    },
  })

  return {
    id: id,
    dismiss,
    update,
  }
}

function useToast() {
  const [state, setState] = React.useState<State>(memoryState)

  React.useEffect(() => {
    listeners.push(setState)
    return () => {
      const index = listeners.indexOf(setState)
      if (index > -1) {
        listeners.splice(index, 1)
      }
    }
  }, [state])

  return {
    ...state,
    toast,
    dismiss: (toastId?: string) => dispatch({ type: "DISMISS_TOAST", toastId }),
  }
}

export { useToast, toast }

</code>

lib\ai-assistant.ts:
<code>
// AI Assistant Engine - TRUE AI ASSISTANT with Real Actions
import { geminiAI } from './gemini';
import { GitHubAPIService } from './github-api';
import { RepositorySorter, Repository } from './repository-sorter';

export interface InterviewQuestion {
  id: string;
  question: string;
  category: 'personal' | 'technical' | 'career' | 'projects' | 'hobbies';
  followUp?: string;
}

export interface InterviewState {
  isActive: boolean;
  currentQuestion: number;
  questions: InterviewQuestion[];
  answers: Record<string, string>;
  completed: boolean;
}

export interface PortfolioData {
  name?: string;
  codingPassion?: string;
  recentExcitement?: string;
  careerGoals?: string;
  hobbies?: string;
  techFocus?: string;
  personalStory?: string;
}

export interface AIAction {
  type: 'create_repo' | 'create_file' | 'delete_repo' | 'sort_repos' | 'analyze_complexity' | 'cv_recommendations' | 'generate_portfolio_readme' | 'start_interview' | 'interview_answer' | 'general_response';
  intent: string;
  parameters: Record<string, any>;
  confidence: number;
}

export interface AIResponse {
  message: string;
  action?: AIAction;
  data?: any;
  success: boolean;
}

export interface UserContext {
  repositories: any[];
  preferences: {
    targetJob?: string;
    techStack?: string[];
    experienceLevel?: string;
  };
  personalInfo?: {
    name?: string;
    bio?: string;
    hobbies?: string[];
    careerGoals?: string;
    favoriteLanguages?: string[];
    personalStory?: string;
  };
  conversationHistory: Array<{
    role: 'user' | 'assistant';
    content: string;
    timestamp: Date;
  }>;
}

export class AIAssistantEngine {
  private githubAPI: GitHubAPIService | null = null;
  private userContext: UserContext;
  private interviewState: InterviewState;

  constructor() {
    this.userContext = {
      repositories: [],
      preferences: {},
      conversationHistory: [],
    };

    // üíæ RESTORE INTERVIEW STATE FROM LOCALSTORAGE
    this.interviewState = this.loadInterviewState();
  }

  // üíæ SAVE INTERVIEW STATE TO LOCALSTORAGE (user-specific)
  private saveInterviewState(userId?: string) {
    if (typeof window === 'undefined') return;

    try {
      const key = userId ? `ai_interview_state_${userId}` : 'ai_interview_state';
      localStorage.setItem(key, JSON.stringify(this.interviewState));
      console.log(`üíæ Interview state saved to ${userId ? 'user-specific' : 'global'} localStorage`);
    } catch (error) {
      console.error('‚ùå Failed to save interview state:', error);
    }
  }

  // üíæ LOAD INTERVIEW STATE FROM LOCALSTORAGE (user-specific)
  private loadInterviewState(userId?: string): InterviewState {
    if (typeof window === 'undefined') {
      console.log('üíæ Server-side rendering, using default interview state');
      return {
        isActive: false,
        currentQuestion: 0,
        questions: [],
        answers: {},
        completed: false,
      };
    }

    try {
      // Try user-specific first, then fall back to global
      const userKey = userId ? `ai_interview_state_${userId}` : null;
      const globalKey = 'ai_interview_state';

      let saved = userKey ? localStorage.getItem(userKey) : null;
      if (!saved) {
        saved = localStorage.getItem(globalKey);
      }

      console.log('üíæ Raw localStorage value:', saved);

      if (saved) {
        const state = JSON.parse(saved);
        console.log(`üíæ Interview state loaded from ${userKey && localStorage.getItem(userKey) ? 'user-specific' : 'global'} localStorage:`, state);
        return state;
      } else {
        console.log('üíæ No saved interview state found in localStorage');
      }
    } catch (error) {
      console.error('‚ùå Failed to load interview state:', error);
    }

    console.log('üíæ Using default interview state');
    return {
      isActive: false,
      currentQuestion: 0,
      questions: [],
      answers: {},
      completed: false,
    };
  }

  // üíæ CLEAR INTERVIEW STATE (user-specific)
  private clearInterviewState(userId?: string) {
    if (typeof window === 'undefined') return;

    try {
      if (userId) {
        localStorage.removeItem(`ai_interview_state_${userId}`);
        console.log(`üíæ User-specific interview state cleared for ${userId}`);
      } else {
        localStorage.removeItem('ai_interview_state');
        console.log('üíæ Global interview state cleared from localStorage');
      }
    } catch (error) {
      console.error('‚ùå Failed to clear interview state:', error);
    }
  }

  // üîß Initialize with GitHub credentials
  initializeGitHub(accessToken: string, username: string) {
    this.githubAPI = new GitHubAPIService(accessToken, username);
    console.log('üîß GitHub API initialized for:', username);
  }

  // üé§ INTERVIEW QUESTION BANK
  private getInterviewQuestions(): InterviewQuestion[] {
    return [
      {
        id: 'name_passion',
        question: "Hi! I'm excited to help you create an amazing portfolio README! üöÄ Let's start with the basics - what's your name and what do you love most about coding?",
        category: 'personal',
        followUp: "That's awesome! Tell me more about what specifically excites you about that."
      },
      {
        id: 'recent_excitement',
        question: "What project or technology have you been most excited about recently? I'd love to hear what's been keeping you motivated!",
        category: 'projects',
        followUp: "That sounds fascinating! What was the most challenging or rewarding part?"
      },
      {
        id: 'career_goals',
        question: "Where do you see yourself in your coding journey? Any dream job, company, or role you're working towards?",
        category: 'career',
        followUp: "That's a great goal! What steps are you taking to get there?"
      },
      {
        id: 'tech_focus',
        question: "What technologies or programming languages are you most passionate about right now? What draws you to them?",
        category: 'technical',
        followUp: "Interesting choice! What do you love most about working with those?"
      },
      {
        id: 'hobbies_personality',
        question: "When you're not coding, what do you love to do? I want to show your personality in your README!",
        category: 'hobbies',
        followUp: "That's cool! How do those interests influence your approach to coding?"
      },
      {
        id: 'personal_story',
        question: "Last question! Is there anything unique about your coding journey or background that you'd like people to know about you?",
        category: 'personal',
        followUp: "That's a great story! It really shows your unique perspective."
      }
    ];
  }

  // üß† PARSE USER COMMAND USING AI
  async parseCommand(userMessage: string): Promise<AIAction> {
    // üîç DEBUG: Log interview state
    console.log('üîç DEBUG Interview State:', {
      isActive: this.interviewState.isActive,
      completed: this.interviewState.completed,
      currentQuestion: this.interviewState.currentQuestion,
      totalQuestions: this.interviewState.questions.length
    });

    // üé§ CHECK FOR START INTERVIEW COMMAND FIRST (before checking if interview is active)
    const lowerMessage = userMessage.toLowerCase();
    if (lowerMessage.includes('start') && lowerMessage.includes('interview')) {
      console.log('üé§ Start interview command detected - will restart interview');
      return {
        type: 'start_interview',
        intent: 'Start portfolio interview',
        parameters: {},
        confidence: 0.9,
      };
    }

    // üé§ INTERVIEW MODE: If interview is active, treat all responses as interview answers
    if (this.interviewState.isActive && !this.interviewState.completed) {
      console.log('üé§ Interview active - treating response as interview answer');
      return {
        type: 'interview_answer',
        intent: 'User answering interview question',
        parameters: {
          answer: userMessage,
          questionId: this.interviewState.questions[this.interviewState.currentQuestion]?.id
        },
        confidence: 1.0
      };
    }

    const systemPrompt = `You are an AI assistant that helps developers manage their GitHub repositories.

    Analyze the user's message and determine what action they want to perform. Respond with a JSON object containing:

    {
      "type": "create_repo" | "create_file" | "delete_repo" | "sort_repos" | "analyze_complexity" | "cv_recommendations" | "generate_portfolio_readme" | "start_interview" | "interview_answer" | "general_response",
      "intent": "brief description of what user wants",
      "parameters": {
        // extracted parameters based on action type
      },
      "confidence": 0.0-1.0
    }

    Action Types:
    - create_repo: User wants to create a new repository
      Parameters: { name, description?, private?, gitignore?, license? }
    - create_file: User wants to create a file in a repository
      Parameters: { repo, filename, content?, message? }
    - delete_repo: User wants to delete a repository (DANGEROUS!)
      Parameters: { name, confirm?: boolean }
    - sort_repos: User wants to sort/organize repositories
      Parameters: { criteria: "complexity" | "date" | "cv" | "alphabetical", order?: "asc" | "desc" }
    - analyze_complexity: User wants to analyze repository structure, complexity, or technical details
      Parameters: { repo?, all?: boolean }
      IMPORTANT: Use this for "analyze structure", "analyze complexity", "analyze my repositories", etc.
    - cv_recommendations: User wants CV/resume optimization
      Parameters: { targetJob?, focus? }
    - generate_portfolio_readme: User wants a comprehensive portfolio README
      Parameters: { includePersonal?: boolean }
    - start_interview: ONLY when user explicitly asks to "start interview" or "begin interview"
      Parameters: { mode?: "quick" | "detailed" }
      IMPORTANT: Do NOT use this for analysis requests - only for explicit interview commands
    - interview_answer: User is answering an interview question
      Parameters: { answer: string, questionId?: string }
    - general_response: General conversation or help
      Parameters: { topic? }
    
    Examples:
    "Create a new repo named Hello world" ‚Üí create_repo with name="Hello world"
    "Delete the hello-world-test repository" ‚Üí delete_repo with name="hello-world-test"
    "Sort repos from simple to complex" ‚Üí sort_repos with criteria="complexity", order="asc"
    "Sort my repositories from simple to complex for CV readiness" ‚Üí sort_repos with criteria="complexity", order="asc"
    "Please sort the repos in order from simple to complex so i can put it on my CV" ‚Üí sort_repos with criteria="complexity", order="asc"
    "Recommend repositories for my CV" ‚Üí cv_recommendations
    "Create a file readme in my hello-world repo" ‚Üí create_file with repo="hello-world", filename="README.md"
    "Generate portfolio README" ‚Üí generate_portfolio_readme
    "Create README based on all my repos" ‚Üí generate_portfolio_readme
    "Start interview for portfolio" ‚Üí start_interview
    "I want personalized README" ‚Üí start_interview

    PRIORITY RULES:
    - If user mentions "sort" AND ("simple" OR "complex" OR "complexity"), ALWAYS use sort_repos regardless of CV mention
    - Only use cv_recommendations for general CV advice without specific sorting requests
    
    IMPORTANT: Only respond with valid JSON, no additional text.`;

    try {
      const response = await geminiAI.generateResponse(
        userMessage,
        this.userContext.conversationHistory.slice(-5), // Last 5 messages for context
        systemPrompt
      );

      // Parse AI response as JSON
      const cleanResponse = response.trim().replace(/```json\n?|\n?```/g, '');
      const action: AIAction = JSON.parse(cleanResponse);
      
      console.log('üß† AI parsed command:', action);
      return action;
    } catch (error) {
      console.error('‚ùå Failed to parse command:', error);
      // Fallback to simple pattern matching
      return this.fallbackParsing(userMessage);
    }
  }

  // üéØ EXECUTE AI ACTION
  async executeAction(action: AIAction): Promise<AIResponse> {
    console.log(`üéØ Executing action: ${action.type}`);

    try {
      switch (action.type) {
        case 'create_repo':
          return await this.handleCreateRepository(action.parameters);

        case 'create_file':
          return await this.handleCreateFile(action.parameters);

        case 'delete_repo':
          return await this.handleDeleteRepository(action.parameters);
        
        case 'sort_repos':
          return await this.handleSortRepositories(action.parameters);
        
        case 'analyze_complexity':
          return await this.handleAnalyzeComplexity(action.parameters);
        
        case 'cv_recommendations':
          return await this.handleCVRecommendations(action.parameters);

        case 'generate_portfolio_readme':
          return await this.handleGeneratePortfolioReadme(action.parameters);

        case 'start_interview':
          return await this.handleStartInterview(action.parameters);

        case 'interview_answer':
          return await this.handleInterviewAnswer(action.parameters);

        case 'general_response':
          return await this.handleGeneralResponse(action.parameters);
        
        default:
          return {
            message: "I'm not sure how to help with that. Can you try rephrasing your request?",
            success: false,
          };
      }
    } catch (error: any) {
      console.error('‚ùå Action execution failed:', error);
      return {
        message: `Sorry, I encountered an error: ${error.message}`,
        success: false,
      };
    }
  }

  // üöÄ CREATE REPOSITORY ACTION
  private async handleCreateRepository(params: any): Promise<AIResponse> {
    if (!this.githubAPI) {
      return {
        message: "GitHub integration is not set up. Please connect your GitHub account first.",
        success: false,
      };
    }

    const { name, description, private: isPrivate, gitignore, license } = params;
    
    if (!name) {
      return {
        message: "I need a repository name to create it. What would you like to name your repository?",
        success: false,
      };
    }

    const result = await this.githubAPI.createRepository({
      name: name.replace(/\s+/g, '-').toLowerCase(), // Convert to kebab-case
      description: description || `Repository created by AI Assistant`,
      private: isPrivate || false,
      auto_init: true,
      gitignore_template: gitignore,
      license_template: license,
    });

    if (result.success) {
      return {
        message: `üöÄ Successfully created repository "${name}"!\n\n‚úÖ Repository URL: ${result.url}\n\n‚è±Ô∏è **Please note:** It may take 10-15 seconds for the repository to appear in your dashboard due to GitHub API sync delays. This is normal!\n\nYour new repository is ready to use. Would you like me to create any files in it?`,
        action: {
          type: 'create_repo',
          intent: 'Repository created successfully',
          parameters: { name, url: result.url },
          confidence: 1.0,
        },
        data: result.repository,
        success: true,
      };
    } else {
      return {
        message: `‚ùå Failed to create repository "${name}": ${result.error}\n\nThis might be because:\n‚Ä¢ A repository with this name already exists\n‚Ä¢ Invalid repository name\n‚Ä¢ GitHub API limits\n\nTry a different name or check your GitHub account.`,
        success: false,
      };
    }
  }

  // üìÑ CREATE FILE ACTION
  private async handleCreateFile(params: any): Promise<AIResponse> {
    if (!this.githubAPI) {
      return {
        message: "GitHub integration is not set up. Please connect your GitHub account first.",
        success: false,
      };
    }

    const { repo, filename, content, message } = params;
    
    if (!repo || !filename) {
      return {
        message: "I need both a repository name and filename. For example: 'Create a README.md file in my hello-world repo'",
        success: false,
      };
    }

    // Generate default content based on file type
    let fileContent = content;
    if (!fileContent) {
      if (filename.toLowerCase().includes('readme')) {
        fileContent = `# ${repo}\n\nDescription of your project.\n\n## Installation\n\n\`\`\`bash\n# Add installation instructions\n\`\`\`\n\n## Usage\n\n\`\`\`bash\n# Add usage examples\n\`\`\`\n\n## Contributing\n\nContributions are welcome!\n`;
      } else {
        fileContent = `// ${filename}\n// Created by AI Assistant\n\nconsole.log('Hello, World!');\n`;
      }
    }

    // Get the actual username from GitHub API
    const username = this.githubAPI ? await this.getAuthenticatedUsername() : 'user';
    
    const result = await this.githubAPI.createFile({
      owner: username,
      repo: repo,
      path: filename,
      content: fileContent,
      message: message || `Add ${filename}`,
    });

    if (result.success) {
      return {
        message: `üìÑ Successfully created "${filename}" in repository "${repo}"!\n\n‚úÖ File URL: ${result.url}\n\nThe file has been created with default content. You can edit it directly on GitHub.`,
        action: {
          type: 'create_file',
          intent: 'File created successfully',
          parameters: { repo, filename, url: result.url },
          confidence: 1.0,
        },
        data: result.file,
        success: true,
      };
    } else {
      return {
        message: `‚ùå Failed to create file "${filename}" in repository "${repo}": ${result.error}\n\nThis might be because:\n‚Ä¢ Repository doesn't exist\n‚Ä¢ File already exists\n‚Ä¢ Permission issues\n\nPlease check the repository name and try again.`,
        success: false,
      };
    }
  }

  // ÔøΩÔ∏è HANDLE DELETE REPOSITORY
  private async handleDeleteRepository(params: any): Promise<AIResponse> {
    if (!this.githubAPI) {
      return {
        message: "‚ùå GitHub integration is not set up. Please connect your GitHub account first.",
        success: false,
      };
    }

    const { name, confirm } = params;

    if (!name) {
      return {
        message: "‚ùå Please specify the repository name to delete.",
        success: false,
      };
    }

    // Get the actual username from GitHub API
    const username = this.githubAPI ? await this.getAuthenticatedUsername() : 'user';

    // Safety confirmation
    if (!confirm) {
      return {
        message: `‚ö†Ô∏è **DANGER ZONE** ‚ö†Ô∏è\n\nYou are about to **PERMANENTLY DELETE** the repository "${name}".\n\nüö® **This action CANNOT be undone!**\n\n**What will be lost:**\n‚Ä¢ All code and files\n‚Ä¢ All commit history\n‚Ä¢ All issues and pull requests\n‚Ä¢ All releases and tags\n‚Ä¢ All collaborator access\n\nIf you're absolutely sure, please type: **"Yes, delete ${name} permanently"**`,
        success: false,
      };
    }

    const result = await this.githubAPI.deleteRepository({
      owner: username,
      name: name,
    });

    if (result.success) {
      return {
        message: `üóëÔ∏è **Repository "${name}" has been permanently deleted!**\n\n‚úÖ The repository and all its contents have been removed from GitHub.\n\n‚ö†Ô∏è This action was irreversible. The repository is gone forever.`,
        action: {
          type: 'delete_repo',
          intent: 'Repository deleted successfully',
          parameters: { name, username },
          confidence: 1.0,
        },
        data: { deleted: true, name, username },
        success: true,
      };
    } else {
      return {
        message: `‚ùå Failed to delete repository "${name}": ${result.error}\n\nPossible reasons:\n‚Ä¢ Repository doesn't exist\n‚Ä¢ You don't have admin access\n‚Ä¢ Repository name is incorrect`,
        success: false,
      };
    }
  }

  // ÔøΩüìä SORT REPOSITORIES ACTION
  private async handleSortRepositories(params: any): Promise<AIResponse> {
    const { criteria, order } = params;
    
    if (!this.userContext.repositories.length) {
      return {
        message: "I don't have access to your repositories yet. Please refresh the page or connect your GitHub account.",
        success: false,
      };
    }

    let sortedRepos;
    let sortDescription;

    // Determine sorting mode based on criteria
    const sortingMode = criteria === 'complexity' ? 'portfolio' : 'cv';

    if (sortingMode === 'portfolio') {
      // Portfolio Mode: Sort by complexity (simple ‚Üí complex)
      console.log('üîß Sorting by complexity for portfolio mode');
      sortedRepos = [...this.userContext.repositories].sort((a, b) => {
        const complexityA = RepositorySorter.calculateComplexity(a).score;
        const complexityB = RepositorySorter.calculateComplexity(b).score;
        return complexityA - complexityB; // simple to complex
      });
      sortDescription = 'from simple to complex';
    } else {
      // CV Mode: Sort by date (newest ‚Üí oldest)
      console.log('üîß Sorting by date for CV mode');
      sortedRepos = [...this.userContext.repositories].sort((a, b) => {
        const dateA = new Date(a.updated_at).getTime();
        const dateB = new Date(b.updated_at).getTime();
        return dateB - dateA; // newest first
      });
      sortDescription = 'by recent activity';
    }

    // Generate bullet points with appropriate labels
    const bulletPoints = this.generateBulletPoints(sortedRepos, sortingMode);

    const modeDescription = sortingMode === 'portfolio'
      ? 'üìö **Portfolio Mode** - Sorted by complexity (Simple ‚Üí Advanced)'
      : 'üíº **CV Mode** - Sorted by activity (Recent ‚Üí Older)';

    const explanation = sortingMode === 'portfolio'
      ? '‚ú® Perfect for showcasing your learning journey and skill progression!'
      : 'üéØ Perfect for recruiters who want to see your recent activity and current skills!';

    return {
      message: `${modeDescription}\n\n${bulletPoints}\n\n${explanation}`,
      action: {
        type: 'sort_repos',
        intent: `Repositories sorted for ${sortingMode} mode`,
        parameters: { criteria, order, mode: sortingMode, count: sortedRepos.length },
        confidence: 1.0,
      },
      data: sortedRepos,
      success: true,
    };
  }

  // üè∑Ô∏è GENERATE BULLET POINTS WITH LABELS
  private generateBulletPoints(repositories: Repository[], mode: 'cv' | 'portfolio'): string {
    return repositories.map((repo, index) => {
      const complexity = repo.complexity || RepositorySorter.calculateComplexity(repo);
      const label = this.getRepositoryLabel(repo, complexity, mode);
      const timeAgo = this.getTimeAgo(repo.updated_at);

      if (mode === 'cv') {
        // CV Mode: Show recent activity with highlights for complex projects
        return `‚Ä¢ ${label} **${repo.name}** (${complexity.level}) - ${timeAgo}`;
      } else {
        // Portfolio Mode: Show progression story
        return `${index + 1}. ${label} **${repo.name}** (${complexity.level})`;
      }
    }).join('\n');
  }

  // üè∑Ô∏è GET REPOSITORY LABEL
  private getRepositoryLabel(repo: Repository, complexity: any, mode: 'cv' | 'portfolio'): string {
    const isRecent = this.isRecentProject(repo.updated_at);
    const isComplex = complexity.score >= 7;
    const isFullstack = this.isFullstackProject(repo);

    if (mode === 'cv') {
      // CV Mode: Prioritize recent activity
      if (isRecent && isComplex) return 'Featured';
      if (isRecent) return 'Recent';
      if (isFullstack) return 'Full-stack';
      return '';
    } else {
      // Portfolio Mode: Show progression
      if (isFullstack) return 'Full-stack';
      if (isComplex) return 'Advanced';
      if (isRecent) return 'Recent';
      return '';
    }
  }

  // ‚è∞ HELPER METHODS
  private isRecentProject(updatedAt: string): boolean {
    const weekAgo = new Date();
    weekAgo.setDate(weekAgo.getDate() - 7);
    return new Date(updatedAt) > weekAgo;
  }

  private isFullstackProject(repo: Repository): boolean {
    const description = repo.description?.toLowerCase() || '';
    const name = repo.name.toLowerCase();
    return description.includes('fullstack') ||
           description.includes('full-stack') ||
           (description.includes('react') && description.includes('api')) ||
           name.includes('dashboard') ||
           name.includes('webapp');
  }

  private getTimeAgo(updatedAt: string): string {
    const now = new Date();
    const updated = new Date(updatedAt);
    const diffInDays = Math.floor((now.getTime() - updated.getTime()) / (1000 * 60 * 60 * 24));

    if (diffInDays === 0) return 'Today';
    if (diffInDays === 1) return 'Yesterday';
    if (diffInDays < 7) return `${diffInDays} days ago`;
    if (diffInDays < 30) return `${Math.floor(diffInDays / 7)} weeks ago`;
    return `${Math.floor(diffInDays / 30)} months ago`;
  }

  // üß† ANALYZE COMPLEXITY ACTION
  private async handleAnalyzeComplexity(params: any): Promise<AIResponse> {
    if (!this.githubAPI) {
      return {
        message: "üîë **GitHub Personal Access Token Required**\n\nTo analyze your repository structure and complexity, I need access to your GitHub repositories through a Personal Access Token (PAT).\n\n**How to set up your PAT:**\n1. Go to your **Profile page** in the top navigation\n2. Click **\"Add Token\"** in the GitHub Token Management section\n3. Follow the instructions to create and save your GitHub PAT\n\nOnce your PAT is configured, I'll be able to analyze your repositories, provide complexity insights, and help optimize your GitHub profile! üöÄ",
        success: false,
      };
    }

    // üîß REAL COMPLEXITY ANALYSIS: Analyze actual repository data
    const repos = this.userContext.repositories;

    if (!repos || repos.length === 0) {
      return {
        message: "üìÇ **No Repositories Found**\n\nI couldn't find any repositories to analyze. This might happen if:\n\n‚Ä¢ Your GitHub PAT token needs to be refreshed\n‚Ä¢ Your repositories are still loading\n‚Ä¢ You don't have any public repositories\n\nPlease check your **Profile page** to ensure your GitHub token is properly configured, or wait a moment for your repositories to load.",
        success: false,
      };
    }

    // Analyze repository complexity based on real data
    const analysis = this.analyzeRepositoryComplexity(repos);

    const message = `**Repository Analysis Complete**

**Overview:**
‚Ä¢ Total Repositories: ${repos.length}
‚Ä¢ Languages Found: ${analysis.languages.join(', ')}
‚Ä¢ Average Complexity Score: ${analysis.averageComplexity}/10

**Most Complex Repositories:**
${analysis.mostComplex.map((repo, i) => `${i + 1}. **${repo.name}** (${repo.complexity}/10) - ${repo.language || 'Unknown'}`).join('\n')}

**Complexity Breakdown:**
‚Ä¢ High Complexity (8-10): ${analysis.highComplexity} repos
‚Ä¢ Medium Complexity (5-7): ${analysis.mediumComplexity} repos
‚Ä¢ Low Complexity (1-4): ${analysis.lowComplexity} repos

**Key Insights:**
${analysis.insights.join('\n')}

This analysis is based on repository size, language complexity, recent activity, and project structure.`;

    return {
      message,
      success: true,
    };
  }

  // üîç ANALYZE REPOSITORY COMPLEXITY HELPER
  private analyzeRepositoryComplexity(repos: any[]) {
    const languages = [...new Set(repos.map(repo => repo.language).filter(Boolean))];

    // Calculate complexity scores for each repo
    const reposWithComplexity = repos.map(repo => {
      let complexity = 1;

      // Language complexity scoring
      const languageComplexity: Record<string, number> = {
        'TypeScript': 8, 'JavaScript': 7, 'Python': 6, 'Java': 8, 'C++': 9, 'C#': 7,
        'Go': 6, 'Rust': 9, 'Swift': 7, 'Kotlin': 7, 'PHP': 5, 'Ruby': 6,
        'HTML': 2, 'CSS': 2, 'Shell': 4, 'Dockerfile': 3
      };

      if (repo.language && languageComplexity[repo.language]) {
        complexity += languageComplexity[repo.language];
      }

      // Size complexity (based on size in KB)
      if (repo.size > 10000) complexity += 2; // Large projects
      else if (repo.size > 1000) complexity += 1; // Medium projects

      // Recent activity bonus
      const daysSinceUpdate = Math.floor((Date.now() - new Date(repo.updated_at).getTime()) / (1000 * 60 * 60 * 24));
      if (daysSinceUpdate < 7) complexity += 1; // Recently active

      // Stars/forks indicate complexity
      if (repo.stargazers_count > 10) complexity += 1;
      if (repo.forks_count > 5) complexity += 1;

      // Cap at 10
      complexity = Math.min(complexity, 10);

      return { ...repo, complexity };
    });

    const averageComplexity = Math.round(reposWithComplexity.reduce((sum, repo) => sum + repo.complexity, 0) / repos.length * 10) / 10;
    const mostComplex = reposWithComplexity.sort((a, b) => b.complexity - a.complexity).slice(0, 3);

    const highComplexity = reposWithComplexity.filter(repo => repo.complexity >= 8).length;
    const mediumComplexity = reposWithComplexity.filter(repo => repo.complexity >= 5 && repo.complexity < 8).length;
    const lowComplexity = reposWithComplexity.filter(repo => repo.complexity < 5).length;

    // Generate insights
    const insights = [];
    if (languages.includes('TypeScript')) insights.push('‚Ä¢ Strong TypeScript usage indicates advanced development practices');
    if (highComplexity > repos.length * 0.3) insights.push('‚Ä¢ High proportion of complex projects shows advanced technical skills');
    if (repos.some(repo => repo.forks_count > 0)) insights.push('‚Ä¢ Forked repositories demonstrate open source contribution');
    if (repos.some(repo => new Date(repo.updated_at) > new Date(Date.now() - 7 * 24 * 60 * 60 * 1000))) {
      insights.push('‚Ä¢ Recent activity shows active development and maintenance');
    }

    return {
      languages,
      averageComplexity,
      mostComplex,
      highComplexity,
      mediumComplexity,
      lowComplexity,
      insights
    };
  }

  // üéØ CV RECOMMENDATIONS ACTION
  private async handleCVRecommendations(params: any): Promise<AIResponse> {
    if (!this.userContext.repositories.length) {
      return {
        message: "I need access to your repositories to provide CV recommendations. Please refresh the page or connect your GitHub account.",
        success: false,
      };
    }

    const recommendations = RepositorySorter.generateCVRecommendations(this.userContext.repositories);
    
    let message = "üéØ **CV Optimization Recommendations**\n\n";
    
    recommendations.forEach(rec => {
      message += `## ${rec.title}\n${rec.description}\n\n`;
      
      if (rec.repositories) {
        rec.repositories.forEach((repo, index) => {
          message += `${index + 1}. **${repo.name}**`;
          if (repo.complexity) message += ` (${repo.complexity.level} - Score: ${repo.complexity.score})`;
          if (repo.description) message += `\n   Description: ${repo.description}`;
          if (repo.complexity?.factors.length) message += `\n   Key factors: ${repo.complexity.factors.join(', ')}`;
          message += '\n\n';
        });
      }
    });

    message += "\nüí° **Pro Tips:**\n‚Ä¢ Lead with your most complex projects\n‚Ä¢ Ensure all featured repositories have good documentation\n‚Ä¢ Keep repository names professional and descriptive\n‚Ä¢ Add clear project descriptions\n\nWould you like me to sort your repositories in this recommended order?";

    return {
      message,
      action: {
        type: 'cv_recommendations',
        intent: 'CV optimization recommendations provided',
        parameters: { recommendationCount: recommendations.length },
        confidence: 1.0,
      },
      data: recommendations,
      success: true,
    };
  }

  // üé§ START INTERVIEW ACTION
  private async handleStartInterview(params: any): Promise<AIResponse> {
    console.log('üé§ Starting portfolio interview...');

    // Initialize interview state
    this.interviewState = {
      isActive: true,
      currentQuestion: 0,
      questions: this.getInterviewQuestions(),
      answers: {},
      completed: false,
    };

    // üíæ SAVE STATE TO LOCALSTORAGE
    this.saveInterviewState();

    const firstQuestion = this.interviewState.questions[0];

    return {
      message: firstQuestion.question,
      action: {
        type: 'start_interview',
        intent: 'Started portfolio interview',
        parameters: {
          questionId: firstQuestion.id,
          totalQuestions: this.interviewState.questions.length,
          currentQuestion: 1
        },
        confidence: 1.0,
      },
      data: {
        interviewActive: true,
        currentQuestion: 1,
        totalQuestions: this.interviewState.questions.length,
        questionId: firstQuestion.id
      },
      success: true,
    };
  }

  // üé§ HANDLE INTERVIEW ANSWER
  private async handleInterviewAnswer(params: any): Promise<AIResponse> {
    if (!this.interviewState.isActive) {
      return {
        message: "No interview is currently active. Would you like to start a portfolio interview?",
        success: false,
      };
    }

    const currentQuestion = this.interviewState.questions[this.interviewState.currentQuestion];
    const answer = params.answer || '';

    // Store the answer
    this.interviewState.answers[currentQuestion.id] = answer;

    // Move to next question
    this.interviewState.currentQuestion++;

    // üíæ SAVE STATE TO LOCALSTORAGE
    this.saveInterviewState();

    // Check if interview is complete
    if (this.interviewState.currentQuestion >= this.interviewState.questions.length) {
      this.interviewState.completed = true;
      this.interviewState.isActive = false;

      // üíæ CLEAR STATE FROM LOCALSTORAGE (interview complete)
      this.clearInterviewState();

      // Generate portfolio README based on answers
      const portfolioReadme = await this.generatePortfolioReadmeFromInterview();

      return {
        message: `üéâ **Interview Complete!**

Thank you for sharing your story! I've created a personalized portfolio README that captures your unique journey and passion.

Here's your custom README based on our conversation:

---

${portfolioReadme}

---

**Your README is ready to download!** This personal touch will help you stand out to recruiters and showcase the real person behind the code. üöÄ`,
        action: {
          type: 'interview_answer',
          intent: 'Interview completed, README generated',
          parameters: {
            completed: true,
            readmeGenerated: true
          },
          confidence: 1.0,
        },
        data: {
          interviewCompleted: true,
          portfolioReadme,
          downloadReady: true
        },
        success: true,
      };
    }

    // Continue with next question
    const nextQuestion = this.interviewState.questions[this.interviewState.currentQuestion];

    return {
      message: `Great answer! üòä

${nextQuestion.question}`,
      action: {
        type: 'interview_answer',
        intent: 'Interview continuing',
        parameters: {
          questionId: nextQuestion.id,
          currentQuestion: this.interviewState.currentQuestion + 1,
          totalQuestions: this.interviewState.questions.length
        },
        confidence: 1.0,
      },
      data: {
        interviewActive: true,
        currentQuestion: this.interviewState.currentQuestion + 1,
        totalQuestions: this.interviewState.questions.length,
        questionId: nextQuestion.id,
        progress: Math.round(((this.interviewState.currentQuestion) / this.interviewState.questions.length) * 100)
      },
      success: true,
    };
  }

  // üìù GENERATE PORTFOLIO README ACTION
  private async handleGeneratePortfolioReadme(params: any): Promise<AIResponse> {
    console.log('üìù Generating portfolio README...');

    if (this.userContext.repositories.length === 0) {
      return {
        message: "I need access to your repositories to generate a portfolio README. Please make sure your repositories are loaded first.",
        success: false,
      };
    }

    // Generate basic portfolio README without interview
    const portfolioReadme = await this.generateBasicPortfolioReadme();

    return {
      message: `üìù **Portfolio README Generated!**

I've created a comprehensive README based on your repository analysis:

---

${portfolioReadme}

---

**Want it more personalized?** Try saying "start interview" for a custom README that includes your personality and story! üé§`,
      action: {
        type: 'generate_portfolio_readme',
        intent: 'Basic portfolio README generated',
        parameters: {
          repositoryCount: this.userContext.repositories.length,
          includePersonal: false
        },
        confidence: 1.0,
      },
      data: {
        portfolioReadme,
        downloadReady: true,
        suggestInterview: true
      },
      success: true,
    };
  }

  // üí¨ GENERAL RESPONSE ACTION
  private async handleGeneralResponse(params: any): Promise<AIResponse> {
    const helpMessage = `**AI Assistant Ready**

I'm your GitHub repository assistant! I can help you with:

**Repository Management:**
‚Ä¢ "Create a new repo named [name]"
‚Ä¢ "Create a README file in my [repo] repository"
‚Ä¢ "Sort my repos by complexity"

**Analysis & Optimization:**
‚Ä¢ "Analyze my repository complexity"
‚Ä¢ "Sort repos for my CV"
‚Ä¢ "Give me CV recommendations"

**Smart Organization:**
‚Ä¢ Drag & drop to reorder repositories
‚Ä¢ Intelligent sorting algorithms
‚Ä¢ CV-optimized recommendations

**Examples:**
‚Ä¢ "Create a new repo named Hello World"
‚Ä¢ "Sort repos from simple to complex for my CV"
‚Ä¢ "Create a README in my portfolio repo"

What would you like me to help you with?`;

    return {
      message: helpMessage,
      success: true,
    };
  }

  // üîÑ FALLBACK PARSING (Simple Pattern Matching)
  private fallbackParsing(message: string): AIAction {
    const lowerMessage = message.toLowerCase();
    
    if (lowerMessage.includes('create') && lowerMessage.includes('repo')) {
      const nameMatch = message.match(/(?:named?|called?)\s+["']?([^"']+)["']?/i);
      return {
        type: 'create_repo',
        intent: 'Create repository',
        parameters: { name: nameMatch?.[1] || 'new-repository' },
        confidence: 0.8,
      };
    }
    
    // HIGHEST PRIORITY: Sort repositories by complexity (even if CV is mentioned)
    if (lowerMessage.includes('sort') && (lowerMessage.includes('complex') || lowerMessage.includes('simple') || lowerMessage.includes('difficulty'))) {
      return {
        type: 'sort_repos',
        intent: 'Sort repositories by complexity',
        parameters: { criteria: 'complexity', order: 'asc' },
        confidence: 0.95,
      };
    }

    // LOWER PRIORITY: CV recommendations only if no complexity sorting requested
    if (lowerMessage.includes('sort') && lowerMessage.includes('cv') && !lowerMessage.includes('complex') && !lowerMessage.includes('simple') && !lowerMessage.includes('difficulty')) {
      return {
        type: 'cv_recommendations',
        intent: 'CV optimization recommendations',
        parameters: {},
        confidence: 0.8,
      };
    }

    // üß† ANALYZE COMPLEXITY/STRUCTURE
    if (lowerMessage.includes('analyze') && (lowerMessage.includes('complex') || lowerMessage.includes('structure') || lowerMessage.includes('repository'))) {
      return {
        type: 'analyze_complexity',
        intent: 'Analyze repository complexity and structure',
        parameters: { all: true },
        confidence: 0.9,
      };
    }

    // üé§ START INTERVIEW
    if (lowerMessage.includes('start') && lowerMessage.includes('interview')) {
      return {
        type: 'start_interview',
        intent: 'Start portfolio interview',
        parameters: {},
        confidence: 0.9,
      };
    }

    // üìù GENERATE PORTFOLIO README
    if (lowerMessage.includes('portfolio') && lowerMessage.includes('readme')) {
      return {
        type: 'generate_portfolio_readme',
        intent: 'Generate portfolio README',
        parameters: {},
        confidence: 0.8,
      };
    }

    return {
      type: 'general_response',
      intent: 'General help',
      parameters: {},
      confidence: 0.5,
    };
  }

  // üìù UPDATE USER CONTEXT
  updateContext(repositories: any[], preferences?: any) {
    this.userContext.repositories = repositories;
    if (preferences) {
      this.userContext.preferences = { ...this.userContext.preferences, ...preferences };
    }
  }

  // üí¨ ADD TO CONVERSATION HISTORY
  addToHistory(role: 'user' | 'assistant', content: string) {
    this.userContext.conversationHistory.push({
      role,
      content,
      timestamp: new Date(),
    });

    // Keep only last 20 messages
    if (this.userContext.conversationHistory.length > 20) {
      this.userContext.conversationHistory = this.userContext.conversationHistory.slice(-20);
    }
  }

  // üîç GET AUTHENTICATED USERNAME
  private async getAuthenticatedUsername(): Promise<string> {
    if (!this.githubAPI) return 'user';

    try {
      // Use the GitHub API to get the authenticated user
      const response = await (this.githubAPI as any).octokit.request('GET /user');
      return response.data.login;
    } catch (error) {
      console.error('‚ùå Failed to get authenticated username:', error);
      return 'user';
    }
  }

  // üé® GENERATE PORTFOLIO README FROM INTERVIEW
  private async generatePortfolioReadmeFromInterview(): Promise<string> {
    const answers = this.interviewState.answers;
    const repos = this.userContext.repositories;

    // Analyze repositories for tech stack and recent projects
    const repoAnalysis = this.analyzeRepositories(repos);
    const recentProjects = this.getRecentProjects(repos, 3);

    // Extract personal info from interview answers
    const personalData: PortfolioData = {
      name: this.extractNameFromAnswer(answers.name_passion),
      codingPassion: this.extractPassionFromAnswer(answers.name_passion),
      recentExcitement: answers.recent_excitement,
      careerGoals: answers.career_goals,
      hobbies: answers.hobbies_personality,
      techFocus: answers.tech_focus,
      personalStory: answers.personal_story,
    };

    return this.buildPersonalizedReadme(personalData, repoAnalysis, recentProjects);
  }

  // üé® GENERATE BASIC PORTFOLIO README
  private async generateBasicPortfolioReadme(): Promise<string> {
    const repos = this.userContext.repositories;
    const repoAnalysis = this.analyzeRepositories(repos);
    const recentProjects = this.getRecentProjects(repos, 3);

    const basicData: PortfolioData = {
      name: "Developer", // Default name
      codingPassion: "building innovative solutions",
      techFocus: repoAnalysis.primaryLanguages.join(", "),
    };

    return this.buildPersonalizedReadme(basicData, repoAnalysis, recentProjects);
  }

  // üìä ANALYZE REPOSITORIES
  private analyzeRepositories(repos: any[]) {
    const languages: Record<string, number> = {};
    const frameworks: string[] = [];
    let totalStars = 0;
    let mostStarredRepo = null;
    let maxStars = 0;

    repos.forEach(repo => {
      // Count languages
      if (repo.language) {
        languages[repo.language] = (languages[repo.language] || 0) + 1;
      }

      // Track stars
      totalStars += repo.stargazers_count || 0;
      if ((repo.stargazers_count || 0) > maxStars) {
        maxStars = repo.stargazers_count || 0;
        mostStarredRepo = repo;
      }

      // Detect frameworks (basic detection)
      if (repo.name.includes('react') || repo.description?.toLowerCase().includes('react')) {
        frameworks.push('React');
      }
      if (repo.name.includes('next') || repo.description?.toLowerCase().includes('next')) {
        frameworks.push('Next.js');
      }
      if (repo.name.includes('vue') || repo.description?.toLowerCase().includes('vue')) {
        frameworks.push('Vue.js');
      }
    });

    const primaryLanguages = Object.entries(languages)
      .sort(([,a], [,b]) => b - a)
      .slice(0, 3)
      .map(([lang]) => lang);

    return {
      primaryLanguages,
      frameworks: [...new Set(frameworks)],
      totalStars,
      mostStarredRepo,
      totalRepos: repos.length,
      languages
    };
  }

  // üìÖ GET RECENT PROJECTS
  private getRecentProjects(repos: any[], count: number = 3) {
    return repos
      .filter(repo => !repo.fork) // Exclude forks
      .sort((a, b) => new Date(b.updated_at).getTime() - new Date(a.updated_at).getTime())
      .slice(0, count);
  }

  // üé≠ BUILD PERSONALIZED README
  private buildPersonalizedReadme(data: PortfolioData, analysis: any, recentProjects: any[]): string {
    const name = data.name || "Developer";
    const passion = data.codingPassion || "building innovative solutions";
    const hobbies = data.hobbies ? ` When I'm not coding, ${data.hobbies.toLowerCase()}.` : "";

    let readme = `# Hi, I'm ${name}\n\n`;

    // Personal intro
    readme += `I'm a passionate developer who loves ${passion}.${hobbies}\n\n`;

    // What drives me section
    if (data.careerGoals) {
      readme += `## What drives me\n`;
      readme += `${data.careerGoals}\n\n`;
    }

    // Tech journey
    readme += `## My Tech Journey\n`;
    if (data.techFocus) {
      readme += `I'm currently focused on ${data.techFocus}. `;
    }
    readme += `I work primarily with ${analysis.primaryLanguages.join(", ")}`;
    if (analysis.frameworks.length > 0) {
      readme += ` and love building with ${analysis.frameworks.join(", ")}`;
    }
    readme += `.\n\n`;

    // Recent projects
    if (data.recentExcitement) {
      readme += `## What I'm excited about lately\n`;
      readme += `${data.recentExcitement}\n\n`;
    }

    if (recentProjects.length > 0) {
      readme += `## Recent Projects\n\n`;
      recentProjects.forEach(project => {
        readme += `**${project.name}** - ${project.description || "An exciting project I've been working on"}\n`;
      });
      readme += `\n`;
    }

    // Tech stack
    readme += `## üõ†Ô∏è Technologies I work with\n\n`;
    readme += `**Languages:** ${analysis.primaryLanguages.join(" ‚Ä¢ ")}\n`;
    if (analysis.frameworks.length > 0) {
      readme += `**Frameworks:** ${analysis.frameworks.join(" ‚Ä¢ ")}\n`;
    }
    readme += `**Total Repositories:** ${analysis.totalRepos}\n`;
    if (analysis.totalStars > 0) {
      readme += `**GitHub Stars:** ${analysis.totalStars} ‚≠ê\n`;
    }
    readme += `\n`;

    // Personal story
    if (data.personalStory) {
      readme += `## üåü My Story\n`;
      readme += `${data.personalStory}\n\n`;
    }

    // GitHub stats
    readme += `## üìä GitHub Stats\n\n`;
    readme += `![GitHub Stats](https://github-readme-stats.vercel.app/api?username=YOUR_USERNAME&show_icons=true&theme=radical)\n\n`;

    // What's next
    if (data.careerGoals) {
      readme += `## üéØ What's Next\n`;
      readme += `I'm always looking for new challenges and opportunities to grow. ${data.careerGoals}\n\n`;
    }

    readme += `---\n\n`;
    readme += `üí¨ **Let's connect!** I'm always excited to collaborate on interesting projects or just chat about tech.\n`;

    return readme;
  }

  // üîç EXTRACT NAME FROM ANSWER
  private extractNameFromAnswer(answer: string): string {
    if (!answer) return "Developer";

    // Look for "I'm [name]" or "My name is [name]" patterns
    const patterns = [
      /(?:i'm|i am)\s+([a-zA-Z]+)/i,
      /(?:my name is|name is)\s+([a-zA-Z]+)/i,
      /^([a-zA-Z]+)(?:\s|,|\.)/,
    ];

    for (const pattern of patterns) {
      const match = answer.match(pattern);
      if (match && match[1]) {
        return match[1].charAt(0).toUpperCase() + match[1].slice(1).toLowerCase();
      }
    }

    return "Developer";
  }

  // üíù EXTRACT PASSION FROM ANSWER
  private extractPassionFromAnswer(answer: string): string {
    if (!answer) return "building innovative solutions";

    // Look for passion indicators
    const passionKeywords = ["love", "passionate", "enjoy", "excited", "fascinated"];
    const lowerAnswer = answer.toLowerCase();

    for (const keyword of passionKeywords) {
      const index = lowerAnswer.indexOf(keyword);
      if (index !== -1) {
        // Extract the part after the passion keyword
        const afterKeyword = answer.substring(index + keyword.length).trim();
        if (afterKeyword.length > 0) {
          return afterKeyword.split('.')[0].trim();
        }
      }
    }

    return "building innovative solutions";
  }
}

// üåü SINGLETON INSTANCE
export const aiAssistant = new AIAssistantEngine();

</code>

lib\gemini.ts:
<code>
// Gemini AI integration using Gemini 2.0 Flash
import { GoogleGenerativeAI } from "@google/generative-ai"

interface ChatMessage {
  role: "user" | "assistant"
  content: string
}

export class GeminiAI {
  private apiKey: string
  private genAI: GoogleGenerativeAI
  private model: any

  constructor() {
    this.apiKey = process.env.NEXT_PUBLIC_GEMINI_API_KEY || "AIzaSyAkgwl43yl9TlceXNeifbGztVLEYe83nPw"
    if (!this.apiKey) {
      throw new Error("NEXT_PUBLIC_GEMINI_API_KEY environment variable is required")
    }

    this.genAI = new GoogleGenerativeAI(this.apiKey)
    // Using Gemini 2.5 Pro model for enhanced capabilities
    this.model = this.genAI.getGenerativeModel({
      model: "gemini-2.5-pro",
      generationConfig: {
        temperature: 0.7,
        topP: 0.8,
        topK: 40,
        maxOutputTokens: 8192,
      },
    })
  }

  async generateResponse(
    message: string,
    conversationHistory: ChatMessage[] = [],
    systemPrompt?: string,
    signal?: AbortSignal,
  ): Promise<string> {
    try {
      // Build conversation context
      let prompt = ""

      if (systemPrompt) {
        prompt += `${systemPrompt}\n\n`
      }

      // Add conversation history
      if (conversationHistory.length > 0) {
        prompt += "Previous conversation:\n"
        conversationHistory.forEach((msg) => {
          prompt += `${msg.role === "user" ? "Human" : "Assistant"}: ${msg.content}\n`
        })
        prompt += "\n"
      }

      prompt += `Human: ${message}\nAssistant:`

      const result = await this.model.generateContent(prompt, { signal })
      const response = await result.response
      const text = response.text()

      if (!text) {
        throw new Error("Empty response from Gemini API")
      }

      return text
    } catch (error) {
      console.error("Gemini AI Error:", error)
      throw new Error(`Failed to generate response: ${error instanceof Error ? error.message : "Unknown error"}`)
    }
  }

  async analyzeRepository(
    repoData: any,
    userProfile?: {
      targetJob?: string
      techStack?: string
      userNotes?: string
    },
  ) {
    const prompt = this.buildRepositoryAnalysisPrompt(repoData, userProfile)

    try {
      const response = await this.generateResponse(
        prompt,
        [],
        "You are a helpful AI assistant that helps developers improve their GitHub repositories before applying for internships or jobs. Always respond in markdown format with the exact sections requested.",
      )

      // Try to parse structured response, fallback to raw response if parsing fails
      try {
        return {
          analysis: response,
          suggestions: this.extractSuggestionsFromAnalysis(response),
          score: this.extractScoreFromAnalysis(response),
          resumeBullet: this.extractResumeBulletFromAnalysis(response),
        }
      } catch {
        return {
          analysis: response,
          suggestions: [
            {
              type: "analysis",
              title: "Repository Analysis",
              description: response,
              priority: "medium",
            },
          ],
          score: 75,
          resumeBullet: `Built ${repoData.name} using ${repoData.language || "modern technologies"} with focus on clean code architecture and user experience.`,
        }
      }
    } catch (error) {
      console.error("Repository analysis error:", error)
      throw new Error("Failed to analyze repository")
    }
  }

  private buildRepositoryAnalysisPrompt(
    repoData: any,
    userProfile?: {
      targetJob?: string
      techStack?: string
      userNotes?: string
    },
  ): string {
    return `üß† **Repository Analysis Request**

You are a helpful AI assistant that helps developers improve their GitHub repositories before applying for internships or jobs.

The user will provide you a repository's structure and basic information. Based on this, your task is to analyze and give specific feedback across the following categories:

---

üìÅ **Repository Name**: ${repoData.name || "Unknown"}
üìù **Description**: ${repoData.description || "No description provided"}
üìÇ **Primary Language**: ${repoData.language || "Unknown"}
‚≠ê **Stars**: ${repoData.stargazers_count || 0}
üç¥ **Forks**: ${repoData.forks_count || 0}
üîó **Repository URL**: ${repoData.html_url || "Not available"}

üßë‚Äçüíª **User Profile**:
- Target job: ${userProfile?.targetJob || "General software development"} (e.g. frontend dev, fullstack intern, ML engineer)
- Tech stack: ${userProfile?.techStack || "Not specified"} (e.g. React, TypeScript, Python, FastAPI)
- Notes: ${userProfile?.userNotes || "No additional notes"}

---

Return your analysis in **markdown** format with the following sections:

## ‚úÖ What This Project Does
- Short summary of what the project is about (in 1-2 sentences)

## üîç How Recruiters Might See It
- Review from the perspective of a hiring manager or tech recruiter

## üßπ Suggestions to Improve This Repo
- Documentation (e.g. missing sections?)
- File/folder structure (e.g. too deep, unclear names?)
- Code quality hints (if possible)
- Deployment and demo recommendations

## üß† How to Include This in Your Resume
- One-sentence resume bullet point in STAR format  
- Tips to describe it during interview

## ‚≠ê Final Portfolio Score
- Give a rating from 1-10 based on how job-ready this repo is
- Brief explanation of the score

Keep the tone friendly but professional.

**Example Output Format:**

### ‚úÖ What This Project Does
A grammar correction web app that uses OpenAI GPT API to detect and fix typos in English text. Users paste input and see fixes in real time.

### üîç How Recruiters Might See It
This is a solid showcase of frontend + AI integration. The use of GPT adds uniqueness, and the tech stack (React + TypeScript) is aligned with modern frontend roles. README is decent, but could use deployment link and example screenshots.

### üßπ Suggestions to Improve This Repo
- Add live demo link on Vercel
- Include before/after grammar example in README
- Add unit tests for grammar fixing component
- Rename \`api/\` to \`services/\` for clarity
- Improve folder grouping (move utils under \`lib/\`)

### üß† How to Include This in Your Resume
> üõ† Built a grammar correction web app using React and GPT API, enabling real-time feedback for over 300+ users, with clean TypeScript architecture.

Tip: In interviews, emphasize the API integration challenge and how you handled prompt engineering.

### ‚≠ê Final Portfolio Score
**7.5 / 10** ‚Äî Good tech stack, cool idea, just missing polish (demos, tests, better README).`
  }

  private extractSuggestionsFromAnalysis(analysis: string): any[] {
    const suggestions = []
    const lines = analysis.split("\n")
    let inSuggestionsSection = false

    for (const line of lines) {
      if (line.includes("üßπ") && line.includes("Suggestions")) {
        inSuggestionsSection = true
        continue
      }

      if (inSuggestionsSection && line.startsWith("###")) {
        inSuggestionsSection = false
        break
      }

      if (inSuggestionsSection && line.trim().startsWith("-")) {
        const suggestion = line.trim().substring(1).trim()
        if (suggestion) {
          suggestions.push({
            type: "improvement",
            title: suggestion.split(" ")[0] || "Improvement",
            description: suggestion,
            priority: "medium",
          })
        }
      }
    }

    return suggestions.length > 0
      ? suggestions
      : [
          {
            type: "general",
            title: "Code Review Needed",
            description: "Consider adding more documentation and examples",
            priority: "medium",
          },
        ]
  }

  private extractScoreFromAnalysis(analysis: string): number {
    const scoreMatch = analysis.match(/(\d+(?:\.\d+)?)\s*\/\s*10/)
    if (scoreMatch) {
      return Number.parseFloat(scoreMatch[1]) * 10 // Convert to 100-point scale
    }
    return 75 // Default score
  }

  private extractResumeBulletFromAnalysis(analysis: string): string {
    const lines = analysis.split("\n")
    let inResumeSection = false

    for (const line of lines) {
      if (line.includes("üß†") && line.includes("Resume")) {
        inResumeSection = true
        continue
      }

      if (inResumeSection && line.startsWith("###")) {
        inResumeSection = false
        break
      }

      if (inResumeSection && line.trim().startsWith(">")) {
        return line.trim().substring(1).trim()
      }
    }

    return "Built a comprehensive application showcasing modern development practices and clean architecture."
  }

  async generateReadme(repoData: any) {
    const prompt = `Generate a comprehensive README.md for this GitHub repository:
    
    Repository: ${repoData.name}
    Description: ${repoData.description}
    Language: ${repoData.language}
    
    Include sections for:
    - Project description
    - Features
    - Installation
    - Usage
    - Contributing
    - License
    
    Make it professional and informative.`

    try {
      return await this.generateResponse(
        prompt,
        [],
        "You are a technical writer creating professional README documentation.",
      )
    } catch (error) {
      console.error("README generation error:", error)
      // Fallback README
      return `# ${repoData.name}

${repoData.description || "A project built with modern technologies."}

## Installation

\`\`\`bash
git clone ${repoData.clone_url || ""}
cd ${repoData.name}
npm install
\`\`\`

## Usage

Please refer to the documentation for usage instructions.

## Contributing

Contributions are welcome! Please feel free to submit a Pull Request.

## License

This project is licensed under the MIT License.`
    }
  }

  async analyzeRepositoryDetailed(
    repoData: any,
    options?: {
      readmeContent?: string
      folderStructure?: string
      userProfile?: {
        targetJob?: string
        techStack?: string
        userNotes?: string
      }
    },
  ) {
    const prompt = `üß† **Detailed Repository Analysis Request**

You are a helpful AI assistant that helps developers improve their GitHub repositories before applying for internships or jobs.

The user will provide you a repository's structure and basic information like the README content. Based on this, your task is to analyze and give specific feedback across the following categories:

---

üìÅ **Repository Name**: ${repoData.name || "Unknown"}
üìù **README.md Content**: 
${options?.readmeContent || "No README content provided"}

üìÇ **Folder Structure**:
${options?.folderStructure || "No folder structure provided"}

üîó **Repository Details**:
- Description: ${repoData.description || "No description"}
- Language: ${repoData.language || "Unknown"}
- Stars: ${repoData.stargazers_count || 0}
- Forks: ${repoData.forks_count || 0}
- URL: ${repoData.html_url || "Not available"}

üßë‚Äçüíª **User Profile**:
- Target job: ${options?.userProfile?.targetJob || "General software development"} (e.g. frontend dev, fullstack intern, ML engineer)
- Tech stack: ${options?.userProfile?.techStack || "Not specified"} (e.g. React, TypeScript, Python, FastAPI)
- Notes: ${options?.userProfile?.userNotes || "No additional notes"}

---

Return your analysis in **markdown** format with the following sections:

## ‚úÖ What This Project Does
- Short summary of what the project is about (in 1-2 sentences)

## üîç How Recruiters Might See It
- Review from the perspective of a hiring manager or tech recruiter
- Alignment with target job role

## üßπ Suggestions to Improve This Repo
- Documentation improvements (missing sections, clarity issues)
- File/folder structure recommendations
- Code quality and organization hints
- Deployment and demo suggestions
- Missing features or enhancements

## üß† How to Include This in Your Resume
- One-sentence resume bullet point in STAR format (Situation, Task, Action, Result)
- Tips to describe it during interview
- Key technical skills to highlight

## ‚≠ê Final Portfolio Score
- Give a rating from 1-10 based on how job-ready this repo is
- Brief explanation of the score with specific areas for improvement

Keep the tone friendly but professional. Be specific and actionable in your suggestions.`

    try {
      const response = await this.generateResponse(
        prompt,
        [],
        "You are a senior software engineer and technical recruiter helping developers improve their GitHub portfolios for job applications. Always respond in clean markdown format.",
      )

      return {
        analysis: response,
        suggestions: this.extractSuggestionsFromAnalysis(response),
        score: this.extractScoreFromAnalysis(response),
        resumeBullet: this.extractResumeBulletFromAnalysis(response),
        recruitersView: this.extractRecruitersViewFromAnalysis(response),
      }
    } catch (error) {
      console.error("Detailed repository analysis error:", error)
      throw new Error("Failed to analyze repository in detail")
    }
  }

  private extractRecruitersViewFromAnalysis(analysis: string): string {
    const lines = analysis.split("\n")
    let inRecruitersSection = false
    let content = ""

    for (const line of lines) {
      if (line.includes("üîç") && line.includes("Recruiters")) {
        inRecruitersSection = true
        continue
      }

      if (inRecruitersSection && line.startsWith("##")) {
        break
      }

      if (inRecruitersSection && line.trim()) {
        content += line.trim() + " "
      }
    }

    return (
      content.trim() || "This repository shows good technical skills and would be interesting to potential employers."
    )
  }

  async generateCommitMessage(changes: string[]) {
    const prompt = `Generate a clear, conventional commit message for these changes:
    
    Changes:
    ${changes.join("\n")}
    
    Follow conventional commit format (feat:, fix:, docs:, etc.)`

    try {
      return await this.generateResponse(
        prompt,
        [],
        "You are a developer creating conventional commit messages. Keep them concise and clear.",
      )
    } catch (error) {
      console.error("Commit message generation error:", error)
      return "feat: update project files and documentation"
    }
  }
}

export const geminiAI = new GeminiAI()

</code>

lib\github-api.ts:
<code>
// GitHub API Integration for Real Actions
import { Octokit } from "@octokit/rest";

export interface CreateRepoParams {
  name: string;
  description?: string;
  private?: boolean;
  auto_init?: boolean;
  gitignore_template?: string;
  license_template?: string;
}

export interface CreateFileParams {
  owner: string;
  repo: string;
  path: string;
  content: string;
  message: string;
  branch?: string;
}

interface DeleteRepoParams {
  owner: string;
  name: string;
}

export interface RepositoryComplexity {
  score: number;
  factors: {
    languages: number;
    fileCount: number;
    dependencies: number;
    architecture: number;
    documentation: number;
  };
  level: 'Simple' | 'Intermediate' | 'Complex' | 'Advanced';
  reasoning: string;
}

export class GitHubAPIService {
  private octokit: Octokit;
  private username: string;

  constructor(accessToken: string, username: string) {
    this.octokit = new Octokit({
      auth: accessToken,
    });
    this.username = username;
  }

  // üöÄ CREATE NEW REPOSITORY
  async createRepository(params: CreateRepoParams) {
    try {
      console.log(`üöÄ Creating repository: ${params.name}`);

      // Test if octokit is properly initialized
      console.log('üîç Testing Octokit instance:', typeof this.octokit);
      console.log('üîç Testing rest property:', typeof this.octokit.rest);
      console.log('üîç Testing repos property:', typeof this.octokit.rest?.repos);

      const response = await this.octokit.request('POST /user/repos', {
        name: params.name,
        description: params.description || `Repository created by NeatRepo`,
        private: params.private || false,
        auto_init: params.auto_init || true,
        gitignore_template: params.gitignore_template,
        license_template: params.license_template,
      });

      console.log(`‚úÖ Repository created: ${response.data.html_url}`);
      return {
        success: true,
        repository: response.data,
        url: response.data.html_url,
      };
    } catch (error: any) {
      console.error('‚ùå Failed to create repository:', error);
      return {
        success: false,
        error: error.message || 'Failed to create repository',
      };
    }
  }

  // üìÑ CREATE FILE IN REPOSITORY
  async createFile(params: CreateFileParams) {
    try {
      console.log(`üìÑ Creating file: ${params.path} in ${params.owner}/${params.repo}`);
      
      const content = Buffer.from(params.content).toString('base64');
      
      const response = await this.octokit.rest.repos.createOrUpdateFileContents({
        owner: params.owner,
        repo: params.repo,
        path: params.path,
        message: params.message,
        content: content,
        branch: params.branch || 'main',
      });

      console.log(`‚úÖ File created: ${response.data.content?.html_url}`);
      return {
        success: true,
        file: response.data,
        url: response.data.content?.html_url,
      };
    } catch (error: any) {
      console.error('‚ùå Failed to create file:', error);
      return {
        success: false,
        error: error.message || 'Failed to create file',
      };
    }
  }

  // üóëÔ∏è DELETE REPOSITORY
  async deleteRepository(params: DeleteRepoParams) {
    try {
      console.log(`üóëÔ∏è Deleting repository: ${params.owner}/${params.name}`);

      const response = await this.octokit.request('DELETE /repos/{owner}/{repo}', {
        owner: params.owner,
        repo: params.name,
      });

      console.log(`‚úÖ Repository deleted: ${params.owner}/${params.name}`);
      return {
        success: true,
        message: `Repository ${params.name} has been permanently deleted`,
      };
    } catch (error: any) {
      console.error('‚ùå Failed to delete repository:', error);
      return {
        success: false,
        error: error.message || 'Failed to delete repository',
      };
    }
  }

  // üß† ANALYZE REPOSITORY COMPLEXITY
  async analyzeRepositoryComplexity(owner: string, repo: string): Promise<RepositoryComplexity> {
    try {
      console.log(`üß† Analyzing complexity for: ${owner}/${repo}`);

      // Get repository details
      const repoData = await this.octokit.rest.repos.get({ owner, repo });
      
      // Get languages
      const languages = await this.octokit.rest.repos.listLanguages({ owner, repo });
      
      // Get repository contents
      const contents = await this.octokit.rest.repos.getContent({ 
        owner, 
        repo, 
        path: '' 
      });

      // Calculate complexity factors
      const languageCount = Object.keys(languages.data).length;
      const fileCount = Array.isArray(contents.data) ? contents.data.length : 1;
      
      // Check for package.json, requirements.txt, etc.
      let dependencyComplexity = 0;
      if (Array.isArray(contents.data)) {
        const hasPackageJson = contents.data.some(file => file.name === 'package.json');
        const hasRequirements = contents.data.some(file => file.name === 'requirements.txt');
        const hasCargoToml = contents.data.some(file => file.name === 'Cargo.toml');
        const hasPomXml = contents.data.some(file => file.name === 'pom.xml');
        
        dependencyComplexity = [hasPackageJson, hasRequirements, hasCargoToml, hasPomXml]
          .filter(Boolean).length * 2;
      }

      // Check for documentation
      const hasReadme = Array.isArray(contents.data) && 
        contents.data.some(file => file.name.toLowerCase().includes('readme'));
      const documentationScore = hasReadme ? 2 : 0;

      // Calculate architecture complexity (based on folder structure)
      const architectureScore = fileCount > 10 ? 3 : fileCount > 5 ? 2 : 1;

      // Calculate total complexity score
      const factors = {
        languages: languageCount,
        fileCount: Math.min(fileCount / 5, 5), // Normalize to max 5
        dependencies: dependencyComplexity,
        architecture: architectureScore,
        documentation: documentationScore,
      };

      const totalScore = Object.values(factors).reduce((sum, score) => sum + score, 0);
      
      // Determine complexity level
      let level: RepositoryComplexity['level'];
      let reasoning: string;

      if (totalScore <= 5) {
        level = 'Simple';
        reasoning = 'Basic project with minimal dependencies and straightforward structure';
      } else if (totalScore <= 10) {
        level = 'Intermediate';
        reasoning = 'Well-structured project with moderate complexity and dependencies';
      } else if (totalScore <= 15) {
        level = 'Complex';
        reasoning = 'Advanced project with multiple technologies and sophisticated architecture';
      } else {
        level = 'Advanced';
        reasoning = 'Highly complex project with extensive dependencies and advanced patterns';
      }

      console.log(`‚úÖ Complexity analysis complete: ${level} (${totalScore})`);

      return {
        score: totalScore,
        factors,
        level,
        reasoning,
      };
    } catch (error: any) {
      console.error('‚ùå Failed to analyze repository complexity:', error);
      return {
        score: 0,
        factors: {
          languages: 0,
          fileCount: 0,
          dependencies: 0,
          architecture: 0,
          documentation: 0,
        },
        level: 'Simple',
        reasoning: 'Unable to analyze repository complexity',
      };
    }
  }

  // üìä GET USER REPOSITORIES WITH COMPLEXITY
  async getRepositoriesWithComplexity() {
    try {
      console.log(`üìä Fetching repositories with complexity analysis...`);
      
      const repos = await this.octokit.rest.repos.listForAuthenticatedUser({
        sort: 'updated',
        per_page: 100,
      });

      const repositoriesWithComplexity = await Promise.all(
        repos.data.map(async (repo) => {
          const complexity = await this.analyzeRepositoryComplexity(repo.owner.login, repo.name);
          return {
            ...repo,
            complexity,
          };
        })
      );

      console.log(`‚úÖ Analyzed ${repositoriesWithComplexity.length} repositories`);
      return repositoriesWithComplexity;
    } catch (error: any) {
      console.error('‚ùå Failed to fetch repositories with complexity:', error);
      throw new Error('Failed to analyze repositories');
    }
  }
}

// üéØ REPOSITORY SORTING UTILITIES
export class RepositorySorter {
  static sortByComplexity(repositories: any[], order: 'asc' | 'desc' = 'asc') {
    return repositories.sort((a, b) => {
      const scoreA = a.complexity?.score || 0;
      const scoreB = b.complexity?.score || 0;
      return order === 'asc' ? scoreA - scoreB : scoreB - scoreA;
    });
  }

  static sortForCV(repositories: any[]) {
    // Sort repositories in optimal order for CV:
    // 1. Complex/Advanced projects first
    // 2. Well-documented projects
    // 3. Recent projects
    // 4. Projects with good naming
    
    return repositories.sort((a, b) => {
      // Primary: Complexity score (higher first)
      const complexityDiff = (b.complexity?.score || 0) - (a.complexity?.score || 0);
      if (complexityDiff !== 0) return complexityDiff;
      
      // Secondary: Documentation (has README)
      const aHasReadme = a.complexity?.factors?.documentation > 0 ? 1 : 0;
      const bHasReadme = b.complexity?.factors?.documentation > 0 ? 1 : 0;
      const docDiff = bHasReadme - aHasReadme;
      if (docDiff !== 0) return docDiff;
      
      // Tertiary: Recent updates
      const aDate = new Date(a.updated_at).getTime();
      const bDate = new Date(b.updated_at).getTime();
      return bDate - aDate;
    });
  }

  static generateCVRecommendations(repositories: any[]) {
    const sorted = this.sortForCV(repositories);
    const recommendations = [];

    // Top 5 repositories for CV
    const topRepos = sorted.slice(0, 5);
    
    recommendations.push({
      type: 'cv_order',
      title: 'üéØ Recommended CV Order',
      description: 'These repositories should be featured prominently on your CV',
      repositories: topRepos.map((repo, index) => ({
        position: index + 1,
        name: repo.name,
        reason: this.getRecommendationReason(repo, index),
        complexity: repo.complexity?.level || 'Unknown',
      })),
    });

    // Improvement suggestions
    const improvements = this.generateImprovementSuggestions(repositories);
    recommendations.push(...improvements);

    return recommendations;
  }

  private static getRecommendationReason(repo: any, position: number): string {
    const complexity = repo.complexity?.level || 'Unknown';
    const hasReadme = repo.complexity?.factors?.documentation > 0;
    
    if (position === 0) {
      return `Lead project - ${complexity} complexity showcases your technical skills`;
    } else if (complexity === 'Advanced' || complexity === 'Complex') {
      return `Demonstrates advanced technical capabilities (${complexity})`;
    } else if (hasReadme) {
      return `Well-documented project shows professionalism`;
    } else {
      return `Recent project demonstrates current activity`;
    }
  }

  private static generateImprovementSuggestions(repositories: any[]) {
    const suggestions = [];
    
    // Check for repositories without README
    const noReadme = repositories.filter(repo => 
      repo.complexity?.factors?.documentation === 0
    );
    
    if (noReadme.length > 0) {
      suggestions.push({
        type: 'improvement',
        title: 'üìù Add Documentation',
        description: 'These repositories would benefit from README files',
        repositories: noReadme.slice(0, 3).map(repo => ({
          name: repo.name,
          suggestion: 'Add a comprehensive README with project description, setup instructions, and usage examples',
        })),
      });
    }

    return suggestions;
  }
}

</code>

lib\repository-manager.ts:
<code>
// ULTRA-FAST repository manager - TARGET: 1-3 SECOND LOADING üöÄ
class RepositoryManager {
  private static instance: RepositoryManager;
  private repositories: any[] = [];
  private lastFetch: number = 0;
  private isInitialized: boolean = false;
  private listeners: Set<(repos: any[]) => void> = new Set();
  private streamingListeners: Set<(repo: any) => void> = new Set();
  private isFetching: boolean = false;
  private loadingStartTime: number = 0;

  private constructor() {
    this.loadFromCache();
  }

  static getInstance(): RepositoryManager {
    if (!RepositoryManager.instance) {
      RepositoryManager.instance = new RepositoryManager();
    }
    return RepositoryManager.instance;
  }

  private loadFromCache(userId?: string) {
    // Skip on server side
    if (typeof window === 'undefined') return false;

    try {
      // Try user-specific cache first, then fall back to global cache
      const cacheKey = userId ? `github_repositories_${userId}` : 'github_repositories';
      const timeKey = userId ? `github_repositories_time_${userId}` : 'github_repositories_time';

      const cached = localStorage.getItem(cacheKey);
      const cacheTime = localStorage.getItem(timeKey);

      if (cached && cacheTime) {
        const timeSinceCache = Date.now() - parseInt(cacheTime);
        // üöÄ IMPROVED UX: Only use cache if very recent (5 minutes) for better freshness
        if (timeSinceCache < 300000) { // 5 minutes instead of 1 hour
          this.repositories = JSON.parse(cached);
          this.lastFetch = parseInt(cacheTime);
          this.isInitialized = true;
          console.log(`‚ö° SINGLETON: Loaded ${this.repositories.length} repositories from ${userId ? 'user-specific' : 'global'} cache (${Math.round(timeSinceCache/1000)}s old)`);
          this.notifyListeners();
          return true;
        } else {
          console.log(`üîÑ SINGLETON: Cache is stale (${Math.round(timeSinceCache/60000)} minutes old), will fetch fresh data`);
        }
      }
    } catch (error) {
      console.log('üìÅ SINGLETON: Cache load failed:', error);
    }
    return false;
  }

  private saveToCache(userId?: string) {
    // Skip on server side
    if (typeof window === 'undefined') return;

    try {
      // Save to user-specific cache if userId provided, otherwise global cache
      const cacheKey = userId ? `github_repositories_${userId}` : 'github_repositories';
      const timeKey = userId ? `github_repositories_time_${userId}` : 'github_repositories_time';

      localStorage.setItem(cacheKey, JSON.stringify(this.repositories));
      localStorage.setItem(timeKey, Date.now().toString());
      this.lastFetch = Date.now();
      console.log(`üíæ SINGLETON: Repositories cached to ${userId ? 'user-specific' : 'global'} storage`);
    } catch (error) {
      console.log('üìÅ SINGLETON: Cache save failed:', error);
    }
  }

  private notifyListeners() {
    this.listeners.forEach(listener => listener([...this.repositories]));
  }

  subscribe(listener: (repos: any[]) => void): () => void {
    this.listeners.add(listener);
    // Immediately provide current data
    listener([...this.repositories]);
    
    return () => {
      this.listeners.delete(listener);
    };
  }

  getRepositories(): any[] {
    return [...this.repositories];
  }

  // Add streaming listener for real-time updates
  addStreamingListener(listener: (repo: any) => void): () => void {
    this.streamingListeners.add(listener);
    return () => {
      this.streamingListeners.delete(listener);
    };
  }

  private notifyStreamingListeners(repo: any) {
    this.streamingListeners.forEach(listener => {
      try {
        listener(repo);
      } catch (error) {
        console.error('üö® SINGLETON: Streaming listener error:', error);
      }
    });
  }

  async fetchRepositories(token: string, forceRefresh = false, userId?: string): Promise<void> {
    // üö® CRITICAL DEBUG: Log token information (safely)
    console.log('üîë SINGLETON: Starting fetch with token:', {
      hasToken: !!token,
      tokenLength: token?.length,
      tokenPrefix: token?.substring(0, 7) + '...',
      forceRefresh
    });

    // Validate token before proceeding ‚Äì if missing, try public-repo fallback instead of hard-erroring
    if (!token || token.trim() === '') {
      console.warn(' SINGLETON: No GitHub token ‚Äì attempting public-repo fallback');

      // If we have the GitHub username cached we can still show public repos (read-only)
      if (typeof window !== 'undefined') {
        const cachedUsername =
          (userId ? localStorage.getItem(`github_username_${userId}`) : null) ||
          localStorage.getItem('github_username');

        if (cachedUsername) {
          try {
            const res = await fetch(`https://api.github.com/users/${cachedUsername}/repos?per_page=100`);
            if (res.ok) {
              this.repositories = await res.json();
              console.log(` SINGLETON: Loaded public repos for ${cachedUsername} (count: ${this.repositories.length})`);
              this.saveToCache(userId);
              this.notifyListeners();
              return; // Success ‚Äì no token required
            }
            console.error(' SINGLETON: Public-repo fetch failed', res.status);
          } catch (publicErr) {
            console.error(' SINGLETON: Exception during public-repo fetch', publicErr);
          }
        }
      }

      // Still no data ‚Äì propagate original error
      throw new Error('No GitHub token available for repository access');
    }

    // IMPROVED UX: Always fetch fresh data unless explicitly using cache
    // Only skip if we have recent data (less than 5 minutes old) and not forced
    if (!forceRefresh && this.repositories.length > 0) {
      const timeSinceLastFetch = Date.now() - this.lastFetch;
      if (timeSinceLastFetch < 300000) { // 5 minutes
        console.log(' SINGLETON: Using recent data, INSTANT LOAD!');
        console.log('‚ö° SINGLETON: Using recent data, INSTANT LOAD!');
        return;
      } else {
        console.log('üîÑ SINGLETON: Data is stale, fetching fresh repositories...');
      }
    }

    // Prevent multiple simultaneous fetches
    if (this.isFetching) {
      console.log('‚è≥ SINGLETON: Fetch already in progress');
      return;
    }

    this.isFetching = true;
    this.loadingStartTime = Date.now();

    try {
      console.log('üöÄ SINGLETON: ULTRA-FAST FETCH STARTING...');

      // PARALLEL REQUESTS for maximum speed
      console.log('üåê SINGLETON: Making parallel GitHub API requests...');
      const [userRepos, starredRepos] = await Promise.allSettled([
        fetch("https://api.github.com/user/repos?sort=updated&per_page=50", {
          headers: {
            Authorization: `token ${token}`,
            Accept: "application/vnd.github.v3+json",
          },
        }),
        fetch("https://api.github.com/user/starred?per_page=20", {
          headers: {
            Authorization: `token ${token}`,
            Accept: "application/vnd.github.v3+json",
          },
        })
      ]);

      console.log('üåê SINGLETON: API requests completed:', {
        userReposStatus: userRepos.status,
        starredReposStatus: starredRepos.status
      });

      let repos: any[] = [];

      // Process user repos
      if (userRepos.status === 'fulfilled' && userRepos.value.ok) {
        const userReposData = await userRepos.value.json();
        repos = userReposData;

        // STREAMING: Notify as data arrives
        userReposData.forEach((repo: any, index: number) => {
          setTimeout(() => {
            this.notifyStreamingListeners(repo);
          }, index * 10); // Stagger for smooth streaming effect
        });
      }

      const fetchTime = Date.now() - this.loadingStartTime;

      console.log(`üöÄ ULTRA-FAST: Loaded ${repos.length} repositories in ${fetchTime}ms`);

      // PERFORMANCE METRICS
      if (fetchTime < 1000) {
        console.log('üèÜ PERFORMANCE: SUB-1-SECOND LOADING ACHIEVED!');
      } else if (fetchTime < 2000) {
        console.log('‚ö° PERFORMANCE: SUB-2-SECOND LOADING!');
      } else if (fetchTime < 3000) {
        console.log('‚úÖ PERFORMANCE: SUB-3-SECOND LOADING!');
      }

      this.repositories = repos;
      this.lastFetch = Date.now();
      this.isInitialized = true;
      this.saveToCache(userId);
      this.notifyListeners();

    } catch (error) {
      console.error('‚ùå SINGLETON: Fetch error:', error);

      // üö® CRITICAL DEBUG: Log detailed error information
      if (error instanceof Error) {
        console.error('‚ùå SINGLETON: Error details:', {
          message: error.message,
          name: error.name,
          stack: error.stack
        });
      }

      // Check if it's a token-related error
      if (error.message?.includes('401') || error.message?.includes('Unauthorized')) {
        console.error('üîë SINGLETON: Token appears to be invalid or expired');
        // Clear cached data for invalid tokens
        this.clearCache();
      }

      // Fallback to cached data if available
      if (this.repositories.length > 0) {
        console.log('üîÑ SINGLETON: Using cached data as fallback');
        this.notifyListeners();
      } else {
        // If no cached data, ensure listeners are still notified with empty array
        console.log('üîÑ SINGLETON: No cached data available, notifying with empty state');
        this.notifyListeners();
      }
      throw error;
    } finally {
      this.isFetching = false;
      console.log('üîÑ SINGLETON: Fetch operation completed, isFetching reset to false');
    }
  }

  isDataAvailable(): boolean {
    return this.repositories.length > 0;
  }

  getLastFetchTime(): number {
    return this.lastFetch;
  }

  // üéØ YOUTUBE-STYLE: Enhanced background sync with long-term resilience
  async backgroundSync(token: string): Promise<void> {
    console.log('üîÑ SINGLETON: Background sync starting...');
    
    try {
      // Test token validity first before attempting sync
      const tokenTest = await fetch("https://api.github.com/user", {
        headers: {
          Authorization: `token ${token}`,
          Accept: "application/vnd.github.v3+json",
        },
      });

      if (!tokenTest.ok) {
        if (tokenTest.status === 401) {
          console.error('üîë SINGLETON: GitHub token expired or invalid');
          // Clear cached data if token is invalid
          this.clearCache();
          throw new Error('GitHub token expired');
        }
        throw new Error(`GitHub API error: ${tokenTest.status}`);
      }

      // If we have stale data (older than 1 hour), force refresh
      const timeSinceLastFetch = Date.now() - this.lastFetch;
      const forceRefresh = timeSinceLastFetch > 3600000; // 1 hour
      
      if (forceRefresh) {
        console.log('üîÑ SINGLETON: Data is very stale (>1h), forcing refresh...');
      }

      await this.fetchRepositories(token, forceRefresh);
      console.log('‚úÖ SINGLETON: Background sync completed successfully');
    } catch (error) {
      console.error('‚ùå SINGLETON: Background sync failed:', error);
      
      // If sync fails but we have cached data, keep using it
      if (this.repositories.length > 0) {
        console.log('üîÑ SINGLETON: Using cached data due to sync failure');
        this.notifyListeners();
      }
    }
  }

  // Clear cache method for token expiry scenarios
  private clearCache(userId?: string): void {
    if (typeof window !== 'undefined') {
      if (userId) {
        localStorage.removeItem(`github_repositories_${userId}`);
        localStorage.removeItem(`github_repositories_time_${userId}`);
        console.log(`üóëÔ∏è SINGLETON: User-specific cache cleared for ${userId}`);
      } else {
        localStorage.removeItem('github_repositories');
        localStorage.removeItem('github_repositories_time');
        console.log('üóëÔ∏è SINGLETON: Global cache cleared due to token issues');
      }
    }
  }
}

export const repositoryManager = RepositoryManager.getInstance();

</code>

lib\repository-sorter.ts:
<code>
// Repository Sorting and Complexity Analysis Engine
export interface Repository {
  id: number;
  name: string;
  full_name: string;
  description?: string;
  language?: string;
  stargazers_count: number;
  forks_count: number;
  updated_at: string;
  created_at: string;
  html_url: string;
  size?: number;
  open_issues_count?: number;
  has_issues?: boolean;
  has_projects?: boolean;
  has_wiki?: boolean;
  archived?: boolean;
  disabled?: boolean;
  pushed_at?: string;
  complexity?: RepositoryComplexity;
  topics?: string[];
  private?: boolean;
  owner?: {
    login: string;
    avatar_url: string;
  };
}

export interface RepositoryComplexity {
  score: number;
  level: 'Simple' | 'Intermediate' | 'Complex' | 'Advanced';
  factors: string[];
  reasoning: string;
}

export interface CVRecommendation {
  title: string;
  description: string;
  repositories?: Repository[];
  priority: number;
}

export class RepositorySorter {
  // üßÆ CALCULATE REPOSITORY COMPLEXITY
  static calculateComplexity(repo: Repository): RepositoryComplexity {
    let score = 0;
    const factors: string[] = [];

    // Language complexity scoring
    const languageScores: Record<string, number> = {
      'TypeScript': 4,
      'JavaScript': 3,
      'Python': 3,
      'Java': 4,
      'C++': 5,
      'C#': 4,
      'Go': 4,
      'Rust': 5,
      'Swift': 4,
      'Kotlin': 4,
      'PHP': 2,
      'Ruby': 3,
      'HTML': 1,
      'CSS': 1,
      'Shell': 2,
      'Dockerfile': 2,
    };

    if (repo.language) {
      const langScore = languageScores[repo.language] || 2;
      score += langScore;
      factors.push(`${repo.language} (${langScore}pts)`);
    }

    // Repository size and activity
    const size = repo.size || 0;
    if (size > 10000) {
      score += 3;
      factors.push('Large codebase (3pts)');
    } else if (size > 1000) {
      score += 2;
      factors.push('Medium codebase (2pts)');
    } else if (size > 100) {
      score += 1;
      factors.push('Small codebase (1pt)');
    }

    // Community engagement
    const stars = repo.stargazers_count || 0;
    const forks = repo.forks_count || 0;
    if (stars > 50 || forks > 10) {
      score += 2;
      factors.push('High engagement (2pts)');
    } else if (stars > 10 || forks > 2) {
      score += 1;
      factors.push('Some engagement (1pt)');
    }

    // Documentation and features
    if (repo.has_wiki) {
      score += 1;
      factors.push('Has wiki (1pt)');
    }
    if (repo.has_issues && (repo.open_issues_count || 0) > 0) {
      score += 1;
      factors.push('Active issues (1pt)');
    }
    if (repo.has_projects) {
      score += 1;
      factors.push('Project boards (1pt)');
    }

    // Topics/tags indicate thoughtful organization
    if (repo.topics && repo.topics.length > 0) {
      score += Math.min(repo.topics.length, 3);
      factors.push(`${repo.topics.length} topics (${Math.min(repo.topics.length, 3)}pts)`);
    }

    // Recent activity
    const lastUpdate = new Date(repo.updated_at);
    const monthsAgo = (Date.now() - lastUpdate.getTime()) / (1000 * 60 * 60 * 24 * 30);
    if (monthsAgo < 1) {
      score += 2;
      factors.push('Very recent activity (2pts)');
    } else if (monthsAgo < 6) {
      score += 1;
      factors.push('Recent activity (1pt)');
    }

    // Determine complexity level
    let level: RepositoryComplexity['level'];
    let reasoning: string;

    if (score <= 4) {
      level = 'Simple';
      reasoning = 'Basic project with minimal complexity and dependencies';
    } else if (score <= 8) {
      level = 'Intermediate';
      reasoning = 'Well-structured project with moderate complexity';
    } else if (score <= 12) {
      level = 'Complex';
      reasoning = 'Advanced project with multiple technologies and features';
    } else {
      level = 'Advanced';
      reasoning = 'Highly sophisticated project with extensive features and engagement';
    }

    return {
      score,
      level,
      factors,
      reasoning,
    };
  }

  // üìä SORT BY COMPLEXITY
  static sortByComplexity(repositories: Repository[], order: 'asc' | 'desc' = 'asc'): Repository[] {
    return repositories.sort((a, b) => {
      const complexityA = a.complexity || this.calculateComplexity(a);
      const complexityB = b.complexity || this.calculateComplexity(b);

      const scoreA = complexityA.score;
      const scoreB = complexityB.score;

      return order === 'asc' ? scoreA - scoreB : scoreB - scoreA;
    });
  }

  // üíº SORT FOR CV OPTIMIZATION
  static sortForCV(repositories: Repository[]): Repository[] {
    return repositories.sort((a, b) => {
      const complexityA = a.complexity || this.calculateComplexity(a);
      const complexityB = b.complexity || this.calculateComplexity(b);

      // Primary: Complexity score (higher first for CV)
      const complexityDiff = complexityB.score - complexityA.score;
      if (complexityDiff !== 0) return complexityDiff;

      // Secondary: Recent activity
      const aDate = new Date(a.updated_at).getTime();
      const bDate = new Date(b.updated_at).getTime();
      const dateDiff = bDate - aDate;
      if (dateDiff !== 0) return dateDiff;

      // Tertiary: Community engagement
      const aEngagement = (a.stargazers_count || 0) + (a.forks_count || 0);
      const bEngagement = (b.stargazers_count || 0) + (b.forks_count || 0);
      return bEngagement - aEngagement;
    });
  }

  // üéØ GENERATE CV RECOMMENDATIONS
  static generateCVRecommendations(repositories: Repository[]): CVRecommendation[] {
    const recommendations: CVRecommendation[] = [];

    // Add complexity analysis to repositories
    const reposWithComplexity = repositories.map(repo => ({
      ...repo,
      complexity: repo.complexity || this.calculateComplexity(repo),
    }));

    // Top Complex Projects
    const complexProjects = reposWithComplexity
      .filter(repo => repo.complexity!.score >= 8)
      .sort((a, b) => b.complexity!.score - a.complexity!.score)
      .slice(0, 3);

    if (complexProjects.length > 0) {
      recommendations.push({
        title: '‚≠ê Showcase Projects (Lead with these)',
        description: 'Your most complex and impressive repositories that demonstrate advanced skills.',
        repositories: complexProjects,
        priority: 1,
      });
    }

    // Recent Active Projects
    const recentProjects = reposWithComplexity
      .filter(repo => {
        const monthsAgo = (Date.now() - new Date(repo.updated_at).getTime()) / (1000 * 60 * 60 * 24 * 30);
        return monthsAgo < 3 && repo.complexity!.score >= 4;
      })
      .sort((a, b) => new Date(b.updated_at).getTime() - new Date(a.updated_at).getTime())
      .slice(0, 3);

    if (recentProjects.length > 0) {
      recommendations.push({
        title: 'üöÄ Recent Work (Show current activity)',
        description: 'Recently updated projects that show you\'re actively coding.',
        repositories: recentProjects,
        priority: 2,
      });
    }

    // Well-Documented Projects
    const documentedProjects = reposWithComplexity
      .filter(repo => repo.has_wiki || repo.description || (repo.topics && repo.topics.length > 0))
      .sort((a, b) => b.complexity!.score - a.complexity!.score)
      .slice(0, 3);

    if (documentedProjects.length > 0) {
      recommendations.push({
        title: 'üìö Well-Documented Projects',
        description: 'Projects with good documentation that show your communication skills.',
        repositories: documentedProjects,
        priority: 3,
      });
    }

    return recommendations;
  }
}
</code>

lib\supabase.ts:
<code>
import { createBrowserClient } from "@supabase/ssr"

// Remove hardcoded values - require environment variables
const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL
const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY

if (!supabaseUrl || !supabaseAnonKey) {
  throw new Error('Missing required Supabase environment variables. Please set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY')
}

// üîß CRITICAL FIX: Use createBrowserClient for proper session persistence in Next.js
export const supabase = createBrowserClient(supabaseUrl, supabaseAnonKey)

// Database types based on our schema

export interface UserProfile {
  id: string
  github_username: string
  github_user_id: number
  github_pat_token?: string
  display_name?: string
  avatar_url?: string
  bio?: string
  goals?: string[]
  preferences: Record<string, any>
  created_at: string
  updated_at: string
}

export interface UserRepository {
  id: string
  user_id: string
  github_repo_id: number
  repo_data: GitHubRepository
  priority_order: number
  user_notes?: string
  ai_analysis?: RepositoryAnalysis
  is_featured: boolean
  created_at: string
  updated_at: string
}

export interface GitHubRepository {
  id: number
  name: string
  full_name: string
  description?: string
  language?: string
  stargazers_count: number
  forks_count: number
  updated_at: string
  created_at: string
  html_url: string
  clone_url: string
  default_branch: string
  topics: string[]
  private: boolean
  owner: {
    login: string
    avatar_url: string
  }
  // Additional fields from GitHub API
  size?: number
  open_issues_count?: number
  has_issues?: boolean
  has_projects?: boolean
  has_wiki?: boolean
  archived?: boolean
  disabled?: boolean
  pushed_at?: string
  // Custom fields for our app
  priority_order?: number
  user_notes?: string | null
  ai_analysis?: RepositoryAnalysis | null
  is_featured?: boolean
}

export interface RepositoryAnalysis {
  complexity_score: number
  tech_stack: string[]
  project_type: string
  completeness_score: number
  suggestions: string[]
  generated_at: string
}

export interface ChatSession {
  id: string
  user_id: string
  title?: string
  repository_id?: number // GitHub repository ID (bigint)
  messages?: ChatMessage[]
  context?: Record<string, any>
  created_at: string
  updated_at: string
}

export interface ChatMessage {
  id: string
  session_id?: string
  role: "user" | "assistant"
  content: string
  timestamp?: string
  created_at: string
  context?: {
    repository?: UserRepository
    action_type?: "analysis" | "suggestion" | "generation"
  }
}

export interface GeneratedContent {
  id: string
  user_id: string
  repository_id: string // This should be a UUID from the repositories table
  content_type: "readme" | "file" | "folder"
  content: Record<string, any>
  status: "draft" | "applied" | "rejected"
  github_commit_sha?: string
  created_at: string
}

// Database helper functions
export const createUserProfile = async (userData: {
  id: string
  github_username: string
  github_user_id: number
  display_name?: string
  avatar_url?: string
  bio?: string
}) => {
  const { data, error } = await supabase.from("user_profiles").insert([userData]).select().single()

  return { data, error }
}

export const getUserProfile = async (userId: string) => {
  const { data, error } = await supabase.from("user_profiles").select("*").eq("id", userId).single()

  return { data, error }
}

export const updateUserProfile = async (userId: string, updates: Partial<UserProfile>) => {
  const { data, error } = await supabase.from("user_profiles").update(updates).eq("id", userId).select().single()

  return { data, error }
}

export const getUserRepositories = async (userId: string) => {
  const { data, error } = await supabase
    .from("user_repositories")
    .select("*")
    .eq("user_id", userId)
    .order("priority_order", { ascending: true })

  return { data, error }
}

export const saveUserRepositories = async (
  repositories: Omit<UserRepository, "id" | "created_at" | "updated_at">[],
) => {
  const { data, error } = await supabase
    .from("user_repositories")
    .upsert(repositories, {
      onConflict: "user_id,github_repo_id",
      ignoreDuplicates: false,
    })
    .select()

  return { data, error }
}

export const updateRepositoryOrder = async (repositoryId: string, newOrder: number) => {
  const { data, error } = await supabase
    .from("user_repositories")
    .update({ priority_order: newOrder })
    .eq("id", repositoryId)
    .select()
    .single()

  return { data, error }
}

</code>

lib\utils.ts:
<code>
import { clsx, type ClassValue } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}

</code>

scripts\add-github-token-column.sql:
<code>
-- Add missing github_token column to user_profiles table
-- This fixes the profile loading issue where the account switcher gets stuck

-- Add github_token column if it doesn't exist
ALTER TABLE user_profiles 
ADD COLUMN IF NOT EXISTS github_token TEXT;

-- Add index for better performance on token lookups
CREATE INDEX IF NOT EXISTS idx_user_profiles_github_token 
ON user_profiles(github_token) 
WHERE github_token IS NOT NULL;

-- Update the table comment
COMMENT ON COLUMN user_profiles.github_token IS 'GitHub Personal Access Token for repository operations';

-- Verify the column was added
SELECT column_name, data_type, is_nullable 
FROM information_schema.columns 
WHERE table_name = 'user_profiles' 
AND column_name = 'github_token';

</code>

tests\oauth-token-persistence.spec.js:
<code>
const { test, expect } = require('@playwright/test');

test.describe('GitHub OAuth Token Persistence Test', () => {
  test('should persist GitHub token after sign out and re-login', async ({ page }) => {
    console.log('üéØ Starting GitHub OAuth Token Persistence Test...');
    
    // Navigate to production app
    await page.goto('https://neatrepo.vercel.app');
    await page.waitForLoadState('networkidle');
    
    console.log('‚úÖ Navigated to NeatRepo');
    
    // Take initial screenshot
    await page.screenshot({ path: 'test-results/01-landing-page.png' });
    
    // Click "Get Started" or "Sign In" button to open auth forms
    const getStartedButton = page.locator('button:has-text("Get Started")').first();
    const signInButton = page.locator('button:has-text("Sign In")').first();
    
    if (await getStartedButton.isVisible()) {
      await getStartedButton.click();
      console.log('‚úÖ Clicked Get Started button');
    } else if (await signInButton.isVisible()) {
      await signInButton.click();
      console.log('‚úÖ Clicked Sign In button');
    } else {
      throw new Error('‚ùå No auth button found');
    }
    
    await page.waitForTimeout(1000);
    await page.screenshot({ path: 'test-results/02-auth-modal-opened.png' });
    
    // Look for GitHub OAuth button
    const githubButton = page.locator('button:has-text("Continue with GitHub")');
    await expect(githubButton).toBeVisible();
    console.log('‚úÖ GitHub OAuth button found');
    
    // Click GitHub OAuth button
    await githubButton.click();
    console.log('‚úÖ Clicked GitHub OAuth button');
    
    // Wait for GitHub OAuth redirect or popup
    await page.waitForTimeout(3000);
    
    // Check if we're redirected to GitHub or if there's an error
    const currentUrl = page.url();
    console.log(`üîó Current URL: ${currentUrl}`);
    
    if (currentUrl.includes('github.com')) {
      console.log('üîÑ Redirected to GitHub OAuth - Manual intervention needed');
      console.log('‚ö†Ô∏è  This test requires manual GitHub login or pre-configured test account');
      
      // Wait for manual login (in real scenario, we'd use test credentials)
      await page.waitForTimeout(30000);
      
    } else if (currentUrl.includes('dashboard')) {
      console.log('‚úÖ Already logged in - redirected to dashboard');
      
    } else {
      console.log('‚ö†Ô∏è  Unexpected redirect or error occurred');
      await page.screenshot({ path: 'test-results/03-unexpected-state.png' });
    }
    
    // Check if we're on dashboard
    await page.waitForTimeout(2000);
    const finalUrl = page.url();
    console.log(`üéØ Final URL: ${finalUrl}`);
    
    if (finalUrl.includes('dashboard')) {
      console.log('‚úÖ Successfully reached dashboard');
      await page.screenshot({ path: 'test-results/04-dashboard-reached.png' });
      
      // Check for GitHub token popup
      const tokenPopup = page.locator('[data-testid="github-token-popup"]');
      const isTokenPopupVisible = await tokenPopup.isVisible().catch(() => false);
      
      if (isTokenPopupVisible) {
        console.log('üìù GitHub token popup is visible (first time setup)');
        await page.screenshot({ path: 'test-results/05-token-popup-first-time.png' });
        
        // For testing, we'll dismiss the popup to simulate token setup
        const dismissButton = page.locator('button:has-text("Dismiss")');
        if (await dismissButton.isVisible()) {
          await dismissButton.click();
          console.log('‚úÖ Dismissed token popup for testing');
        }
      } else {
        console.log('‚úÖ No GitHub token popup (token already exists)');
      }
      
      // Now test the critical part: Sign out and re-login
      console.log('üîÑ Testing sign out and re-login...');
      
      // Find and click sign out button
      const signOutButton = page.locator('button:has-text("Sign Out")');
      await expect(signOutButton).toBeVisible();
      await signOutButton.click();
      console.log('‚úÖ Clicked Sign Out button');
      
      // Wait for redirect to homepage
      await page.waitForTimeout(3000);
      await page.screenshot({ path: 'test-results/06-after-signout.png' });
      
      // Verify we're back on homepage
      const homeUrl = page.url();
      console.log(`üè† After sign out URL: ${homeUrl}`);
      
      // Now re-login with GitHub OAuth
      console.log('üîÑ Re-logging in with GitHub OAuth...');
      
      // Click auth button again
      if (await getStartedButton.isVisible()) {
        await getStartedButton.click();
      } else if (await signInButton.isVisible()) {
        await signInButton.click();
      }
      
      await page.waitForTimeout(1000);
      
      // Click GitHub OAuth again
      const githubButtonSecond = page.locator('button:has-text("Continue with GitHub")');
      await githubButtonSecond.click();
      console.log('‚úÖ Clicked GitHub OAuth button (second time)');
      
      // Wait for auth flow
      await page.waitForTimeout(5000);
      
      // Check if we reach dashboard again
      const secondLoginUrl = page.url();
      console.log(`üéØ Second login URL: ${secondLoginUrl}`);
      
      if (secondLoginUrl.includes('dashboard')) {
        console.log('‚úÖ Successfully re-logged in to dashboard');
        await page.screenshot({ path: 'test-results/07-dashboard-second-login.png' });
        
        // CRITICAL TEST: Check if GitHub token popup appears again
        await page.waitForTimeout(2000);
        const tokenPopupSecond = page.locator('[data-testid="github-token-popup"]');
        const isTokenPopupVisibleSecond = await tokenPopupSecond.isVisible().catch(() => false);
        
        if (isTokenPopupVisibleSecond) {
          console.log('‚ùå CRITICAL BUG: GitHub token popup appeared again after re-login!');
          console.log('üêõ This means token persistence is broken');
          await page.screenshot({ path: 'test-results/08-BUG-token-popup-reappeared.png' });
          
          // This is the bug we need to fix
          throw new Error('CRITICAL BUG: GitHub token popup should not appear for existing users');
          
        } else {
          console.log('‚úÖ PERFECT: No GitHub token popup on re-login');
          console.log('üéâ Token persistence is working correctly');
          await page.screenshot({ path: 'test-results/08-SUCCESS-no-popup-relogin.png' });
        }
        
      } else {
        console.log('‚ö†Ô∏è  Failed to reach dashboard on second login');
        await page.screenshot({ path: 'test-results/07-second-login-failed.png' });
      }
      
    } else {
      console.log('‚ùå Failed to reach dashboard on first login');
      await page.screenshot({ path: 'test-results/04-dashboard-not-reached.png' });
    }
    
    console.log('üèÅ GitHub OAuth Token Persistence Test completed');
  });
});

</code>



Can you help me debug this code?